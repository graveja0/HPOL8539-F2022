<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Advanced Program and Policy Evaluation (HPOL8539)</title>
<link>https://graveja0.github.io/HPOL8539-F2022/blog/index.html</link>
<atom:link href="https://graveja0.github.io/HPOL8539-F2022/blog/index.xml" rel="self" type="application/rss+xml"/>
<description></description>
<generator>quarto-1.0.36</generator>
<lastBuildDate>Tue, 13 Sep 2022 21:35:33 GMT</lastBuildDate>
<item>
  <title>A Practical Guide to Extended Difference-in-Differences</title>
  <link>https://graveja0.github.io/HPOL8539-F2022/blog/posts/extended-difference-in-differences.html</link>
  <description><![CDATA[ 



<div class="cell">

</div>
<div class="cell">

</div>
<div class="cell">

</div>
<section id="data-setup" class="level1 page-columns page-full">
<h1>Data Setup</h1>
<div class="column-screen">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/extended-difference-in-differences_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<section id="determine-if-there-is-a-never-treated-cohort" class="level3">
<h3 class="anchored" data-anchor-id="determine-if-there-is-a-never-treated-cohort">1. Determine if there is a never treated cohort</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">n_years <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">max</span>(df_<span class="sc" style="color: #5E5E5E;">$</span>year) <span class="sc" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">min</span>(df_<span class="sc" style="color: #5E5E5E;">$</span>year) <span class="sc" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">1</span></span>
<span id="cb1-2"></span>
<span id="cb1-3">never_treated <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb1-4">  df_ <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb1-5">  <span class="fu" style="color: #4758AB;">ungroup</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb1-6">  <span class="fu" style="color: #4758AB;">filter</span>(w_it<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">0</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb1-7">  <span class="fu" style="color: #4758AB;">group_by</span>(unit) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb1-8">  <span class="fu" style="color: #4758AB;">count</span>(year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb1-9">  <span class="fu" style="color: #4758AB;">summarise</span>(<span class="at" style="color: #657422;">n =</span> <span class="fu" style="color: #4758AB;">sum</span>(n)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb1-10">  <span class="fu" style="color: #4758AB;">ungroup</span>()  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb1-11">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">never_treated =</span> <span class="fu" style="color: #4758AB;">as.integer</span>(n<span class="sc" style="color: #5E5E5E;">==</span>n_years)) </span>
<span id="cb1-12"></span>
<span id="cb1-13">any_never_treated <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">max</span>(never_treated<span class="sc" style="color: #5E5E5E;">$</span>never_treated)<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span></span>
<span id="cb1-14">any_never_treated</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
<section id="identify-treatment-cohorts-d" class="level3">
<h3 class="anchored" data-anchor-id="identify-treatment-cohorts-d">2. Identify treatment cohorts (d*)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">d_star <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb3-2">  df_ <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;">select</span>(unit,year,w_it) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;">unique</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;">filter</span>(w_it<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-6">  <span class="fu" style="color: #4758AB;">group_by</span>(unit) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-7">  <span class="fu" style="color: #4758AB;">filter</span>(year<span class="sc" style="color: #5E5E5E;">==</span><span class="fu" style="color: #4758AB;">min</span>(year)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-8">  <span class="fu" style="color: #4758AB;">select</span>(<span class="sc" style="color: #5E5E5E;">-</span>w_it) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-9">  <span class="fu" style="color: #4758AB;">rename</span>(<span class="at" style="color: #657422;">d =</span> year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-10">  <span class="fu" style="color: #4758AB;">dummy_cols</span>(<span class="st" style="color: #20794D;">"d"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-11">  <span class="fu" style="color: #4758AB;">select</span>(unit,<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"d_"</span>))</span>
<span id="cb3-12"></span>
<span id="cb3-13">last_treatment_year <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">colnames</span>(d_star)[<span class="fu" style="color: #4758AB;">length</span>(<span class="fu" style="color: #4758AB;">colnames</span>(d_star))] <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"d_"</span>,<span class="st" style="color: #20794D;">""</span>,.) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(.))</span>
<span id="cb3-14"><span class="fu" style="color: #4758AB;">colnames</span>(d_star)[<span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "d_1989" "d_1998"</code></pre>
</div>
</div>
</section>
<section id="identify-all-post-treatment-years" class="level3">
<h3 class="anchored" data-anchor-id="identify-all-post-treatment-years">3. Identify All Post-Treatment Years</h3>
<p>If all groups are eventually treated, drop observations that occur on or after the last treatment date. This group has no untreated comparison group. Moreover, after this group is treated, it should not be utilized as a comparison group for the earlier treated cohorts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">f_star <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb5-2">   <span class="fu" style="color: #4758AB;">with</span>(df_,<span class="fu" style="color: #4758AB;">table</span>(year,w_it)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">data.frame</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb5-3">   <span class="fu" style="color: #4758AB;">filter</span>(w_it<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> Freq<span class="sc" style="color: #5E5E5E;">&gt;</span><span class="dv" style="color: #AD0000;">0</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb5-4">   <span class="fu" style="color: #4758AB;">select</span>(<span class="at" style="color: #657422;">f_star =</span> year)</span>
<span id="cb5-5"></span>
<span id="cb5-6"><span class="cf" style="color: #003B4F;">if</span> (<span class="sc" style="color: #5E5E5E;">!</span>any_never_treated) {</span>
<span id="cb5-7">  f_star <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb5-8">    f_star <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb5-9">    <span class="fu" style="color: #4758AB;">filter</span>(<span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(f_star)) <span class="sc" style="color: #5E5E5E;">&lt;</span> last_treatment_year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb5-10">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">f_star =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(f_star))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb5-11">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">f_star =</span> <span class="fu" style="color: #4758AB;">factor</span>(f_star))</span>
<span id="cb5-12">}</span></code></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">  </th>
   <th style="text-align:left;">  </th>
   <th style="text-align:left;">  </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> f_star_1980 </td>
   <td style="text-align:left;"> f_star_1992 </td>
   <td style="text-align:left;"> f_star_2004 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_star_1981 </td>
   <td style="text-align:left;"> f_star_1993 </td>
   <td style="text-align:left;"> f_star_2005 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_star_1982 </td>
   <td style="text-align:left;"> f_star_1994 </td>
   <td style="text-align:left;"> f_star_2006 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_star_1983 </td>
   <td style="text-align:left;"> f_star_1995 </td>
   <td style="text-align:left;"> f_star_2007 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_star_1984 </td>
   <td style="text-align:left;"> f_star_1996 </td>
   <td style="text-align:left;"> f_star_2008 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_star_1985 </td>
   <td style="text-align:left;"> f_star_1997 </td>
   <td style="text-align:left;"> f_star_2009 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_star_1986 </td>
   <td style="text-align:left;"> f_star_1998 </td>
   <td style="text-align:left;"> f_star_2010 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_star_1987 </td>
   <td style="text-align:left;"> f_star_1999 </td>
   <td style="text-align:left;"> f_star_2011 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_star_1988 </td>
   <td style="text-align:left;"> f_star_2000 </td>
   <td style="text-align:left;"> f_star_2012 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_star_1989 </td>
   <td style="text-align:left;"> f_star_2001 </td>
   <td style="text-align:left;"> f_star_2013 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_star_1990 </td>
   <td style="text-align:left;"> f_star_2002 </td>
   <td style="text-align:left;"> f_star_2014 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_star_1991 </td>
   <td style="text-align:left;"> f_star_2003 </td>
   <td style="text-align:left;"> f_star_2015 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</section>
<section id="define-all-cohort-post-treatment-interactions" class="level3">
<h3 class="anchored" data-anchor-id="define-all-cohort-post-treatment-interactions">4. Define all cohort * post-treatment interactions</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">cohort_year_interactions <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;">crossing</span>(<span class="at" style="color: #657422;">d =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"d_"</span>,<span class="st" style="color: #20794D;">""</span>,<span class="fu" style="color: #4758AB;">grep</span>(<span class="st" style="color: #20794D;">"d_"</span>,<span class="fu" style="color: #4758AB;">colnames</span>(d_star),<span class="at" style="color: #657422;">value=</span><span class="cn" style="color: #8f5902;">TRUE</span>))),<span class="at" style="color: #657422;">f =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(f_star<span class="sc" style="color: #5E5E5E;">$</span>f_star))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">value =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(f<span class="sc" style="color: #5E5E5E;">&gt;=</span>d)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">f =</span> <span class="fu" style="color: #4758AB;">paste0</span>(<span class="st" style="color: #20794D;">"f_"</span>,f)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">d =</span> <span class="fu" style="color: #4758AB;">paste0</span>(<span class="st" style="color: #20794D;">"d_"</span>,d)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-6">  <span class="fu" style="color: #4758AB;">spread</span>(f,value) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-7">  <span class="fu" style="color: #4758AB;">gather</span>(f,value,<span class="sc" style="color: #5E5E5E;">-</span>d) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-8">  <span class="fu" style="color: #4758AB;">filter</span>(value<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-9">  <span class="fu" style="color: #4758AB;">arrange</span>(d,f) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-10">  <span class="fu" style="color: #4758AB;">select</span>(<span class="sc" style="color: #5E5E5E;">-</span>value) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-11">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">i =</span> <span class="fu" style="color: #4758AB;">paste0</span>(<span class="st" style="color: #20794D;">"I("</span>,d,<span class="st" style="color: #20794D;">"*"</span>,f,<span class="st" style="color: #20794D;">")"</span>))</span>
<span id="cb6-12"></span>
<span id="cb6-13"><span class="cf" style="color: #003B4F;">if</span> (any_never_treated) {</span>
<span id="cb6-14">  df_ <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb6-15">    df_ <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-16">    <span class="fu" style="color: #4758AB;">select</span>(unit,year,y_it,<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"x_i"</span>),w_it) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-17">    <span class="fu" style="color: #4758AB;">left_join</span>(d_star,<span class="st" style="color: #20794D;">"unit"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-18">    <span class="fu" style="color: #4758AB;">mutate_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"d_"</span>)),<span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">ifelse</span>(<span class="fu" style="color: #4758AB;">is.na</span>(.),<span class="dv" style="color: #AD0000;">0</span>,.)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-19">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">f =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(year <span class="sc" style="color: #5E5E5E;">%in%</span> f_star<span class="sc" style="color: #5E5E5E;">$</span>f_star,year,<span class="cn" style="color: #8f5902;">NA</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-20">    <span class="fu" style="color: #4758AB;">dummy_cols</span>(<span class="st" style="color: #20794D;">"f"</span>,<span class="at" style="color: #657422;">ignore_na=</span><span class="cn" style="color: #8f5902;">TRUE</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-21">    <span class="fu" style="color: #4758AB;">mutate_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"f_"</span>)),<span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">ifelse</span>(<span class="fu" style="color: #4758AB;">is.na</span>(.),<span class="dv" style="color: #AD0000;">0</span>,.))  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-22">    <span class="fu" style="color: #4758AB;">dummy_cols</span>(<span class="st" style="color: #20794D;">"year"</span>,<span class="at" style="color: #657422;">ignore_na=</span><span class="cn" style="color: #8f5902;">TRUE</span>)</span>
<span id="cb6-23">} <span class="cf" style="color: #003B4F;">else</span> {</span>
<span id="cb6-24">   df_ <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb6-25">    df_ <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-26">    <span class="fu" style="color: #4758AB;">filter</span>(year <span class="sc" style="color: #5E5E5E;">&lt;</span> last_treatment_year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-27">    <span class="fu" style="color: #4758AB;">select</span>(unit,year,y_it,<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"x_i"</span>),w_it) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-28">    <span class="fu" style="color: #4758AB;">left_join</span>(d_star,<span class="st" style="color: #20794D;">"unit"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-29">    <span class="fu" style="color: #4758AB;">mutate_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"d_"</span>)),<span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">ifelse</span>(<span class="fu" style="color: #4758AB;">is.na</span>(.),<span class="dv" style="color: #AD0000;">0</span>,.)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-30">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">f =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(year <span class="sc" style="color: #5E5E5E;">%in%</span> f_star<span class="sc" style="color: #5E5E5E;">$</span>f_star,year,<span class="cn" style="color: #8f5902;">NA</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-31">    <span class="fu" style="color: #4758AB;">dummy_cols</span>(<span class="st" style="color: #20794D;">"f"</span>,<span class="at" style="color: #657422;">ignore_na=</span><span class="cn" style="color: #8f5902;">TRUE</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-32">    <span class="fu" style="color: #4758AB;">mutate_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"f_"</span>)),<span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">ifelse</span>(<span class="fu" style="color: #4758AB;">is.na</span>(.),<span class="dv" style="color: #AD0000;">0</span>,.))  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-33">    <span class="fu" style="color: #4758AB;">dummy_cols</span>(<span class="st" style="color: #20794D;">"year"</span>,<span class="at" style="color: #657422;">ignore_na=</span><span class="cn" style="color: #8f5902;">TRUE</span>)</span>
<span id="cb6-34">}</span></code></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> f </th>
   <th style="text-align:left;"> d_1989 </th>
   <th style="text-align:left;"> d_1998 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> f_1989 </td>
   <td style="text-align:left;"> Y </td>
   <td style="text-align:left;"> - </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_1990 </td>
   <td style="text-align:left;"> Y </td>
   <td style="text-align:left;"> - </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_1991 </td>
   <td style="text-align:left;"> Y </td>
   <td style="text-align:left;"> - </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_1992 </td>
   <td style="text-align:left;"> Y </td>
   <td style="text-align:left;"> - </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_1993 </td>
   <td style="text-align:left;"> Y </td>
   <td style="text-align:left;"> - </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_1994 </td>
   <td style="text-align:left;"> Y </td>
   <td style="text-align:left;"> - </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_1995 </td>
   <td style="text-align:left;"> Y </td>
   <td style="text-align:left;"> - </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_1996 </td>
   <td style="text-align:left;"> Y </td>
   <td style="text-align:left;"> - </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_1997 </td>
   <td style="text-align:left;"> Y </td>
   <td style="text-align:left;"> - </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_1998 </td>
   <td style="text-align:left;"> Y </td>
   <td style="text-align:left;"> Y </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_1999 </td>
   <td style="text-align:left;"> Y </td>
   <td style="text-align:left;"> Y </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_2000 </td>
   <td style="text-align:left;"> Y </td>
   <td style="text-align:left;"> Y </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_2001 </td>
   <td style="text-align:left;"> Y </td>
   <td style="text-align:left;"> Y </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_2002 </td>
   <td style="text-align:left;"> Y </td>
   <td style="text-align:left;"> Y </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_2003 </td>
   <td style="text-align:left;"> Y </td>
   <td style="text-align:left;"> Y </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_2004 </td>
   <td style="text-align:left;"> Y </td>
   <td style="text-align:left;"> Y </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_2005 </td>
   <td style="text-align:left;"> Y </td>
   <td style="text-align:left;"> Y </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_2006 </td>
   <td style="text-align:left;"> Y </td>
   <td style="text-align:left;"> Y </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_2007 </td>
   <td style="text-align:left;"> Y </td>
   <td style="text-align:left;"> Y </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_2008 </td>
   <td style="text-align:left;"> Y </td>
   <td style="text-align:left;"> Y </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_2009 </td>
   <td style="text-align:left;"> Y </td>
   <td style="text-align:left;"> Y </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_2010 </td>
   <td style="text-align:left;"> Y </td>
   <td style="text-align:left;"> Y </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_2011 </td>
   <td style="text-align:left;"> Y </td>
   <td style="text-align:left;"> Y </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_2012 </td>
   <td style="text-align:left;"> Y </td>
   <td style="text-align:left;"> Y </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_2013 </td>
   <td style="text-align:left;"> Y </td>
   <td style="text-align:left;"> Y </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_2014 </td>
   <td style="text-align:left;"> Y </td>
   <td style="text-align:left;"> Y </td>
  </tr>
  <tr>
   <td style="text-align:left;"> f_2015 </td>
   <td style="text-align:left;"> Y </td>
   <td style="text-align:left;"> Y </td>
  </tr>
</tbody>
</table>

</div>
</div>
</section>
</section>
<section id="estimation" class="level1">
<h1>Estimation</h1>
<section id="common-treatment-timing" class="level2">
<h2 class="anchored" data-anchor-id="common-treatment-timing">Common Treatment Timing</h2>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 50%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>Estimation Formula</th>
<th>Fixed or Random Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Two-Way Fixed Effects</td>
<td><code>feols(I(w : f*) + factor(time)  | unit)</code></td>
<td>Unit Fixed Effect</td>
</tr>
<tr class="even">
<td>Pooled OLS</td>
<td><code>lm(I(w : f*) + factor(time) + d*)</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Two-Way Mundlak</td>
<td><code>lmer(I(w : f*) + factor(time) + d* + (1|unit)</code></td>
<td>Unit Random Effect</td>
</tr>
</tbody>
</table>
</section>
<section id="staggered-treatment-timing" class="level2">
<h2 class="anchored" data-anchor-id="staggered-treatment-timing">Staggered Treatment Timing</h2>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 50%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>Estimation Formula</th>
<th>Fixed or Random Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Two-Way Fixed Effects</td>
<td><code>feols(I(d* : f*) + factor(time)  | unit)</code></td>
<td>Unit Fixed Effect</td>
</tr>
<tr class="even">
<td>Pooled OLS</td>
<td><code>lm(I(d* : f*) + factor(time) + d*)</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Two-Way Mundlak</td>
<td><code>lmer(I(d* : f*) + factor(time) + d* + (1|unit)</code></td>
<td>Unit Random Effect</td>
</tr>
</tbody>
</table>
</section>
<section id="staggered-treatment-timing-with-covariates" class="level2">
<h2 class="anchored" data-anchor-id="staggered-treatment-timing-with-covariates">Staggered Treatment Timing with Covariate(s)</h2>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 50%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>Estimation Formula</th>
<th>Fixed or Random Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Two-Way Fixed Effects</td>
<td><code>feols(I(w : d* : f*) + I(w : d* : f* : x_dm_d*) + factor(time) + I(factor(time) * x_dm_d*) | unit)</code></td>
<td>Unit Fixed Effect</td>
</tr>
<tr class="even">
<td>Pooled OLS</td>
<td><code>lm(I(w : d* : f*) + I(w: d* : f* : x_dm_d*) + factor(time) + I(factor(time) : x_dm_d*) + d* + x + I(d* : x_dm_d*))</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Two-Way Mundlak</td>
<td><code>lmer(I(w : d* : f*) + I(w: d* : f* : x_dm_d*) + factor(time) + I(factor(time) : x_dm_d*) + d* +  x + I(d* : x_dm_d*) + (1|unit)</code></td>
<td>Unit Random Effect</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">ff_twfe <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">as.formula</span>(<span class="fu" style="color: #4758AB;">paste0</span>(<span class="st" style="color: #20794D;">"y_it ~"</span>,<span class="fu" style="color: #4758AB;">paste0</span>(cohort_year_interactions<span class="sc" style="color: #5E5E5E;">$</span>i,<span class="at" style="color: #657422;">collapse=</span><span class="st" style="color: #20794D;">"+"</span>),<span class="st" style="color: #20794D;">"+ factor(year) | unit"</span>))</span>
<span id="cb7-2">fit_twfe <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">feols</span>(ff_twfe, <span class="at" style="color: #657422;">data =</span> df_)</span>
<span id="cb7-3"></span>
<span id="cb7-4">ff_pols <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">as.formula</span>(<span class="fu" style="color: #4758AB;">paste0</span>(<span class="st" style="color: #20794D;">"y_it ~"</span>,<span class="fu" style="color: #4758AB;">paste0</span>(cohort_year_interactions<span class="sc" style="color: #5E5E5E;">$</span>i,<span class="at" style="color: #657422;">collapse=</span><span class="st" style="color: #20794D;">"+"</span>),<span class="st" style="color: #20794D;">"+"</span>,<span class="fu" style="color: #4758AB;">paste0</span>(<span class="fu" style="color: #4758AB;">grep</span>(<span class="st" style="color: #20794D;">"^d_"</span>,<span class="fu" style="color: #4758AB;">colnames</span>(df_), <span class="at" style="color: #657422;">value=</span><span class="cn" style="color: #8f5902;">TRUE</span>),<span class="at" style="color: #657422;">collapse=</span><span class="st" style="color: #20794D;">"+"</span>),<span class="st" style="color: #20794D;">"+ factor(year)"</span>))</span>
<span id="cb7-5">fit_pols <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">lm</span>(ff_pols,<span class="at" style="color: #657422;">data =</span> df_)</span>
<span id="cb7-6"></span>
<span id="cb7-7">ff_re <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">as.formula</span>(<span class="fu" style="color: #4758AB;">paste0</span>(<span class="st" style="color: #20794D;">"y_it ~"</span>,<span class="fu" style="color: #4758AB;">paste0</span>(cohort_year_interactions<span class="sc" style="color: #5E5E5E;">$</span>i,<span class="at" style="color: #657422;">collapse=</span><span class="st" style="color: #20794D;">"+"</span>),<span class="st" style="color: #20794D;">"+"</span>,<span class="fu" style="color: #4758AB;">paste0</span>(<span class="fu" style="color: #4758AB;">grep</span>(<span class="st" style="color: #20794D;">"^d_"</span>,<span class="fu" style="color: #4758AB;">colnames</span>(df_), <span class="at" style="color: #657422;">value=</span><span class="cn" style="color: #8f5902;">TRUE</span>),<span class="at" style="color: #657422;">collapse=</span><span class="st" style="color: #20794D;">"+"</span>),<span class="st" style="color: #20794D;">"+ factor(year) + (1| unit)"</span>))</span>
<span id="cb7-8">fit_re <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">lmer</span>(ff_re, <span class="at" style="color: #657422;">data =</span> df_)</span></code></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">

<div id="jtineofiii" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#jtineofiii .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#jtineofiii .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jtineofiii .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#jtineofiii .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#jtineofiii .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jtineofiii .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jtineofiii .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#jtineofiii .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#jtineofiii .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#jtineofiii .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#jtineofiii .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#jtineofiii .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#jtineofiii .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#jtineofiii .gt_from_md > :first-child {
  margin-top: 0;
}

#jtineofiii .gt_from_md > :last-child {
  margin-bottom: 0;
}

#jtineofiii .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#jtineofiii .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#jtineofiii .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#jtineofiii .gt_row_group_first td {
  border-top-width: 2px;
}

#jtineofiii .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jtineofiii .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#jtineofiii .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#jtineofiii .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jtineofiii .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jtineofiii .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#jtineofiii .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#jtineofiii .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jtineofiii .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jtineofiii .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#jtineofiii .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jtineofiii .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#jtineofiii .gt_left {
  text-align: left;
}

#jtineofiii .gt_center {
  text-align: center;
}

#jtineofiii .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#jtineofiii .gt_font_normal {
  font-weight: normal;
}

#jtineofiii .gt_font_bold {
  font-weight: bold;
}

#jtineofiii .gt_font_italic {
  font-style: italic;
}

#jtineofiii .gt_super {
  font-size: 65%;
}

#jtineofiii .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#jtineofiii .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#jtineofiii .gt_indent_1 {
  text-indent: 5px;
}

#jtineofiii .gt_indent_2 {
  text-indent: 10px;
}

#jtineofiii .gt_indent_3 {
  text-indent: 15px;
}

#jtineofiii .gt_indent_4 {
  text-indent: 20px;
}

#jtineofiii .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Estimator</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Regression Call</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">TWFE</td>
<td class="gt_row gt_left">feols(y_it ~ I(d_1989 * f_1989) + I(d_1989 * f_1990) + I(d_1989 * f_1991) +      I(d_1989 * f_1992) + I(d_1989 * f_1993) + I(d_1989 * f_1994) +      I(d_1989 * f_1995) + I(d_1989 * f_1996) + I(d_1989 * f_1997) +      I(d_1989 * f_1998) + I(d_1989 * f_1999) + I(d_1989 * f_2000) +      I(d_1989 * f_2001) + I(d_1989 * f_2002) + I(d_1989 * f_2003) +      I(d_1989 * f_2004) + I(d_1989 * f_2005) + I(d_1989 * f_2006) +      I(d_1989 * f_2007) + I(d_1989 * f_2008) + I(d_1989 * f_2009) +      I(d_1989 * f_2010) + I(d_1989 * f_2011) + I(d_1989 * f_2012) +      I(d_1989 * f_2013) + I(d_1989 * f_2014) + I(d_1989 * f_2015) +      I(d_1998 * f_1998) + I(d_1998 * f_1999) + I(d_1998 * f_2000) +      I(d_1998 * f_2001) + I(d_1998 * f_2002) + I(d_1998 * f_2003) +      I(d_1998 * f_2004) + I(d_1998 * f_2005) + I(d_1998 * f_2006) +      I(d_1998 * f_2007) + I(d_1998 * f_2008) + I(d_1998 * f_2009) +      I(d_1998 * f_2010) + I(d_1998 * f_2011) + I(d_1998 * f_2012) +      I(d_1998 * f_2013) + I(d_1998 * f_2014) + I(d_1998 * f_2015) +      factor(year) | unit, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">POLS</td>
<td class="gt_row gt_left">lm(y_it ~ I(d_1989 * f_1989) + I(d_1989 * f_1990) + I(d_1989 * f_1991) +      I(d_1989 * f_1992) + I(d_1989 * f_1993) + I(d_1989 * f_1994) +      I(d_1989 * f_1995) + I(d_1989 * f_1996) + I(d_1989 * f_1997) +      I(d_1989 * f_1998) + I(d_1989 * f_1999) + I(d_1989 * f_2000) +      I(d_1989 * f_2001) + I(d_1989 * f_2002) + I(d_1989 * f_2003) +      I(d_1989 * f_2004) + I(d_1989 * f_2005) + I(d_1989 * f_2006) +      I(d_1989 * f_2007) + I(d_1989 * f_2008) + I(d_1989 * f_2009) +      I(d_1989 * f_2010) + I(d_1989 * f_2011) + I(d_1989 * f_2012) +      I(d_1989 * f_2013) + I(d_1989 * f_2014) + I(d_1989 * f_2015) +      I(d_1998 * f_1998) + I(d_1998 * f_1999) + I(d_1998 * f_2000) +      I(d_1998 * f_2001) + I(d_1998 * f_2002) + I(d_1998 * f_2003) +      I(d_1998 * f_2004) + I(d_1998 * f_2005) + I(d_1998 * f_2006) +      I(d_1998 * f_2007) + I(d_1998 * f_2008) + I(d_1998 * f_2009) +      I(d_1998 * f_2010) + I(d_1998 * f_2011) + I(d_1998 * f_2012) +      I(d_1998 * f_2013) + I(d_1998 * f_2014) + I(d_1998 * f_2015) +      d_1989 + d_1998 + factor(year), data = df_)</td></tr>
    <tr><td class="gt_row gt_left">TWM</td>
<td class="gt_row gt_left">lmer(y_it ~ I(d_1989 * f_1989) + I(d_1989 * f_1990) + I(d_1989 * f_1991) +      I(d_1989 * f_1992) + I(d_1989 * f_1993) + I(d_1989 * f_1994) +      I(d_1989 * f_1995) + I(d_1989 * f_1996) + I(d_1989 * f_1997) +      I(d_1989 * f_1998) + I(d_1989 * f_1999) + I(d_1989 * f_2000) +      I(d_1989 * f_2001) + I(d_1989 * f_2002) + I(d_1989 * f_2003) +      I(d_1989 * f_2004) + I(d_1989 * f_2005) + I(d_1989 * f_2006) +      I(d_1989 * f_2007) + I(d_1989 * f_2008) + I(d_1989 * f_2009) +      I(d_1989 * f_2010) + I(d_1989 * f_2011) + I(d_1989 * f_2012) +      I(d_1989 * f_2013) + I(d_1989 * f_2014) + I(d_1989 * f_2015) +      I(d_1998 * f_1998) + I(d_1998 * f_1999) + I(d_1998 * f_2000) +      I(d_1998 * f_2001) + I(d_1998 * f_2002) + I(d_1998 * f_2003) +      I(d_1998 * f_2004) + I(d_1998 * f_2005) + I(d_1998 * f_2006) +      I(d_1998 * f_2007) + I(d_1998 * f_2008) + I(d_1998 * f_2009) +      I(d_1998 * f_2010) + I(d_1998 * f_2011) + I(d_1998 * f_2012) +      I(d_1998 * f_2013) + I(d_1998 * f_2014) + I(d_1998 * f_2015) +      d_1989 + d_1998 + factor(year) + (1 | unit), data = df_)</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</section>
</section>
<section id="results" class="level1 page-columns page-full">
<h1>Results</h1>
<div class="cell">
<div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:right;"> Treatment Cohort </th>
   <th style="text-align:right;"> Year </th>
   <th style="text-align:right;"> POLS </th>
   <th style="text-align:right;"> E-TWFE </th>
   <th style="text-align:right;"> E-TWM </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 1989 </td>
   <td style="text-align:right;"> 1989 </td>
   <td style="text-align:right;"> 0.470 </td>
   <td style="text-align:right;"> 0.470 </td>
   <td style="text-align:right;"> 0.470 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1989 </td>
   <td style="text-align:right;"> 1990 </td>
   <td style="text-align:right;"> 0.981 </td>
   <td style="text-align:right;"> 0.981 </td>
   <td style="text-align:right;"> 0.981 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1989 </td>
   <td style="text-align:right;"> 1991 </td>
   <td style="text-align:right;"> 1.456 </td>
   <td style="text-align:right;"> 1.456 </td>
   <td style="text-align:right;"> 1.456 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1989 </td>
   <td style="text-align:right;"> 1992 </td>
   <td style="text-align:right;"> 1.925 </td>
   <td style="text-align:right;"> 1.925 </td>
   <td style="text-align:right;"> 1.925 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1989 </td>
   <td style="text-align:right;"> 1993 </td>
   <td style="text-align:right;"> 2.316 </td>
   <td style="text-align:right;"> 2.316 </td>
   <td style="text-align:right;"> 2.316 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1989 </td>
   <td style="text-align:right;"> 1994 </td>
   <td style="text-align:right;"> 2.992 </td>
   <td style="text-align:right;"> 2.992 </td>
   <td style="text-align:right;"> 2.992 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1989 </td>
   <td style="text-align:right;"> 1995 </td>
   <td style="text-align:right;"> 3.511 </td>
   <td style="text-align:right;"> 3.511 </td>
   <td style="text-align:right;"> 3.511 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1989 </td>
   <td style="text-align:right;"> 1996 </td>
   <td style="text-align:right;"> 3.906 </td>
   <td style="text-align:right;"> 3.906 </td>
   <td style="text-align:right;"> 3.906 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1989 </td>
   <td style="text-align:right;"> 1997 </td>
   <td style="text-align:right;"> 4.343 </td>
   <td style="text-align:right;"> 4.343 </td>
   <td style="text-align:right;"> 4.343 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1989 </td>
   <td style="text-align:right;"> 1998 </td>
   <td style="text-align:right;"> 4.899 </td>
   <td style="text-align:right;"> 4.899 </td>
   <td style="text-align:right;"> 4.899 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1989 </td>
   <td style="text-align:right;"> 1999 </td>
   <td style="text-align:right;"> 5.446 </td>
   <td style="text-align:right;"> 5.446 </td>
   <td style="text-align:right;"> 5.446 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1989 </td>
   <td style="text-align:right;"> 2000 </td>
   <td style="text-align:right;"> 5.858 </td>
   <td style="text-align:right;"> 5.858 </td>
   <td style="text-align:right;"> 5.858 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1989 </td>
   <td style="text-align:right;"> 2001 </td>
   <td style="text-align:right;"> 6.355 </td>
   <td style="text-align:right;"> 6.355 </td>
   <td style="text-align:right;"> 6.355 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1989 </td>
   <td style="text-align:right;"> 2002 </td>
   <td style="text-align:right;"> 6.872 </td>
   <td style="text-align:right;"> 6.872 </td>
   <td style="text-align:right;"> 6.872 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1989 </td>
   <td style="text-align:right;"> 2003 </td>
   <td style="text-align:right;"> 7.352 </td>
   <td style="text-align:right;"> 7.352 </td>
   <td style="text-align:right;"> 7.352 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1989 </td>
   <td style="text-align:right;"> 2004 </td>
   <td style="text-align:right;"> 7.915 </td>
   <td style="text-align:right;"> 7.915 </td>
   <td style="text-align:right;"> 7.915 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1989 </td>
   <td style="text-align:right;"> 2005 </td>
   <td style="text-align:right;"> 8.309 </td>
   <td style="text-align:right;"> 8.309 </td>
   <td style="text-align:right;"> 8.309 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1989 </td>
   <td style="text-align:right;"> 2006 </td>
   <td style="text-align:right;"> 8.958 </td>
   <td style="text-align:right;"> 8.958 </td>
   <td style="text-align:right;"> 8.958 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1989 </td>
   <td style="text-align:right;"> 2007 </td>
   <td style="text-align:right;"> 9.281 </td>
   <td style="text-align:right;"> 9.281 </td>
   <td style="text-align:right;"> 9.281 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1989 </td>
   <td style="text-align:right;"> 2008 </td>
   <td style="text-align:right;"> 9.728 </td>
   <td style="text-align:right;"> 9.728 </td>
   <td style="text-align:right;"> 9.728 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1989 </td>
   <td style="text-align:right;"> 2009 </td>
   <td style="text-align:right;"> 10.373 </td>
   <td style="text-align:right;"> 10.373 </td>
   <td style="text-align:right;"> 10.373 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1989 </td>
   <td style="text-align:right;"> 2010 </td>
   <td style="text-align:right;"> 10.830 </td>
   <td style="text-align:right;"> 10.830 </td>
   <td style="text-align:right;"> 10.830 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1989 </td>
   <td style="text-align:right;"> 2011 </td>
   <td style="text-align:right;"> 11.315 </td>
   <td style="text-align:right;"> 11.315 </td>
   <td style="text-align:right;"> 11.315 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1989 </td>
   <td style="text-align:right;"> 2012 </td>
   <td style="text-align:right;"> 11.788 </td>
   <td style="text-align:right;"> 11.788 </td>
   <td style="text-align:right;"> 11.788 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1989 </td>
   <td style="text-align:right;"> 2013 </td>
   <td style="text-align:right;"> 12.223 </td>
   <td style="text-align:right;"> 12.223 </td>
   <td style="text-align:right;"> 12.223 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1989 </td>
   <td style="text-align:right;"> 2014 </td>
   <td style="text-align:right;"> 12.713 </td>
   <td style="text-align:right;"> 12.713 </td>
   <td style="text-align:right;"> 12.713 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1989 </td>
   <td style="text-align:right;"> 2015 </td>
   <td style="text-align:right;"> 13.318 </td>
   <td style="text-align:right;"> 13.318 </td>
   <td style="text-align:right;"> 13.318 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1998 </td>
   <td style="text-align:right;"> 1998 </td>
   <td style="text-align:right;"> 0.308 </td>
   <td style="text-align:right;"> 0.308 </td>
   <td style="text-align:right;"> 0.308 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1998 </td>
   <td style="text-align:right;"> 1999 </td>
   <td style="text-align:right;"> 0.491 </td>
   <td style="text-align:right;"> 0.491 </td>
   <td style="text-align:right;"> 0.491 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1998 </td>
   <td style="text-align:right;"> 2000 </td>
   <td style="text-align:right;"> 0.856 </td>
   <td style="text-align:right;"> 0.856 </td>
   <td style="text-align:right;"> 0.856 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1998 </td>
   <td style="text-align:right;"> 2001 </td>
   <td style="text-align:right;"> 1.190 </td>
   <td style="text-align:right;"> 1.190 </td>
   <td style="text-align:right;"> 1.190 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1998 </td>
   <td style="text-align:right;"> 2002 </td>
   <td style="text-align:right;"> 1.470 </td>
   <td style="text-align:right;"> 1.470 </td>
   <td style="text-align:right;"> 1.470 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1998 </td>
   <td style="text-align:right;"> 2003 </td>
   <td style="text-align:right;"> 1.819 </td>
   <td style="text-align:right;"> 1.819 </td>
   <td style="text-align:right;"> 1.819 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1998 </td>
   <td style="text-align:right;"> 2004 </td>
   <td style="text-align:right;"> 2.170 </td>
   <td style="text-align:right;"> 2.170 </td>
   <td style="text-align:right;"> 2.170 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1998 </td>
   <td style="text-align:right;"> 2005 </td>
   <td style="text-align:right;"> 2.346 </td>
   <td style="text-align:right;"> 2.346 </td>
   <td style="text-align:right;"> 2.346 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1998 </td>
   <td style="text-align:right;"> 2006 </td>
   <td style="text-align:right;"> 2.781 </td>
   <td style="text-align:right;"> 2.781 </td>
   <td style="text-align:right;"> 2.781 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1998 </td>
   <td style="text-align:right;"> 2007 </td>
   <td style="text-align:right;"> 3.008 </td>
   <td style="text-align:right;"> 3.008 </td>
   <td style="text-align:right;"> 3.008 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1998 </td>
   <td style="text-align:right;"> 2008 </td>
   <td style="text-align:right;"> 3.259 </td>
   <td style="text-align:right;"> 3.259 </td>
   <td style="text-align:right;"> 3.259 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1998 </td>
   <td style="text-align:right;"> 2009 </td>
   <td style="text-align:right;"> 3.637 </td>
   <td style="text-align:right;"> 3.637 </td>
   <td style="text-align:right;"> 3.637 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1998 </td>
   <td style="text-align:right;"> 2010 </td>
   <td style="text-align:right;"> 4.024 </td>
   <td style="text-align:right;"> 4.024 </td>
   <td style="text-align:right;"> 4.024 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1998 </td>
   <td style="text-align:right;"> 2011 </td>
   <td style="text-align:right;"> 4.307 </td>
   <td style="text-align:right;"> 4.307 </td>
   <td style="text-align:right;"> 4.307 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1998 </td>
   <td style="text-align:right;"> 2012 </td>
   <td style="text-align:right;"> 4.673 </td>
   <td style="text-align:right;"> 4.673 </td>
   <td style="text-align:right;"> 4.673 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1998 </td>
   <td style="text-align:right;"> 2013 </td>
   <td style="text-align:right;"> 4.785 </td>
   <td style="text-align:right;"> 4.785 </td>
   <td style="text-align:right;"> 4.785 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1998 </td>
   <td style="text-align:right;"> 2014 </td>
   <td style="text-align:right;"> 5.134 </td>
   <td style="text-align:right;"> 5.134 </td>
   <td style="text-align:right;"> 5.134 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1998 </td>
   <td style="text-align:right;"> 2015 </td>
   <td style="text-align:right;"> 5.580 </td>
   <td style="text-align:right;"> 5.580 </td>
   <td style="text-align:right;"> 5.580 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<div class="cell">
<div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:right;"> Relative Time </th>
   <th style="text-align:right;"> Truth </th>
   <th style="text-align:right;"> POLS </th>
   <th style="text-align:right;"> E-TWFE </th>
   <th style="text-align:right;"> E-TWM </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.397 </td>
   <td style="text-align:right;"> 0.389 </td>
   <td style="text-align:right;"> 0.389 </td>
   <td style="text-align:right;"> 0.389 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 0.794 </td>
   <td style="text-align:right;"> 0.736 </td>
   <td style="text-align:right;"> 0.736 </td>
   <td style="text-align:right;"> 0.736 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 1.191 </td>
   <td style="text-align:right;"> 1.156 </td>
   <td style="text-align:right;"> 1.156 </td>
   <td style="text-align:right;"> 1.156 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 1.589 </td>
   <td style="text-align:right;"> 1.557 </td>
   <td style="text-align:right;"> 1.557 </td>
   <td style="text-align:right;"> 1.557 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 1.986 </td>
   <td style="text-align:right;"> 1.893 </td>
   <td style="text-align:right;"> 1.893 </td>
   <td style="text-align:right;"> 1.893 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 2.383 </td>
   <td style="text-align:right;"> 2.406 </td>
   <td style="text-align:right;"> 2.406 </td>
   <td style="text-align:right;"> 2.406 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 2.780 </td>
   <td style="text-align:right;"> 2.840 </td>
   <td style="text-align:right;"> 2.840 </td>
   <td style="text-align:right;"> 2.840 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 7 </td>
   <td style="text-align:right;"> 3.177 </td>
   <td style="text-align:right;"> 3.126 </td>
   <td style="text-align:right;"> 3.126 </td>
   <td style="text-align:right;"> 3.126 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 3.574 </td>
   <td style="text-align:right;"> 3.562 </td>
   <td style="text-align:right;"> 3.562 </td>
   <td style="text-align:right;"> 3.562 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 9 </td>
   <td style="text-align:right;"> 3.971 </td>
   <td style="text-align:right;"> 3.953 </td>
   <td style="text-align:right;"> 3.953 </td>
   <td style="text-align:right;"> 3.953 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:right;"> 4.369 </td>
   <td style="text-align:right;"> 4.352 </td>
   <td style="text-align:right;"> 4.352 </td>
   <td style="text-align:right;"> 4.352 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 11 </td>
   <td style="text-align:right;"> 4.766 </td>
   <td style="text-align:right;"> 4.747 </td>
   <td style="text-align:right;"> 4.747 </td>
   <td style="text-align:right;"> 4.747 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 12 </td>
   <td style="text-align:right;"> 5.163 </td>
   <td style="text-align:right;"> 5.189 </td>
   <td style="text-align:right;"> 5.189 </td>
   <td style="text-align:right;"> 5.189 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 13 </td>
   <td style="text-align:right;"> 5.560 </td>
   <td style="text-align:right;"> 5.589 </td>
   <td style="text-align:right;"> 5.589 </td>
   <td style="text-align:right;"> 5.589 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 5.957 </td>
   <td style="text-align:right;"> 6.012 </td>
   <td style="text-align:right;"> 6.012 </td>
   <td style="text-align:right;"> 6.012 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 15 </td>
   <td style="text-align:right;"> 6.354 </td>
   <td style="text-align:right;"> 6.350 </td>
   <td style="text-align:right;"> 6.350 </td>
   <td style="text-align:right;"> 6.350 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 16 </td>
   <td style="text-align:right;"> 6.751 </td>
   <td style="text-align:right;"> 6.722 </td>
   <td style="text-align:right;"> 6.722 </td>
   <td style="text-align:right;"> 6.722 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 17 </td>
   <td style="text-align:right;"> 7.149 </td>
   <td style="text-align:right;"> 7.269 </td>
   <td style="text-align:right;"> 7.269 </td>
   <td style="text-align:right;"> 7.269 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 18 </td>
   <td style="text-align:right;"> 9.500 </td>
   <td style="text-align:right;"> 9.281 </td>
   <td style="text-align:right;"> 9.281 </td>
   <td style="text-align:right;"> 9.281 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 19 </td>
   <td style="text-align:right;"> 10.000 </td>
   <td style="text-align:right;"> 9.728 </td>
   <td style="text-align:right;"> 9.728 </td>
   <td style="text-align:right;"> 9.728 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 20 </td>
   <td style="text-align:right;"> 10.500 </td>
   <td style="text-align:right;"> 10.373 </td>
   <td style="text-align:right;"> 10.373 </td>
   <td style="text-align:right;"> 10.373 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 21 </td>
   <td style="text-align:right;"> 11.000 </td>
   <td style="text-align:right;"> 10.830 </td>
   <td style="text-align:right;"> 10.830 </td>
   <td style="text-align:right;"> 10.830 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 22 </td>
   <td style="text-align:right;"> 11.500 </td>
   <td style="text-align:right;"> 11.315 </td>
   <td style="text-align:right;"> 11.315 </td>
   <td style="text-align:right;"> 11.315 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 23 </td>
   <td style="text-align:right;"> 12.000 </td>
   <td style="text-align:right;"> 11.788 </td>
   <td style="text-align:right;"> 11.788 </td>
   <td style="text-align:right;"> 11.788 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 24 </td>
   <td style="text-align:right;"> 12.500 </td>
   <td style="text-align:right;"> 12.223 </td>
   <td style="text-align:right;"> 12.223 </td>
   <td style="text-align:right;"> 12.223 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 25 </td>
   <td style="text-align:right;"> 13.000 </td>
   <td style="text-align:right;"> 12.713 </td>
   <td style="text-align:right;"> 12.713 </td>
   <td style="text-align:right;"> 12.713 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 26 </td>
   <td style="text-align:right;"> 13.500 </td>
   <td style="text-align:right;"> 13.318 </td>
   <td style="text-align:right;"> 13.318 </td>
   <td style="text-align:right;"> 13.318 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<div class="cell">

</div>
<div class="column-screen">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/extended-difference-in-differences_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/extended-difference-in-differences_files/figure-html/unnamed-chunk-15-2.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div class="column-screen">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/extended-difference-in-differences_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/extended-difference-in-differences_files/figure-html/unnamed-chunk-16-2.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div class="column-screen">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/extended-difference-in-differences_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/extended-difference-in-differences_files/figure-html/unnamed-chunk-17-2.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div class="column-screen">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/extended-difference-in-differences_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/extended-difference-in-differences_files/figure-html/unnamed-chunk-18-2.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div class="column-screen">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/extended-difference-in-differences_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/extended-difference-in-differences_files/figure-html/unnamed-chunk-19-2.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div class="column-screen">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/extended-difference-in-differences_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/extended-difference-in-differences_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">prepare_extended_did_data <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(df,<span class="at" style="color: #657422;">covariates =</span> <span class="cn" style="color: #8f5902;">NULL</span>) {</span>
<span id="cb8-2">  </span>
<span id="cb8-3">  any_never_treated <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(df) {</span>
<span id="cb8-4">    n_years <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">max</span>(df<span class="sc" style="color: #5E5E5E;">$</span>year) <span class="sc" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">min</span>(df<span class="sc" style="color: #5E5E5E;">$</span>year) <span class="sc" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">1</span></span>
<span id="cb8-5">    </span>
<span id="cb8-6">    never_treated <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb8-7">      df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-8">      <span class="fu" style="color: #4758AB;">ungroup</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-9">      <span class="fu" style="color: #4758AB;">filter</span>(w_it<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">0</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-10">      <span class="fu" style="color: #4758AB;">group_by</span>(unit) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-11">      <span class="fu" style="color: #4758AB;">count</span>(year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-12">      <span class="fu" style="color: #4758AB;">summarise</span>(<span class="at" style="color: #657422;">n =</span> <span class="fu" style="color: #4758AB;">sum</span>(n)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-13">      <span class="fu" style="color: #4758AB;">ungroup</span>()  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-14">      <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">never_treated =</span> <span class="fu" style="color: #4758AB;">as.integer</span>(n<span class="sc" style="color: #5E5E5E;">==</span>n_years)) </span>
<span id="cb8-15">    </span>
<span id="cb8-16">    any_never_treated <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">max</span>(never_treated<span class="sc" style="color: #5E5E5E;">$</span>never_treated)<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span></span>
<span id="cb8-17">    any_never_treated</span>
<span id="cb8-18">  }</span>
<span id="cb8-19">  </span>
<span id="cb8-20">  get_d_star <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(df) {</span>
<span id="cb8-21">      </span>
<span id="cb8-22">    df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-23">      <span class="fu" style="color: #4758AB;">select</span>(unit,year,w_it) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-24">      <span class="fu" style="color: #4758AB;">unique</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-25">      <span class="fu" style="color: #4758AB;">filter</span>(w_it<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-26">      <span class="fu" style="color: #4758AB;">group_by</span>(unit) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-27">      <span class="fu" style="color: #4758AB;">filter</span>(year<span class="sc" style="color: #5E5E5E;">==</span><span class="fu" style="color: #4758AB;">min</span>(year)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-28">      <span class="fu" style="color: #4758AB;">select</span>(<span class="sc" style="color: #5E5E5E;">-</span>w_it) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-29">      <span class="fu" style="color: #4758AB;">rename</span>(<span class="at" style="color: #657422;">d =</span> year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-30">      <span class="fu" style="color: #4758AB;">dummy_cols</span>(<span class="st" style="color: #20794D;">"d"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-31">      <span class="fu" style="color: #4758AB;">select</span>(unit,<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"d_"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-32">      <span class="fu" style="color: #4758AB;">right_join</span>(df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">select</span>(unit) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">unique</span>(),<span class="st" style="color: #20794D;">"unit"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-33">      <span class="fu" style="color: #4758AB;">mutate_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"d_"</span>)),<span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">ifelse</span>(<span class="fu" style="color: #4758AB;">is.na</span>(.),<span class="dv" style="color: #AD0000;">0</span>,.)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-34">      <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">never_treated =</span> <span class="fu" style="color: #4758AB;">as.integer</span>(<span class="fu" style="color: #4758AB;">rowSums</span>(.[,<span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>])<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">0</span>))  </span>
<span id="cb8-35">  }</span>
<span id="cb8-36">  </span>
<span id="cb8-37">  get_f_star <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(df) {</span>
<span id="cb8-38">    <span class="fu" style="color: #4758AB;">with</span>(df,<span class="fu" style="color: #4758AB;">table</span>(year,w_it)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">data.frame</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-39">      <span class="fu" style="color: #4758AB;">filter</span>(w_it<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> Freq<span class="sc" style="color: #5E5E5E;">&gt;</span><span class="dv" style="color: #AD0000;">0</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-40">      <span class="fu" style="color: #4758AB;">select</span>(<span class="at" style="color: #657422;">f_star =</span> year)</span>
<span id="cb8-41">  }</span>
<span id="cb8-42">  </span>
<span id="cb8-43">  get_cohort_year_interactions <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(df,d_star, f_star) {</span>
<span id="cb8-44">    <span class="fu" style="color: #4758AB;">crossing</span>(<span class="at" style="color: #657422;">d =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"d_"</span>,<span class="st" style="color: #20794D;">""</span>,<span class="fu" style="color: #4758AB;">grep</span>(<span class="st" style="color: #20794D;">"d_"</span>,<span class="fu" style="color: #4758AB;">colnames</span>(d_star),<span class="at" style="color: #657422;">value=</span><span class="cn" style="color: #8f5902;">TRUE</span>))),<span class="at" style="color: #657422;">f =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(f_star<span class="sc" style="color: #5E5E5E;">$</span>f_star))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-45">      <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">value =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(f<span class="sc" style="color: #5E5E5E;">&gt;=</span>d)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-46">      <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">f =</span> <span class="fu" style="color: #4758AB;">paste0</span>(<span class="st" style="color: #20794D;">"f_"</span>,f)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-47">      <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">d =</span> <span class="fu" style="color: #4758AB;">paste0</span>(<span class="st" style="color: #20794D;">"d_"</span>,d)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-48">      <span class="fu" style="color: #4758AB;">spread</span>(f,value) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-49">      <span class="fu" style="color: #4758AB;">gather</span>(f,value,<span class="sc" style="color: #5E5E5E;">-</span>d) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-50">      <span class="fu" style="color: #4758AB;">filter</span>(value<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-51">      <span class="fu" style="color: #4758AB;">arrange</span>(d,f) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-52">      <span class="fu" style="color: #4758AB;">select</span>(<span class="sc" style="color: #5E5E5E;">-</span>value) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-53">      <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">i =</span> <span class="fu" style="color: #4758AB;">paste0</span>(<span class="st" style="color: #20794D;">"I("</span>,d,<span class="st" style="color: #20794D;">"*"</span>,f,<span class="st" style="color: #20794D;">")"</span>))</span>
<span id="cb8-54">  }</span>
<span id="cb8-55">  </span>
<span id="cb8-56">  is_there_any_never_treated <span class="ot" style="color: #003B4F;">&lt;-</span> df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">any_never_treated</span>()</span>
<span id="cb8-57">  d_star <span class="ot" style="color: #003B4F;">&lt;-</span> df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">get_d_star</span>()</span>
<span id="cb8-58">  d_star_names <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">colnames</span>(d_star)[<span class="sc" style="color: #5E5E5E;">-</span><span class="fu" style="color: #4758AB;">grep</span>(<span class="st" style="color: #20794D;">"unit|never_treated"</span>,<span class="fu" style="color: #4758AB;">colnames</span>(d_star))]</span>
<span id="cb8-59">  f_star <span class="ot" style="color: #003B4F;">&lt;-</span> df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">get_f_star</span>()</span>
<span id="cb8-60">  cohort_year_interactions <span class="ot" style="color: #003B4F;">&lt;-</span> df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">get_cohort_year_interactions</span>(., <span class="at" style="color: #657422;">d_star =</span> d_star, <span class="at" style="color: #657422;">f_star =</span> f_star)</span>
<span id="cb8-61">  </span>
<span id="cb8-62">  df_final_ <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb8-63">    df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-64">    <span class="fu" style="color: #4758AB;">select</span>(unit,year,y_it,<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"x_i"</span>),w_it,covariates) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-65">    <span class="fu" style="color: #4758AB;">left_join</span>(d_star,<span class="st" style="color: #20794D;">"unit"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-66">    <span class="fu" style="color: #4758AB;">mutate_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"d_"</span>)),<span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">ifelse</span>(<span class="fu" style="color: #4758AB;">is.na</span>(.),<span class="dv" style="color: #AD0000;">0</span>,.)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-67">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">f =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(year <span class="sc" style="color: #5E5E5E;">%in%</span> f_star<span class="sc" style="color: #5E5E5E;">$</span>f_star,year,<span class="cn" style="color: #8f5902;">NA</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-68">    <span class="fu" style="color: #4758AB;">dummy_cols</span>(<span class="st" style="color: #20794D;">"f"</span>,<span class="at" style="color: #657422;">ignore_na=</span><span class="cn" style="color: #8f5902;">TRUE</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-69">    <span class="fu" style="color: #4758AB;">mutate_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"f_"</span>)),<span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">ifelse</span>(<span class="fu" style="color: #4758AB;">is.na</span>(.),<span class="dv" style="color: #AD0000;">0</span>,.))  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-70">    <span class="fu" style="color: #4758AB;">dummy_cols</span>(<span class="st" style="color: #20794D;">"year"</span>,<span class="at" style="color: #657422;">ignore_na=</span><span class="cn" style="color: #8f5902;">TRUE</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-71">    <span class="fu" style="color: #4758AB;">select</span>(<span class="sc" style="color: #5E5E5E;">-</span>f)</span>
<span id="cb8-72">  </span>
<span id="cb8-73">  <span class="cf" style="color: #003B4F;">if</span> (<span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.null</span>(covariates)) {</span>
<span id="cb8-74">    <span class="cf" style="color: #003B4F;">for</span> (.x <span class="cf" style="color: #003B4F;">in</span> covariates) {</span>
<span id="cb8-75">      covariate_means <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb8-76">        df_final_ <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-77">        <span class="fu" style="color: #4758AB;">select_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(unit,.x,<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"d_"</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-78">        <span class="fu" style="color: #4758AB;">pivot_longer</span>(<span class="at" style="color: #657422;">cols =</span> <span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"d_"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-79">        <span class="fu" style="color: #4758AB;">filter</span>(value<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-80">        <span class="fu" style="color: #4758AB;">rename</span>(<span class="at" style="color: #657422;">cohort =</span> name) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-81">        <span class="fu" style="color: #4758AB;">select</span>(<span class="sc" style="color: #5E5E5E;">-</span>value) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-82">        <span class="fu" style="color: #4758AB;">group_by</span>(cohort) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-83">        <span class="fu" style="color: #4758AB;">summarise_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(.x),mean,<span class="at" style="color: #657422;">na.rm=</span><span class="cn" style="color: #8f5902;">TRUE</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-84">        <span class="fu" style="color: #4758AB;">mutate</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-85">        <span class="fu" style="color: #4758AB;">gather</span>(covar,mean,<span class="sc" style="color: #5E5E5E;">-</span>cohort) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-86">        <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">covar =</span> <span class="fu" style="color: #4758AB;">paste0</span>(covar,<span class="st" style="color: #20794D;">"_dm"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-87">        <span class="fu" style="color: #4758AB;">unite</span>(covar,covar,cohort) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-88">        <span class="fu" style="color: #4758AB;">spread</span>(covar,mean)</span>
<span id="cb8-89">      </span>
<span id="cb8-90">      tmp <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb8-91">        df_final_ <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-92">        <span class="fu" style="color: #4758AB;">select</span>(unit,year,<span class="at" style="color: #657422;">tmp =</span> .x) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-93">        <span class="fu" style="color: #4758AB;">left_join</span>(covariate_means, <span class="at" style="color: #657422;">by =</span> <span class="fu" style="color: #4758AB;">character</span>()) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-94">        <span class="fu" style="color: #4758AB;">mutate_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(<span class="fu" style="color: #4758AB;">colnames</span>(covariate_means)),<span class="sc" style="color: #5E5E5E;">~</span>(.data<span class="sc" style="color: #5E5E5E;">$</span>tmp <span class="sc" style="color: #5E5E5E;">-</span> .)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-95">        <span class="fu" style="color: #4758AB;">select</span>(unit,year,<span class="fu" style="color: #4758AB;">contains</span>(<span class="st" style="color: #20794D;">"_dm_"</span>))</span>
<span id="cb8-96">      </span>
<span id="cb8-97">      df_final_ <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb8-98">        df_final_ <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-99">        <span class="fu" style="color: #4758AB;">left_join</span>(tmp,<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"unit"</span>,<span class="st" style="color: #20794D;">"year"</span>))</span>
<span id="cb8-100">      </span>
<span id="cb8-101">    }</span>
<span id="cb8-102">    df_final <span class="ot" style="color: #003B4F;">&lt;-</span> df_final_</span>
<span id="cb8-103">  } <span class="cf" style="color: #003B4F;">else</span> {</span>
<span id="cb8-104">    df_final <span class="ot" style="color: #003B4F;">&lt;-</span> df_final_</span>
<span id="cb8-105">    ff_twfe <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">as.formula</span>(<span class="fu" style="color: #4758AB;">paste0</span>(<span class="st" style="color: #20794D;">"y_it ~"</span>,<span class="fu" style="color: #4758AB;">paste0</span>(cohort_year_interactions<span class="sc" style="color: #5E5E5E;">$</span>i,<span class="at" style="color: #657422;">collapse=</span><span class="st" style="color: #20794D;">"+"</span>),<span class="st" style="color: #20794D;">"+ factor(year) | unit"</span>))</span>
<span id="cb8-106">    ff_pols <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">as.formula</span>(<span class="fu" style="color: #4758AB;">paste0</span>(<span class="st" style="color: #20794D;">"y_it ~"</span>,<span class="fu" style="color: #4758AB;">paste0</span>(cohort_year_interactions<span class="sc" style="color: #5E5E5E;">$</span>i,<span class="at" style="color: #657422;">collapse=</span><span class="st" style="color: #20794D;">"+"</span>),<span class="st" style="color: #20794D;">"+"</span>,<span class="fu" style="color: #4758AB;">paste0</span>(<span class="fu" style="color: #4758AB;">grep</span>(<span class="st" style="color: #20794D;">"^d_"</span>,<span class="fu" style="color: #4758AB;">colnames</span>(df_final), <span class="at" style="color: #657422;">value=</span><span class="cn" style="color: #8f5902;">TRUE</span>),<span class="at" style="color: #657422;">collapse=</span><span class="st" style="color: #20794D;">"+"</span>),<span class="st" style="color: #20794D;">"+ factor(year)"</span>))</span>
<span id="cb8-107">    ff_re <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">as.formula</span>(<span class="fu" style="color: #4758AB;">paste0</span>(<span class="st" style="color: #20794D;">"y_it ~"</span>,<span class="fu" style="color: #4758AB;">paste0</span>(cohort_year_interactions<span class="sc" style="color: #5E5E5E;">$</span>i,<span class="at" style="color: #657422;">collapse=</span><span class="st" style="color: #20794D;">"+"</span>),<span class="st" style="color: #20794D;">"+"</span>,<span class="fu" style="color: #4758AB;">paste0</span>(<span class="fu" style="color: #4758AB;">grep</span>(<span class="st" style="color: #20794D;">"^d_"</span>,<span class="fu" style="color: #4758AB;">colnames</span>(df_final), <span class="at" style="color: #657422;">value=</span><span class="cn" style="color: #8f5902;">TRUE</span>),<span class="at" style="color: #657422;">collapse=</span><span class="st" style="color: #20794D;">"+"</span>),<span class="st" style="color: #20794D;">"+ factor(year) + (1| unit)"</span>))</span>
<span id="cb8-108">  }</span>
<span id="cb8-109">  </span>
<span id="cb8-110">  <span class="fu" style="color: #4758AB;">return</span>(<span class="fu" style="color: #4758AB;">list</span>(<span class="at" style="color: #657422;">df =</span> df_final, <span class="at" style="color: #657422;">ff_pols =</span> ff_pols, <span class="at" style="color: #657422;">ff_twfe =</span> ff_twfe, <span class="at" style="color: #657422;">ff_re =</span> ff_re))</span>
<span id="cb8-111">}</span></code></pre></div>
</div>


</section>

 ]]></description>
  <guid>https://graveja0.github.io/HPOL8539-F2022/blog/posts/extended-difference-in-differences.html</guid>
  <pubDate>Tue, 13 Sep 2022 21:35:33 GMT</pubDate>
</item>
<item>
  <title>Quasi-Demeaning: The Relationship Between Fixed and Random Effects</title>
  <link>https://graveja0.github.io/HPOL8539-F2022/blog/posts/quasi-demeaning.html</link>
  <description><![CDATA[ 



<section id="setup" class="level1">
<h1>Setup</h1>
<p>Assume the following data generation process:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AY_%7Bit%7D%20=%20%5Cmathbf%7BX%7D_%7Bi%7D'%5Cbeta%20+%20%5Ctau%20D_%7Bit%7D%20+%20U_i%20+%5Cepsilon_%7Bit%7D%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?i"> indexes individual units and <img src="https://latex.codecogs.com/png.latex?t"> indexes time, <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BX%7D_i"> are unit-level attributes, <img src="https://latex.codecogs.com/png.latex?D_%7Bit%7D"> is a treatment indicator (set to 1 if the observation is treated and in the post-treatment period). Finally, <img src="https://latex.codecogs.com/png.latex?U_i"> captures unobserved unit-level heterogeneity.</p>
<section id="estimation-random-vs.-fixed-effects" class="level2">
<h2 class="anchored" data-anchor-id="estimation-random-vs.-fixed-effects">Estimation: Random vs.&nbsp;Fixed Effects</h2>
<ul>
<li><p>Random effects uses an approach called “quasi-demeaning” or “partial pooling.”</p></li>
<li><p>The random effects model can be represented as:</p></li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign%7D%0A(Y_%7Bit%7D-%5Ctheta%20%5Cbar%7BY_i%7D)%20=%20(%5Cmathbf%7BX%7D_%7Bit%7D-%5Ctheta%20%5Cbar%7B%5Cmathbf%7BX%7D_i%7D)'%5Cbeta%20+%20%5Ctau%20(D_%7Bit%7D-%5Ctheta%20%5Cbar%7BD_i%7D)%20%20+%20(%5Cepsilon_%7Bit%7D%20-%20%5Ctheta%20%5Cbar%7B%5Cepsilon_i%7D)%20%5Cquad%20%5Cquad%20%5Cquad%20Eq.%209%0A%5Cend%7Balign%7D%0A"></p>
<p>where</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctheta%20=%201%20-%20%5Cbigg%20%5B%5Cfrac%7B%5Csigma%5E2_%5Cepsilon%7D%7B(%5Csigma%5E2_%5Cepsilon%20+%20T%5Csigma%5E2_u)%7D%5Cbigg%20%5D%5E%7B1/2%7D%0A"></p>
<p>In the above, <img src="https://latex.codecogs.com/png.latex?%5Csigma_u"> is the variance of unit-level heterogeneity, and <img src="https://latex.codecogs.com/png.latex?%5Csigma_%7B%5Cepsilon%7D"> is the variance of <img src="https://latex.codecogs.com/png.latex?%5Cepsilon_%7Bit%7D">. And recall <img src="https://latex.codecogs.com/png.latex?T"> is the total number of repeated unit-level observations in our panel (e.g., the total number of time periods, the total number of patients for a given physician, etc.)</p>
<ul>
<li><p>When <img src="https://latex.codecogs.com/png.latex?%5Ctheta%20=%200">, it just reduces pooled regression.</p></li>
<li><p>When <img src="https://latex.codecogs.com/png.latex?%5Ctheta%20=%201">, it is equivalent to fixed effects regression. This <em>only</em> isolates variation within units to estimate the regression coefficients (i.e., units are only compared to themselves, which is why the unobserved heterogeneity is accounted for).</p></li>
<li><p>Essentially, when you fit a random effects regression, Stata estimates <img src="https://latex.codecogs.com/png.latex?%5Ctheta"> and then plugs that estimate it into the above model.</p></li>
<li><p>(When you fit a fixed effects regression, Stata uses the demeaning approach–unless, of course, you manually fit a dummy variable model)</p></li>
<li><p>Often <img src="https://latex.codecogs.com/png.latex?0%20%3C%20%5Ctheta%20%3C%201">, hence the term “partial-pooling.” That is, the regression draws on both variation “within” units and variation “between” units.</p></li>
<li><p>The degree to which within and between variation is used depends on the data context.</p></li>
<li><p>Remember, when <img src="https://latex.codecogs.com/png.latex?%5Ctheta=0"> the random effects regression reduces to pooled OLS. When is this the case?</p>
<ul>
<li>If the term <img src="https://latex.codecogs.com/png.latex?T%5Csigma%5E2_u"> is 0, i.e., <img src="https://latex.codecogs.com/png.latex?%5Csigma%5E2_u=0"> or there is no variation in individual heterogeneity.</li>
</ul></li>
<li><p>Remember, when <img src="https://latex.codecogs.com/png.latex?%5Ctheta=1"> the random effects regression reduces to fixed effects. When is this the case?</p>
<ul>
<li><p>If the term <img src="https://latex.codecogs.com/png.latex?T%5Csigma%5E2_u"> gets super large (more formally, it would need to blast off towards infinity…).</p></li>
<li><p>If we have a very “large” panel of observations on each unit (i.e., large <img src="https://latex.codecogs.com/png.latex?T">) there is sufficient “within” variation and we really don’t need to do any pooling across units.</p></li>
</ul></li>
</ul>
</section>
</section>
<section id="setup-1" class="level1">
<h1>Setup</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──
✔ ggplot2 3.3.6     ✔ purrr   0.3.4
✔ tibble  3.1.8     ✔ dplyr   1.0.9
✔ tidyr   1.2.0     ✔ stringr 1.4.1
✔ readr   2.1.2     ✔ forcats 0.5.2
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;">library</span>(lme4)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Matrix

Attaching package: 'Matrix'

The following objects are masked from 'package:tidyr':

    expand, pack, unpack</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;">library</span>(broom)</span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;">library</span>(knitr)</span>
<span id="cb5-3"><span class="fu" style="color: #4758AB;">theme_set</span>(<span class="fu" style="color: #4758AB;">theme_bw</span>())</span></code></pre></div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">params_panel <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">list</span>(</span>
<span id="cb6-2">  <span class="at" style="color: #657422;">N =</span> <span class="dv" style="color: #AD0000;">1000</span>,</span>
<span id="cb6-3">  <span class="at" style="color: #657422;">T =</span> <span class="dv" style="color: #AD0000;">2</span>,</span>
<span id="cb6-4">  <span class="at" style="color: #657422;">tx_time =</span> <span class="dv" style="color: #AD0000;">2</span>, </span>
<span id="cb6-5">  <span class="at" style="color: #657422;">rho_t =</span> <span class="fl" style="color: #AD0000;">0.8</span>,</span>
<span id="cb6-6">  <span class="at" style="color: #657422;">beta_0 =</span> <span class="fl" style="color: #AD0000;">0.5</span>,</span>
<span id="cb6-7">  <span class="at" style="color: #657422;">beta_1 =</span> <span class="dv" style="color: #AD0000;">2</span>,</span>
<span id="cb6-8">  <span class="at" style="color: #657422;">tau =</span> <span class="fl" style="color: #AD0000;">0.5</span>,</span>
<span id="cb6-9">  <span class="at" style="color: #657422;">p_d =</span> <span class="fl" style="color: #AD0000;">0.5</span></span>
<span id="cb6-10">)</span>
<span id="cb6-11"></span>
<span id="cb6-12">dgp_panel <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(params) {</span>
<span id="cb6-13">  <span class="fu" style="color: #4758AB;">with</span>(params, {</span>
<span id="cb6-14"></span>
<span id="cb6-15">    <span class="co" style="color: #5E5E5E;"># Time effects</span></span>
<span id="cb6-16">    t_ <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb6-17">      <span class="fu" style="color: #4758AB;">data.frame</span>(<span class="at" style="color: #657422;">t =</span> <span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span>T,</span>
<span id="cb6-18">                 <span class="at" style="color: #657422;">gamma_t =</span> <span class="fu" style="color: #4758AB;">arima.sim</span>(<span class="at" style="color: #657422;">n=</span>T, <span class="fu" style="color: #4758AB;">list</span>(<span class="at" style="color: #657422;">ar =</span> rho_t, <span class="at" style="color: #657422;">order=</span><span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">1</span>,<span class="dv" style="color: #AD0000;">0</span>,<span class="dv" style="color: #AD0000;">0</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.vector</span>())</span>
<span id="cb6-19"></span>
<span id="cb6-20">    <span class="co" style="color: #5E5E5E;"># Individual measures and effects</span></span>
<span id="cb6-21">    i_ <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb6-22">      <span class="fu" style="color: #4758AB;">data.frame</span>(</span>
<span id="cb6-23">        <span class="at" style="color: #657422;">unit_id =</span> <span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span>N,</span>
<span id="cb6-24">        <span class="at" style="color: #657422;">x_i =</span> <span class="fu" style="color: #4758AB;">rnorm</span>(N, <span class="at" style="color: #657422;">mean =</span> <span class="dv" style="color: #AD0000;">0</span>, <span class="at" style="color: #657422;">sd =</span> <span class="dv" style="color: #AD0000;">1</span>),</span>
<span id="cb6-25">        <span class="at" style="color: #657422;">u_i =</span> <span class="fu" style="color: #4758AB;">rnorm</span>(N, <span class="at" style="color: #657422;">mean =</span> <span class="dv" style="color: #AD0000;">0</span>, <span class="at" style="color: #657422;">sd =</span> <span class="dv" style="color: #AD0000;">1</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-26">      <span class="fu" style="color: #4758AB;">rowwise</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="co" style="color: #5E5E5E;"># This allows us to get each value's pr_treated in the line below. </span></span>
<span id="cb6-27">      <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">pr_treated =</span> boot<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">inv.logit</span>(u_i)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-28">      <span class="fu" style="color: #4758AB;">ungroup</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span>  <span class="co" style="color: #5E5E5E;"># This undoes the rowwise </span></span>
<span id="cb6-29">      <span class="co" style="color: #5E5E5E;"># Treatment indicator</span></span>
<span id="cb6-30">      <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">d_i =</span> <span class="fu" style="color: #4758AB;">rbinom</span>(N, <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">1</span>, <span class="at" style="color: #657422;">prob =</span> pr_treated)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-31">      <span class="fu" style="color: #4758AB;">ungroup</span>()</span>
<span id="cb6-32"></span>
<span id="cb6-33">    <span class="fu" style="color: #4758AB;">crossing</span>(<span class="at" style="color: #657422;">unit_id =</span> i_<span class="sc" style="color: #5E5E5E;">$</span>unit_id,<span class="at" style="color: #657422;">t =</span> t_<span class="sc" style="color: #5E5E5E;">$</span>t) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-34">      <span class="fu" style="color: #4758AB;">left_join</span>(i_,<span class="st" style="color: #20794D;">"unit_id"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-35">      <span class="fu" style="color: #4758AB;">left_join</span>(t_,<span class="st" style="color: #20794D;">"t"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-36">      <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">d_i =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(t<span class="sc" style="color: #5E5E5E;">&lt;</span>tx_time,<span class="dv" style="color: #AD0000;">0</span>,d_i)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-37">      <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">y_i =</span> beta_0 <span class="sc" style="color: #5E5E5E;">+</span> beta_1 <span class="sc" style="color: #5E5E5E;">*</span> x_i <span class="sc" style="color: #5E5E5E;">+</span> tau <span class="sc" style="color: #5E5E5E;">*</span> d_i <span class="sc" style="color: #5E5E5E;">+</span> u_i <span class="sc" style="color: #5E5E5E;">+</span> gamma_t <span class="sc" style="color: #5E5E5E;">+</span> <span class="fu" style="color: #4758AB;">rnorm</span>(N, <span class="at" style="color: #657422;">mean =</span> <span class="dv" style="color: #AD0000;">0</span>, <span class="at" style="color: #657422;">sd =</span> <span class="dv" style="color: #AD0000;">1</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-38">      <span class="fu" style="color: #4758AB;">select</span>(unit_id, t, y_i , x_i, d_i)</span>
<span id="cb6-39">  })</span>
<span id="cb6-40">}</span>
<span id="cb6-41"></span>
<span id="cb6-42">estimator_fn_re <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(df) {</span>
<span id="cb6-43">  <span class="fu" style="color: #4758AB;">lmer</span>(y_i <span class="sc" style="color: #5E5E5E;">~</span>  d_i <span class="sc" style="color: #5E5E5E;">+</span> (<span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">|</span>unit_id) , df)</span>
<span id="cb6-44">}</span>
<span id="cb6-45"></span>
<span id="cb6-46">disc_fn_re <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(fit) {</span>
<span id="cb6-47">  fit <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">summary</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">pluck</span>(<span class="st" style="color: #20794D;">"coefficients"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-48">    <span class="fu" style="color: #4758AB;">data.frame</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-49">    <span class="fu" style="color: #4758AB;">rownames_to_column</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-50">    janitor<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">clean_names</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-51">    <span class="fu" style="color: #4758AB;">filter</span>(rowname<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"d_i"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-52">    <span class="fu" style="color: #4758AB;">pull</span>(estimate) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-53">    <span class="fu" style="color: #4758AB;">as.vector</span>()</span>
<span id="cb6-54">}</span>
<span id="cb6-55"></span>
<span id="cb6-56">generate_estimate_discriminate_re <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(params) {</span>
<span id="cb6-57">  params <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="co" style="color: #5E5E5E;"># Step 1: Parameterize the problem</span></span>
<span id="cb6-58">      <span class="fu" style="color: #4758AB;">dgp_panel</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span>  <span class="co" style="color: #5E5E5E;"># Step 2: Define the data generation process</span></span>
<span id="cb6-59">        <span class="fu" style="color: #4758AB;">estimator_fn_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span>  <span class="co" style="color: #5E5E5E;"># Step 3: Estimate </span></span>
<span id="cb6-60">          <span class="fu" style="color: #4758AB;">disc_fn_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="co" style="color: #5E5E5E;"># Step 4: Pull out what you need</span></span>
<span id="cb6-61">            <span class="fu" style="color: #4758AB;">data.frame</span>(<span class="at" style="color: #657422;">tau_hat =</span> .) <span class="co" style="color: #5E5E5E;"># store the result as a data frame object</span></span>
<span id="cb6-62">}</span>
<span id="cb6-63"></span>
<span id="cb6-64">construct_dm <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(df) {</span>
<span id="cb6-65">  df_ <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb6-66">    df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-67">      <span class="co" style="color: #5E5E5E;"># mutate(y_i = y_i + mean(y_i),</span></span>
<span id="cb6-68">      <span class="co" style="color: #5E5E5E;">#       d_i = d_i + mean(d_i)) %&gt;% </span></span>
<span id="cb6-69">      <span class="co" style="color: #5E5E5E;">#       group_by(t) %&gt;% </span></span>
<span id="cb6-70">      <span class="co" style="color: #5E5E5E;">#       mutate(y_i = y_i - mean(y_i),</span></span>
<span id="cb6-71">      <span class="co" style="color: #5E5E5E;">#       d_i = d_i - mean(d_i)) %&gt;% </span></span>
<span id="cb6-72">            <span class="fu" style="color: #4758AB;">group_by</span>(unit_id) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-73">            <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">y_i =</span> y_i <span class="sc" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">mean</span>(y_i),</span>
<span id="cb6-74">            <span class="at" style="color: #657422;">d_i =</span> d_i <span class="sc" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">mean</span>(d_i))</span>
<span id="cb6-75"></span>
<span id="cb6-76">  <span class="fu" style="color: #4758AB;">return</span>(df_)</span>
<span id="cb6-77">}</span>
<span id="cb6-78"></span>
<span id="cb6-79">estimate_dm <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(df) {</span>
<span id="cb6-80">  <span class="fu" style="color: #4758AB;">lm</span>(y_i <span class="sc" style="color: #5E5E5E;">~</span> d_i   , <span class="at" style="color: #657422;">data =</span> df)</span>
<span id="cb6-81">}</span>
<span id="cb6-82"></span>
<span id="cb6-83">disc_fn_dm <span class="ot" style="color: #003B4F;">=</span> <span class="cf" style="color: #003B4F;">function</span>(fit) {</span>
<span id="cb6-84">  fit_ <span class="ot" style="color: #003B4F;">=</span>broom<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">tidy</span>(fit)   <span class="co" style="color: #5E5E5E;"># This cleans up the fitted regression object</span></span>
<span id="cb6-85">  out <span class="ot" style="color: #003B4F;">=</span>fit_ <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-86">    <span class="fu" style="color: #4758AB;">filter</span>(term<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"d_i"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-87">    <span class="fu" style="color: #4758AB;">pull</span>(estimate)</span>
<span id="cb6-88">  </span>
<span id="cb6-89">  <span class="fu" style="color: #4758AB;">return</span>(out)</span>
<span id="cb6-90">}</span>
<span id="cb6-91"></span>
<span id="cb6-92"></span>
<span id="cb6-93"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">123</span>)</span>
<span id="cb6-94">df_c <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb6-95">  <span class="fu" style="color: #4758AB;">modifyList</span>(params_panel,<span class="fu" style="color: #4758AB;">list</span>(<span class="at" style="color: #657422;">T=</span><span class="dv" style="color: #AD0000;">400</span>,<span class="at" style="color: #657422;">tx_time=</span><span class="dv" style="color: #AD0000;">200</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-96">  <span class="fu" style="color: #4758AB;">dgp_panel</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-97">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">index =</span> t<span class="dv" style="color: #AD0000;">-200</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-98">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">T2=</span> <span class="fu" style="color: #4758AB;">as.integer</span>(index <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>,<span class="dv" style="color: #AD0000;">0</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-99">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">T4 =</span> <span class="fu" style="color: #4758AB;">as.integer</span>(index <span class="sc" style="color: #5E5E5E;">&gt;</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">3</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> index <span class="sc" style="color: #5E5E5E;">&lt;</span><span class="dv" style="color: #AD0000;">2</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-100">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">T10 =</span> <span class="fu" style="color: #4758AB;">as.integer</span>(index <span class="sc" style="color: #5E5E5E;">&gt;=</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">5</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> index<span class="sc" style="color: #5E5E5E;">&lt;</span><span class="dv" style="color: #AD0000;">5</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-101">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">T20 =</span> <span class="fu" style="color: #4758AB;">as.integer</span>(index <span class="sc" style="color: #5E5E5E;">&gt;=</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">10</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> index <span class="sc" style="color: #5E5E5E;">&lt;</span><span class="dv" style="color: #AD0000;">10</span> )) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-102">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">T50 =</span> <span class="dv" style="color: #AD0000;">1</span> ) </span>
<span id="cb6-103"></span>
<span id="cb6-104">df <span class="ot" style="color: #003B4F;">&lt;-</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(T4<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>)</span>
<span id="cb6-105"></span>
<span id="cb6-106">params_panel <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-107">  <span class="fu" style="color: #4758AB;">dgp_panel</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-108">  <span class="fu" style="color: #4758AB;">head</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-109">  <span class="fu" style="color: #4758AB;">kable</span>(<span class="at" style="color: #657422;">digits=</span><span class="dv" style="color: #AD0000;">3</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: right;">unit_id</th>
<th style="text-align: right;">t</th>
<th style="text-align: right;">y_i</th>
<th style="text-align: right;">x_i</th>
<th style="text-align: right;">d_i</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.855</td>
<td style="text-align: right;">0.502</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2.825</td>
<td style="text-align: right;">0.502</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5.893</td>
<td style="text-align: right;">1.434</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">7.620</td>
<td style="text-align: right;">1.434</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.225</td>
<td style="text-align: right;">2.166</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">6.555</td>
<td style="text-align: right;">2.166</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Let’s first show the equivalance between the random effect model and a quasi-demeaned linear regression model. We’ll do so by focusing on a case where <img src="https://latex.codecogs.com/png.latex?T=4">.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">fit_re <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb7-2">  df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;">estimator_fn_re</span>()</span>
<span id="cb7-4"></span>
<span id="cb7-5"><span class="fu" style="color: #4758AB;">summary</span>(fit_re)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: y_i ~ d_i + (1 | unit_id)
   Data: df

REML criterion at convergence: 14733.6

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.0705 -0.7249  0.1037  0.6245  2.0637 

Random effects:
 Groups   Name        Variance Std.Dev.
 unit_id  (Intercept) 5.462    2.337   
 Residual             1.085    1.041   
Number of obs: 4000, groups:  unit_id, 1000

Fixed effects:
            Estimate Std. Error t value
(Intercept)  0.29151    0.07661   3.805
d_i         -0.51889    0.04550 -11.403

Correlation of Fixed Effects:
    (Intr)
d_i -0.152</code></pre>
</div>
</div>
<ul>
<li>Notice the use of the term “fixed effects” is based on a traditional statistical definition–these are the regression parameters not assumed to come from a stochastic (statsitical) distribution, such as the random effects.</li>
</ul>
<p>Let’s now extract out the variance parameter estimates <img src="https://latex.codecogs.com/png.latex?%5Csigma%5E2_%7B%5Cepsilon%7D"> and <img src="https://latex.codecogs.com/png.latex?%5Csigma%5E2_u">:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">get_re <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(fit) {</span>
<span id="cb9-2">    x <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">VarCorr</span>(fit) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">data.frame</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb9-3">    <span class="fu" style="color: #4758AB;">tibble</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb9-4">    <span class="fu" style="color: #4758AB;">select</span>(grp,var1,vcov)</span>
<span id="cb9-5">}</span>
<span id="cb9-6"></span>
<span id="cb9-7">re_est <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb9-8">  fit_re <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb9-9">  <span class="fu" style="color: #4758AB;">get_re</span>()</span></code></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">grp</th>
<th style="text-align: left;">var1</th>
<th style="text-align: right;">vcov</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">unit_id</td>
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">5.462082</td>
</tr>
<tr class="even">
<td style="text-align: left;">Residual</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">1.084670</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We can then use these to calculatate <img src="https://latex.codecogs.com/png.latex?%5Ctheta">:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">sigma2_e <span class="ot" style="color: #003B4F;">=</span> fit_re <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">get_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(grp<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"Residual"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">pull</span>(vcov)</span>
<span id="cb10-2">sigma2_ui <span class="ot" style="color: #003B4F;">=</span> fit_re <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">get_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(grp<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"unit_id"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">pull</span>(vcov)</span>
<span id="cb10-3">theta_i <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">1</span> <span class="sc" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">sqrt</span>(sigma2_e<span class="sc" style="color: #5E5E5E;">/</span>(<span class="dv" style="color: #AD0000;">4</span><span class="sc" style="color: #5E5E5E;">*</span>sigma2_ui <span class="sc" style="color: #5E5E5E;">+</span> sigma2_e))</span>
<span id="cb10-4"></span>
<span id="cb10-5">theta_i</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7825205</code></pre>
</div>
</div>
<p>Next we will create a quasi-demeaned version of our input data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">df_ <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb12-2">  df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;">group_by</span>(unit_id) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb12-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">y_i =</span> y_i <span class="sc" style="color: #5E5E5E;">-</span> theta_i <span class="sc" style="color: #5E5E5E;">*</span> <span class="fu" style="color: #4758AB;">mean</span>(y_i),</span>
<span id="cb12-5">         <span class="at" style="color: #657422;">d_i =</span> d_i <span class="sc" style="color: #5E5E5E;">-</span> theta_i <span class="sc" style="color: #5E5E5E;">*</span> <span class="fu" style="color: #4758AB;">mean</span>(d_i))</span></code></pre></div>
</div>
<p>We now fit a quasi-demeaned</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">fit_qdm <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">lm</span>(y_i <span class="sc" style="color: #5E5E5E;">~</span> d_i, <span class="at" style="color: #657422;">data =</span> df_)</span>
<span id="cb13-2"><span class="fu" style="color: #4758AB;">summary</span>(fit_qdm)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y_i ~ d_i, data = df_)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.1586 -0.7768  0.0980  0.7425  3.2119 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.06340    0.01666   3.805 0.000144 ***
d_i         -0.51889    0.04550 -11.403  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.041 on 3998 degrees of freedom
Multiple R-squared:  0.0315,    Adjusted R-squared:  0.03126 
F-statistic:   130 on 1 and 3998 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Now let’s compare:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">res <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb15-2">  fit_qdm <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">tidy</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb15-3">  <span class="fu" style="color: #4758AB;">select</span>(term,<span class="at" style="color: #657422;">estimate_qdm =</span> estimate) </span>
<span id="cb15-4"></span>
<span id="cb15-5"><span class="fu" style="color: #4758AB;">cbind</span>(res,df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">estimator_fn_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">summary</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">pluck</span>(<span class="st" style="color: #20794D;">"coefficients"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb15-6">  <span class="fu" style="color: #4758AB;">data.frame</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb15-7">  <span class="fu" style="color: #4758AB;">select</span>(<span class="at" style="color: #657422;">estimate_re =</span> Estimate)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb15-8">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">theta =</span> theta_i) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb15-9">  <span class="fu" style="color: #4758AB;">select</span>(term, estimate_re, estimate_qdm, theta) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb15-10">  <span class="fu" style="color: #4758AB;">remove_rownames</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb15-11">  <span class="fu" style="color: #4758AB;">kable</span>(<span class="at" style="color: #657422;">digits =</span> <span class="dv" style="color: #AD0000;">3</span>)</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate_re</th>
<th style="text-align: right;">estimate_qdm</th>
<th style="text-align: right;">theta</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">0.292</td>
<td style="text-align: right;">0.063</td>
<td style="text-align: right;">0.783</td>
</tr>
<tr class="even">
<td style="text-align: left;">d_i</td>
<td style="text-align: right;">-0.519</td>
<td style="text-align: right;">-0.519</td>
<td style="text-align: right;">0.783</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">get_theta <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(fit) {</span>
<span id="cb16-2">  sigma2_e <span class="ot" style="color: #003B4F;">=</span> fit <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">get_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(grp<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"Residual"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">pull</span>(vcov)</span>
<span id="cb16-3">  sigma2_ui <span class="ot" style="color: #003B4F;">=</span> fit <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">get_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(grp<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"unit_id"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">pull</span>(vcov)</span>
<span id="cb16-4">  theta <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">1</span> <span class="sc" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">sqrt</span>(sigma2_e<span class="sc" style="color: #5E5E5E;">/</span>(<span class="dv" style="color: #AD0000;">4</span><span class="sc" style="color: #5E5E5E;">*</span>sigma2_ui <span class="sc" style="color: #5E5E5E;">+</span> sigma2_e))</span>
<span id="cb16-5">  theta </span>
<span id="cb16-6">}</span>
<span id="cb16-7"></span>
<span id="cb16-8">t_qdm <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">tibble</span>(</span>
<span id="cb16-9">  <span class="at" style="color: #657422;">T2 =</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(T2<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">estimator_fn_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">disc_fn_re</span>(),</span>
<span id="cb16-10">  <span class="at" style="color: #657422;">theta2  =</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(T2<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">estimator_fn_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">get_theta</span>(),</span>
<span id="cb16-11">  <span class="at" style="color: #657422;">T2fe =</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(T2<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">construct_dm</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">estimate_dm</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">disc_fn_dm</span>()  ,</span>
<span id="cb16-12">  <span class="at" style="color: #657422;">T4 =</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(T4<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">estimator_fn_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">disc_fn_re</span>(),</span>
<span id="cb16-13">  <span class="at" style="color: #657422;">theta4  =</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(T4<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">estimator_fn_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">get_theta</span>(),</span>
<span id="cb16-14">  <span class="at" style="color: #657422;">T4fe =</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(T4<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">construct_dm</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">estimate_dm</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">disc_fn_dm</span>()    ,</span>
<span id="cb16-15">  <span class="at" style="color: #657422;">T10 =</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(T10<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">estimator_fn_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">disc_fn_re</span>(),</span>
<span id="cb16-16">  <span class="at" style="color: #657422;">theta10  =</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(T10<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">estimator_fn_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">get_theta</span>(),  </span>
<span id="cb16-17">  <span class="at" style="color: #657422;">T10fe =</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(T10<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">construct_dm</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">estimate_dm</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">disc_fn_dm</span>()   ,</span>
<span id="cb16-18">  <span class="at" style="color: #657422;">T20 =</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(T20<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">estimator_fn_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">disc_fn_re</span>(),</span>
<span id="cb16-19">  <span class="at" style="color: #657422;">theta20  =</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(T20<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">estimator_fn_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">get_theta</span>(),  </span>
<span id="cb16-20">  <span class="at" style="color: #657422;">T20fe =</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(T20<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">construct_dm</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">estimate_dm</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">disc_fn_dm</span>()  ,</span>
<span id="cb16-21">  <span class="at" style="color: #657422;">T400 =</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span>  <span class="fu" style="color: #4758AB;">estimator_fn_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">disc_fn_re</span>(),</span>
<span id="cb16-22">  <span class="at" style="color: #657422;">theta400 =</span>  df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span>  <span class="fu" style="color: #4758AB;">estimator_fn_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">get_theta</span>(),</span>
<span id="cb16-23">  <span class="at" style="color: #657422;">T400fe =</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">construct_dm</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">estimate_dm</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">disc_fn_dm</span>()</span>
<span id="cb16-24">)</span>
<span id="cb16-25">  </span>
<span id="cb16-26">t_qdm <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb16-27">  <span class="fu" style="color: #4758AB;">select</span>(<span class="sc" style="color: #5E5E5E;">-</span><span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"theta"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb16-28">  <span class="fu" style="color: #4758AB;">gather</span>(measure,value) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb16-29">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">method =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(<span class="fu" style="color: #4758AB;">grepl</span>(<span class="st" style="color: #20794D;">"fe"</span>,measure),<span class="st" style="color: #20794D;">"FE"</span>,<span class="st" style="color: #20794D;">"RE"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb16-30">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">measure =</span> <span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"fe"</span>,<span class="st" style="color: #20794D;">""</span>,measure)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb16-31">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">measure =</span> <span class="fu" style="color: #4758AB;">case_when</span>(measure <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"T2"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"T = 2"</span>,</span>
<span id="cb16-32">                             measure <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"T4"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"T = 4"</span>,</span>
<span id="cb16-33">                             measure <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"T10"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"T = 10"</span>,</span>
<span id="cb16-34">                             measure <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"T20"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"T = 20"</span>,</span>
<span id="cb16-35">                             measure <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"T400"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"T = 400"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb16-36">  <span class="fu" style="color: #4758AB;">rename</span>(<span class="at" style="color: #657422;">time_periods =</span> measure) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb16-37">  <span class="fu" style="color: #4758AB;">spread</span>(method, value) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb16-38">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">time_periods =</span> <span class="fu" style="color: #4758AB;">factor</span>(time_periods, <span class="at" style="color: #657422;">levels =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"T = 2"</span>,<span class="st" style="color: #20794D;">"T = 4"</span>, <span class="st" style="color: #20794D;">"T = 10"</span>,<span class="st" style="color: #20794D;">"T = 20"</span> , <span class="st" style="color: #20794D;">"T = 400"</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb16-39">  <span class="fu" style="color: #4758AB;">arrange</span>(time_periods) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb16-40">  <span class="fu" style="color: #4758AB;">kable</span>()</span></code></pre></div>
</details>
</div>


</section>

 ]]></description>
  <guid>https://graveja0.github.io/HPOL8539-F2022/blog/posts/quasi-demeaning.html</guid>
  <pubDate>Tue, 13 Sep 2022 21:35:33 GMT</pubDate>
</item>
</channel>
</rss>
