<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Advanced Program and Policy Evaluation (HPOL8539)</title>
<link>https://graveja0.github.io/HPOL8539-F2022/blog/index.html</link>
<atom:link href="https://graveja0.github.io/HPOL8539-F2022/blog/index.xml" rel="self" type="application/rss+xml"/>
<description></description>
<generator>quarto-1.0.36</generator>
<lastBuildDate>Wed, 07 Sep 2022 02:25:17 GMT</lastBuildDate>
<item>
  <title>Generalized Estimating Equations</title>
  <link>https://graveja0.github.io/HPOL8539-F2022/blog/posts/gee.html</link>
  <description><![CDATA[ 



<p><a href="https://data.library.virginia.edu/getting-started-with-generalized-estimating-equations/">Source</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──
✔ ggplot2 3.3.6     ✔ purrr   0.3.4
✔ tibble  3.1.8     ✔ dplyr   1.0.9
✔ tidyr   1.2.0     ✔ stringr 1.4.1
✔ readr   2.1.2     ✔ forcats 0.5.2
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;">library</span>(lme4)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Matrix

Attaching package: 'Matrix'

The following objects are masked from 'package:tidyr':

    expand, pack, unpack</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;">library</span>(broom)</span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;">library</span>(knitr)</span>
<span id="cb5-3"><span class="fu" style="color: #4758AB;">library</span>(gee)</span>
<span id="cb5-4"><span class="fu" style="color: #4758AB;">theme_set</span>(<span class="fu" style="color: #4758AB;">theme_bw</span>())</span>
<span id="cb5-5"><span class="fu" style="color: #4758AB;">options</span>(<span class="st" style="color: #20794D;">"scipen"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">100</span>, <span class="st" style="color: #20794D;">"digits"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">5</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: right;">unit_id</th>
<th style="text-align: right;">t</th>
<th style="text-align: right;">y_i</th>
<th style="text-align: right;">x_i</th>
<th style="text-align: right;">d_i</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-1.542</td>
<td style="text-align: right;">-1.368</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">-2.962</td>
<td style="text-align: right;">-1.368</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-2.419</td>
<td style="text-align: right;">-0.414</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">-2.595</td>
<td style="text-align: right;">-0.414</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.109</td>
<td style="text-align: right;">0.668</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.208</td>
<td style="text-align: right;">0.668</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;">library</span>(geepack)</span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;">library</span>(nlme)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'nlme'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:lme4':

    lmList</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    collapse</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;">#https://m-clark.github.io/clustered-data/gee.html</span></span>
<span id="cb10-2"><span class="fu" style="color: #4758AB;">geeglm</span>(y_i <span class="sc" style="color: #5E5E5E;">~</span> d_i, <span class="at" style="color: #657422;">data=</span>df, <span class="at" style="color: #657422;">id=</span>unit_id)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
geeglm(formula = y_i ~ d_i, data = df, id = unit_id)

Coefficients:
(Intercept)         d_i 
    2.04211    -0.33648 

Degrees of Freedom: 40000 Total (i.e. Null);  39998 Residual

Scale Link:                   identity
Estimated Scale Parameters:  [1] 10.278

Correlation:  Structure = independence  
Number of clusters:   2000   Maximum cluster size: 20 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;">lme</span>(y_i <span class="sc" style="color: #5E5E5E;">~</span> d_i, <span class="at" style="color: #657422;">data=</span>df, <span class="at" style="color: #657422;">random =</span> <span class="sc" style="color: #5E5E5E;">~</span><span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">|</span>unit_id, </span>
<span id="cb12-2">                        <span class="at" style="color: #657422;">control=</span><span class="fu" style="color: #4758AB;">lmeControl</span>(<span class="at" style="color: #657422;">opt=</span><span class="st" style="color: #20794D;">'optim'</span>), <span class="at" style="color: #657422;">method=</span><span class="st" style="color: #20794D;">'ML'</span>)  </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed-effects model fit by maximum likelihood
  Data: df 
  Log-likelihood: -93325
  Fixed: y_i ~ d_i 
(Intercept)         d_i 
    2.13476    -0.70197 

Random effects:
 Formula: ~1 | unit_id
        (Intercept) Residual
StdDev:      2.2219   2.3165

Number of Observations: 40000
Number of Groups: 2000 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">construct_dm</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">estimate_dm</span>() </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y_i ~ d_i, data = df)

Coefficients:
         (Intercept)                   d_i  
 0.00000000000000177  -0.73162297645096519  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="fu" style="color: #4758AB;">gee</span>(y_i <span class="sc" style="color: #5E5E5E;">~</span> x_i <span class="sc" style="color: #5E5E5E;">+</span> d_i, <span class="at" style="color: #657422;">data =</span> df, <span class="at" style="color: #657422;">id =</span> unit_id,</span>
<span id="cb16-2">    <span class="at" style="color: #657422;">family =</span> gaussian,<span class="at" style="color: #657422;">corstr=</span><span class="st" style="color: #20794D;">"exchangeable"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">summary</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> {.<span class="sc" style="color: #5E5E5E;">$</span>coefficients} <span class="sc" style="color: #5E5E5E;">%&gt;%</span> {.[<span class="st" style="color: #20794D;">"d_i"</span>,]} <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">round</span>(.,<span class="dv" style="color: #AD0000;">3</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Beginning Cgee S-function, @(#) geeformula.q 4.13 98/01/27</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>running glm to get initial regression estimate</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)         x_i         d_i 
    2.03488     2.02944    -0.36911 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   Estimate  Naive S.E.     Naive z Robust S.E.    Robust z 
     -0.611       0.031     -19.898       0.012     -50.426 </code></pre>
</div>
</div>



 ]]></description>
  <guid>https://graveja0.github.io/HPOL8539-F2022/blog/posts/gee.html</guid>
  <pubDate>Wed, 07 Sep 2022 02:25:17 GMT</pubDate>
</item>
<item>
  <title>Using Simulation to Calculate Power and Minimum Detectable Effects</title>
  <link>https://graveja0.github.io/HPOL8539-F2022/blog/posts/post1.html</link>
  <description><![CDATA[ 



<p>This posting will walk through the steps to perform power and minimum detectable effect calculations via simulation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(mcreplicate)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;">library</span>(tictoc)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;">library</span>(CVXR)</span></code></pre></div>
</div>
<section id="define-the-data-generation-process" class="level1">
<h1>Define the Data Generation Process</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">params <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb2-2">    <span class="fu" style="color: #4758AB;">list</span>(</span>
<span id="cb2-3">        <span class="at" style="color: #657422;">n =</span> <span class="dv" style="color: #AD0000;">100</span>,</span>
<span id="cb2-4">        <span class="at" style="color: #657422;">p =</span> <span class="dv" style="color: #AD0000;">1</span>,</span>
<span id="cb2-5">        <span class="at" style="color: #657422;">beta =</span> <span class="dv" style="color: #AD0000;">0</span></span>
<span id="cb2-6">    )</span></code></pre></div>
</div>
<p>Now we define the data generation process formula:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">dgp <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(params) {</span>
<span id="cb3-2">    <span class="fu" style="color: #4758AB;">with</span>(params,{</span>
<span id="cb3-3">        X <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">matrix</span>(<span class="fu" style="color: #4758AB;">rnorm</span>(n <span class="sc" style="color: #5E5E5E;">*</span> p), <span class="at" style="color: #657422;">nrow=</span>n)</span>
<span id="cb3-4">        <span class="fu" style="color: #4758AB;">colnames</span>(X) <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">paste0</span>(<span class="st" style="color: #20794D;">"beta_"</span>, beta)</span>
<span id="cb3-5">        Y <span class="ot" style="color: #003B4F;">&lt;-</span> X <span class="sc" style="color: #5E5E5E;">%*%</span> beta <span class="sc" style="color: #5E5E5E;">+</span> <span class="fu" style="color: #4758AB;">rnorm</span>(n)</span>
<span id="cb3-6">        <span class="fu" style="color: #4758AB;">data.frame</span>(Y,X)</span>
<span id="cb3-7">    })</span>
<span id="cb3-8">}</span></code></pre></div>
</div>
</section>
<section id="define-the-estimator" class="level1">
<h1>Define the Estimator</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">est <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(df) {</span>
<span id="cb4-2">    Y <span class="ot" style="color: #003B4F;">&lt;-</span> df[,<span class="st" style="color: #20794D;">"Y"</span>]</span>
<span id="cb4-3">    X <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">as.matrix</span>(df[,<span class="fu" style="color: #4758AB;">setdiff</span>(<span class="fu" style="color: #4758AB;">colnames</span>(df),<span class="st" style="color: #20794D;">"Y"</span>)])</span>
<span id="cb4-4">    ls.model <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">lm</span>(Y <span class="sc" style="color: #5E5E5E;">~</span> <span class="dv" style="color: #AD0000;">0</span> <span class="sc" style="color: #5E5E5E;">+</span> X)   <span class="co" style="color: #5E5E5E;"># There is no intercept in our model above</span></span>
<span id="cb4-5">    m <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">data.frame</span>(<span class="at" style="color: #657422;">ls.est =</span> <span class="fu" style="color: #4758AB;">coef</span>(ls.model))</span>
<span id="cb4-6">    <span class="fu" style="color: #4758AB;">rownames</span>(m) <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"Xbeta"</span>,<span class="st" style="color: #20794D;">"beta"</span>,<span class="fu" style="color: #4758AB;">rownames</span>(m))</span>
<span id="cb4-7">    m <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">cbind</span>(m,<span class="fu" style="color: #4758AB;">confint</span>(ls.model))</span>
<span id="cb4-8">    m</span>
<span id="cb4-9">}</span></code></pre></div>
</div>
</section>
<section id="define-the-discrimination-function" class="level1">
<h1>Define the discrimination function</h1>
<ul>
<li>Reject if 0 is within the 95% confidence interval.</li>
<li>Accept is 1 minus the above.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">disc <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(fit) {</span>
<span id="cb5-2">    beta.hat <span class="ot" style="color: #003B4F;">&lt;-</span> fit[<span class="st" style="color: #20794D;">"X"</span>,]</span>
<span id="cb5-3">    accept <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">-</span><span class="fu" style="color: #4758AB;">as.integer</span>(dplyr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">between</span>(<span class="dv" style="color: #AD0000;">0</span>,beta.hat[,<span class="dv" style="color: #AD0000;">2</span>],beta.hat[,<span class="dv" style="color: #AD0000;">3</span>]))</span>
<span id="cb5-4">    <span class="fu" style="color: #4758AB;">return</span>(accept)</span>
<span id="cb5-5">}</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">est_power <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(params) {</span>
<span id="cb6-2">    <span class="fu" style="color: #4758AB;">cat</span>(params<span class="sc" style="color: #5E5E5E;">$</span>beta)</span>
<span id="cb6-3">    <span class="fu" style="color: #4758AB;">cat</span>(<span class="st" style="color: #20794D;">"</span><span class="sc" style="color: #5E5E5E;">\n</span><span class="st" style="color: #20794D;">"</span>)</span>
<span id="cb6-4">    params <span class="sc" style="color: #5E5E5E;">%&gt;%</span>  </span>
<span id="cb6-5">      <span class="fu" style="color: #4758AB;">dgp</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span>  </span>
<span id="cb6-6">        <span class="fu" style="color: #4758AB;">est</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-7">          <span class="fu" style="color: #4758AB;">disc</span>()</span>
<span id="cb6-8"></span>
<span id="cb6-9">}</span></code></pre></div>
</div>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<section id="power" class="level2">
<h2 class="anchored" data-anchor-id="power">Power</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">B <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">1000</span></span>
<span id="cb7-2">power <span class="ot" style="color: #003B4F;">=</span></span>
<span id="cb7-3">    <span class="fu" style="color: #4758AB;">seq</span>(<span class="dv" style="color: #AD0000;">100</span>,<span class="dv" style="color: #AD0000;">1000</span>,<span class="dv" style="color: #AD0000;">100</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb7-4">    <span class="fu" style="color: #4758AB;">map</span>(<span class="sc" style="color: #5E5E5E;">~</span>(<span class="fu" style="color: #4758AB;">mc_replicate</span>(B,<span class="fu" style="color: #4758AB;">est_power</span>(<span class="fu" style="color: #4758AB;">modifyList</span>(params,<span class="fu" style="color: #4758AB;">list</span>(<span class="at" style="color: #657422;">beta =</span> .<span class="dv" style="color: #AD0000;">1</span>,<span class="at" style="color: #657422;">n=</span>.x))),<span class="at" style="color: #657422;">mc.cores=</span><span class="dv" style="color: #AD0000;">10</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb7-5">    <span class="fu" style="color: #4758AB;">map_dbl</span>(<span class="sc" style="color: #5E5E5E;">~</span>(<span class="fu" style="color: #4758AB;">mean</span>(.x)))  <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb7-6">    <span class="fu" style="color: #4758AB;">data.frame</span>(<span class="at" style="color: #657422;">row.names =</span> <span class="fu" style="color: #4758AB;">seq</span>(<span class="dv" style="color: #AD0000;">100</span>,<span class="dv" style="color: #AD0000;">1000</span>,<span class="dv" style="color: #AD0000;">100</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb7-7">    <span class="fu" style="color: #4758AB;">rownames_to_column</span>(<span class="at" style="color: #657422;">var =</span> <span class="st" style="color: #20794D;">"N"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb7-8">    <span class="fu" style="color: #4758AB;">set_names</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"N"</span>,<span class="st" style="color: #20794D;">"power"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb7-9">    <span class="fu" style="color: #4758AB;">as_tibble</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb7-10">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">N =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(N)))</span></code></pre></div>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">power <span class="sc" style="color: #5E5E5E;">%&gt;%</span> knitr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">kable</span>()</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: right;">N</th>
<th style="text-align: right;">power</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">100</td>
<td style="text-align: right;">0.176</td>
</tr>
<tr class="even">
<td style="text-align: right;">200</td>
<td style="text-align: right;">0.293</td>
</tr>
<tr class="odd">
<td style="text-align: right;">300</td>
<td style="text-align: right;">0.427</td>
</tr>
<tr class="even">
<td style="text-align: right;">400</td>
<td style="text-align: right;">0.503</td>
</tr>
<tr class="odd">
<td style="text-align: right;">500</td>
<td style="text-align: right;">0.595</td>
</tr>
<tr class="even">
<td style="text-align: right;">600</td>
<td style="text-align: right;">0.685</td>
</tr>
<tr class="odd">
<td style="text-align: right;">700</td>
<td style="text-align: right;">0.752</td>
</tr>
<tr class="even">
<td style="text-align: right;">800</td>
<td style="text-align: right;">0.789</td>
</tr>
<tr class="odd">
<td style="text-align: right;">900</td>
<td style="text-align: right;">0.842</td>
</tr>
<tr class="even">
<td style="text-align: right;">1000</td>
<td style="text-align: right;">0.885</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">power <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb9-2">    <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> N , <span class="at" style="color: #657422;">y =</span> power)) <span class="sc" style="color: #5E5E5E;">+</span> <span class="fu" style="color: #4758AB;">geom_line</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-3">    ggthemes<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">theme_few</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/post1_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="minimum-detectable-effects" class="level1">
<h1>Minimum Detectable Effects</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">calc_mde <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(.x, <span class="at" style="color: #657422;">B=</span><span class="dv" style="color: #AD0000;">10000</span>) {</span>
<span id="cb10-2">    power <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">mc_replicate</span>(B,<span class="fu" style="color: #4758AB;">est_power</span>(<span class="fu" style="color: #4758AB;">modifyList</span>(params,<span class="fu" style="color: #4758AB;">list</span>(<span class="at" style="color: #657422;">beta =</span> .x,<span class="at" style="color: #657422;">n=</span><span class="dv" style="color: #AD0000;">1000</span>))),<span class="at" style="color: #657422;">mc.cores=</span><span class="dv" style="color: #AD0000;">10</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">mean</span>()</span>
<span id="cb10-3">    <span class="fu" style="color: #4758AB;">abs</span>(power<span class="fl" style="color: #AD0000;">-.8</span>)</span>
<span id="cb10-4">}</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">search_grid <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">seq</span>(<span class="dv" style="color: #AD0000;">0</span>,.<span class="dv" style="color: #AD0000;">1</span>,<span class="fl" style="color: #AD0000;">0.01</span>)</span>
<span id="cb11-2">mde <span class="ot" style="color: #003B4F;">=</span></span>
<span id="cb11-3">    search_grid <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb11-4">    <span class="fu" style="color: #4758AB;">map</span>(<span class="sc" style="color: #5E5E5E;">~</span>(<span class="fu" style="color: #4758AB;">mc_replicate</span>(B,<span class="fu" style="color: #4758AB;">est_power</span>(<span class="fu" style="color: #4758AB;">modifyList</span>(params,<span class="fu" style="color: #4758AB;">list</span>(<span class="at" style="color: #657422;">beta =</span> .x,<span class="at" style="color: #657422;">n=</span><span class="dv" style="color: #AD0000;">1000</span>))),<span class="at" style="color: #657422;">mc.cores=</span><span class="dv" style="color: #AD0000;">10</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb11-5">    <span class="fu" style="color: #4758AB;">map_dbl</span>(<span class="sc" style="color: #5E5E5E;">~</span>(<span class="fu" style="color: #4758AB;">mean</span>(.x)))  <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb11-6">    <span class="fu" style="color: #4758AB;">data.frame</span>(<span class="at" style="color: #657422;">row.names =</span> search_grid) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb11-7">    <span class="fu" style="color: #4758AB;">rownames_to_column</span>(<span class="at" style="color: #657422;">var =</span> <span class="st" style="color: #20794D;">"N"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb11-8">    <span class="fu" style="color: #4758AB;">set_names</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"beta"</span>,<span class="st" style="color: #20794D;">"power"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb11-9">    <span class="fu" style="color: #4758AB;">as_tibble</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb11-10">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">beta =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(beta)))</span></code></pre></div>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">mde <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb12-2">    <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> beta, <span class="at" style="color: #657422;">y =</span> power)) <span class="sc" style="color: #5E5E5E;">+</span> <span class="fu" style="color: #4758AB;">geom_line</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb12-3">    ggthemes<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">theme_few</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb12-4">    <span class="fu" style="color: #4758AB;">ylim</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">0</span>,<span class="dv" style="color: #AD0000;">1</span>)) <span class="sc" style="color: #5E5E5E;">+</span> <span class="fu" style="color: #4758AB;">geom_hline</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">yintercept =</span><span class="fl" style="color: #AD0000;">0.8</span>),<span class="at" style="color: #657422;">lty=</span><span class="dv" style="color: #AD0000;">2</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/post1_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">closest <span class="ot" style="color: #003B4F;">&lt;-</span> mde<span class="sc" style="color: #5E5E5E;">$</span>beta[<span class="fu" style="color: #4758AB;">which</span>(<span class="fu" style="color: #4758AB;">abs</span>(mde<span class="sc" style="color: #5E5E5E;">$</span>power<span class="fl" style="color: #AD0000;">-.8</span>)<span class="sc" style="color: #5E5E5E;">==</span><span class="fu" style="color: #4758AB;">min</span>(<span class="fu" style="color: #4758AB;">abs</span>(mde<span class="sc" style="color: #5E5E5E;">$</span>power<span class="fl" style="color: #AD0000;">-.8</span>)))]</span>
<span id="cb13-2">closest</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.09</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;">tic</span>()</span>
<span id="cb15-2"><span class="fu" style="color: #4758AB;">optim</span>(closest,calc_mde,<span class="at" style="color: #657422;">method =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Nelder-Mead"</span>))</span>
<span id="cb15-3"><span class="fu" style="color: #4758AB;">toc</span>()</span></code></pre></div>
</div>


</section>

 ]]></description>
  <guid>https://graveja0.github.io/HPOL8539-F2022/blog/posts/post1.html</guid>
  <pubDate>Wed, 07 Sep 2022 02:25:17 GMT</pubDate>
</item>
<item>
  <title>Two-Way Fixed Effects, the Two-Way Mundlak Regression, and Difference-in-Difference Estimators</title>
  <link>https://graveja0.github.io/HPOL8539-F2022/blog/posts/twfe-twm-and-did.html</link>
  <description><![CDATA[ 



<p>The objective of this posting is to walk through various data structuring and estimation issues for fitting two-way fixed effects, two-way Mundlak regressions, and difference-in-difference estimators.</p>
<p>Note that this is adapted from <code>staggered_6.do</code>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">library</span>(fastDummies)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;">library</span>(glue)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;">library</span>(broom)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;">library</span>(lme4)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;">library</span>(fixest)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;">library</span>(directlabels)</span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;">library</span>(ggthemes)</span>
<span id="cb1-9"><span class="fu" style="color: #4758AB;">library</span>(knitr)</span>
<span id="cb1-10"><span class="fu" style="color: #4758AB;">library</span>(kableExtra)</span>
<span id="cb1-11"><span class="fu" style="color: #4758AB;">library</span>(gt)</span>
<span id="cb1-12"><span class="fu" style="color: #4758AB;">library</span>(did)</span>
<span id="cb1-13"></span>
<span id="cb1-14"><span class="fu" style="color: #4758AB;">options</span>(<span class="st" style="color: #20794D;">"RStata.StataPath"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="st" style="color: #20794D;">"/Applications/Stata/StataSE.app/Contents/MacOS/stata-se"</span>)</span>
<span id="cb1-15"><span class="fu" style="color: #4758AB;">options</span>(<span class="st" style="color: #20794D;">"RStata.StataVersion"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">16</span>)</span>
<span id="cb1-16">    </span>
<span id="cb1-17"><span class="fu" style="color: #4758AB;">options</span>(<span class="at" style="color: #657422;">dplyr.summarise.inform =</span> <span class="cn" style="color: #8f5902;">FALSE</span>)</span>
<span id="cb1-18"></span>
<span id="cb1-19">theme_tufte_grid <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(<span class="at" style="color: #657422;">base_size =</span> <span class="dv" style="color: #AD0000;">16</span>, <span class="at" style="color: #657422;">base_family =</span> <span class="st" style="color: #20794D;">"Gill Sans"</span>, <span class="at" style="color: #657422;">ticks =</span> <span class="cn" style="color: #8f5902;">TRUE</span>) {</span>
<span id="cb1-20">  </span>
<span id="cb1-21">  ret <span class="ot" style="color: #003B4F;">&lt;-</span> ggplot2<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">theme_bw</span>(<span class="at" style="color: #657422;">base_family =</span> base_family, <span class="at" style="color: #657422;">base_size =</span> base_size) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb1-22">    ggplot2<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">theme</span>(</span>
<span id="cb1-23">      <span class="at" style="color: #657422;">axis.line =</span> ggplot2<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">element_blank</span>(),</span>
<span id="cb1-24">      <span class="at" style="color: #657422;">axis.ticks =</span> ggplot2<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">element_blank</span>(),</span>
<span id="cb1-25">      <span class="at" style="color: #657422;">axis.title.x =</span> ggplot2<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">element_text</span>(<span class="at" style="color: #657422;">vjust =</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">0.3</span>),</span>
<span id="cb1-26">      <span class="at" style="color: #657422;">axis.title.y =</span> ggplot2<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">element_text</span>(<span class="at" style="color: #657422;">vjust =</span> <span class="fl" style="color: #AD0000;">0.8</span>),</span>
<span id="cb1-27">      <span class="at" style="color: #657422;">legend.background =</span> ggplot2<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">element_blank</span>(),</span>
<span id="cb1-28">      <span class="at" style="color: #657422;">legend.key =</span> ggplot2<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">element_blank</span>(),</span>
<span id="cb1-29">      <span class="at" style="color: #657422;">legend.title =</span> ggplot2<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">element_text</span>(<span class="at" style="color: #657422;">face=</span><span class="st" style="color: #20794D;">"plain"</span>),</span>
<span id="cb1-30">      <span class="at" style="color: #657422;">panel.background =</span> ggplot2<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">element_blank</span>(),</span>
<span id="cb1-31">      <span class="at" style="color: #657422;">panel.border =</span> ggplot2<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">element_blank</span>(),</span>
<span id="cb1-32">      <span class="at" style="color: #657422;">panel.grid =</span> ggplot2<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">element_blank</span>(),</span>
<span id="cb1-33">      <span class="at" style="color: #657422;">plot.background =</span> ggplot2<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">element_blank</span>(),</span>
<span id="cb1-34">      <span class="at" style="color: #657422;">strip.background =</span> ggplot2<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">element_blank</span>()</span>
<span id="cb1-35">    )</span>
<span id="cb1-36">  </span>
<span id="cb1-37">  <span class="cf" style="color: #003B4F;">if</span> (<span class="sc" style="color: #5E5E5E;">!</span>ticks) {</span>
<span id="cb1-38">    ret <span class="ot" style="color: #003B4F;">&lt;-</span> ret <span class="sc" style="color: #5E5E5E;">+</span> ggplot2<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">axis.ticks =</span> ggplot2<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">element_blank</span>())</span>
<span id="cb1-39">  }</span>
<span id="cb1-40">  </span>
<span id="cb1-41">  ret</span>
<span id="cb1-42">}</span>
<span id="cb1-43">invthm <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb1-44">  <span class="fu" style="color: #4758AB;">theme</span>(</span>
<span id="cb1-45">    <span class="at" style="color: #657422;">panel.background =</span> <span class="fu" style="color: #4758AB;">element_rect</span>(<span class="at" style="color: #657422;">fill =</span> <span class="st" style="color: #20794D;">"transparent"</span>, <span class="at" style="color: #657422;">colour =</span> <span class="cn" style="color: #8f5902;">NA</span>), </span>
<span id="cb1-46">    <span class="at" style="color: #657422;">plot.background =</span> <span class="fu" style="color: #4758AB;">element_rect</span>(<span class="at" style="color: #657422;">fill =</span> <span class="st" style="color: #20794D;">"transparent"</span>, <span class="at" style="color: #657422;">colour =</span> <span class="cn" style="color: #8f5902;">NA</span>),</span>
<span id="cb1-47">    <span class="at" style="color: #657422;">legend.background =</span> <span class="fu" style="color: #4758AB;">element_rect</span>(<span class="at" style="color: #657422;">fill =</span> <span class="st" style="color: #20794D;">"transparent"</span>, <span class="at" style="color: #657422;">colour =</span> <span class="cn" style="color: #8f5902;">NA</span>),</span>
<span id="cb1-48">    <span class="at" style="color: #657422;">legend.key =</span> <span class="fu" style="color: #4758AB;">element_rect</span>(<span class="at" style="color: #657422;">fill =</span> <span class="st" style="color: #20794D;">"transparent"</span>, <span class="at" style="color: #657422;">colour =</span> <span class="cn" style="color: #8f5902;">NA</span>),</span>
<span id="cb1-49">    <span class="at" style="color: #657422;">text =</span> <span class="fu" style="color: #4758AB;">element_text</span>(<span class="at" style="color: #657422;">colour =</span> <span class="st" style="color: #20794D;">"black"</span>),</span>
<span id="cb1-50">    <span class="at" style="color: #657422;">axis.text =</span> <span class="fu" style="color: #4758AB;">element_text</span>(<span class="at" style="color: #657422;">colour =</span> <span class="st" style="color: #20794D;">"black"</span>),</span>
<span id="cb1-51">    <span class="at" style="color: #657422;">legend.position =</span> <span class="st" style="color: #20794D;">'none'</span>,</span>
<span id="cb1-52">    <span class="at" style="color: #657422;">legend.title =</span> <span class="fu" style="color: #4758AB;">element_blank</span>(),</span>
<span id="cb1-53">    <span class="at" style="color: #657422;">plot.title =</span> <span class="fu" style="color: #4758AB;">element_text</span>(<span class="at" style="color: #657422;">hjust =</span> <span class="fl" style="color: #AD0000;">0.5</span>),</span>
<span id="cb1-54">    <span class="at" style="color: #657422;">plot.subtitle =</span> <span class="fu" style="color: #4758AB;">element_text</span>(<span class="at" style="color: #657422;">hjust =</span> <span class="fl" style="color: #AD0000;">0.5</span>),</span>
<span id="cb1-55">    <span class="at" style="color: #657422;">axis.title.y =</span> <span class="fu" style="color: #4758AB;">element_text</span>(<span class="at" style="color: #657422;">hjust =</span> <span class="fl" style="color: #AD0000;">0.5</span>, <span class="at" style="color: #657422;">vjust =</span> <span class="fl" style="color: #AD0000;">0.5</span>, <span class="at" style="color: #657422;">angle =</span> <span class="dv" style="color: #AD0000;">360</span>)</span>
<span id="cb1-56">  )</span>
<span id="cb1-57">make_data <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(params, <span class="at" style="color: #657422;">N =</span> <span class="dv" style="color: #AD0000;">1000</span>, <span class="at" style="color: #657422;">start =</span> <span class="dv" style="color: #AD0000;">1980</span>, <span class="at" style="color: #657422;">stop =</span> <span class="dv" style="color: #AD0000;">2015</span>) {</span>
<span id="cb1-58">  mu <span class="ot" style="color: #003B4F;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;">$</span>mu</span>
<span id="cb1-59">  mu_t <span class="ot" style="color: #003B4F;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;">$</span>mu_t</span>
<span id="cb1-60">  tx <span class="ot" style="color: #003B4F;">=</span> params<span class="sc" style="color: #5E5E5E;">$</span>tx</span>
<span id="cb1-61">  bin <span class="ot" style="color: #003B4F;">&lt;-</span> params<span class="sc" style="color: #5E5E5E;">$</span>bin</span>
<span id="cb1-62"></span>
<span id="cb1-63">  <span class="co" style="color: #5E5E5E;"># year fixed effects</span></span>
<span id="cb1-64">  year <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">tibble</span>(</span>
<span id="cb1-65">    <span class="at" style="color: #657422;">year =</span> start<span class="sc" style="color: #5E5E5E;">:</span>stop,</span>
<span id="cb1-66">    <span class="at" style="color: #657422;">year_fe =</span> <span class="fu" style="color: #4758AB;">rnorm</span>(<span class="fu" style="color: #4758AB;">length</span>(start<span class="sc" style="color: #5E5E5E;">:</span>stop), <span class="dv" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">0.5</span>))</span>
<span id="cb1-67"></span>
<span id="cb1-68">  df_truth_ <span class="ot" style="color: #003B4F;">&lt;-</span><span class="fu" style="color: #4758AB;">suppressWarnings</span>({</span>
<span id="cb1-69">    <span class="fu" style="color: #4758AB;">map</span>(tx,<span class="sc" style="color: #5E5E5E;">~</span>(.x <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">data.frame</span>())) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-70">      <span class="fu" style="color: #4758AB;">bind_rows</span>(<span class="at" style="color: #657422;">.id =</span> <span class="st" style="color: #20794D;">"tx"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-71">      <span class="fu" style="color: #4758AB;">set_names</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"group"</span>,<span class="st" style="color: #20794D;">"state"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-72">      <span class="fu" style="color: #4758AB;">as_tibble</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-73">      <span class="fu" style="color: #4758AB;">suppressMessages</span>(<span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(group)))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-74">      <span class="fu" style="color: #4758AB;">left_join</span>(</span>
<span id="cb1-75">        <span class="fu" style="color: #4758AB;">map</span>(mu,<span class="sc" style="color: #5E5E5E;">~</span>(.x <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">data.frame</span>())) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-76">          <span class="fu" style="color: #4758AB;">bind_rows</span>(<span class="at" style="color: #657422;">.id =</span> <span class="st" style="color: #20794D;">"tx"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-77">          <span class="fu" style="color: #4758AB;">set_names</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"group"</span>,<span class="st" style="color: #20794D;">"mu"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-78">          <span class="fu" style="color: #4758AB;">inner_join</span>(</span>
<span id="cb1-79">            <span class="fu" style="color: #4758AB;">map</span>(mu_t,<span class="sc" style="color: #5E5E5E;">~</span>(.x <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">data.frame</span>())) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-80">              <span class="fu" style="color: #4758AB;">bind_rows</span>(<span class="at" style="color: #657422;">.id =</span> <span class="st" style="color: #20794D;">"tx"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-81">              <span class="fu" style="color: #4758AB;">set_names</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"group"</span>,<span class="st" style="color: #20794D;">"mu_t"</span>)),<span class="st" style="color: #20794D;">"group"</span></span>
<span id="cb1-82">          ), <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"group"</span>)</span>
<span id="cb1-83">      ) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-84">      <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(<span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(group),<span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(group)),<span class="cn" style="color: #8f5902;">NA</span>))</span>
<span id="cb1-85">  })</span>
<span id="cb1-86"></span>
<span id="cb1-87">  <span class="co" style="color: #5E5E5E;"># For dynamic treatment effects</span></span>
<span id="cb1-88">  df_truth_t <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb1-89">    <span class="fu" style="color: #4758AB;">crossing</span>(<span class="at" style="color: #657422;">state =</span> <span class="fu" style="color: #4758AB;">unique</span>(df_truth_<span class="sc" style="color: #5E5E5E;">$</span>state), <span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">unique</span>(year<span class="sc" style="color: #5E5E5E;">$</span>year)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-90">    <span class="fu" style="color: #4758AB;">left_join</span>(df_truth_,<span class="st" style="color: #20794D;">"state"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-91">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">rel_time =</span> <span class="fu" style="color: #4758AB;">pmax</span>(year<span class="sc" style="color: #5E5E5E;">-</span>group)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-92">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">tau =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(<span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(mu) <span class="sc" style="color: #5E5E5E;">&amp;</span> rel_time<span class="sc" style="color: #5E5E5E;">&gt;=</span><span class="dv" style="color: #AD0000;">0</span>,mu,<span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb1-93">           <span class="at" style="color: #657422;">tau_t =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(<span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(mu_t) <span class="sc" style="color: #5E5E5E;">&amp;</span>rel_time<span class="sc" style="color: #5E5E5E;">&gt;=</span><span class="dv" style="color: #AD0000;">0</span>,mu_t,<span class="dv" style="color: #AD0000;">0</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-94">    <span class="fu" style="color: #4758AB;">group_by</span>(group, state) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-95">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">cumtau =</span> tau <span class="sc" style="color: #5E5E5E;">+</span> <span class="fu" style="color: #4758AB;">cumsum</span>(tau_t))   <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-96">    <span class="fu" style="color: #4758AB;">group_by</span>(rel_time) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-97">    <span class="fu" style="color: #4758AB;">summarise</span>(<span class="at" style="color: #657422;">mu_truth =</span> <span class="fu" style="color: #4758AB;">mean</span>(cumtau)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">na.omit</span>()</span>
<span id="cb1-98"></span>
<span id="cb1-99"></span>
<span id="cb1-100"></span>
<span id="cb1-101">  df_truth <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb1-102">    <span class="fu" style="color: #4758AB;">crossing</span>(<span class="at" style="color: #657422;">state =</span> <span class="fu" style="color: #4758AB;">unique</span>(df_truth_<span class="sc" style="color: #5E5E5E;">$</span>state), <span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">unique</span>(year<span class="sc" style="color: #5E5E5E;">$</span>year)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-103">    <span class="fu" style="color: #4758AB;">left_join</span>(df_truth_,<span class="st" style="color: #20794D;">"state"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-104">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">rel_time =</span> <span class="fu" style="color: #4758AB;">pmax</span>(year<span class="sc" style="color: #5E5E5E;">-</span>group)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-105">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">tau =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(<span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(mu) <span class="sc" style="color: #5E5E5E;">&amp;</span> rel_time<span class="sc" style="color: #5E5E5E;">&gt;=</span><span class="dv" style="color: #AD0000;">0</span>,mu,<span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb1-106">           <span class="at" style="color: #657422;">tau_t =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(<span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(mu_t) <span class="sc" style="color: #5E5E5E;">&amp;</span>rel_time<span class="sc" style="color: #5E5E5E;">&gt;=</span><span class="dv" style="color: #AD0000;">0</span>,mu_t,<span class="dv" style="color: #AD0000;">0</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-107">    <span class="fu" style="color: #4758AB;">group_by</span>(group, state) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-108">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">cumtau =</span> tau <span class="sc" style="color: #5E5E5E;">+</span> <span class="fu" style="color: #4758AB;">cumsum</span>(tau_t)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-109">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">max_time_post =</span> <span class="fu" style="color: #4758AB;">max</span>(year<span class="sc" style="color: #5E5E5E;">-</span>group)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-110">    <span class="fu" style="color: #4758AB;">ungroup</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-111">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">max_time_post =</span> <span class="fu" style="color: #4758AB;">min</span>(max_time_post,<span class="at" style="color: #657422;">na.rm=</span><span class="cn" style="color: #8f5902;">TRUE</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-112">    <span class="co" style="color: #5E5E5E;">#filter(rel_time &lt;= max_time_post) %&gt;%</span></span>
<span id="cb1-113">    <span class="fu" style="color: #4758AB;">filter</span>(cumtau<span class="sc" style="color: #5E5E5E;">&gt;</span><span class="dv" style="color: #AD0000;">0</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">group_by</span>(group) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">summarise</span>(<span class="at" style="color: #657422;">mean =</span> <span class="fu" style="color: #4758AB;">mean</span>(cumtau)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-114">    <span class="fu" style="color: #4758AB;">as_tibble</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-115">    <span class="fu" style="color: #4758AB;">left_join</span>(</span>
<span id="cb1-116">      tx <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">map_dbl</span>(<span class="sc" style="color: #5E5E5E;">~</span>(<span class="fu" style="color: #4758AB;">length</span>(.x))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">data.frame</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">rownames_to_column</span>(<span class="at" style="color: #657422;">var =</span> <span class="st" style="color: #20794D;">"group"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">set_names</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"group"</span>,<span class="st" style="color: #20794D;">"weight"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-117">        <span class="fu" style="color: #4758AB;">filter</span>(group <span class="sc" style="color: #5E5E5E;">!=</span> <span class="st" style="color: #20794D;">"NA"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-118">        <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">total_weight =</span> <span class="fu" style="color: #4758AB;">sum</span>(weight)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-119">        <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(group))),</span>
<span id="cb1-120">      <span class="st" style="color: #20794D;">"group"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-121">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">mu_truth =</span> mean<span class="sc" style="color: #5E5E5E;">*</span>weight<span class="sc" style="color: #5E5E5E;">/</span>total_weight) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-122">    <span class="fu" style="color: #4758AB;">summarise</span>(<span class="at" style="color: #657422;">mu_truth =</span> <span class="fu" style="color: #4758AB;">sum</span>(mu_truth)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-123">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">rel_time =</span> <span class="cn" style="color: #8f5902;">NA</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-124">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">type =</span> <span class="st" style="color: #20794D;">"Static"</span>)  <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-125">    <span class="fu" style="color: #4758AB;">bind_rows</span>(</span>
<span id="cb1-126">      df_truth_t <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-127">        <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">type =</span> <span class="st" style="color: #20794D;">"Dynamic"</span>)</span>
<span id="cb1-128">    )</span>
<span id="cb1-129"></span>
<span id="cb1-130">  <span class="co" style="color: #5E5E5E;"># Units</span></span>
<span id="cb1-131">  unit <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb1-132">    <span class="fu" style="color: #4758AB;">tibble</span>(</span>
<span id="cb1-133">    <span class="at" style="color: #657422;">unit =</span> <span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span>N,</span>
<span id="cb1-134">    <span class="at" style="color: #657422;">unit_fe =</span> <span class="fu" style="color: #4758AB;">rnorm</span>(N, <span class="dv" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">0.5</span>),</span>
<span id="cb1-135">    <span class="co" style="color: #5E5E5E;"># generate state</span></span>
<span id="cb1-136">    <span class="at" style="color: #657422;">state =</span> <span class="fu" style="color: #4758AB;">sample</span>(<span class="fu" style="color: #4758AB;">rep</span>(<span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">50</span>, N<span class="sc" style="color: #5E5E5E;">/</span><span class="dv" style="color: #AD0000;">50</span>), N, <span class="at" style="color: #657422;">replace =</span> <span class="cn" style="color: #8f5902;">FALSE</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-137">    <span class="fu" style="color: #4758AB;">left_join</span>(</span>
<span id="cb1-138">      df_truth_,<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"state"</span>)</span>
<span id="cb1-139">    ) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-140">        <span class="fu" style="color: #4758AB;">ungroup</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb1-141">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">evertreated =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(<span class="fu" style="color: #4758AB;">is.na</span>(<span class="fu" style="color: #4758AB;">as.numeric</span>(group)),<span class="st" style="color: #20794D;">"C"</span>,<span class="st" style="color: #20794D;">"T"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-142">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">hat_gamma =</span> mu) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-143">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">hat_gamma_t =</span> mu_t) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-144">    <span class="co" style="color: #5E5E5E;"># generate unit specific yearly treatment effects</span></span>
<span id="cb1-145">    <span class="fu" style="color: #4758AB;">rowwise</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-146">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">gamma =</span> <span class="fu" style="color: #4758AB;">rnorm</span>(<span class="dv" style="color: #AD0000;">1</span>, hat_gamma, .<span class="dv" style="color: #AD0000;">2</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-147">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">gamma_t =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(mu_t<span class="sc" style="color: #5E5E5E;">!=</span><span class="dv" style="color: #AD0000;">0</span>,<span class="fu" style="color: #4758AB;">rnorm</span>(<span class="dv" style="color: #AD0000;">1</span>,hat_gamma_t,<span class="fl" style="color: #AD0000;">0.2</span>),<span class="dv" style="color: #AD0000;">0</span>))</span>
<span id="cb1-148"></span>
<span id="cb1-149"></span>
<span id="cb1-150">  <span class="co" style="color: #5E5E5E;"># full interaction of unit X year</span></span>
<span id="cb1-151">  df <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">crossing</span>(unit, year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-152">    <span class="co" style="color: #5E5E5E;"># make error term and get treatment indicators and treatment effects</span></span>
<span id="cb1-153">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">error =</span> <span class="fu" style="color: #4758AB;">rnorm</span>(<span class="fu" style="color: #4758AB;">nrow</span>(.), <span class="dv" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">0.5</span>),</span>
<span id="cb1-154">           <span class="at" style="color: #657422;">treat =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(year <span class="sc" style="color: #5E5E5E;">&gt;=</span> group <span class="sc" style="color: #5E5E5E;">&amp;</span> <span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(group), <span class="dv" style="color: #AD0000;">1</span>, <span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb1-155">           <span class="at" style="color: #657422;">tau =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(treat <span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">1</span>, gamma, <span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb1-156">           <span class="at" style="color: #657422;">tau_t =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(treat<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>,gamma_t,<span class="dv" style="color: #AD0000;">0</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-157">    <span class="co" style="color: #5E5E5E;"># calculate the dep variable</span></span>
<span id="cb1-158">    <span class="fu" style="color: #4758AB;">group_by</span>(unit) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-159">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">cumtau =</span> tau <span class="sc" style="color: #5E5E5E;">+</span> <span class="fu" style="color: #4758AB;">cumsum</span>(tau_t)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-160">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">dep_var =</span> unit_fe <span class="sc" style="color: #5E5E5E;">+</span> year_fe <span class="sc" style="color: #5E5E5E;">+</span> cumtau <span class="sc" style="color: #5E5E5E;">+</span> error) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-161">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">rel_year =</span> year <span class="sc" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(group)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-162">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">rel_year =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(rel_year <span class="sc" style="color: #5E5E5E;">==</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="cn" style="color: #8f5902;">Inf</span>, <span class="cn" style="color: #8f5902;">NA</span>, rel_year))<span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-163">    <span class="fu" style="color: #4758AB;">dummy_cols</span>(<span class="at" style="color: #657422;">select_columns =</span> <span class="st" style="color: #20794D;">"rel_year"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-164">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="fu" style="color: #4758AB;">across</span>(<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"rel_year_"</span>), <span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">replace_na</span>(., <span class="dv" style="color: #AD0000;">0</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-165">    <span class="co" style="color: #5E5E5E;"># generate pre and post dummies</span></span>
<span id="cb1-166">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">Pre =</span> <span class="fu" style="color: #4758AB;">ifelse</span>((rel_year <span class="sc" style="color: #5E5E5E;">&lt;</span> bin[<span class="dv" style="color: #AD0000;">1</span>]) <span class="sc" style="color: #5E5E5E;">*</span> (<span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(rel_year)), <span class="dv" style="color: #AD0000;">1</span>, <span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb1-167">           <span class="at" style="color: #657422;">Post =</span> <span class="fu" style="color: #4758AB;">ifelse</span>((rel_year <span class="sc" style="color: #5E5E5E;">&gt;</span> bin[<span class="dv" style="color: #AD0000;">2</span>]) <span class="sc" style="color: #5E5E5E;">*</span> (<span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(rel_year)), <span class="dv" style="color: #AD0000;">1</span>, <span class="dv" style="color: #AD0000;">0</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-168">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">bin1 =</span> bin[<span class="dv" style="color: #AD0000;">1</span>],</span>
<span id="cb1-169">           <span class="at" style="color: #657422;">bin2 =</span> bin[<span class="dv" style="color: #AD0000;">2</span>])</span>
<span id="cb1-170"></span>
<span id="cb1-171">  out <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">list</span>(</span>
<span id="cb1-172">    <span class="at" style="color: #657422;">df =</span> df,</span>
<span id="cb1-173">    <span class="at" style="color: #657422;">truth =</span>   df_truth,</span>
<span id="cb1-174">    <span class="at" style="color: #657422;">truth_g =</span> df_truth_,</span>
<span id="cb1-175">    <span class="at" style="color: #657422;">params =</span> params</span>
<span id="cb1-176">  )</span>
<span id="cb1-177">}</span>
<span id="cb1-178">plot_data <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(df) {</span>
<span id="cb1-179"></span>
<span id="cb1-180">  year_range <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">range</span>(df<span class="sc" style="color: #5E5E5E;">$</span>df<span class="sc" style="color: #5E5E5E;">$</span>year)</span>
<span id="cb1-181">  </span>
<span id="cb1-182">  staggered <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">ifelse</span>(<span class="fu" style="color: #4758AB;">length</span>(<span class="fu" style="color: #4758AB;">unique</span>(<span class="fu" style="color: #4758AB;">na.omit</span>(df<span class="sc" style="color: #5E5E5E;">$</span>df<span class="sc" style="color: #5E5E5E;">$</span>group)))<span class="sc" style="color: #5E5E5E;">&gt;</span><span class="dv" style="color: #AD0000;">1</span>,<span class="st" style="color: #20794D;">"Staggered"</span>,<span class="st" style="color: #20794D;">"Single Treatment Time"</span>)</span>
<span id="cb1-183"></span>
<span id="cb1-184">  control <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">ifelse</span>(<span class="st" style="color: #20794D;">"C"</span> <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="fu" style="color: #4758AB;">unique</span>(df<span class="sc" style="color: #5E5E5E;">$</span>df<span class="sc" style="color: #5E5E5E;">$</span>evertreated),<span class="cn" style="color: #8f5902;">TRUE</span>,<span class="cn" style="color: #8f5902;">FALSE</span>)</span>
<span id="cb1-185"></span>
<span id="cb1-186">  <span class="cf" style="color: #003B4F;">if</span> (control) {</span>
<span id="cb1-187">    df_ <span class="ot" style="color: #003B4F;">&lt;-</span> df<span class="sc" style="color: #5E5E5E;">$</span>df <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-188">      <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(evertreated<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"C"</span>,<span class="st" style="color: #20794D;">"Never Treated"</span>,<span class="fu" style="color: #4758AB;">paste0</span>(group)))</span>
<span id="cb1-189">  } <span class="cf" style="color: #003B4F;">else</span> {</span>
<span id="cb1-190">    df_ <span class="ot" style="color: #003B4F;">&lt;-</span> df<span class="sc" style="color: #5E5E5E;">$</span>df</span>
<span id="cb1-191">  }</span>
<span id="cb1-192">  unique_groups <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">unique</span>(df_<span class="sc" style="color: #5E5E5E;">$</span>group)</span>
<span id="cb1-193">  colors <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"#A7473A"</span>,<span class="st" style="color: #20794D;">"#4B5F6C"</span>,<span class="st" style="color: #20794D;">"#51806a"</span>)[<span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="fu" style="color: #4758AB;">length</span>(unique_groups)]</span>
<span id="cb1-194">  <span class="fu" style="color: #4758AB;">names</span>(colors) <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">unique</span>(df_<span class="sc" style="color: #5E5E5E;">$</span>group)</span>
<span id="cb1-195"></span>
<span id="cb1-196">  df_vline <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">suppressWarnings</span>({</span>
<span id="cb1-197">    <span class="fu" style="color: #4758AB;">data.frame</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">unique</span>(df_<span class="sc" style="color: #5E5E5E;">$</span>group),<span class="at" style="color: #657422;">xintercept =</span> <span class="fu" style="color: #4758AB;">unique</span>(<span class="fu" style="color: #4758AB;">as.numeric</span>(df_<span class="sc" style="color: #5E5E5E;">$</span>group)) <span class="sc" style="color: #5E5E5E;">-</span> <span class="fl" style="color: #AD0000;">0.5</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-198">      <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">color =</span> colors[<span class="fu" style="color: #4758AB;">factor</span>(group)])</span>
<span id="cb1-199">  })</span>
<span id="cb1-200"></span>
<span id="cb1-201">  <span class="fu" style="color: #4758AB;">suppressWarnings</span>({</span>
<span id="cb1-202">    df_ <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-203">      <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> year, <span class="at" style="color: #657422;">y =</span> dep_var)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb1-204">      <span class="co" style="color: #5E5E5E;"># unit specific lines</span></span>
<span id="cb1-205">      <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">alpha =</span> <span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">/</span><span class="dv" style="color: #AD0000;">10</span>, <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"grey"</span>,<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">group =</span> unit)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb1-206">      <span class="co" style="color: #5E5E5E;"># group specific averages</span></span>
<span id="cb1-207">      <span class="fu" style="color: #4758AB;">geom_line</span>(</span>
<span id="cb1-208">        <span class="at" style="color: #657422;">data =</span> . <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-209">          <span class="fu" style="color: #4758AB;">group_by</span>(group, year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-210">          <span class="fu" style="color: #4758AB;">summarize</span>(<span class="at" style="color: #657422;">dep_var =</span> <span class="fu" style="color: #4758AB;">mean</span>(dep_var)) ,</span>
<span id="cb1-211">        <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> year, <span class="at" style="color: #657422;">y =</span> dep_var, <span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">factor</span>(group),</span>
<span id="cb1-212">            <span class="at" style="color: #657422;">color =</span> <span class="fu" style="color: #4758AB;">factor</span>(group)), <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb1-213">      <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">x =</span> <span class="st" style="color: #20794D;">""</span>, <span class="at" style="color: #657422;">y =</span> <span class="st" style="color: #20794D;">""</span>, <span class="at" style="color: #657422;">color =</span> <span class="st" style="color: #20794D;">"Group"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb1-214">      <span class="fu" style="color: #4758AB;">geom_vline</span>(<span class="at" style="color: #657422;">data =</span> df_vline, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">xintercept =</span> xintercept, <span class="at" style="color: #657422;">color =</span> <span class="fu" style="color: #4758AB;">factor</span>(group)),<span class="at" style="color: #657422;">linetype=</span><span class="st" style="color: #20794D;">"dashed"</span>,<span class="at" style="color: #657422;">size=</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb1-215">      ggsci<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">scale_color_aaas</span>()<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb1-216">      <span class="fu" style="color: #4758AB;">geom_dl</span>(<span class="at" style="color: #657422;">data =</span></span>
<span id="cb1-217">                . <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-218">                <span class="fu" style="color: #4758AB;">group_by</span>(group, year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-219">                <span class="fu" style="color: #4758AB;">summarize</span>(<span class="at" style="color: #657422;">dep_var =</span> <span class="fu" style="color: #4758AB;">mean</span>(dep_var)), <span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"last.bumpup"</span>,<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">label =</span> group)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb1-220">      <span class="fu" style="color: #4758AB;">scale_y_continuous</span>(<span class="at" style="color: #657422;">limits =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">3</span>, <span class="dv" style="color: #AD0000;">20</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb1-221">      <span class="co" style="color: #5E5E5E;">#labs(subtitle = expression(paste("Staggered + Dynamic/Unequal ", tau))) +</span></span>
<span id="cb1-222">      <span class="co" style="color: #5E5E5E;"># theme_clean() + theme(plot.background = element_blank()) +</span></span>
<span id="cb1-223">      <span class="co" style="color: #5E5E5E;"># theme(legend.position = 'none',</span></span>
<span id="cb1-224">      <span class="co" style="color: #5E5E5E;">#       legend.title = element_blank(),</span></span>
<span id="cb1-225">      <span class="co" style="color: #5E5E5E;">#       plot.title = element_text(hjust = 0.5),</span></span>
<span id="cb1-226">      <span class="co" style="color: #5E5E5E;">#       plot.subtitle = element_text(hjust = 0.5),</span></span>
<span id="cb1-227">      <span class="co" style="color: #5E5E5E;">#       axis.title.y = element_text(hjust = 0.5, vjust = 0.5, angle = 360))+</span></span>
<span id="cb1-228">      </span>
<span id="cb1-229">      <span class="fu" style="color: #4758AB;">scale_x_continuous</span>(<span class="at" style="color: #657422;">limits =</span> year_range) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb1-230">      <span class="fu" style="color: #4758AB;">scale_x_continuous</span>(<span class="at" style="color: #657422;">expand =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="fl" style="color: #AD0000;">0.25</span>,<span class="dv" style="color: #AD0000;">0</span>)) <span class="sc" style="color: #5E5E5E;">+</span> invthm</span>
<span id="cb1-231">  })</span>
<span id="cb1-232">}</span></code></pre></div>
</details>
</div>
<section id="case-1-common-treatment-time-constant-treatment-effects" class="level1">
<h1>Case 1: Common Treatment Time, Constant Treatment Effects</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">params1 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">list</span>(</span>
<span id="cb2-2">  <span class="at" style="color: #657422;">mu =</span> <span class="fu" style="color: #4758AB;">list</span>(<span class="st" style="color: #20794D;">"1998"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">2</span>),</span>
<span id="cb2-3">  <span class="at" style="color: #657422;">mu_t =</span> <span class="fu" style="color: #4758AB;">list</span>(<span class="st" style="color: #20794D;">"1998"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb2-4">  <span class="at" style="color: #657422;">tx =</span> <span class="fu" style="color: #4758AB;">list</span>(<span class="st" style="color: #20794D;">"1998"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">25</span>,</span>
<span id="cb2-5">            <span class="st" style="color: #20794D;">"NA"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">26</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">50</span>),</span>
<span id="cb2-6">  <span class="at" style="color: #657422;">bin =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">5</span>,<span class="dv" style="color: #AD0000;">5</span>)</span>
<span id="cb2-7">)</span>
<span id="cb2-8"></span>
<span id="cb2-9"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">123</span>)</span>
<span id="cb2-10">df1 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">make_data</span>(params1,<span class="at" style="color: #657422;">N=</span><span class="dv" style="color: #AD0000;">200</span>) </span>
<span id="cb2-11">data1 <span class="ot" style="color: #003B4F;">&lt;-</span> df1<span class="sc" style="color: #5E5E5E;">$</span>df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb2-12">  <span class="fu" style="color: #4758AB;">select</span>(dep_var,<span class="at" style="color: #657422;">treatment_time =</span> group, state,unit, year, treat) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb2-13">  <span class="fu" style="color: #4758AB;">mutate_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(treatment_time, year), factor)</span>
<span id="cb2-14"><span class="fu" style="color: #4758AB;">plot_data</span>(df1) </span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/twfe-twm-and-did_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">df <span class="ot" style="color: #003B4F;">=</span> data1</span></code></pre></div>
</details>
</div>
<section id="data-setup" class="level2">
<h2 class="anchored" data-anchor-id="data-setup">Data Setup</h2>
<p>Figure Figure&nbsp;1 shows the first five rows of the raw data frame.</p>
<ul>
<li><code>dep_var</code> is the outcome</li>
<li><code>treatment_time</code> is the treatment group indicator set to the first treatment year for those treated, and set to missing for nontreated units.</li>
<li><code>state</code> is the state of residence for the underlying unit.</li>
<li><code>unit</code> is the individual unit identifier</li>
<li><code>year</code> is the time variable</li>
<li><code>treat</code> takes a value of 1 if the unit is treated and the observation is in the post-treatment period.</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;">head</span>(<span class="at" style="color: #657422;">n=</span><span class="dv" style="color: #AD0000;">5</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;">kable</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;">kable_styling</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb4-5">  <span class="fu" style="color: #4758AB;">scroll_box</span>(<span class="at" style="color: #657422;">width =</span> <span class="st" style="color: #20794D;">"100%"</span>, <span class="at" style="color: #657422;">height =</span> <span class="st" style="color: #20794D;">"400px"</span>)</span></code></pre></div>
</details>
<div id="fig-df-raw" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:400px; overflow-x: scroll; width:100%; ">

<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dep_var
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
treatment_time
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
state
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
unit
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
year
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
treat
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0.1832233
</td>
<td style="text-align:left;">
1998
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1980
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
0.0480280
</td>
<td style="text-align:left;">
1998
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1981
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
1.0665383
</td>
<td style="text-align:left;">
1998
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1982
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
0.4692419
</td>
<td style="text-align:left;">
1998
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1983
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
1.0057100
</td>
<td style="text-align:left;">
1998
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1984
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>

</table>
</div>
<p></p><figcaption class="figure-caption">Figure 1: First five rows of data</figcaption><p></p>
</figure>
</div>
</div>
<p>We next need to construct a series of dummy indicators</p>
<ol type="1">
<li>Define all the years where at least one group is treated (<code>treatment_years</code>)</li>
<li>Define all the treated groups (<code>treatment_groups</code>)</li>
</ol>
<section id="define-all-the-years-where-at-least-one-group-is-treated-treatment_years" class="level3">
<h3 class="anchored" data-anchor-id="define-all-the-years-where-at-least-one-group-is-treated-treatment_years">1. Define all the years where at least one group is treated (<code>treatment_years</code>)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">treatment_years <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb5-2">  df <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;">count</span>(treat, year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;">filter</span>(treat<span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">1</span> ) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;">pull</span>(year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb5-6">  <span class="fu" style="color: #4758AB;">as.vector</span>()</span>
<span id="cb5-7">treatment_years</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "1998" "1999" "2000" "2001" "2002" "2003" "2004" "2005" "2006" "2007"
[11] "2008" "2009" "2010" "2011" "2012" "2013" "2014" "2015"</code></pre>
</div>
</div>
</section>
<section id="define-all-the-treated-groups-treatment_groups" class="level3">
<h3 class="anchored" data-anchor-id="define-all-the-treated-groups-treatment_groups">2. Define all the treated groups (<code>treatment_groups</code>)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">treatment_groups <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;">unique</span>(df[df<span class="sc" style="color: #5E5E5E;">$</span>treatment_time <span class="sc" style="color: #5E5E5E;">!=</span> <span class="dv" style="color: #AD0000;">0</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> <span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(df<span class="sc" style="color: #5E5E5E;">$</span>treatment_time),]<span class="sc" style="color: #5E5E5E;">$</span>treatment_time) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;">paste</span>()</span>
<span id="cb7-4">treatment_groups</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1998"</code></pre>
</div>
</div>
<p>We will next structure the model matrix to fit the regression models. This involves:</p>
<ol type="1">
<li><p>Creating dummy variables for all treatment times, but limiting the final set to only those times identified by <code>treatment_times</code> above.</p></li>
<li><p>Creating dummy variables for all treatment groups.</p></li>
</ol>
<p>We will also prefix all dummy variables created in (1) with <code>f</code> and those created in (2) with <code>d</code>. Figure Figure&nbsp;2 shows the final data frame used for the regressions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">df_ <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb9-2">  df <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">treatment_time =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(<span class="fu" style="color: #4758AB;">is.na</span>(treatment_time),<span class="dv" style="color: #AD0000;">0</span>,<span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(treatment_time)))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb9-4">  <span class="fu" style="color: #4758AB;">select</span>(<span class="at" style="color: #657422;">y =</span> dep_var,<span class="at" style="color: #657422;">w =</span> treat, <span class="at" style="color: #657422;">id =</span> unit,year, treatment_time) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb9-5">  fastDummies<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">dummy_cols</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"year"</span>,<span class="st" style="color: #20794D;">"treatment_time"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb9-6">  <span class="fu" style="color: #4758AB;">select_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(y,w,id,year,<span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"year_{treatment_years}"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.vector</span>(),</span>
<span id="cb9-7">                 <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"treatment_time_{treatment_groups}"</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb9-8">  <span class="fu" style="color: #4758AB;">rename_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"year_"</span>)),<span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"year_"</span>,<span class="st" style="color: #20794D;">"f"</span>,.)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb9-9">  <span class="fu" style="color: #4758AB;">rename_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"treatment_time_"</span>)),<span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"treatment_time_"</span>,<span class="st" style="color: #20794D;">"d"</span>,.))</span></code></pre></div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">df_ <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;">head</span>(<span class="at" style="color: #657422;">n=</span><span class="dv" style="color: #AD0000;">5</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;">kable</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb10-4">  <span class="fu" style="color: #4758AB;">kable_styling</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb10-5">  <span class="fu" style="color: #4758AB;">scroll_box</span>(<span class="at" style="color: #657422;">width =</span> <span class="st" style="color: #20794D;">"100%"</span>, <span class="at" style="color: #657422;">height =</span> <span class="st" style="color: #20794D;">"300px"</span>)</span></code></pre></div>
</details>
<div id="fig-df-model-matrix" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:300px; overflow-x: scroll; width:100%; ">

<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
y
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
w
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
id
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
year
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f1998
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f1999
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2000
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2001
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2002
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2003
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2004
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2005
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2006
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2007
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2008
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2009
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2010
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2011
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2012
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2013
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2014
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2015
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
d1998
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0.1832233
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1980
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
0.0480280
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1981
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1.0665383
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1982
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
0.4692419
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1983
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1.0057100
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1984
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>

</table>
</div>
<p></p><figcaption class="figure-caption">Figure 2: First five rows of data</figcaption><p></p>
</figure>
</div>
</div>
</section>
</section>
<section id="estimate-models" class="level2">
<h2 class="anchored" data-anchor-id="estimate-models">Estimate Models</h2>
<p>We next estimate the models</p>
<table class="table">
<colgroup>
<col style="width: 29%">
<col style="width: 14%">
<col style="width: 24%">
<col style="width: 31%">
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>Command</th>
<th>Design Variables</th>
<th>Fixed or Random Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Two-Way Fixed Effects</td>
<td><code>feols()</code></td>
<td><code>w</code> + <code>f*</code></td>
<td>Unit Fixed Effect</td>
</tr>
<tr class="even">
<td>Pooled OLS</td>
<td><code>lm()</code></td>
<td><code>w</code> + <code>f*</code> + <code>d*</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Two-Way Mundlak</td>
<td><code>lmer()</code></td>
<td><code>w</code> + <code>f*</code> + <code>d*</code></td>
<td>Unit Random Effect</td>
</tr>
</tbody>
</table>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="co" style="color: #5E5E5E;"># TWFE</span></span>
<span id="cb11-2">fmla_twfe1 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"y ~ w + {paste0('f',treatment_years,collapse= '+')} | id "</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.formula</span>()</span>
<span id="cb11-3">fit_twfe1 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">feols</span>(fmla_twfe1, <span class="at" style="color: #657422;">data =</span> df_)</span>
<span id="cb11-4">est_twfe1 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">tibble</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"TWFE"</span>, <span class="at" style="color: #657422;">estimate =</span> <span class="fu" style="color: #4758AB;">coef</span>(fit_twfe1)[<span class="st" style="color: #20794D;">"w"</span>], <span class="at" style="color: #657422;">formula =</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"feols({Reduce(paste,deparse(fmla_twfe1))}, data = df_)"</span>))</span>
<span id="cb11-5"></span>
<span id="cb11-6"><span class="co" style="color: #5E5E5E;"># Alternative version based on a standard TWFE regression. </span></span>
<span id="cb11-7">fmla_twfe1_v2 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"y ~ w + factor(year) | id "</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.formula</span>()</span>
<span id="cb11-8">fit_twfe1_v2 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">feols</span>(fmla_twfe1_v2, <span class="at" style="color: #657422;">data =</span> df_) </span>
<span id="cb11-9">est_twfe1_v2 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">tibble</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"TWFE-V2"</span>, <span class="at" style="color: #657422;">estimate =</span> <span class="fu" style="color: #4758AB;">coef</span>(fit_twfe1_v2)[<span class="st" style="color: #20794D;">"w"</span>], <span class="at" style="color: #657422;">formula =</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"feols({Reduce(paste,deparse(fmla_twfe1_v2))}, data = df_)"</span>))</span>
<span id="cb11-10"></span>
<span id="cb11-11"><span class="co" style="color: #5E5E5E;"># POLS</span></span>
<span id="cb11-12">fmla_lm1 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"y ~ w + {paste0('f',treatment_years,collapse= '+')} + {paste0('d',treatment_groups,collapse= '+')}"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.formula</span>()</span>
<span id="cb11-13">fit_lm1 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">lm</span>(fmla_lm1, <span class="at" style="color: #657422;">data =</span> df_) </span>
<span id="cb11-14">est_lm1 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">tibble</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"POLS"</span>, <span class="at" style="color: #657422;">estimate =</span> <span class="fu" style="color: #4758AB;">coef</span>(fit_lm1)[<span class="st" style="color: #20794D;">"w"</span>], <span class="at" style="color: #657422;">formula =</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lm({Reduce(paste,deparse(fmla_lm1))}, data = df_)"</span>))</span>
<span id="cb11-15"></span>
<span id="cb11-16"><span class="co" style="color: #5E5E5E;"># TWM </span></span>
<span id="cb11-17">fmla_twm1 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"y ~ w + {paste0('f',treatment_years,collapse= '+')} + {paste0('d',treatment_groups,collapse= '+')} + (1|id)"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.formula</span>()</span>
<span id="cb11-18">fit_twm1 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">lmer</span>( fmla_twm1 , <span class="at" style="color: #657422;">data =</span> df_) </span>
<span id="cb11-19">est_twm1 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">tibble</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"TWM"</span>, <span class="at" style="color: #657422;">estimate =</span> <span class="fu" style="color: #4758AB;">coef</span>(<span class="fu" style="color: #4758AB;">summary</span>(fit_twm1))[<span class="st" style="color: #20794D;">"w"</span>,][<span class="dv" style="color: #AD0000;">1</span>] <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">unname</span>(), <span class="at" style="color: #657422;">formula =</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lmer({Reduce(paste,deparse(fmla_twm1))}, data = df_)"</span>))</span>
<span id="cb11-20"></span>
<span id="cb11-21"><span class="co" style="color: #5E5E5E;"># CS</span></span>
<span id="cb11-22">data1_cs <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb11-23">  data1 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb11-24">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(year)),</span>
<span id="cb11-25">         <span class="at" style="color: #657422;">treatment_time =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(treatment_time)))  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb11-26">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">treatment_time =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(<span class="fu" style="color: #4758AB;">is.na</span>(treatment_time),<span class="dv" style="color: #AD0000;">0</span>,treatment_time))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_mutate(quo): NAs introduced by coercion</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">fit_cs1 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">att_gt</span>(<span class="at" style="color: #657422;">yname =</span> <span class="st" style="color: #20794D;">"dep_var"</span>,</span>
<span id="cb13-2">                  <span class="at" style="color: #657422;">tname =</span> <span class="st" style="color: #20794D;">"year"</span>,</span>
<span id="cb13-3">                  <span class="at" style="color: #657422;">idname =</span> <span class="st" style="color: #20794D;">"unit"</span>,</span>
<span id="cb13-4">                  <span class="at" style="color: #657422;">gname =</span> <span class="st" style="color: #20794D;">"treatment_time"</span>,</span>
<span id="cb13-5">                  <span class="at" style="color: #657422;">control_group =</span> <span class="st" style="color: #20794D;">"notyettreated"</span>,</span>
<span id="cb13-6">                  <span class="at" style="color: #657422;">data =</span> data1_cs</span>
<span id="cb13-7">)</span>
<span id="cb13-8"></span>
<span id="cb13-9">est_cs1 <span class="ot" style="color: #003B4F;">&lt;-</span>  <span class="fu" style="color: #4758AB;">tibble</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">paste0</span>(fit_cs1<span class="sc" style="color: #5E5E5E;">$</span>group), <span class="at" style="color: #657422;">year =</span> fit_cs1<span class="sc" style="color: #5E5E5E;">$</span>t, <span class="at" style="color: #657422;">estimate =</span> fit_cs1<span class="sc" style="color: #5E5E5E;">$</span>att) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb13-10">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"CS"</span>) </span>
<span id="cb13-11"></span>
<span id="cb13-12"><span class="fu" style="color: #4758AB;">tibble</span>(<span class="at" style="color: #657422;">method =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"TWFE"</span>,<span class="st" style="color: #20794D;">"TWFE-V2"</span>,<span class="st" style="color: #20794D;">"POLS"</span>,<span class="st" style="color: #20794D;">"TWM"</span>),</span>
<span id="cb13-13">         <span class="at" style="color: #657422;">formula =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"feols({Reduce(paste,deparse(fmla_twfe1))}, data = df_)"</span>),</span>
<span id="cb13-14">                     <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"feols({Reduce(paste,deparse(fmla_twfe1_v2))}, data = df_)"</span>),</span>
<span id="cb13-15">                     <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lm({Reduce(paste,deparse(fmla_lm1))}, data = df_)"</span>),</span>
<span id="cb13-16">                     <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lmer({Reduce(paste,deparse(fmla_twm1))}, data = df_)"</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb13-17">  <span class="fu" style="color: #4758AB;">gt</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb13-18">  <span class="fu" style="color: #4758AB;">cols_label</span>(<span class="st" style="color: #20794D;">"method"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="st" style="color: #20794D;">"Estimator"</span>,</span>
<span id="cb13-19">             <span class="st" style="color: #20794D;">"formula"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="st" style="color: #20794D;">"Regression Call"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">

<div id="voxbdjkcvt" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#voxbdjkcvt .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#voxbdjkcvt .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#voxbdjkcvt .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#voxbdjkcvt .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#voxbdjkcvt .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#voxbdjkcvt .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#voxbdjkcvt .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#voxbdjkcvt .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#voxbdjkcvt .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#voxbdjkcvt .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#voxbdjkcvt .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#voxbdjkcvt .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#voxbdjkcvt .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#voxbdjkcvt .gt_from_md > :first-child {
  margin-top: 0;
}

#voxbdjkcvt .gt_from_md > :last-child {
  margin-bottom: 0;
}

#voxbdjkcvt .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#voxbdjkcvt .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#voxbdjkcvt .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#voxbdjkcvt .gt_row_group_first td {
  border-top-width: 2px;
}

#voxbdjkcvt .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#voxbdjkcvt .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#voxbdjkcvt .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#voxbdjkcvt .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#voxbdjkcvt .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#voxbdjkcvt .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#voxbdjkcvt .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#voxbdjkcvt .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#voxbdjkcvt .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#voxbdjkcvt .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#voxbdjkcvt .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#voxbdjkcvt .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#voxbdjkcvt .gt_left {
  text-align: left;
}

#voxbdjkcvt .gt_center {
  text-align: center;
}

#voxbdjkcvt .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#voxbdjkcvt .gt_font_normal {
  font-weight: normal;
}

#voxbdjkcvt .gt_font_bold {
  font-weight: bold;
}

#voxbdjkcvt .gt_font_italic {
  font-style: italic;
}

#voxbdjkcvt .gt_super {
  font-size: 65%;
}

#voxbdjkcvt .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#voxbdjkcvt .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#voxbdjkcvt .gt_indent_1 {
  text-indent: 5px;
}

#voxbdjkcvt .gt_indent_2 {
  text-indent: 10px;
}

#voxbdjkcvt .gt_indent_3 {
  text-indent: 15px;
}

#voxbdjkcvt .gt_indent_4 {
  text-indent: 20px;
}

#voxbdjkcvt .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Estimator</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Regression Call</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">TWFE</td>
<td class="gt_row gt_left">feols(y ~ w + f1998 + f1999 + f2000 + f2001 + f2002 + f2003 + f2004 +      f2005 + f2006 + f2007 + f2008 + f2009 + f2010 + f2011 + f2012 +      f2013 + f2014 + f2015 | id, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">TWFE-V2</td>
<td class="gt_row gt_left">feols(y ~ w + factor(year) | id, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">POLS</td>
<td class="gt_row gt_left">lm(y ~ w + f1998 + f1999 + f2000 + f2001 + f2002 + f2003 + f2004 +      f2005 + f2006 + f2007 + f2008 + f2009 + f2010 + f2011 + f2012 +      f2013 + f2014 + f2015 + d1998, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">TWM</td>
<td class="gt_row gt_left">lmer(y ~ w + f1998 + f1999 + f2000 + f2001 + f2002 + f2003 + f2004 +      f2005 + f2006 + f2007 + f2008 + f2009 + f2010 + f2011 + f2012 +      f2013 + f2014 + f2015 + d1998 + (1 | id), data = df_)</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</section>
<section id="summary-of-estimates" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-estimates">Summary of Estimates</h2>
<p>Table Figure&nbsp;3 summarizes the treatment effect estimates across all three approaches. These estimates are also plotted as lines in Figure&nbsp;4.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">est1 <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb14-2">  est_twfe1 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb14-3">  <span class="fu" style="color: #4758AB;">bind_rows</span>(est_twfe1_v2) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb14-4">  <span class="fu" style="color: #4758AB;">bind_rows</span>(est_lm1) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb14-5">  <span class="fu" style="color: #4758AB;">bind_rows</span>(est_twm1) </span>
<span id="cb14-6"></span>
<span id="cb14-7">est1 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb14-8">  <span class="fu" style="color: #4758AB;">select</span>(<span class="sc" style="color: #5E5E5E;">-</span>formula) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb14-9">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="st" style="color: #20794D;">"Intervention"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb14-10">  <span class="fu" style="color: #4758AB;">spread</span>(method,estimate) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb14-11">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">truth =</span> df1<span class="sc" style="color: #5E5E5E;">$</span>truth <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(type<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"Static"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">pull</span>(mu_truth))  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb14-12">  gt<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">gt</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb14-13">  <span class="fu" style="color: #4758AB;">fmt_number</span>(<span class="at" style="color: #657422;">columns =</span> <span class="fu" style="color: #4758AB;">c</span>(TWFE,<span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">TWFE-V2</span><span class="st" style="color: #20794D;">`</span>,TWM, POLS),<span class="at" style="color: #657422;">decimals=</span><span class="dv" style="color: #AD0000;">3</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb14-14">  <span class="fu" style="color: #4758AB;">cols_label</span>(<span class="st" style="color: #20794D;">"group"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="st" style="color: #20794D;">""</span>,</span>
<span id="cb14-15">             <span class="st" style="color: #20794D;">"truth"</span><span class="ot" style="color: #003B4F;">=</span> <span class="st" style="color: #20794D;">"Truth"</span>)</span></code></pre></div>
</details>
<div id="fig-sum-case1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div id="ysolqpgmnr" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ysolqpgmnr .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ysolqpgmnr .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ysolqpgmnr .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ysolqpgmnr .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ysolqpgmnr .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ysolqpgmnr .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ysolqpgmnr .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ysolqpgmnr .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ysolqpgmnr .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ysolqpgmnr .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ysolqpgmnr .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ysolqpgmnr .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#ysolqpgmnr .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ysolqpgmnr .gt_from_md > :first-child {
  margin-top: 0;
}

#ysolqpgmnr .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ysolqpgmnr .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ysolqpgmnr .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ysolqpgmnr .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ysolqpgmnr .gt_row_group_first td {
  border-top-width: 2px;
}

#ysolqpgmnr .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ysolqpgmnr .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ysolqpgmnr .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ysolqpgmnr .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ysolqpgmnr .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ysolqpgmnr .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ysolqpgmnr .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ysolqpgmnr .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ysolqpgmnr .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ysolqpgmnr .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ysolqpgmnr .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ysolqpgmnr .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ysolqpgmnr .gt_left {
  text-align: left;
}

#ysolqpgmnr .gt_center {
  text-align: center;
}

#ysolqpgmnr .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ysolqpgmnr .gt_font_normal {
  font-weight: normal;
}

#ysolqpgmnr .gt_font_bold {
  font-weight: bold;
}

#ysolqpgmnr .gt_font_italic {
  font-style: italic;
}

#ysolqpgmnr .gt_super {
  font-size: 65%;
}

#ysolqpgmnr .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#ysolqpgmnr .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ysolqpgmnr .gt_indent_1 {
  text-indent: 5px;
}

#ysolqpgmnr .gt_indent_2 {
  text-indent: 10px;
}

#ysolqpgmnr .gt_indent_3 {
  text-indent: 15px;
}

#ysolqpgmnr .gt_indent_4 {
  text-indent: 20px;
}

#ysolqpgmnr .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col"></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">POLS</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWFE</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWFE-V2</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWM</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">Truth</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">Intervention</td>
<td class="gt_row gt_right">1.983</td>
<td class="gt_row gt_right">1.983</td>
<td class="gt_row gt_right">1.983</td>
<td class="gt_row gt_right">1.983</td>
<td class="gt_row gt_right">2</td></tr>
  </tbody>
  
  
</table>
</div>
<p></p><figcaption class="figure-caption">Figure 3: Summary of Estimates - Common Treatment Time, Constant Treatment Effects</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">df_est1 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">crossing</span>(<span class="at" style="color: #657422;">group=</span> treatment_groups, <span class="at" style="color: #657422;">year =</span> treatment_years) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb15-2">                      <span class="fu" style="color: #4758AB;">as_tibble</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb15-3">                      <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">tmp =</span> <span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb15-4">                      <span class="fu" style="color: #4758AB;">left_join</span>(est1 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">tmp=</span><span class="dv" style="color: #AD0000;">1</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb15-5">              <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(year))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb15-6">  <span class="fu" style="color: #4758AB;">bind_rows</span>(est_cs1 )</span>
<span id="cb15-7">  </span>
<span id="cb15-8"><span class="fu" style="color: #4758AB;">plot_data</span>(df1) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb15-9">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">data =</span> df_est1, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> year, <span class="at" style="color: #657422;">y =</span> estimate, <span class="at" style="color: #657422;">colour =</span> <span class="fu" style="color: #4758AB;">factor</span>(group),<span class="at" style="color: #657422;">lty=</span><span class="fu" style="color: #4758AB;">factor</span>(method)), <span class="at" style="color: #657422;">lwd=</span><span class="dv" style="color: #AD0000;">2</span>)  <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb15-10">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position=</span><span class="st" style="color: #20794D;">"bottom"</span>) </span></code></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot-case1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/twfe-twm-and-did_files/figure-html/fig-plot-case1-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 4: Treatment Effect Estimates</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="case-2-common-treatment-time-dynamic-treatment-effects" class="level1">
<h1>Case 2: Common Treatment Time, Dynamic Treatment Effects</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">params2<span class="ot" style="color: #003B4F;">=</span>  <span class="fu" style="color: #4758AB;">list</span>(</span>
<span id="cb16-2">  <span class="at" style="color: #657422;">mu =</span> <span class="fu" style="color: #4758AB;">list</span>(<span class="st" style="color: #20794D;">"1998"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb16-3">  <span class="at" style="color: #657422;">mu_t =</span> <span class="fu" style="color: #4758AB;">list</span>(<span class="st" style="color: #20794D;">"1998"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="fl" style="color: #AD0000;">0.3</span>),</span>
<span id="cb16-4">  <span class="at" style="color: #657422;">tx =</span> <span class="fu" style="color: #4758AB;">list</span>(<span class="st" style="color: #20794D;">"1998"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">25</span>,</span>
<span id="cb16-5">            <span class="st" style="color: #20794D;">"NA"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">26</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">50</span>),</span>
<span id="cb16-6">  <span class="at" style="color: #657422;">bin =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">5</span>,<span class="dv" style="color: #AD0000;">5</span>))</span>
<span id="cb16-7"></span>
<span id="cb16-8"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">123</span>)</span>
<span id="cb16-9">df2 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">make_data</span>(params2,<span class="at" style="color: #657422;">N=</span><span class="dv" style="color: #AD0000;">200</span>) </span>
<span id="cb16-10">data2 <span class="ot" style="color: #003B4F;">&lt;-</span> df2<span class="sc" style="color: #5E5E5E;">$</span>df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb16-11">  <span class="fu" style="color: #4758AB;">select</span>(dep_var,<span class="at" style="color: #657422;">treatment_time =</span> group, state,unit, year, treat) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb16-12">  <span class="fu" style="color: #4758AB;">mutate_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(treatment_time, year), factor)</span>
<span id="cb16-13"><span class="fu" style="color: #4758AB;">plot_data</span>(df2) </span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/twfe-twm-and-did_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">treatment_years2 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb17-2">  data2 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb17-3">  <span class="fu" style="color: #4758AB;">count</span>(treat, year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb17-4">  <span class="fu" style="color: #4758AB;">filter</span>(treat<span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">1</span> ) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb17-5">  <span class="fu" style="color: #4758AB;">pull</span>(year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb17-6">  <span class="fu" style="color: #4758AB;">as.vector</span>()</span>
<span id="cb17-7"></span>
<span id="cb17-8">treatment_groups2 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb17-9">  <span class="fu" style="color: #4758AB;">unique</span>(data2[data2<span class="sc" style="color: #5E5E5E;">$</span>treatment_time <span class="sc" style="color: #5E5E5E;">!=</span> <span class="dv" style="color: #AD0000;">0</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> <span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(data2<span class="sc" style="color: #5E5E5E;">$</span>treatment_time),]<span class="sc" style="color: #5E5E5E;">$</span>treatment_time) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb17-10">  <span class="fu" style="color: #4758AB;">paste</span>()</span>
<span id="cb17-11"></span>
<span id="cb17-12">df_ <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb17-13">  data2 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb17-14">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">treatment_time =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(<span class="fu" style="color: #4758AB;">is.na</span>(treatment_time),<span class="dv" style="color: #AD0000;">0</span>,<span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(treatment_time)))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb17-15">  <span class="fu" style="color: #4758AB;">select</span>(<span class="at" style="color: #657422;">y =</span> dep_var,<span class="at" style="color: #657422;">w =</span> treat, <span class="at" style="color: #657422;">id =</span> unit,year, treatment_time) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb17-16">  fastDummies<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">dummy_cols</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"year"</span>,<span class="st" style="color: #20794D;">"treatment_time"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb17-17">  <span class="fu" style="color: #4758AB;">select_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(y,w,id,year,<span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"year_{treatment_years2}"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.vector</span>(),</span>
<span id="cb17-18">                 <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"treatment_time_{treatment_groups2}"</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb17-19">  <span class="fu" style="color: #4758AB;">rename_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"year_"</span>)),<span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"year_"</span>,<span class="st" style="color: #20794D;">"f"</span>,.)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb17-20">  <span class="fu" style="color: #4758AB;">rename_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"treatment_time_"</span>)),<span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"treatment_time_"</span>,<span class="st" style="color: #20794D;">"d"</span>,.))</span></code></pre></div>
</details>
</div>
<section id="estimate-models-1" class="level2">
<h2 class="anchored" data-anchor-id="estimate-models-1">Estimate Models</h2>
<p>We next estimate the models</p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>Command</th>
<th>Design Variables</th>
<th>Fixed or Random Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Two-Way Fixed Effects</td>
<td><code>feols()</code></td>
<td><code>w : f*</code> + <code>f*</code></td>
<td>Unit Fixed Effect</td>
</tr>
<tr class="even">
<td>Pooled OLS</td>
<td><code>lm()</code></td>
<td><code>w : f*</code> + <code>f*</code> + <code>d*</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Two-Way Mundlak</td>
<td><code>lmer()</code></td>
<td><code>w : f*</code> + <code>f*</code> + <code>d*</code></td>
<td>Unit Random Effect</td>
</tr>
</tbody>
</table>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">fmla_twfe2 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"y ~ {paste0('w : ',paste0('f',treatment_years2), collapse = ' + ')} + {paste0('f',treatment_years2,collapse=' + ')} | id"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.formula</span>()</span>
<span id="cb18-2">fit_twfe2 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">feols</span>(fmla_twfe2, <span class="at" style="color: #657422;">data =</span> df_)</span>
<span id="cb18-3"></span>
<span id="cb18-4">fmla_lm2 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"y ~ {paste0('w : ',paste0('f',treatment_years2), collapse = ' + ')} + {paste0('f',treatment_years2,collapse=' + ')} + {paste0('d',treatment_groups2,collapse= '+')}"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.formula</span>()</span>
<span id="cb18-5">fit_lm2 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">lm</span>(fmla_lm2, <span class="at" style="color: #657422;">data =</span> df_) </span>
<span id="cb18-6"></span>
<span id="cb18-7">fmla_twm2 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"y ~ {paste0('w : ',paste0('f',treatment_years2), collapse = ' + ')} + {paste0('f',treatment_years2,collapse=' + ')} + {paste0('d',treatment_groups2,collapse= '+')} + (1|id)"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.formula</span>()</span>
<span id="cb18-8">fit_twm2 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">lmer</span>( fmla_twm2 , <span class="at" style="color: #657422;">data =</span> df_) </span>
<span id="cb18-9"></span>
<span id="cb18-10"><span class="co" style="color: #5E5E5E;"># CS</span></span>
<span id="cb18-11">data2_cs <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb18-12">  data2 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb18-13">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(year)),</span>
<span id="cb18-14">         <span class="at" style="color: #657422;">treatment_time =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(treatment_time)))  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb18-15">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">treatment_time =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(<span class="fu" style="color: #4758AB;">is.na</span>(treatment_time),<span class="dv" style="color: #AD0000;">0</span>,treatment_time))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_mutate(quo): NAs introduced by coercion</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">fit_cs2 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">att_gt</span>(<span class="at" style="color: #657422;">yname =</span> <span class="st" style="color: #20794D;">"dep_var"</span>,</span>
<span id="cb20-2">                  <span class="at" style="color: #657422;">tname =</span> <span class="st" style="color: #20794D;">"year"</span>,</span>
<span id="cb20-3">                  <span class="at" style="color: #657422;">idname =</span> <span class="st" style="color: #20794D;">"unit"</span>,</span>
<span id="cb20-4">                  <span class="at" style="color: #657422;">gname =</span> <span class="st" style="color: #20794D;">"treatment_time"</span>,</span>
<span id="cb20-5">                  <span class="at" style="color: #657422;">control_group =</span> <span class="st" style="color: #20794D;">"notyettreated"</span>,</span>
<span id="cb20-6">                  <span class="at" style="color: #657422;">data =</span> data2_cs</span>
<span id="cb20-7">)</span>
<span id="cb20-8"></span>
<span id="cb20-9">est_cs2 <span class="ot" style="color: #003B4F;">&lt;-</span>  <span class="fu" style="color: #4758AB;">tibble</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">paste0</span>(fit_cs2<span class="sc" style="color: #5E5E5E;">$</span>group), <span class="at" style="color: #657422;">year =</span> fit_cs2<span class="sc" style="color: #5E5E5E;">$</span>t, <span class="at" style="color: #657422;">estimate =</span> fit_cs2<span class="sc" style="color: #5E5E5E;">$</span>att) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb20-10">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"CS"</span>)  </span>
<span id="cb20-11"></span>
<span id="cb20-12">  <span class="fu" style="color: #4758AB;">tibble</span>(<span class="at" style="color: #657422;">method =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"TWFE"</span>,<span class="st" style="color: #20794D;">"POLS"</span>,<span class="st" style="color: #20794D;">"TWM"</span>),</span>
<span id="cb20-13">         <span class="at" style="color: #657422;">formula =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"feols({Reduce(paste,deparse(fmla_twfe2))}, data = df_)"</span>),</span>
<span id="cb20-14">                     <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lm({Reduce(paste,deparse(fmla_lm2))}, data = df_)"</span>),</span>
<span id="cb20-15">                     <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lmer({Reduce(paste,deparse(fmla_twm2))}, data = df_)"</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb20-16">  <span class="fu" style="color: #4758AB;">gt</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb20-17">  <span class="fu" style="color: #4758AB;">cols_label</span>(<span class="st" style="color: #20794D;">"method"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="st" style="color: #20794D;">"Estimator"</span>,</span>
<span id="cb20-18">             <span class="st" style="color: #20794D;">"formula"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="st" style="color: #20794D;">"Regression Call"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">

<div id="cueyqyprtn" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#cueyqyprtn .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#cueyqyprtn .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cueyqyprtn .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#cueyqyprtn .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#cueyqyprtn .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cueyqyprtn .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cueyqyprtn .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#cueyqyprtn .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#cueyqyprtn .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#cueyqyprtn .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#cueyqyprtn .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#cueyqyprtn .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#cueyqyprtn .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#cueyqyprtn .gt_from_md > :first-child {
  margin-top: 0;
}

#cueyqyprtn .gt_from_md > :last-child {
  margin-bottom: 0;
}

#cueyqyprtn .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#cueyqyprtn .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#cueyqyprtn .gt_row_group_first td {
  border-top-width: 2px;
}

#cueyqyprtn .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#cueyqyprtn .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#cueyqyprtn .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cueyqyprtn .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#cueyqyprtn .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#cueyqyprtn .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cueyqyprtn .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cueyqyprtn .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cueyqyprtn .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_left {
  text-align: left;
}

#cueyqyprtn .gt_center {
  text-align: center;
}

#cueyqyprtn .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#cueyqyprtn .gt_font_normal {
  font-weight: normal;
}

#cueyqyprtn .gt_font_bold {
  font-weight: bold;
}

#cueyqyprtn .gt_font_italic {
  font-style: italic;
}

#cueyqyprtn .gt_super {
  font-size: 65%;
}

#cueyqyprtn .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#cueyqyprtn .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#cueyqyprtn .gt_indent_1 {
  text-indent: 5px;
}

#cueyqyprtn .gt_indent_2 {
  text-indent: 10px;
}

#cueyqyprtn .gt_indent_3 {
  text-indent: 15px;
}

#cueyqyprtn .gt_indent_4 {
  text-indent: 20px;
}

#cueyqyprtn .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Estimator</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Regression Call</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">TWFE</td>
<td class="gt_row gt_left">feols(y ~ w:f1998 + w:f1999 + w:f2000 + w:f2001 + w:f2002 + w:f2003 +      w:f2004 + w:f2005 + w:f2006 + w:f2007 + w:f2008 + w:f2009 +      w:f2010 + w:f2011 + w:f2012 + w:f2013 + w:f2014 + w:f2015 +      f1998 + f1999 + f2000 + f2001 + f2002 + f2003 + f2004 + f2005 +      f2006 + f2007 + f2008 + f2009 + f2010 + f2011 + f2012 + f2013 +      f2014 + f2015 | id, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">POLS</td>
<td class="gt_row gt_left">lm(y ~ w:f1998 + w:f1999 + w:f2000 + w:f2001 + w:f2002 + w:f2003 +      w:f2004 + w:f2005 + w:f2006 + w:f2007 + w:f2008 + w:f2009 +      w:f2010 + w:f2011 + w:f2012 + w:f2013 + w:f2014 + w:f2015 +      f1998 + f1999 + f2000 + f2001 + f2002 + f2003 + f2004 + f2005 +      f2006 + f2007 + f2008 + f2009 + f2010 + f2011 + f2012 + f2013 +      f2014 + f2015 + d1998, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">TWM</td>
<td class="gt_row gt_left">lmer(y ~ w:f1998 + w:f1999 + w:f2000 + w:f2001 + w:f2002 + w:f2003 +      w:f2004 + w:f2005 + w:f2006 + w:f2007 + w:f2008 + w:f2009 +      w:f2010 + w:f2011 + w:f2012 + w:f2013 + w:f2014 + w:f2015 +      f1998 + f1999 + f2000 + f2001 + f2002 + f2003 + f2004 + f2005 +      f2006 + f2007 + f2008 + f2009 + f2010 + f2011 + f2012 + f2013 +      f2014 + f2015 + d1998 + (1 | id), data = df_)</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</section>
<section id="summary-of-estimates-1" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-estimates-1">Summary of Estimates</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">est_twfe2 <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb21-2">  fit_twfe2 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">tidy</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-3">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"TWFE"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">call =</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"feols({Reduce(paste,deparse(fmla_twfe2))}, data = df_)"</span>))</span>
<span id="cb21-5"></span>
<span id="cb21-6">est_lm2 <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb21-7">  fit_lm2 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">tidy</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-8">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">call =</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lm({Reduce(paste,deparse(fmla_lm2))}, data = df_)"</span>))  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-9">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"POLS"</span>)</span>
<span id="cb21-10"></span>
<span id="cb21-11">est_twm2 <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb21-12">  fit_twm2  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">summary</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-13">  <span class="fu" style="color: #4758AB;">coef</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-14">  <span class="fu" style="color: #4758AB;">data.frame</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-15">  <span class="fu" style="color: #4758AB;">rownames_to_column</span>(<span class="at" style="color: #657422;">var =</span> <span class="st" style="color: #20794D;">"term"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-16">  janitor<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">clean_names</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-17">  <span class="fu" style="color: #4758AB;">as_tibble</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-18">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"TWM"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-19">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">call =</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lmer({Reduce(paste,deparse(fmla_twm2))}, data = df_)"</span>))</span>
<span id="cb21-20"></span>
<span id="cb21-21">est2 <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb21-22">  est_twfe2 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-23">  <span class="fu" style="color: #4758AB;">bind_rows</span>(est_lm2) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-24">  <span class="fu" style="color: #4758AB;">bind_rows</span>(est_twm2) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-25">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="fu" style="color: #4758AB;">grepl</span>(<span class="st" style="color: #20794D;">"^w:"</span>,term)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-26">  <span class="fu" style="color: #4758AB;">separate</span>(term,<span class="at" style="color: #657422;">into=</span><span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"tmp"</span>,<span class="st" style="color: #20794D;">"year"</span>), <span class="at" style="color: #657422;">sep =</span> <span class="st" style="color: #20794D;">":"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-27">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"f"</span>,<span class="st" style="color: #20794D;">""</span>,year)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-28">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(year))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-29">  <span class="fu" style="color: #4758AB;">select</span>(<span class="sc" style="color: #5E5E5E;">-</span>tmp) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-30">  <span class="fu" style="color: #4758AB;">bind_rows</span>(est_cs2 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(<span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(group))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-31">  <span class="fu" style="color: #4758AB;">select</span>(<span class="sc" style="color: #5E5E5E;">-</span>group)</span>
<span id="cb21-32"></span>
<span id="cb21-33">df_est2 <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb21-34">  <span class="fu" style="color: #4758AB;">crossing</span>(<span class="at" style="color: #657422;">group=</span> treatment_groups, <span class="at" style="color: #657422;">year =</span> treatment_years) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-35">  <span class="fu" style="color: #4758AB;">as_tibble</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb21-36">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(year))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-37">  <span class="fu" style="color: #4758AB;">left_join</span>(est2, <span class="st" style="color: #20794D;">"year"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-38">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(year))) </span>
<span id="cb21-39"></span>
<span id="cb21-40">df_est2 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-41">  <span class="fu" style="color: #4758AB;">select</span>(year,estimate,method) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-42">  <span class="fu" style="color: #4758AB;">spread</span>(method,estimate) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-43">  <span class="fu" style="color: #4758AB;">select</span>(year,TWFE,POLS,TWM, CS) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-44">  <span class="fu" style="color: #4758AB;">gt</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb21-45">  <span class="fu" style="color: #4758AB;">fmt_number</span>(<span class="at" style="color: #657422;">columns=</span><span class="fu" style="color: #4758AB;">c</span>(TWFE,POLS,TWM,CS),<span class="at" style="color: #657422;">decimals=</span><span class="dv" style="color: #AD0000;">3</span>)</span></code></pre></div>
</details>
<div id="fig-sum-case2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div id="ftgjihjymh" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ftgjihjymh .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ftgjihjymh .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ftgjihjymh .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ftgjihjymh .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ftgjihjymh .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ftgjihjymh .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ftgjihjymh .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ftgjihjymh .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ftgjihjymh .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ftgjihjymh .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ftgjihjymh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ftgjihjymh .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#ftgjihjymh .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ftgjihjymh .gt_from_md > :first-child {
  margin-top: 0;
}

#ftgjihjymh .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ftgjihjymh .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ftgjihjymh .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ftgjihjymh .gt_row_group_first td {
  border-top-width: 2px;
}

#ftgjihjymh .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ftgjihjymh .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ftgjihjymh .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ftgjihjymh .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ftgjihjymh .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ftgjihjymh .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ftgjihjymh .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ftgjihjymh .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ftgjihjymh .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_left {
  text-align: left;
}

#ftgjihjymh .gt_center {
  text-align: center;
}

#ftgjihjymh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ftgjihjymh .gt_font_normal {
  font-weight: normal;
}

#ftgjihjymh .gt_font_bold {
  font-weight: bold;
}

#ftgjihjymh .gt_font_italic {
  font-style: italic;
}

#ftgjihjymh .gt_super {
  font-size: 65%;
}

#ftgjihjymh .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#ftgjihjymh .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ftgjihjymh .gt_indent_1 {
  text-indent: 5px;
}

#ftgjihjymh .gt_indent_2 {
  text-indent: 10px;
}

#ftgjihjymh .gt_indent_3 {
  text-indent: 15px;
}

#ftgjihjymh .gt_indent_4 {
  text-indent: 20px;
}

#ftgjihjymh .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">year</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWFE</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">POLS</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWM</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">CS</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">0.273</td>
<td class="gt_row gt_right">0.273</td>
<td class="gt_row gt_right">0.273</td>
<td class="gt_row gt_right">0.288</td></tr>
    <tr><td class="gt_row gt_right">1999</td>
<td class="gt_row gt_right">0.489</td>
<td class="gt_row gt_right">0.489</td>
<td class="gt_row gt_right">0.489</td>
<td class="gt_row gt_right">0.504</td></tr>
    <tr><td class="gt_row gt_right">2000</td>
<td class="gt_row gt_right">0.909</td>
<td class="gt_row gt_right">0.909</td>
<td class="gt_row gt_right">0.909</td>
<td class="gt_row gt_right">0.924</td></tr>
    <tr><td class="gt_row gt_right">2001</td>
<td class="gt_row gt_right">1.291</td>
<td class="gt_row gt_right">1.291</td>
<td class="gt_row gt_right">1.291</td>
<td class="gt_row gt_right">1.306</td></tr>
    <tr><td class="gt_row gt_right">2002</td>
<td class="gt_row gt_right">1.714</td>
<td class="gt_row gt_right">1.714</td>
<td class="gt_row gt_right">1.714</td>
<td class="gt_row gt_right">1.729</td></tr>
    <tr><td class="gt_row gt_right">2003</td>
<td class="gt_row gt_right">1.898</td>
<td class="gt_row gt_right">1.898</td>
<td class="gt_row gt_right">1.898</td>
<td class="gt_row gt_right">1.913</td></tr>
    <tr><td class="gt_row gt_right">2004</td>
<td class="gt_row gt_right">2.226</td>
<td class="gt_row gt_right">2.226</td>
<td class="gt_row gt_right">2.226</td>
<td class="gt_row gt_right">2.241</td></tr>
    <tr><td class="gt_row gt_right">2005</td>
<td class="gt_row gt_right">2.434</td>
<td class="gt_row gt_right">2.434</td>
<td class="gt_row gt_right">2.434</td>
<td class="gt_row gt_right">2.449</td></tr>
    <tr><td class="gt_row gt_right">2006</td>
<td class="gt_row gt_right">2.759</td>
<td class="gt_row gt_right">2.759</td>
<td class="gt_row gt_right">2.759</td>
<td class="gt_row gt_right">2.774</td></tr>
    <tr><td class="gt_row gt_right">2007</td>
<td class="gt_row gt_right">3.190</td>
<td class="gt_row gt_right">3.190</td>
<td class="gt_row gt_right">3.190</td>
<td class="gt_row gt_right">3.205</td></tr>
    <tr><td class="gt_row gt_right">2008</td>
<td class="gt_row gt_right">3.471</td>
<td class="gt_row gt_right">3.471</td>
<td class="gt_row gt_right">3.471</td>
<td class="gt_row gt_right">3.486</td></tr>
    <tr><td class="gt_row gt_right">2009</td>
<td class="gt_row gt_right">3.676</td>
<td class="gt_row gt_right">3.676</td>
<td class="gt_row gt_right">3.676</td>
<td class="gt_row gt_right">3.691</td></tr>
    <tr><td class="gt_row gt_right">2010</td>
<td class="gt_row gt_right">4.097</td>
<td class="gt_row gt_right">4.097</td>
<td class="gt_row gt_right">4.097</td>
<td class="gt_row gt_right">4.112</td></tr>
    <tr><td class="gt_row gt_right">2011</td>
<td class="gt_row gt_right">4.328</td>
<td class="gt_row gt_right">4.328</td>
<td class="gt_row gt_right">4.328</td>
<td class="gt_row gt_right">4.343</td></tr>
    <tr><td class="gt_row gt_right">2012</td>
<td class="gt_row gt_right">4.783</td>
<td class="gt_row gt_right">4.783</td>
<td class="gt_row gt_right">4.783</td>
<td class="gt_row gt_right">4.799</td></tr>
    <tr><td class="gt_row gt_right">2013</td>
<td class="gt_row gt_right">4.994</td>
<td class="gt_row gt_right">4.994</td>
<td class="gt_row gt_right">4.994</td>
<td class="gt_row gt_right">5.009</td></tr>
    <tr><td class="gt_row gt_right">2014</td>
<td class="gt_row gt_right">5.278</td>
<td class="gt_row gt_right">5.278</td>
<td class="gt_row gt_right">5.278</td>
<td class="gt_row gt_right">5.293</td></tr>
    <tr><td class="gt_row gt_right">2015</td>
<td class="gt_row gt_right">5.718</td>
<td class="gt_row gt_right">5.718</td>
<td class="gt_row gt_right">5.718</td>
<td class="gt_row gt_right">5.733</td></tr>
  </tbody>
  
  
</table>
</div>
<p></p><figcaption class="figure-caption">Figure 5: Summary of Estimates - Common Treatment Time, Dynamic Treatment Effects</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="fu" style="color: #4758AB;">plot_data</span>(df2) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb22-2">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">data =</span> df_est2, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> year, <span class="at" style="color: #657422;">y =</span> estimate, <span class="at" style="color: #657422;">colour =</span> <span class="fu" style="color: #4758AB;">factor</span>(group),<span class="at" style="color: #657422;">lty=</span><span class="fu" style="color: #4758AB;">factor</span>(method)), <span class="at" style="color: #657422;">lwd=</span><span class="dv" style="color: #AD0000;">2</span>)  <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb22-3">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position=</span><span class="st" style="color: #20794D;">"bottom"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot-case2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/twfe-twm-and-did_files/figure-html/fig-plot-case2-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 6: Treatment Effect Estimates</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="case-3-multiple-treatment-periods-and-constant-equal-treatment-effects" class="level1">
<h1>Case 3: Multiple Treatment Periods and Constant Equal Treatment Effects</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="co" style="color: #5E5E5E;"># Case 3: Multiple Treatment Periods and Constant Equal Treatment Effects</span></span>
<span id="cb23-2">params3<span class="ot" style="color: #003B4F;">=</span>  <span class="fu" style="color: #4758AB;">list</span>(</span>
<span id="cb23-3">  <span class="at" style="color: #657422;">mu =</span> <span class="fu" style="color: #4758AB;">list</span>(<span class="st" style="color: #20794D;">"1989"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">3</span>,</span>
<span id="cb23-4">            <span class="st" style="color: #20794D;">"1998"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">3</span>,</span>
<span id="cb23-5">            <span class="st" style="color: #20794D;">"2007"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">3</span>),</span>
<span id="cb23-6">  <span class="at" style="color: #657422;">mu_t =</span> <span class="fu" style="color: #4758AB;">list</span>(<span class="st" style="color: #20794D;">"1989"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">0</span>,</span>
<span id="cb23-7">              <span class="st" style="color: #20794D;">"1998"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">0</span>,</span>
<span id="cb23-8">              <span class="st" style="color: #20794D;">"2007"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb23-9">  <span class="at" style="color: #657422;">tx =</span> <span class="fu" style="color: #4758AB;">list</span>(<span class="st" style="color: #20794D;">"1989"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">17</span>,</span>
<span id="cb23-10">            <span class="st" style="color: #20794D;">"1998"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">18</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">35</span>,</span>
<span id="cb23-11">            <span class="st" style="color: #20794D;">"2007"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">36</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">50</span>),</span>
<span id="cb23-12">  <span class="at" style="color: #657422;">bin =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">5</span>,<span class="dv" style="color: #AD0000;">5</span>))</span>
<span id="cb23-13"></span>
<span id="cb23-14"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">123</span>)</span>
<span id="cb23-15">df3 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">make_data</span>(params3,<span class="at" style="color: #657422;">N=</span><span class="dv" style="color: #AD0000;">200</span>) </span>
<span id="cb23-16">data3 <span class="ot" style="color: #003B4F;">&lt;-</span> df3<span class="sc" style="color: #5E5E5E;">$</span>df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb23-17">  <span class="fu" style="color: #4758AB;">select</span>(dep_var,<span class="at" style="color: #657422;">treatment_time =</span> group, state,unit, year, treat) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb23-18">  <span class="fu" style="color: #4758AB;">mutate_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(treatment_time, year), factor)</span>
<span id="cb23-19"><span class="fu" style="color: #4758AB;">plot_data</span>(df3) </span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/twfe-twm-and-did_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">treatment_years3 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb24-2">  data3 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb24-3">  <span class="fu" style="color: #4758AB;">count</span>(treat, year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb24-4">  <span class="fu" style="color: #4758AB;">filter</span>(treat<span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">1</span> ) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb24-5">  <span class="fu" style="color: #4758AB;">pull</span>(year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb24-6">  <span class="fu" style="color: #4758AB;">as.vector</span>()</span>
<span id="cb24-7"></span>
<span id="cb24-8">treatment_groups3 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb24-9">  <span class="fu" style="color: #4758AB;">unique</span>(data3[data3<span class="sc" style="color: #5E5E5E;">$</span>treatment_time <span class="sc" style="color: #5E5E5E;">!=</span> <span class="dv" style="color: #AD0000;">0</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> <span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(data3<span class="sc" style="color: #5E5E5E;">$</span>treatment_time),]<span class="sc" style="color: #5E5E5E;">$</span>treatment_time) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb24-10">  <span class="fu" style="color: #4758AB;">paste</span>()</span>
<span id="cb24-11"></span>
<span id="cb24-12">df_ <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb24-13">  data3 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb24-14">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">treatment_time =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(<span class="fu" style="color: #4758AB;">is.na</span>(treatment_time),<span class="dv" style="color: #AD0000;">0</span>,<span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(treatment_time)))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb24-15">  <span class="fu" style="color: #4758AB;">select</span>(<span class="at" style="color: #657422;">y =</span> dep_var,<span class="at" style="color: #657422;">w =</span> treat, <span class="at" style="color: #657422;">id =</span> unit,year, treatment_time) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb24-16">  fastDummies<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">dummy_cols</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"year"</span>,<span class="st" style="color: #20794D;">"treatment_time"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb24-17">  <span class="fu" style="color: #4758AB;">select_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(y,w,id,year,<span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"year_{treatment_years3}"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.vector</span>(),</span>
<span id="cb24-18">                 <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"treatment_time_{treatment_groups3}"</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb24-19">  <span class="fu" style="color: #4758AB;">rename_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"year_"</span>)),<span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"year_"</span>,<span class="st" style="color: #20794D;">"f"</span>,.)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb24-20">  <span class="fu" style="color: #4758AB;">rename_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"treatment_time_"</span>)),<span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"treatment_time_"</span>,<span class="st" style="color: #20794D;">"d"</span>,.))</span></code></pre></div>
</details>
</div>
<section id="estimate-models-2" class="level2">
<h2 class="anchored" data-anchor-id="estimate-models-2">Estimate Models</h2>
<p>We next estimate the models</p>
<table class="table">
<colgroup>
<col style="width: 29%">
<col style="width: 14%">
<col style="width: 24%">
<col style="width: 31%">
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>Command</th>
<th>Design Variables</th>
<th>Fixed or Random Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Two-Way Fixed Effects</td>
<td><code>feols()</code></td>
<td><code>w</code> + <code>f*</code></td>
<td>Unit Fixed Effect</td>
</tr>
<tr class="even">
<td>Pooled OLS</td>
<td><code>lm()</code></td>
<td><code>w</code> + <code>f*</code> + <code>d*</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Two-Way Mundlak</td>
<td><code>lmer()</code></td>
<td><code>w</code> + <code>f*</code> + <code>d*</code></td>
<td>Unit Random Effect</td>
</tr>
</tbody>
</table>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">fmla_twfe3 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"y ~ w + {paste0('f',treatment_years3,collapse= '+')} | id "</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.formula</span>()</span>
<span id="cb25-2">fit_twfe3 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">feols</span>(fmla_twfe3, <span class="at" style="color: #657422;">data =</span> df_)</span>
<span id="cb25-3">est_twfe3 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">tibble</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"TWFE"</span>, <span class="at" style="color: #657422;">estimate =</span> <span class="fu" style="color: #4758AB;">coef</span>(fit_twfe3)[<span class="st" style="color: #20794D;">"w"</span>], <span class="at" style="color: #657422;">formula =</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"feols({Reduce(paste,deparse(fmla_twfe3))}, data = df_)"</span>))</span>
<span id="cb25-4"></span>
<span id="cb25-5">fmla_lm3 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"y ~ w + {paste0('f',treatment_years3,collapse= '+')} + {paste0('d',treatment_groups3,collapse= '+')}"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.formula</span>()</span>
<span id="cb25-6">fit_lm3 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">lm</span>(fmla_lm3, <span class="at" style="color: #657422;">data =</span> df_) </span>
<span id="cb25-7">est_lm3 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">tibble</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"POLS"</span>, <span class="at" style="color: #657422;">estimate =</span> <span class="fu" style="color: #4758AB;">coef</span>(fit_lm3)[<span class="st" style="color: #20794D;">"w"</span>], <span class="at" style="color: #657422;">formula =</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lm({Reduce(paste,deparse(fmla_lm3))}, data = df_)"</span>))</span>
<span id="cb25-8"></span>
<span id="cb25-9">fmla_twm3 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"y ~ w + {paste0('f',treatment_years3,collapse= '+')} + {paste0('d',treatment_groups3,collapse= '+')} + (1|id)"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.formula</span>()</span>
<span id="cb25-10">fit_twm3 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">lmer</span>( fmla_twm3 , <span class="at" style="color: #657422;">data =</span> df_) </span>
<span id="cb25-11">est_twm3 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">tibble</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"TWM"</span>, <span class="at" style="color: #657422;">estimate =</span> <span class="fu" style="color: #4758AB;">coef</span>(<span class="fu" style="color: #4758AB;">summary</span>(fit_twm3))[<span class="st" style="color: #20794D;">"w"</span>,][<span class="dv" style="color: #AD0000;">1</span>] <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">unname</span>(), <span class="at" style="color: #657422;">formula =</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lmer({Reduce(paste,deparse(fmla_twm3))}, data = df_)"</span>))</span>
<span id="cb25-12"></span>
<span id="cb25-13"><span class="co" style="color: #5E5E5E;"># CS</span></span>
<span id="cb25-14">data3_cs <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb25-15">  data3 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb25-16">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(year)),</span>
<span id="cb25-17">         <span class="at" style="color: #657422;">treatment_time =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(treatment_time)))  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb25-18">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">treatment_time =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(<span class="fu" style="color: #4758AB;">is.na</span>(treatment_time),<span class="dv" style="color: #AD0000;">0</span>,treatment_time))</span>
<span id="cb25-19"></span>
<span id="cb25-20"></span>
<span id="cb25-21">fit_cs3 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">att_gt</span>(<span class="at" style="color: #657422;">yname =</span> <span class="st" style="color: #20794D;">"dep_var"</span>,</span>
<span id="cb25-22">                  <span class="at" style="color: #657422;">tname =</span> <span class="st" style="color: #20794D;">"year"</span>,</span>
<span id="cb25-23">                  <span class="at" style="color: #657422;">idname =</span> <span class="st" style="color: #20794D;">"unit"</span>,</span>
<span id="cb25-24">                  <span class="at" style="color: #657422;">gname =</span> <span class="st" style="color: #20794D;">"treatment_time"</span>,</span>
<span id="cb25-25">                  <span class="at" style="color: #657422;">control_group =</span> <span class="st" style="color: #20794D;">"notyettreated"</span>,</span>
<span id="cb25-26">                  <span class="at" style="color: #657422;">data =</span> data3_cs</span>
<span id="cb25-27">)</span>
<span id="cb25-28"></span>
<span id="cb25-29">est_cs3 <span class="ot" style="color: #003B4F;">&lt;-</span>  <span class="fu" style="color: #4758AB;">tibble</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">paste0</span>(fit_cs3<span class="sc" style="color: #5E5E5E;">$</span>group), <span class="at" style="color: #657422;">year =</span> fit_cs3<span class="sc" style="color: #5E5E5E;">$</span>t, <span class="at" style="color: #657422;">estimate =</span> fit_cs3<span class="sc" style="color: #5E5E5E;">$</span>att) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb25-30">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"CS"</span>) </span>
<span id="cb25-31"></span>
<span id="cb25-32"><span class="fu" style="color: #4758AB;">tibble</span>(<span class="at" style="color: #657422;">method =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"TWFE"</span>,<span class="st" style="color: #20794D;">"POLS"</span>,<span class="st" style="color: #20794D;">"TWM"</span>),</span>
<span id="cb25-33">         <span class="at" style="color: #657422;">formula =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"feols({Reduce(paste,deparse(fmla_twfe3))}, data = df_)"</span>),</span>
<span id="cb25-34">                     <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lm({Reduce(paste,deparse(fmla_lm3))}, data = df_)"</span>),</span>
<span id="cb25-35">                     <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lmer({Reduce(paste,deparse(fmla_twm3))}, data = df_)"</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb25-36">  <span class="fu" style="color: #4758AB;">gt</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb25-37">  <span class="fu" style="color: #4758AB;">cols_label</span>(<span class="st" style="color: #20794D;">"method"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="st" style="color: #20794D;">"Estimator"</span>,</span>
<span id="cb25-38">             <span class="st" style="color: #20794D;">"formula"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="st" style="color: #20794D;">"Regression Call"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">

<div id="cueyqyprtn" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#cueyqyprtn .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#cueyqyprtn .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cueyqyprtn .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#cueyqyprtn .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#cueyqyprtn .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cueyqyprtn .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cueyqyprtn .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#cueyqyprtn .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#cueyqyprtn .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#cueyqyprtn .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#cueyqyprtn .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#cueyqyprtn .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#cueyqyprtn .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#cueyqyprtn .gt_from_md > :first-child {
  margin-top: 0;
}

#cueyqyprtn .gt_from_md > :last-child {
  margin-bottom: 0;
}

#cueyqyprtn .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#cueyqyprtn .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#cueyqyprtn .gt_row_group_first td {
  border-top-width: 2px;
}

#cueyqyprtn .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#cueyqyprtn .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#cueyqyprtn .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cueyqyprtn .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#cueyqyprtn .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#cueyqyprtn .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cueyqyprtn .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cueyqyprtn .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cueyqyprtn .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_left {
  text-align: left;
}

#cueyqyprtn .gt_center {
  text-align: center;
}

#cueyqyprtn .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#cueyqyprtn .gt_font_normal {
  font-weight: normal;
}

#cueyqyprtn .gt_font_bold {
  font-weight: bold;
}

#cueyqyprtn .gt_font_italic {
  font-style: italic;
}

#cueyqyprtn .gt_super {
  font-size: 65%;
}

#cueyqyprtn .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#cueyqyprtn .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#cueyqyprtn .gt_indent_1 {
  text-indent: 5px;
}

#cueyqyprtn .gt_indent_2 {
  text-indent: 10px;
}

#cueyqyprtn .gt_indent_3 {
  text-indent: 15px;
}

#cueyqyprtn .gt_indent_4 {
  text-indent: 20px;
}

#cueyqyprtn .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Estimator</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Regression Call</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">TWFE</td>
<td class="gt_row gt_left">feols(y ~ w + f1989 + f1990 + f1991 + f1992 + f1993 + f1994 + f1995 +      f1996 + f1997 + f1998 + f1999 + f2000 + f2001 + f2002 + f2003 +      f2004 + f2005 + f2006 + f2007 + f2008 + f2009 + f2010 + f2011 +      f2012 + f2013 + f2014 + f2015 | id, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">POLS</td>
<td class="gt_row gt_left">lm(y ~ w + f1989 + f1990 + f1991 + f1992 + f1993 + f1994 + f1995 +      f1996 + f1997 + f1998 + f1999 + f2000 + f2001 + f2002 + f2003 +      f2004 + f2005 + f2006 + f2007 + f2008 + f2009 + f2010 + f2011 +      f2012 + f2013 + f2014 + f2015 + d1989 + d1998 + d2007, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">TWM</td>
<td class="gt_row gt_left">lmer(y ~ w + f1989 + f1990 + f1991 + f1992 + f1993 + f1994 + f1995 +      f1996 + f1997 + f1998 + f1999 + f2000 + f2001 + f2002 + f2003 +      f2004 + f2005 + f2006 + f2007 + f2008 + f2009 + f2010 + f2011 +      f2012 + f2013 + f2014 + f2015 + d1989 + d1998 + d2007 + (1 |      id), data = df_)</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</section>
<section id="summary-of-estimates-2" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-estimates-2">Summary of Estimates</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">est3 <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb26-2">  est_twfe3 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb26-3">  <span class="fu" style="color: #4758AB;">bind_rows</span>(est_lm3) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb26-4">  <span class="fu" style="color: #4758AB;">bind_rows</span>(est_twm3) </span>
<span id="cb26-5"></span>
<span id="cb26-6">est3 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb26-7">  <span class="fu" style="color: #4758AB;">select</span>(<span class="sc" style="color: #5E5E5E;">-</span>formula) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb26-8">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="st" style="color: #20794D;">"Intervention"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb26-9">  <span class="fu" style="color: #4758AB;">spread</span>(method,estimate) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb26-10">  gt<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">gt</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb26-11">  <span class="fu" style="color: #4758AB;">fmt_number</span>(<span class="at" style="color: #657422;">columns =</span> <span class="fu" style="color: #4758AB;">c</span>(TWFE,TWM, POLS),<span class="at" style="color: #657422;">decimals=</span><span class="dv" style="color: #AD0000;">3</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb26-12">  <span class="fu" style="color: #4758AB;">cols_label</span>(<span class="st" style="color: #20794D;">"group"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="st" style="color: #20794D;">""</span>)</span></code></pre></div>
</details>
<div id="fig-sum-case3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div id="ftgjihjymh" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ftgjihjymh .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ftgjihjymh .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ftgjihjymh .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ftgjihjymh .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ftgjihjymh .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ftgjihjymh .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ftgjihjymh .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ftgjihjymh .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ftgjihjymh .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ftgjihjymh .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ftgjihjymh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ftgjihjymh .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#ftgjihjymh .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ftgjihjymh .gt_from_md > :first-child {
  margin-top: 0;
}

#ftgjihjymh .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ftgjihjymh .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ftgjihjymh .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ftgjihjymh .gt_row_group_first td {
  border-top-width: 2px;
}

#ftgjihjymh .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ftgjihjymh .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ftgjihjymh .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ftgjihjymh .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ftgjihjymh .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ftgjihjymh .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ftgjihjymh .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ftgjihjymh .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ftgjihjymh .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_left {
  text-align: left;
}

#ftgjihjymh .gt_center {
  text-align: center;
}

#ftgjihjymh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ftgjihjymh .gt_font_normal {
  font-weight: normal;
}

#ftgjihjymh .gt_font_bold {
  font-weight: bold;
}

#ftgjihjymh .gt_font_italic {
  font-style: italic;
}

#ftgjihjymh .gt_super {
  font-size: 65%;
}

#ftgjihjymh .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#ftgjihjymh .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ftgjihjymh .gt_indent_1 {
  text-indent: 5px;
}

#ftgjihjymh .gt_indent_2 {
  text-indent: 10px;
}

#ftgjihjymh .gt_indent_3 {
  text-indent: 15px;
}

#ftgjihjymh .gt_indent_4 {
  text-indent: 20px;
}

#ftgjihjymh .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col"></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">POLS</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWFE</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWM</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">Intervention</td>
<td class="gt_row gt_right">3.009</td>
<td class="gt_row gt_right">3.009</td>
<td class="gt_row gt_right">3.009</td></tr>
  </tbody>
  
  
</table>
</div>
<p></p><figcaption class="figure-caption">Figure 7: Summary of Estimates - Common Treatment Time, Constant Treatment Effects</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">df_est3 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">crossing</span>(<span class="at" style="color: #657422;">group=</span> treatment_groups3, <span class="at" style="color: #657422;">year =</span> treatment_years3) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb27-2">                      <span class="fu" style="color: #4758AB;">as_tibble</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb27-3">                      <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">tmp =</span> <span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb27-4">                      <span class="fu" style="color: #4758AB;">left_join</span>(est3 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">tmp=</span><span class="dv" style="color: #AD0000;">1</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb27-5">              <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(year))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb27-6">  <span class="fu" style="color: #4758AB;">bind_rows</span>(est_cs3)</span>
<span id="cb27-7">  </span>
<span id="cb27-8"><span class="fu" style="color: #4758AB;">plot_data</span>(df3)  <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb27-9">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">data =</span> df_est3, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> year, <span class="at" style="color: #657422;">y =</span> estimate, <span class="at" style="color: #657422;">colour =</span> <span class="fu" style="color: #4758AB;">factor</span>(group),<span class="at" style="color: #657422;">lty=</span><span class="fu" style="color: #4758AB;">factor</span>(method)), <span class="at" style="color: #657422;">lwd=</span><span class="dv" style="color: #AD0000;">2</span>)  <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb27-10">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position=</span><span class="st" style="color: #20794D;">"bottom"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot-case3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/twfe-twm-and-did_files/figure-html/fig-plot-case3-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 8: Treatment Effect Estimates</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="case-4a-multiple-treatment-periods-and-constant-different-treatment-effects" class="level1">
<h1>Case 4a: Multiple Treatment Periods and Constant Different Treatment Effects</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1">params4a <span class="ot" style="color: #003B4F;">=</span>  <span class="fu" style="color: #4758AB;">list</span>(</span>
<span id="cb28-2">  <span class="at" style="color: #657422;">mu =</span> <span class="fu" style="color: #4758AB;">list</span>(<span class="st" style="color: #20794D;">"1989"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">5</span>,</span>
<span id="cb28-3">            <span class="st" style="color: #20794D;">"1998"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">3</span>,</span>
<span id="cb28-4">            <span class="st" style="color: #20794D;">"2007"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">1</span>),</span>
<span id="cb28-5">  <span class="at" style="color: #657422;">mu_t =</span> <span class="fu" style="color: #4758AB;">list</span>(<span class="st" style="color: #20794D;">"1989"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">0</span>,</span>
<span id="cb28-6">              <span class="st" style="color: #20794D;">"1998"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">0</span>,</span>
<span id="cb28-7">              <span class="st" style="color: #20794D;">"2007"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb28-8">  <span class="at" style="color: #657422;">tx =</span> <span class="fu" style="color: #4758AB;">list</span>(<span class="st" style="color: #20794D;">"1989"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">17</span>,</span>
<span id="cb28-9">            <span class="st" style="color: #20794D;">"1998"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">18</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">35</span>,</span>
<span id="cb28-10">            <span class="st" style="color: #20794D;">"2007"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">36</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">50</span>),</span>
<span id="cb28-11">  <span class="at" style="color: #657422;">bin =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">5</span>,<span class="dv" style="color: #AD0000;">5</span>))</span>
<span id="cb28-12"></span>
<span id="cb28-13"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">123</span>)</span>
<span id="cb28-14">df4a <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">make_data</span>(params4a,<span class="at" style="color: #657422;">N=</span><span class="dv" style="color: #AD0000;">200</span>) </span>
<span id="cb28-15">data4a <span class="ot" style="color: #003B4F;">&lt;-</span> df4a<span class="sc" style="color: #5E5E5E;">$</span>df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb28-16">  <span class="fu" style="color: #4758AB;">select</span>(dep_var,<span class="at" style="color: #657422;">treatment_time =</span> group, state,unit, year, treat) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb28-17">  <span class="fu" style="color: #4758AB;">mutate_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(treatment_time, year), factor)</span>
<span id="cb28-18"><span class="fu" style="color: #4758AB;">plot_data</span>(df4a) </span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/twfe-twm-and-did_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1">treatment_years4a <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb29-2">  data4a <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb29-3">  <span class="fu" style="color: #4758AB;">count</span>(treat, year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb29-4">  <span class="fu" style="color: #4758AB;">filter</span>(treat<span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">1</span> ) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb29-5">  <span class="fu" style="color: #4758AB;">pull</span>(year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb29-6">  <span class="fu" style="color: #4758AB;">as.vector</span>()</span>
<span id="cb29-7"></span>
<span id="cb29-8">treatment_groups4a <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb29-9">  <span class="fu" style="color: #4758AB;">unique</span>(data4a[data4a<span class="sc" style="color: #5E5E5E;">$</span>treatment_time <span class="sc" style="color: #5E5E5E;">!=</span> <span class="dv" style="color: #AD0000;">0</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> <span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(data4a<span class="sc" style="color: #5E5E5E;">$</span>treatment_time),]<span class="sc" style="color: #5E5E5E;">$</span>treatment_time) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb29-10">  <span class="fu" style="color: #4758AB;">paste</span>()</span>
<span id="cb29-11"></span>
<span id="cb29-12">df4a_ <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb29-13">  data4a <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb29-14">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">treatment_time =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(<span class="fu" style="color: #4758AB;">is.na</span>(treatment_time),<span class="dv" style="color: #AD0000;">0</span>,<span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(treatment_time)))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb29-15">  <span class="fu" style="color: #4758AB;">select</span>(<span class="at" style="color: #657422;">y =</span> dep_var,<span class="at" style="color: #657422;">w =</span> treat, <span class="at" style="color: #657422;">id =</span> unit,year, treatment_time) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb29-16">  fastDummies<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">dummy_cols</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"year"</span>,<span class="st" style="color: #20794D;">"treatment_time"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb29-17">  <span class="fu" style="color: #4758AB;">select_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(y,w,id,year,<span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"year_{treatment_years4a}"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.vector</span>(),</span>
<span id="cb29-18">                 <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"treatment_time_{treatment_groups4a}"</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb29-19">  <span class="fu" style="color: #4758AB;">rename_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"year_"</span>)),<span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"year_"</span>,<span class="st" style="color: #20794D;">"f"</span>,.)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb29-20">  <span class="fu" style="color: #4758AB;">rename_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"treatment_time_"</span>)),<span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"treatment_time_"</span>,<span class="st" style="color: #20794D;">"d"</span>,.))</span></code></pre></div>
</details>
</div>
<section id="estimate-models-3" class="level2">
<h2 class="anchored" data-anchor-id="estimate-models-3">Estimate Models</h2>
<p>We next estimate the models</p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>Command</th>
<th>Design Variables</th>
<th>Fixed or Random Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Two-Way Fixed Effects</td>
<td><code>feols()</code></td>
<td><code>w : d*</code> + <code>f*</code></td>
<td>Unit Fixed Effect</td>
</tr>
<tr class="even">
<td>Pooled OLS</td>
<td><code>lm()</code></td>
<td><code>w : d*</code> + <code>f*</code> + <code>d*</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Two-Way Mundlak</td>
<td><code>lmer()</code></td>
<td><code>w : d*</code> + <code>f*</code> + <code>d*</code></td>
<td>Unit Random Effect</td>
</tr>
</tbody>
</table>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1">fmla_twfe4a <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"y ~ {paste0('w : ',paste0('d',treatment_groups4a), collapse = ' + ')} + {paste0('f',treatment_years4a,collapse=' + ')} | id"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.formula</span>()</span>
<span id="cb30-2">fit_twfe4a <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">feols</span>(fmla_twfe4a, <span class="at" style="color: #657422;">data =</span> df4a_)</span>
<span id="cb30-3"></span>
<span id="cb30-4">fmla_lm4a <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"y ~ {paste0('w : ',paste0('d',treatment_groups4a), collapse = ' + ')} + {paste0('f',treatment_years4a,collapse=' + ')} + {paste0('d',treatment_groups4a,collapse=' + ')}"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.formula</span>()</span>
<span id="cb30-5">fit_lm4a <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">lm</span>(fmla_lm4a, <span class="at" style="color: #657422;">data =</span> df4a_) </span>
<span id="cb30-6"></span>
<span id="cb30-7"></span>
<span id="cb30-8">fmla_twm4a <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"y ~ {paste0('w : ',paste0('d',treatment_groups4a), collapse = ' + ')} + {paste0('f',treatment_years4a,collapse=' + ')} + {paste0('d',treatment_groups4a,collapse=' + ')} + (1|id)"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.formula</span>()</span>
<span id="cb30-9">fit_twm4a <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">lmer</span>( fmla_twm4a , <span class="at" style="color: #657422;">data =</span> df4a_) </span>
<span id="cb30-10"></span>
<span id="cb30-11"><span class="co" style="color: #5E5E5E;"># CS</span></span>
<span id="cb30-12">data4a_cs <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb30-13">  data4a <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb30-14">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(year)),</span>
<span id="cb30-15">         <span class="at" style="color: #657422;">treatment_time =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(treatment_time)))  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb30-16">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">treatment_time =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(<span class="fu" style="color: #4758AB;">is.na</span>(treatment_time),<span class="dv" style="color: #AD0000;">0</span>,treatment_time))</span>
<span id="cb30-17"></span>
<span id="cb30-18"></span>
<span id="cb30-19">fit_cs4a <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">att_gt</span>(<span class="at" style="color: #657422;">yname =</span> <span class="st" style="color: #20794D;">"dep_var"</span>,</span>
<span id="cb30-20">                  <span class="at" style="color: #657422;">tname =</span> <span class="st" style="color: #20794D;">"year"</span>,</span>
<span id="cb30-21">                  <span class="at" style="color: #657422;">idname =</span> <span class="st" style="color: #20794D;">"unit"</span>,</span>
<span id="cb30-22">                  <span class="at" style="color: #657422;">gname =</span> <span class="st" style="color: #20794D;">"treatment_time"</span>,</span>
<span id="cb30-23">                  <span class="at" style="color: #657422;">control_group =</span> <span class="st" style="color: #20794D;">"notyettreated"</span>,</span>
<span id="cb30-24">                  <span class="at" style="color: #657422;">data =</span> data4a_cs</span>
<span id="cb30-25">)</span>
<span id="cb30-26"></span>
<span id="cb30-27">est_cs4a <span class="ot" style="color: #003B4F;">&lt;-</span>  <span class="fu" style="color: #4758AB;">tibble</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">paste0</span>(fit_cs4a<span class="sc" style="color: #5E5E5E;">$</span>group), <span class="at" style="color: #657422;">year =</span> fit_cs4a<span class="sc" style="color: #5E5E5E;">$</span>t, <span class="at" style="color: #657422;">estimate =</span> fit_cs4a<span class="sc" style="color: #5E5E5E;">$</span>att) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb30-28">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"CS"</span>)  </span>
<span id="cb30-29"></span>
<span id="cb30-30"><span class="fu" style="color: #4758AB;">tibble</span>(<span class="at" style="color: #657422;">method =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"TWFE"</span>,<span class="st" style="color: #20794D;">"POLS"</span>,<span class="st" style="color: #20794D;">"TWM"</span>),</span>
<span id="cb30-31">         <span class="at" style="color: #657422;">formula =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"feols({Reduce(paste,deparse(fmla_twfe4a))}, data = df_)"</span>),</span>
<span id="cb30-32">                     <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lm({Reduce(paste,deparse(fmla_lm4a))}, data = df_)"</span>),</span>
<span id="cb30-33">                     <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lmer({Reduce(paste,deparse(fmla_twm4a))}, data = df_)"</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb30-34">  <span class="fu" style="color: #4758AB;">gt</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb30-35">  <span class="fu" style="color: #4758AB;">cols_label</span>(<span class="st" style="color: #20794D;">"method"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="st" style="color: #20794D;">"Estimator"</span>,</span>
<span id="cb30-36">             <span class="st" style="color: #20794D;">"formula"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="st" style="color: #20794D;">"Regression Call"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">

<div id="cueyqyprtn" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#cueyqyprtn .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#cueyqyprtn .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cueyqyprtn .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#cueyqyprtn .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#cueyqyprtn .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cueyqyprtn .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cueyqyprtn .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#cueyqyprtn .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#cueyqyprtn .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#cueyqyprtn .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#cueyqyprtn .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#cueyqyprtn .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#cueyqyprtn .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#cueyqyprtn .gt_from_md > :first-child {
  margin-top: 0;
}

#cueyqyprtn .gt_from_md > :last-child {
  margin-bottom: 0;
}

#cueyqyprtn .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#cueyqyprtn .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#cueyqyprtn .gt_row_group_first td {
  border-top-width: 2px;
}

#cueyqyprtn .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#cueyqyprtn .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#cueyqyprtn .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cueyqyprtn .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#cueyqyprtn .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#cueyqyprtn .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cueyqyprtn .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cueyqyprtn .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cueyqyprtn .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_left {
  text-align: left;
}

#cueyqyprtn .gt_center {
  text-align: center;
}

#cueyqyprtn .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#cueyqyprtn .gt_font_normal {
  font-weight: normal;
}

#cueyqyprtn .gt_font_bold {
  font-weight: bold;
}

#cueyqyprtn .gt_font_italic {
  font-style: italic;
}

#cueyqyprtn .gt_super {
  font-size: 65%;
}

#cueyqyprtn .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#cueyqyprtn .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#cueyqyprtn .gt_indent_1 {
  text-indent: 5px;
}

#cueyqyprtn .gt_indent_2 {
  text-indent: 10px;
}

#cueyqyprtn .gt_indent_3 {
  text-indent: 15px;
}

#cueyqyprtn .gt_indent_4 {
  text-indent: 20px;
}

#cueyqyprtn .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Estimator</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Regression Call</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">TWFE</td>
<td class="gt_row gt_left">feols(y ~ w:d1989 + w:d1998 + w:d2007 + f1989 + f1990 + f1991 + f1992 +      f1993 + f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 +      f2001 + f2002 + f2003 + f2004 + f2005 + f2006 + f2007 + f2008 +      f2009 + f2010 + f2011 + f2012 + f2013 + f2014 + f2015 | id, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">POLS</td>
<td class="gt_row gt_left">lm(y ~ w:d1989 + w:d1998 + w:d2007 + f1989 + f1990 + f1991 + f1992 +      f1993 + f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 +      f2001 + f2002 + f2003 + f2004 + f2005 + f2006 + f2007 + f2008 +      f2009 + f2010 + f2011 + f2012 + f2013 + f2014 + f2015 + d1989 +      d1998 + d2007, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">TWM</td>
<td class="gt_row gt_left">lmer(y ~ w:d1989 + w:d1998 + w:d2007 + f1989 + f1990 + f1991 + f1992 +      f1993 + f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 +      f2001 + f2002 + f2003 + f2004 + f2005 + f2006 + f2007 + f2008 +      f2009 + f2010 + f2011 + f2012 + f2013 + f2014 + f2015 + d1989 +      d1998 + d2007 + (1 | id), data = df_)</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1">est_twfe4a <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb31-2">  fit_twfe4a <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">tidy</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb31-3">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"TWFE"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb31-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">call =</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"feols({Reduce(paste,deparse(fmla_twfe4a))}, data = df4a_)"</span>))</span>
<span id="cb31-5"></span>
<span id="cb31-6">est_lm4a <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb31-7">  fit_lm4a <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">tidy</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb31-8">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">call =</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lm({Reduce(paste,deparse(fmla_lm4a))}, data = df4a_)"</span>))  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb31-9">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"POLS"</span>)</span>
<span id="cb31-10"></span>
<span id="cb31-11">est_twm4a <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb31-12">  fit_twm4a  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">summary</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb31-13">  <span class="fu" style="color: #4758AB;">coef</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb31-14">  <span class="fu" style="color: #4758AB;">data.frame</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb31-15">  <span class="fu" style="color: #4758AB;">rownames_to_column</span>(<span class="at" style="color: #657422;">var =</span> <span class="st" style="color: #20794D;">"term"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb31-16">  janitor<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">clean_names</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb31-17">  <span class="fu" style="color: #4758AB;">as_tibble</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb31-18">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"TWM"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb31-19">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">call =</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lmer({Reduce(paste,deparse(fmla_twm4a))}, data = df4a_)"</span>))</span>
<span id="cb31-20"></span>
<span id="cb31-21">est4a <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb31-22">  est_twfe4a <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb31-23">  <span class="fu" style="color: #4758AB;">bind_rows</span>(est_lm4a) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb31-24">  <span class="fu" style="color: #4758AB;">bind_rows</span>(est_twm4a) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb31-25">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="fu" style="color: #4758AB;">grepl</span>(<span class="st" style="color: #20794D;">"^w:"</span>,term)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb31-26">  <span class="fu" style="color: #4758AB;">separate</span>(term,<span class="at" style="color: #657422;">into=</span><span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"tmp"</span>,<span class="st" style="color: #20794D;">"group"</span>), <span class="at" style="color: #657422;">sep =</span> <span class="st" style="color: #20794D;">":"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb31-27">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"d"</span>,<span class="st" style="color: #20794D;">""</span>,group)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb31-28">  <span class="fu" style="color: #4758AB;">select</span>(<span class="sc" style="color: #5E5E5E;">-</span>tmp) <span class="co" style="color: #5E5E5E;">#%&gt;% </span></span>
<span id="cb31-29">  <span class="co" style="color: #5E5E5E;">#bind_rows(est_cs4a %&gt;% filter(!is.na(group))) </span></span>
<span id="cb31-30"></span>
<span id="cb31-31">df_est4a <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb31-32">  <span class="fu" style="color: #4758AB;">crossing</span>(<span class="at" style="color: #657422;">group=</span> treatment_groups4a) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb31-33">  <span class="fu" style="color: #4758AB;">as_tibble</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb31-34">  <span class="fu" style="color: #4758AB;">left_join</span>(est4a, <span class="st" style="color: #20794D;">"group"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb31-35">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">factor</span>(group))</span>
<span id="cb31-36"></span>
<span id="cb31-37">df_est4a <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb31-38">  <span class="fu" style="color: #4758AB;">select</span>(group,estimate,method) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb31-39">  <span class="fu" style="color: #4758AB;">spread</span>(method,estimate) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb31-40">  <span class="fu" style="color: #4758AB;">select</span>(group,TWFE,POLS,TWM) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb31-41">  <span class="fu" style="color: #4758AB;">gt</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb31-42">  <span class="fu" style="color: #4758AB;">fmt_number</span>(<span class="at" style="color: #657422;">columns=</span><span class="fu" style="color: #4758AB;">c</span>(TWFE,POLS,TWM),<span class="at" style="color: #657422;">decimals=</span><span class="dv" style="color: #AD0000;">3</span>)</span></code></pre></div>
</details>
<div id="fig-sum-case4a" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div id="ftgjihjymh" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ftgjihjymh .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ftgjihjymh .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ftgjihjymh .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ftgjihjymh .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ftgjihjymh .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ftgjihjymh .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ftgjihjymh .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ftgjihjymh .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ftgjihjymh .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ftgjihjymh .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ftgjihjymh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ftgjihjymh .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#ftgjihjymh .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ftgjihjymh .gt_from_md > :first-child {
  margin-top: 0;
}

#ftgjihjymh .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ftgjihjymh .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ftgjihjymh .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ftgjihjymh .gt_row_group_first td {
  border-top-width: 2px;
}

#ftgjihjymh .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ftgjihjymh .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ftgjihjymh .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ftgjihjymh .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ftgjihjymh .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ftgjihjymh .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ftgjihjymh .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ftgjihjymh .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ftgjihjymh .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_left {
  text-align: left;
}

#ftgjihjymh .gt_center {
  text-align: center;
}

#ftgjihjymh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ftgjihjymh .gt_font_normal {
  font-weight: normal;
}

#ftgjihjymh .gt_font_bold {
  font-weight: bold;
}

#ftgjihjymh .gt_font_italic {
  font-style: italic;
}

#ftgjihjymh .gt_super {
  font-size: 65%;
}

#ftgjihjymh .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#ftgjihjymh .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ftgjihjymh .gt_indent_1 {
  text-indent: 5px;
}

#ftgjihjymh .gt_indent_2 {
  text-indent: 10px;
}

#ftgjihjymh .gt_indent_3 {
  text-indent: 15px;
}

#ftgjihjymh .gt_indent_4 {
  text-indent: 20px;
}

#ftgjihjymh .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col">group</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWFE</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">POLS</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWM</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_center">1989</td>
<td class="gt_row gt_right">4.951</td>
<td class="gt_row gt_right">4.951</td>
<td class="gt_row gt_right">4.951</td></tr>
    <tr><td class="gt_row gt_center">1998</td>
<td class="gt_row gt_right">3.036</td>
<td class="gt_row gt_right">3.036</td>
<td class="gt_row gt_right">3.036</td></tr>
    <tr><td class="gt_row gt_center">2007</td>
<td class="gt_row gt_right">1.029</td>
<td class="gt_row gt_right">1.029</td>
<td class="gt_row gt_right">1.029</td></tr>
  </tbody>
  
  
</table>
</div>
<p></p><figcaption class="figure-caption">Figure 9: Summary of Estimates - Multiple Treatment Periods and Constant Different Treatment Effects</figcaption><p></p>
</figure>
</div>
</div>
</section>
<section id="summary-of-estimates-3" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-estimates-3">Summary of Estimates</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1">df_est4a_ <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb32-2">  <span class="fu" style="color: #4758AB;">crossing</span>(<span class="at" style="color: #657422;">year =</span> treatment_years4a,<span class="at" style="color: #657422;">group =</span> treatment_groups4a) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb32-3">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(group))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb32-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(year))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb32-5">  <span class="fu" style="color: #4758AB;">filter</span>(year<span class="sc" style="color: #5E5E5E;">&gt;=</span>group) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb32-6">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">factor</span>(group)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb32-7">  <span class="fu" style="color: #4758AB;">left_join</span>(</span>
<span id="cb32-8">    df_est4a,<span class="st" style="color: #20794D;">"group"</span></span>
<span id="cb32-9">  ) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb32-10">  <span class="fu" style="color: #4758AB;">bind_rows</span>(est_cs4a)</span>
<span id="cb32-11"></span>
<span id="cb32-12"><span class="fu" style="color: #4758AB;">plot_data</span>(df4a) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb32-13">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">data =</span> df_est4a_, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> year, <span class="at" style="color: #657422;">y =</span> estimate, <span class="at" style="color: #657422;">colour =</span> <span class="fu" style="color: #4758AB;">factor</span>(group),<span class="at" style="color: #657422;">lty=</span><span class="fu" style="color: #4758AB;">factor</span>(method)), <span class="at" style="color: #657422;">lwd=</span><span class="dv" style="color: #AD0000;">2</span>)  <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb32-14">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position=</span><span class="st" style="color: #20794D;">"bottom"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot-case4a" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/twfe-twm-and-did_files/figure-html/fig-plot-case4a-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 10: Treatment Effect Estimates - Multiple Treatment Periods and Constant Different Treatment Effects</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="case-4b-multiple-treatment-periods-and-constant-different-treatment-effects" class="level1">
<h1>Case 4b: Multiple Treatment Periods and Constant Different Treatment Effects</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1">params4b <span class="ot" style="color: #003B4F;">=</span>  <span class="fu" style="color: #4758AB;">list</span>(</span>
<span id="cb33-2">  <span class="at" style="color: #657422;">mu =</span> <span class="fu" style="color: #4758AB;">list</span>(<span class="st" style="color: #20794D;">"1989"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">5</span>,</span>
<span id="cb33-3">            <span class="st" style="color: #20794D;">"1998"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">3</span>),</span>
<span id="cb33-4">  <span class="at" style="color: #657422;">mu_t =</span> <span class="fu" style="color: #4758AB;">list</span>(<span class="st" style="color: #20794D;">"1989"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">0</span>,</span>
<span id="cb33-5">              <span class="st" style="color: #20794D;">"1998"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb33-6">  <span class="at" style="color: #657422;">tx =</span> <span class="fu" style="color: #4758AB;">list</span>(<span class="st" style="color: #20794D;">"1989"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">17</span>,</span>
<span id="cb33-7">            <span class="st" style="color: #20794D;">"1998"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">18</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">35</span>,</span>
<span id="cb33-8">            <span class="st" style="color: #20794D;">"NA"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">36</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">50</span>),</span>
<span id="cb33-9">  <span class="at" style="color: #657422;">bin =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">5</span>,<span class="dv" style="color: #AD0000;">5</span>))</span>
<span id="cb33-10"></span>
<span id="cb33-11"></span>
<span id="cb33-12"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">123</span>)</span>
<span id="cb33-13">df4b <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">make_data</span>(params4b,<span class="at" style="color: #657422;">N=</span><span class="dv" style="color: #AD0000;">200</span>) </span>
<span id="cb33-14">data4b <span class="ot" style="color: #003B4F;">&lt;-</span> df4b<span class="sc" style="color: #5E5E5E;">$</span>df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb33-15">  <span class="fu" style="color: #4758AB;">select</span>(dep_var,<span class="at" style="color: #657422;">treatment_time =</span> group, state,unit, year, treat) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb33-16">  <span class="fu" style="color: #4758AB;">mutate_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(treatment_time, year), factor)</span>
<span id="cb33-17"><span class="fu" style="color: #4758AB;">plot_data</span>(df4b) </span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/twfe-twm-and-did_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1">treatment_years4b <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb34-2">  data4b <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb34-3">  <span class="fu" style="color: #4758AB;">count</span>(treat, year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb34-4">  <span class="fu" style="color: #4758AB;">filter</span>(treat<span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">1</span> ) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb34-5">  <span class="fu" style="color: #4758AB;">pull</span>(year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb34-6">  <span class="fu" style="color: #4758AB;">as.vector</span>()</span>
<span id="cb34-7"></span>
<span id="cb34-8">treatment_groups4b <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb34-9">  <span class="fu" style="color: #4758AB;">unique</span>(data4b[data4b<span class="sc" style="color: #5E5E5E;">$</span>treatment_time <span class="sc" style="color: #5E5E5E;">!=</span> <span class="dv" style="color: #AD0000;">0</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> <span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(data4b<span class="sc" style="color: #5E5E5E;">$</span>treatment_time),]<span class="sc" style="color: #5E5E5E;">$</span>treatment_time) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb34-10">  <span class="fu" style="color: #4758AB;">paste</span>()</span>
<span id="cb34-11"></span>
<span id="cb34-12">df4b_ <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb34-13">  data4b <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb34-14">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">treatment_time =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(<span class="fu" style="color: #4758AB;">is.na</span>(treatment_time),<span class="dv" style="color: #AD0000;">0</span>,<span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(treatment_time)))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb34-15">  <span class="fu" style="color: #4758AB;">select</span>(<span class="at" style="color: #657422;">y =</span> dep_var,<span class="at" style="color: #657422;">w =</span> treat, <span class="at" style="color: #657422;">id =</span> unit,year, treatment_time) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb34-16">  fastDummies<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">dummy_cols</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"year"</span>,<span class="st" style="color: #20794D;">"treatment_time"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb34-17">  <span class="fu" style="color: #4758AB;">select_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(y,w,id,year,treatment_time,<span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"year_{treatment_years4b}"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.vector</span>(),</span>
<span id="cb34-18">                 <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"treatment_time_{treatment_groups4b}"</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb34-19">  <span class="fu" style="color: #4758AB;">rename_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"year_"</span>)),<span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"year_"</span>,<span class="st" style="color: #20794D;">"f"</span>,.)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb34-20">  <span class="fu" style="color: #4758AB;">rename_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"treatment_time_"</span>)),<span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"treatment_time_"</span>,<span class="st" style="color: #20794D;">"d"</span>,.))</span></code></pre></div>
</details>
</div>
<section id="estimate-models-4" class="level2">
<h2 class="anchored" data-anchor-id="estimate-models-4">Estimate Models</h2>
<p>We next estimate the models</p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>Command</th>
<th>Design Variables</th>
<th>Fixed or Random Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Two-Way Fixed Effects</td>
<td><code>feols()</code></td>
<td><code>w : d*</code> + <code>f*</code></td>
<td>Unit Fixed Effect</td>
</tr>
<tr class="even">
<td>Pooled OLS</td>
<td><code>lm()</code></td>
<td><code>w : d*</code> + <code>f*</code> + <code>d*</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Two-Way Mundlak</td>
<td><code>lmer()</code></td>
<td><code>w : d*</code> + <code>f*</code> + <code>d*</code></td>
<td>Unit Random Effect</td>
</tr>
</tbody>
</table>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1">fmla_twfe4b <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"y ~ {paste0('w : ',paste0('d',treatment_groups4b), collapse = ' + ')} + {paste0('f',treatment_years4b,collapse=' + ')} | id"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.formula</span>()</span>
<span id="cb35-2">fit_twfe4b <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">feols</span>(fmla_twfe4b, <span class="at" style="color: #657422;">data =</span> df4b_)</span>
<span id="cb35-3"></span>
<span id="cb35-4">fmla_lm4b <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"y ~ {paste0('w : ',paste0('d',treatment_groups4b), collapse = ' + ')} + {paste0('f',treatment_years4b,collapse=' + ')} + {paste0('d',treatment_groups4b,collapse=' + ')}"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.formula</span>()</span>
<span id="cb35-5">fit_lm4b <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">lm</span>(fmla_lm4b, <span class="at" style="color: #657422;">data =</span> df4b_) </span>
<span id="cb35-6"></span>
<span id="cb35-7">fmla_twm4b <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"y ~ {paste0('w : ',paste0('d',treatment_groups4b), collapse = ' + ')} + {paste0('f',treatment_years4b,collapse=' + ')} + {paste0('d',treatment_groups4b,collapse=' + ')} + (1|id)"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.formula</span>()</span>
<span id="cb35-8">fit_twm4b <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">lmer</span>( fmla_twm4b , <span class="at" style="color: #657422;">data =</span> df4b_) </span>
<span id="cb35-9"></span>
<span id="cb35-10"><span class="fu" style="color: #4758AB;">tibble</span>(<span class="at" style="color: #657422;">method =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"TWFE"</span>,<span class="st" style="color: #20794D;">"POLS"</span>,<span class="st" style="color: #20794D;">"TWM"</span>),</span>
<span id="cb35-11">         <span class="at" style="color: #657422;">formula =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"feols({Reduce(paste,deparse(fmla_twfe4b))}, data = df_)"</span>),</span>
<span id="cb35-12">                     <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lm({Reduce(paste,deparse(fmla_lm4b))}, data = df_)"</span>),</span>
<span id="cb35-13">                     <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lmer({Reduce(paste,deparse(fmla_twm4b))}, data = df_)"</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb35-14">  <span class="fu" style="color: #4758AB;">gt</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb35-15">  <span class="fu" style="color: #4758AB;">cols_label</span>(<span class="st" style="color: #20794D;">"method"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="st" style="color: #20794D;">"Estimator"</span>,</span>
<span id="cb35-16">             <span class="st" style="color: #20794D;">"formula"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="st" style="color: #20794D;">"Regression Call"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">

<div id="fbguytibxb" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#fbguytibxb .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#fbguytibxb .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fbguytibxb .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#fbguytibxb .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#fbguytibxb .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fbguytibxb .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fbguytibxb .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#fbguytibxb .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#fbguytibxb .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#fbguytibxb .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#fbguytibxb .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#fbguytibxb .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#fbguytibxb .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#fbguytibxb .gt_from_md > :first-child {
  margin-top: 0;
}

#fbguytibxb .gt_from_md > :last-child {
  margin-bottom: 0;
}

#fbguytibxb .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#fbguytibxb .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#fbguytibxb .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#fbguytibxb .gt_row_group_first td {
  border-top-width: 2px;
}

#fbguytibxb .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fbguytibxb .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#fbguytibxb .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#fbguytibxb .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fbguytibxb .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fbguytibxb .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#fbguytibxb .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#fbguytibxb .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fbguytibxb .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fbguytibxb .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fbguytibxb .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fbguytibxb .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fbguytibxb .gt_left {
  text-align: left;
}

#fbguytibxb .gt_center {
  text-align: center;
}

#fbguytibxb .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#fbguytibxb .gt_font_normal {
  font-weight: normal;
}

#fbguytibxb .gt_font_bold {
  font-weight: bold;
}

#fbguytibxb .gt_font_italic {
  font-style: italic;
}

#fbguytibxb .gt_super {
  font-size: 65%;
}

#fbguytibxb .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#fbguytibxb .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#fbguytibxb .gt_indent_1 {
  text-indent: 5px;
}

#fbguytibxb .gt_indent_2 {
  text-indent: 10px;
}

#fbguytibxb .gt_indent_3 {
  text-indent: 15px;
}

#fbguytibxb .gt_indent_4 {
  text-indent: 20px;
}

#fbguytibxb .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Estimator</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Regression Call</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">TWFE</td>
<td class="gt_row gt_left">feols(y ~ w:d1989 + w:d1998 + f1989 + f1990 + f1991 + f1992 + f1993 +      f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 + f2001 +      f2002 + f2003 + f2004 + f2005 + f2006 + f2007 + f2008 + f2009 +      f2010 + f2011 + f2012 + f2013 + f2014 + f2015 | id, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">POLS</td>
<td class="gt_row gt_left">lm(y ~ w:d1989 + w:d1998 + f1989 + f1990 + f1991 + f1992 + f1993 +      f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 + f2001 +      f2002 + f2003 + f2004 + f2005 + f2006 + f2007 + f2008 + f2009 +      f2010 + f2011 + f2012 + f2013 + f2014 + f2015 + d1989 + d1998, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">TWM</td>
<td class="gt_row gt_left">lmer(y ~ w:d1989 + w:d1998 + f1989 + f1990 + f1991 + f1992 + f1993 +      f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 + f2001 +      f2002 + f2003 + f2004 + f2005 + f2006 + f2007 + f2008 + f2009 +      f2010 + f2011 + f2012 + f2013 + f2014 + f2015 + d1989 + d1998 +      (1 | id), data = df_)</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><span class="co" style="color: #5E5E5E;"># CS</span></span>
<span id="cb36-2">data4b_cs <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb36-3">  data4b <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb36-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(year)),</span>
<span id="cb36-5">         <span class="at" style="color: #657422;">treatment_time =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(treatment_time)))  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb36-6">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">treatment_time =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(<span class="fu" style="color: #4758AB;">is.na</span>(treatment_time),<span class="dv" style="color: #AD0000;">0</span>,treatment_time))</span>
<span id="cb36-7"></span>
<span id="cb36-8"></span>
<span id="cb36-9">fit_cs4b <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">att_gt</span>(<span class="at" style="color: #657422;">yname =</span> <span class="st" style="color: #20794D;">"dep_var"</span>,</span>
<span id="cb36-10">                  <span class="at" style="color: #657422;">tname =</span> <span class="st" style="color: #20794D;">"year"</span>,</span>
<span id="cb36-11">                  <span class="at" style="color: #657422;">idname =</span> <span class="st" style="color: #20794D;">"unit"</span>,</span>
<span id="cb36-12">                  <span class="at" style="color: #657422;">gname =</span> <span class="st" style="color: #20794D;">"treatment_time"</span>,</span>
<span id="cb36-13">                  <span class="at" style="color: #657422;">control_group =</span> <span class="st" style="color: #20794D;">"nevertreated"</span>,</span>
<span id="cb36-14">                  <span class="at" style="color: #657422;">data =</span> data4b_cs</span>
<span id="cb36-15">)</span>
<span id="cb36-16"></span>
<span id="cb36-17">est_cs4b <span class="ot" style="color: #003B4F;">&lt;-</span>  <span class="fu" style="color: #4758AB;">tibble</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">paste0</span>(fit_cs4b<span class="sc" style="color: #5E5E5E;">$</span>group), <span class="at" style="color: #657422;">year =</span> fit_cs4b<span class="sc" style="color: #5E5E5E;">$</span>t, <span class="at" style="color: #657422;">estimate =</span> fit_cs4b<span class="sc" style="color: #5E5E5E;">$</span>att) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb36-18">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"CS"</span>)  </span></code></pre></div>
</details>
</div>
</section>
<section id="summary-of-estimates-4" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-estimates-4">Summary of Estimates</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1">est_twfe4b <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb37-2">  fit_twfe4b <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">tidy</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb37-3">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"TWFE"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb37-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">call =</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"feols({Reduce(paste,deparse(fmla_twfe4b))}, data = df4b_)"</span>)) </span>
<span id="cb37-5"></span>
<span id="cb37-6">est_lm4b <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb37-7">  fit_lm4b <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">tidy</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb37-8">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">call =</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lm({Reduce(paste,deparse(fmla_lm4b))}, data = df4b_)"</span>))  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb37-9">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"POLS"</span>)</span>
<span id="cb37-10"></span>
<span id="cb37-11">est_twm4b <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb37-12">  fit_twm4b  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">summary</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb37-13">  <span class="fu" style="color: #4758AB;">coef</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb37-14">  <span class="fu" style="color: #4758AB;">data.frame</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb37-15">  <span class="fu" style="color: #4758AB;">rownames_to_column</span>(<span class="at" style="color: #657422;">var =</span> <span class="st" style="color: #20794D;">"term"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb37-16">  janitor<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">clean_names</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb37-17">  <span class="fu" style="color: #4758AB;">as_tibble</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb37-18">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"TWM"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb37-19">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">call =</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lmer({Reduce(paste,deparse(fmla_twm4b))}, data = df4b_)"</span>))</span>
<span id="cb37-20"></span>
<span id="cb37-21">est4b <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb37-22">  est_twfe4b <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb37-23">  <span class="fu" style="color: #4758AB;">bind_rows</span>(est_lm4b) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb37-24">  <span class="fu" style="color: #4758AB;">bind_rows</span>(est_twm4b) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb37-25">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="fu" style="color: #4758AB;">grepl</span>(<span class="st" style="color: #20794D;">"^w:"</span>,term)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb37-26">  <span class="fu" style="color: #4758AB;">separate</span>(term,<span class="at" style="color: #657422;">into=</span><span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"tmp"</span>,<span class="st" style="color: #20794D;">"group"</span>), <span class="at" style="color: #657422;">sep =</span> <span class="st" style="color: #20794D;">":"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb37-27">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"d"</span>,<span class="st" style="color: #20794D;">""</span>,group)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb37-28">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(group))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb37-29">  <span class="fu" style="color: #4758AB;">select</span>(<span class="sc" style="color: #5E5E5E;">-</span>tmp) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb37-30">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">factor</span>(group))</span>
<span id="cb37-31"></span>
<span id="cb37-32">df_est4b <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb37-33">  <span class="fu" style="color: #4758AB;">crossing</span>(<span class="at" style="color: #657422;">group=</span> treatment_groups4b) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb37-34">  <span class="fu" style="color: #4758AB;">as_tibble</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb37-35">  <span class="fu" style="color: #4758AB;">left_join</span>(est4b, <span class="st" style="color: #20794D;">"group"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb37-36">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">factor</span>(group))</span>
<span id="cb37-37"></span>
<span id="cb37-38">df_est4b <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb37-39">  <span class="fu" style="color: #4758AB;">select</span>(group,estimate,method) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb37-40">  <span class="fu" style="color: #4758AB;">spread</span>(method,estimate) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb37-41">  <span class="fu" style="color: #4758AB;">select</span>(group,TWFE,POLS,TWM) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb37-42">  <span class="fu" style="color: #4758AB;">gt</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb37-43">  <span class="fu" style="color: #4758AB;">fmt_number</span>(<span class="at" style="color: #657422;">columns=</span><span class="fu" style="color: #4758AB;">c</span>(TWFE,POLS,TWM),<span class="at" style="color: #657422;">decimals=</span><span class="dv" style="color: #AD0000;">3</span>)</span></code></pre></div>
</details>
<div id="fig-sum-case4b" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div id="xryyodlbmy" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#xryyodlbmy .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#xryyodlbmy .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xryyodlbmy .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#xryyodlbmy .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#xryyodlbmy .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xryyodlbmy .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xryyodlbmy .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#xryyodlbmy .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#xryyodlbmy .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#xryyodlbmy .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#xryyodlbmy .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#xryyodlbmy .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#xryyodlbmy .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#xryyodlbmy .gt_from_md > :first-child {
  margin-top: 0;
}

#xryyodlbmy .gt_from_md > :last-child {
  margin-bottom: 0;
}

#xryyodlbmy .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#xryyodlbmy .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#xryyodlbmy .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#xryyodlbmy .gt_row_group_first td {
  border-top-width: 2px;
}

#xryyodlbmy .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xryyodlbmy .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#xryyodlbmy .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#xryyodlbmy .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xryyodlbmy .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xryyodlbmy .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#xryyodlbmy .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#xryyodlbmy .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xryyodlbmy .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xryyodlbmy .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xryyodlbmy .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xryyodlbmy .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xryyodlbmy .gt_left {
  text-align: left;
}

#xryyodlbmy .gt_center {
  text-align: center;
}

#xryyodlbmy .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#xryyodlbmy .gt_font_normal {
  font-weight: normal;
}

#xryyodlbmy .gt_font_bold {
  font-weight: bold;
}

#xryyodlbmy .gt_font_italic {
  font-style: italic;
}

#xryyodlbmy .gt_super {
  font-size: 65%;
}

#xryyodlbmy .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#xryyodlbmy .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#xryyodlbmy .gt_indent_1 {
  text-indent: 5px;
}

#xryyodlbmy .gt_indent_2 {
  text-indent: 10px;
}

#xryyodlbmy .gt_indent_3 {
  text-indent: 15px;
}

#xryyodlbmy .gt_indent_4 {
  text-indent: 20px;
}

#xryyodlbmy .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col">group</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWFE</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">POLS</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWM</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_center">1989</td>
<td class="gt_row gt_right">5.055</td>
<td class="gt_row gt_right">5.055</td>
<td class="gt_row gt_right">5.055</td></tr>
    <tr><td class="gt_row gt_center">1998</td>
<td class="gt_row gt_right">2.983</td>
<td class="gt_row gt_right">2.983</td>
<td class="gt_row gt_right">2.983</td></tr>
  </tbody>
  
  
</table>
</div>
<p></p><figcaption class="figure-caption">Figure 11: Summary of Estimates - Multiple Treatment Periods and Constant Different Treatment Effects</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1">df_est4b_ <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb38-2">  <span class="fu" style="color: #4758AB;">crossing</span>(<span class="at" style="color: #657422;">year =</span> treatment_years4b,<span class="at" style="color: #657422;">group =</span> treatment_groups4b) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb38-3">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(group))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb38-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(year))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb38-5">  <span class="fu" style="color: #4758AB;">filter</span>(year<span class="sc" style="color: #5E5E5E;">&gt;=</span>group) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb38-6">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">factor</span>(group)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb38-7">  <span class="fu" style="color: #4758AB;">left_join</span>(</span>
<span id="cb38-8">    df_est4b,<span class="st" style="color: #20794D;">"group"</span></span>
<span id="cb38-9">  ) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb38-10">  <span class="fu" style="color: #4758AB;">bind_rows</span>(est_cs4b)</span>
<span id="cb38-11"></span>
<span id="cb38-12"><span class="fu" style="color: #4758AB;">plot_data</span>(df4b) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb38-13">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">data =</span> df_est4b_, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> year, <span class="at" style="color: #657422;">y =</span> estimate, <span class="at" style="color: #657422;">colour =</span> <span class="fu" style="color: #4758AB;">factor</span>(group),<span class="at" style="color: #657422;">lty=</span><span class="fu" style="color: #4758AB;">factor</span>(method)), <span class="at" style="color: #657422;">lwd=</span><span class="dv" style="color: #AD0000;">2</span>)  <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb38-14">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position=</span><span class="st" style="color: #20794D;">"bottom"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot-case4b" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/twfe-twm-and-did_files/figure-html/fig-plot-case4b-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 12: Treatment Effect Estimates - Multiple Treatment Periods and Constant Different Treatment Effects</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="case-4c-multiple-treatment-periods-and-constant-different-treatment-effects---never-treated-as-control" class="level1">
<h1>Case 4c: Multiple Treatment Periods and Constant Different Treatment Effects - Never Treated as Control</h1>
<section id="define-all-the-years-where-at-least-one-group-is-treated-treatment_years-1" class="level3">
<h3 class="anchored" data-anchor-id="define-all-the-years-where-at-least-one-group-is-treated-treatment_years-1">1. Define all the years where at least one group is treated (<code>treatment_years</code>)</h3>
<p>Note that we define these years across <em>the entire sample</em> and do not restrict to only post-treatment years, as we did above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1">treatment_years4b_nev <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb39-2">  data4b <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb39-3">  <span class="fu" style="color: #4758AB;">count</span>(treat, year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb39-4">  <span class="co" style="color: #5E5E5E;">#!!!! </span><span class="al" style="color: #AD0000;">NOTE</span><span class="co" style="color: #5E5E5E;"> THAT WE DON'T RESTRICT TO POST-TREATMENT YEARS AS BEFORE</span></span>
<span id="cb39-5">  <span class="co" style="color: #5E5E5E;">#filter(treat== 1 ) %&gt;%</span></span>
<span id="cb39-6">  <span class="fu" style="color: #4758AB;">pull</span>(year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb39-7">  <span class="fu" style="color: #4758AB;">as.vector</span>()</span>
<span id="cb39-8">treatment_years4b_nev</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "1980" "1981" "1982" "1983" "1984" "1985" "1986" "1987" "1988" "1989"
[11] "1990" "1991" "1992" "1993" "1994" "1995" "1996" "1997" "1998" "1999"
[21] "2000" "2001" "2002" "2003" "2004" "2005" "2006" "2007" "2008" "2009"
[31] "2010" "2011" "2012" "2013" "2014" "2015" "1989" "1990" "1991" "1992"
[41] "1993" "1994" "1995" "1996" "1997" "1998" "1999" "2000" "2001" "2002"
[51] "2003" "2004" "2005" "2006" "2007" "2008" "2009" "2010" "2011" "2012"
[61] "2013" "2014" "2015"</code></pre>
</div>
</div>
</section>
<section id="estimate-models-5" class="level2">
<h2 class="anchored" data-anchor-id="estimate-models-5">Estimate Models</h2>
<p>We next estimate the models</p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>Command</th>
<th>Design Variables</th>
<th>Fixed or Random Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Two-Way Fixed Effects</td>
<td><code>feols()</code></td>
<td><code>w : d*</code> + <code>f*</code></td>
<td>Unit Fixed Effect</td>
</tr>
<tr class="even">
<td>Pooled OLS</td>
<td><code>lm()</code></td>
<td><code>w : d*</code> + <code>f*</code> + <code>d*</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Two-Way Mundlak</td>
<td><code>lmer()</code></td>
<td><code>w : d*</code> + <code>f*</code> + <code>d*</code></td>
<td>Unit Random Effect</td>
</tr>
</tbody>
</table>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1">df4b_nev_ <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb41-2">  data4b <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb41-3">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">treatment_time =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(<span class="fu" style="color: #4758AB;">is.na</span>(treatment_time),<span class="dv" style="color: #AD0000;">0</span>,<span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(treatment_time)))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb41-4">  <span class="fu" style="color: #4758AB;">select</span>(<span class="at" style="color: #657422;">y =</span> dep_var,<span class="at" style="color: #657422;">w =</span> treat, <span class="at" style="color: #657422;">id =</span> unit,year, treatment_time) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb41-5">  fastDummies<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">dummy_cols</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"year"</span>,<span class="st" style="color: #20794D;">"treatment_time"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb41-6">  <span class="fu" style="color: #4758AB;">select_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(y,w,id,year,treatment_time,<span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"year_{treatment_years4b_nev}"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.vector</span>(),</span>
<span id="cb41-7">                 <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"treatment_time_{treatment_groups4b}"</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb41-8">  <span class="fu" style="color: #4758AB;">rename_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"year_"</span>)),<span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"year_"</span>,<span class="st" style="color: #20794D;">"f"</span>,.)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb41-9">  <span class="fu" style="color: #4758AB;">rename_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"treatment_time_"</span>)),<span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"treatment_time_"</span>,<span class="st" style="color: #20794D;">"d"</span>,.))</span>
<span id="cb41-10"></span>
<span id="cb41-11">fmla_twfe4b_nev <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"y ~ {paste0('w : ',paste0('d',treatment_groups4b), collapse = ' + ')} + {paste0('f',treatment_years4b_nev[-1],collapse=' + ')} | id"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.formula</span>()</span>
<span id="cb41-12">fit_twfe4b_nev <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">feols</span>(fmla_twfe4b_nev, <span class="at" style="color: #657422;">data =</span> df4b_nev_)</span>
<span id="cb41-13"></span>
<span id="cb41-14">fmla_lm4b_nev <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"y ~ {paste0('w : ',paste0('d',treatment_groups4b), collapse = ' + ')} + {paste0('f',treatment_years4b_nev[-1],collapse=' + ')} + {paste0('d',treatment_groups4b,collapse=' + ')}"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.formula</span>()</span>
<span id="cb41-15">fit_lm4b_nev <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">lm</span>(fmla_lm4b_nev, <span class="at" style="color: #657422;">data =</span> df4b_nev_) </span>
<span id="cb41-16"></span>
<span id="cb41-17">fmla_twm4b_nev <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"y ~ {paste0('w : ',paste0('d',treatment_groups4b), collapse = ' + ')} + {paste0('f',treatment_years4b_nev[-1],collapse=' + ')} + {paste0('d',treatment_groups4b,collapse=' + ')} + (1|id)"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.formula</span>()</span>
<span id="cb41-18">fit_twm4b_nev <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">lmer</span>( fmla_twm4b_nev , <span class="at" style="color: #657422;">data =</span> df4b_nev_) </span>
<span id="cb41-19"></span>
<span id="cb41-20"><span class="fu" style="color: #4758AB;">tibble</span>(<span class="at" style="color: #657422;">method =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"TWFE"</span>,<span class="st" style="color: #20794D;">"POLS"</span>,<span class="st" style="color: #20794D;">"TWM"</span>),</span>
<span id="cb41-21">         <span class="at" style="color: #657422;">formula =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"feols({Reduce(paste,deparse(fmla_twfe4b_nev))}, data = df_)"</span>),</span>
<span id="cb41-22">                     <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lm({Reduce(paste,deparse(fmla_lm4b_nev))}, data = df_)"</span>),</span>
<span id="cb41-23">                     <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lmer({Reduce(paste,deparse(fmla_twm4b_nev))}, data = df_)"</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb41-24">  <span class="fu" style="color: #4758AB;">gt</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb41-25">  <span class="fu" style="color: #4758AB;">cols_label</span>(<span class="st" style="color: #20794D;">"method"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="st" style="color: #20794D;">"Estimator"</span>,</span>
<span id="cb41-26">             <span class="st" style="color: #20794D;">"formula"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="st" style="color: #20794D;">"Regression Call"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">

<div id="gcsjrhlxtg" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#gcsjrhlxtg .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#gcsjrhlxtg .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gcsjrhlxtg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#gcsjrhlxtg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#gcsjrhlxtg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gcsjrhlxtg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gcsjrhlxtg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#gcsjrhlxtg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#gcsjrhlxtg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#gcsjrhlxtg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#gcsjrhlxtg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#gcsjrhlxtg .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#gcsjrhlxtg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#gcsjrhlxtg .gt_from_md > :first-child {
  margin-top: 0;
}

#gcsjrhlxtg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#gcsjrhlxtg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#gcsjrhlxtg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#gcsjrhlxtg .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#gcsjrhlxtg .gt_row_group_first td {
  border-top-width: 2px;
}

#gcsjrhlxtg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gcsjrhlxtg .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#gcsjrhlxtg .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#gcsjrhlxtg .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gcsjrhlxtg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gcsjrhlxtg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#gcsjrhlxtg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#gcsjrhlxtg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gcsjrhlxtg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gcsjrhlxtg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gcsjrhlxtg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gcsjrhlxtg .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gcsjrhlxtg .gt_left {
  text-align: left;
}

#gcsjrhlxtg .gt_center {
  text-align: center;
}

#gcsjrhlxtg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#gcsjrhlxtg .gt_font_normal {
  font-weight: normal;
}

#gcsjrhlxtg .gt_font_bold {
  font-weight: bold;
}

#gcsjrhlxtg .gt_font_italic {
  font-style: italic;
}

#gcsjrhlxtg .gt_super {
  font-size: 65%;
}

#gcsjrhlxtg .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#gcsjrhlxtg .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#gcsjrhlxtg .gt_indent_1 {
  text-indent: 5px;
}

#gcsjrhlxtg .gt_indent_2 {
  text-indent: 10px;
}

#gcsjrhlxtg .gt_indent_3 {
  text-indent: 15px;
}

#gcsjrhlxtg .gt_indent_4 {
  text-indent: 20px;
}

#gcsjrhlxtg .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Estimator</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Regression Call</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">TWFE</td>
<td class="gt_row gt_left">feols(y ~ w:d1989 + w:d1998 + f1981 + f1982 + f1983 + f1984 + f1985 +      f1986 + f1987 + f1988 + f1989 + f1990 + f1991 + f1992 + f1993 +      f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 + f2001 +      f2002 + f2003 + f2004 + f2005 + f2006 + f2007 + f2008 + f2009 +      f2010 + f2011 + f2012 + f2013 + f2014 + f2015 + f1989 + f1990 +      f1991 + f1992 + f1993 + f1994 + f1995 + f1996 + f1997 + f1998 +      f1999 + f2000 + f2001 + f2002 + f2003 + f2004 + f2005 + f2006 +      f2007 + f2008 + f2009 + f2010 + f2011 + f2012 + f2013 + f2014 +      f2015 | id, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">POLS</td>
<td class="gt_row gt_left">lm(y ~ w:d1989 + w:d1998 + f1981 + f1982 + f1983 + f1984 + f1985 +      f1986 + f1987 + f1988 + f1989 + f1990 + f1991 + f1992 + f1993 +      f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 + f2001 +      f2002 + f2003 + f2004 + f2005 + f2006 + f2007 + f2008 + f2009 +      f2010 + f2011 + f2012 + f2013 + f2014 + f2015 + f1989 + f1990 +      f1991 + f1992 + f1993 + f1994 + f1995 + f1996 + f1997 + f1998 +      f1999 + f2000 + f2001 + f2002 + f2003 + f2004 + f2005 + f2006 +      f2007 + f2008 + f2009 + f2010 + f2011 + f2012 + f2013 + f2014 +      f2015 + d1989 + d1998, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">TWM</td>
<td class="gt_row gt_left">lmer(y ~ w:d1989 + w:d1998 + f1981 + f1982 + f1983 + f1984 + f1985 +      f1986 + f1987 + f1988 + f1989 + f1990 + f1991 + f1992 + f1993 +      f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 + f2001 +      f2002 + f2003 + f2004 + f2005 + f2006 + f2007 + f2008 + f2009 +      f2010 + f2011 + f2012 + f2013 + f2014 + f2015 + f1989 + f1990 +      f1991 + f1992 + f1993 + f1994 + f1995 + f1996 + f1997 + f1998 +      f1999 + f2000 + f2001 + f2002 + f2003 + f2004 + f2005 + f2006 +      f2007 + f2008 + f2009 + f2010 + f2011 + f2012 + f2013 + f2014 +      f2015 + d1989 + d1998 + (1 | id), data = df_)</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><span class="co" style="color: #5E5E5E;"># CS</span></span>
<span id="cb42-2">data4b_nev_cs <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb42-3">  data4b <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb42-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(year)),</span>
<span id="cb42-5">         <span class="at" style="color: #657422;">treatment_time =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(treatment_time)))  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb42-6">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">treatment_time =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(<span class="fu" style="color: #4758AB;">is.na</span>(treatment_time),<span class="dv" style="color: #AD0000;">0</span>,treatment_time))</span>
<span id="cb42-7"></span>
<span id="cb42-8"></span>
<span id="cb42-9">fit_cs4b_nev <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">att_gt</span>(<span class="at" style="color: #657422;">yname =</span> <span class="st" style="color: #20794D;">"dep_var"</span>,</span>
<span id="cb42-10">                  <span class="at" style="color: #657422;">tname =</span> <span class="st" style="color: #20794D;">"year"</span>,</span>
<span id="cb42-11">                  <span class="at" style="color: #657422;">idname =</span> <span class="st" style="color: #20794D;">"unit"</span>,</span>
<span id="cb42-12">                  <span class="at" style="color: #657422;">gname =</span> <span class="st" style="color: #20794D;">"treatment_time"</span>,</span>
<span id="cb42-13">                  <span class="at" style="color: #657422;">control_group =</span> <span class="st" style="color: #20794D;">"nevertreated"</span>,</span>
<span id="cb42-14">                  <span class="at" style="color: #657422;">data =</span> data4b_nev_cs</span>
<span id="cb42-15">)</span>
<span id="cb42-16"></span>
<span id="cb42-17">est_cs4b_nev <span class="ot" style="color: #003B4F;">&lt;-</span>  <span class="fu" style="color: #4758AB;">tibble</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">paste0</span>(fit_cs4b<span class="sc" style="color: #5E5E5E;">$</span>group), <span class="at" style="color: #657422;">year =</span> fit_cs4b<span class="sc" style="color: #5E5E5E;">$</span>t, <span class="at" style="color: #657422;">estimate =</span> fit_cs4b<span class="sc" style="color: #5E5E5E;">$</span>att) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb42-18">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"CS"</span>)  </span></code></pre></div>
</details>
</div>
</section>
<section id="summary-of-estimates-5" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-estimates-5">Summary of Estimates</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1">est_twfe4b_nev <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb43-2">  fit_twfe4b_nev <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">tidy</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb43-3">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"TWFE"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb43-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">call =</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"feols({Reduce(paste,deparse(fmla_twfe4b_nev))}, data = df4b_nev_)"</span>))</span>
<span id="cb43-5"></span>
<span id="cb43-6">est_lm4b_nev <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb43-7">  fit_lm4b_nev <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">tidy</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb43-8">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">call =</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lm({Reduce(paste,deparse(fmla_lm4b_nev))}, data = df4b_nev_)"</span>))  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb43-9">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"POLS"</span>)</span>
<span id="cb43-10"></span>
<span id="cb43-11">est_twm4b_nev <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb43-12">  fit_twm4b_nev  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">summary</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb43-13">  <span class="fu" style="color: #4758AB;">coef</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb43-14">  <span class="fu" style="color: #4758AB;">data.frame</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb43-15">  <span class="fu" style="color: #4758AB;">rownames_to_column</span>(<span class="at" style="color: #657422;">var =</span> <span class="st" style="color: #20794D;">"term"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb43-16">  janitor<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">clean_names</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb43-17">  <span class="fu" style="color: #4758AB;">as_tibble</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb43-18">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"TWM"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb43-19">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">call =</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lmer({Reduce(paste,deparse(fmla_twm4b_nev))}, data = df4b_nev_)"</span>))</span>
<span id="cb43-20"></span>
<span id="cb43-21">est4b_nev <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb43-22">  est_twfe4b_nev <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb43-23">  <span class="fu" style="color: #4758AB;">bind_rows</span>(est_lm4b_nev) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb43-24">  <span class="fu" style="color: #4758AB;">bind_rows</span>(est_twm4b_nev) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb43-25">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="fu" style="color: #4758AB;">grepl</span>(<span class="st" style="color: #20794D;">"^w:"</span>,term)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb43-26">  <span class="fu" style="color: #4758AB;">separate</span>(term,<span class="at" style="color: #657422;">into=</span><span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"tmp"</span>,<span class="st" style="color: #20794D;">"group"</span>), <span class="at" style="color: #657422;">sep =</span> <span class="st" style="color: #20794D;">":"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb43-27">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"d"</span>,<span class="st" style="color: #20794D;">""</span>,group)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb43-28">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(group))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb43-29">  <span class="fu" style="color: #4758AB;">select</span>(<span class="sc" style="color: #5E5E5E;">-</span>tmp) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb43-30">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">factor</span>(group))</span>
<span id="cb43-31"></span>
<span id="cb43-32">df_est4b_nev <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb43-33">  <span class="fu" style="color: #4758AB;">crossing</span>(<span class="at" style="color: #657422;">group=</span> treatment_groups4b) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb43-34">  <span class="fu" style="color: #4758AB;">as_tibble</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb43-35">  <span class="fu" style="color: #4758AB;">left_join</span>(est4b_nev, <span class="st" style="color: #20794D;">"group"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb43-36">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">factor</span>(group))</span>
<span id="cb43-37"></span>
<span id="cb43-38">df_est4b_nev <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb43-39">  <span class="fu" style="color: #4758AB;">select</span>(group,estimate,method) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb43-40">  <span class="fu" style="color: #4758AB;">spread</span>(method,estimate) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb43-41">  <span class="fu" style="color: #4758AB;">select</span>(group,TWFE,POLS,TWM) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb43-42">  <span class="fu" style="color: #4758AB;">gt</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb43-43">  <span class="fu" style="color: #4758AB;">fmt_number</span>(<span class="at" style="color: #657422;">columns=</span><span class="fu" style="color: #4758AB;">c</span>(TWFE,POLS,TWM),<span class="at" style="color: #657422;">decimals=</span><span class="dv" style="color: #AD0000;">3</span>)</span></code></pre></div>
</details>
<div id="fig-sum-case4b-nev" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div id="gyanjrujsb" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#gyanjrujsb .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#gyanjrujsb .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gyanjrujsb .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#gyanjrujsb .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#gyanjrujsb .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gyanjrujsb .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gyanjrujsb .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#gyanjrujsb .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#gyanjrujsb .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#gyanjrujsb .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#gyanjrujsb .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#gyanjrujsb .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#gyanjrujsb .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#gyanjrujsb .gt_from_md > :first-child {
  margin-top: 0;
}

#gyanjrujsb .gt_from_md > :last-child {
  margin-bottom: 0;
}

#gyanjrujsb .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#gyanjrujsb .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#gyanjrujsb .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#gyanjrujsb .gt_row_group_first td {
  border-top-width: 2px;
}

#gyanjrujsb .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gyanjrujsb .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#gyanjrujsb .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#gyanjrujsb .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gyanjrujsb .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gyanjrujsb .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#gyanjrujsb .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#gyanjrujsb .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gyanjrujsb .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gyanjrujsb .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gyanjrujsb .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gyanjrujsb .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gyanjrujsb .gt_left {
  text-align: left;
}

#gyanjrujsb .gt_center {
  text-align: center;
}

#gyanjrujsb .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#gyanjrujsb .gt_font_normal {
  font-weight: normal;
}

#gyanjrujsb .gt_font_bold {
  font-weight: bold;
}

#gyanjrujsb .gt_font_italic {
  font-style: italic;
}

#gyanjrujsb .gt_super {
  font-size: 65%;
}

#gyanjrujsb .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#gyanjrujsb .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#gyanjrujsb .gt_indent_1 {
  text-indent: 5px;
}

#gyanjrujsb .gt_indent_2 {
  text-indent: 10px;
}

#gyanjrujsb .gt_indent_3 {
  text-indent: 15px;
}

#gyanjrujsb .gt_indent_4 {
  text-indent: 20px;
}

#gyanjrujsb .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col">group</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWFE</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">POLS</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWM</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_center">1989</td>
<td class="gt_row gt_right">5.055</td>
<td class="gt_row gt_right">5.055</td>
<td class="gt_row gt_right">5.055</td></tr>
    <tr><td class="gt_row gt_center">1998</td>
<td class="gt_row gt_right">2.983</td>
<td class="gt_row gt_right">2.983</td>
<td class="gt_row gt_right">2.983</td></tr>
  </tbody>
  
  
</table>
</div>
<p></p><figcaption class="figure-caption">Figure 13: Summary of Estimates - Multiple Treatment Periods and Constant Different Treatment Effects (Never Treated as Only Control)</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1">df_est4b_nev_ <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb44-2">  <span class="fu" style="color: #4758AB;">crossing</span>(<span class="at" style="color: #657422;">year =</span> treatment_years4b_nev,<span class="at" style="color: #657422;">group =</span> treatment_groups4b) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb44-3">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(group))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb44-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(year))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb44-5">  <span class="fu" style="color: #4758AB;">filter</span>(year<span class="sc" style="color: #5E5E5E;">&gt;=</span>group) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb44-6">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">factor</span>(group)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb44-7">  <span class="fu" style="color: #4758AB;">left_join</span>(</span>
<span id="cb44-8">    df_est4b,<span class="st" style="color: #20794D;">"group"</span></span>
<span id="cb44-9">  ) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb44-10">  <span class="fu" style="color: #4758AB;">bind_rows</span>(est_cs4b)</span>
<span id="cb44-11"></span>
<span id="cb44-12"><span class="fu" style="color: #4758AB;">plot_data</span>(df4b) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb44-13">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">data =</span> df_est4b_nev_, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> year, <span class="at" style="color: #657422;">y =</span> estimate, <span class="at" style="color: #657422;">colour =</span> <span class="fu" style="color: #4758AB;">factor</span>(group),<span class="at" style="color: #657422;">lty=</span><span class="fu" style="color: #4758AB;">factor</span>(method)), <span class="at" style="color: #657422;">lwd=</span><span class="dv" style="color: #AD0000;">2</span>)  <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb44-14">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position=</span><span class="st" style="color: #20794D;">"bottom"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot-case4b-nev" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/twfe-twm-and-did_files/figure-html/fig-plot-case4b-nev-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 14: Treatment Effect Estimates - Multiple Treatment Periods and Constant Different Treatment Effects (Never Treated as Only Control)</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="case-5-multiple-treatment-periods-and-constant-dynamic-treatment-effects" class="level1">
<h1>Case 5: Multiple Treatment Periods and Constant Dynamic Treatment Effects</h1>
<p>In this case we need to first limit our sample to years &lt; the maximum treatment time.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1">params5<span class="ot" style="color: #003B4F;">=</span>  <span class="fu" style="color: #4758AB;">list</span>(</span>
<span id="cb45-2">  <span class="at" style="color: #657422;">mu =</span> <span class="fu" style="color: #4758AB;">list</span>(<span class="st" style="color: #20794D;">"1989"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">0</span>,</span>
<span id="cb45-3">            <span class="st" style="color: #20794D;">"1998"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">0</span>,</span>
<span id="cb45-4">            <span class="st" style="color: #20794D;">"2007"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb45-5">  <span class="at" style="color: #657422;">mu_t =</span> <span class="fu" style="color: #4758AB;">list</span>(<span class="st" style="color: #20794D;">"1989"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="fl" style="color: #AD0000;">0.3</span>,</span>
<span id="cb45-6">              <span class="st" style="color: #20794D;">"1998"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="fl" style="color: #AD0000;">0.3</span>,</span>
<span id="cb45-7">              <span class="st" style="color: #20794D;">"2007"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="fl" style="color: #AD0000;">0.3</span>),</span>
<span id="cb45-8">  <span class="at" style="color: #657422;">tx =</span> <span class="fu" style="color: #4758AB;">list</span>(<span class="st" style="color: #20794D;">"1989"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">17</span>,</span>
<span id="cb45-9">            <span class="st" style="color: #20794D;">"1998"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">18</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">35</span>,</span>
<span id="cb45-10">            <span class="st" style="color: #20794D;">"2007"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">36</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">50</span>),</span>
<span id="cb45-11">  <span class="at" style="color: #657422;">bin =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">5</span>,<span class="dv" style="color: #AD0000;">5</span>))</span>
<span id="cb45-12"></span>
<span id="cb45-13"></span>
<span id="cb45-14"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">123</span>)</span>
<span id="cb45-15">df5 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">make_data</span>(params5,<span class="at" style="color: #657422;">N=</span><span class="dv" style="color: #AD0000;">200</span>) </span>
<span id="cb45-16"></span>
<span id="cb45-17">data5 <span class="ot" style="color: #003B4F;">&lt;-</span> df5<span class="sc" style="color: #5E5E5E;">$</span>df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb45-18">  <span class="fu" style="color: #4758AB;">select</span>(dep_var,<span class="at" style="color: #657422;">treatment_time =</span> group, state,unit, year, treat) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb45-19">  <span class="fu" style="color: #4758AB;">mutate_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(treatment_time, year), factor) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb45-20">  <span class="co" style="color: #5E5E5E;"># Impose sample restriction</span></span>
<span id="cb45-21">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">max_treatment_time=</span> <span class="fu" style="color: #4758AB;">max</span>(<span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(treatment_time)),<span class="at" style="color: #657422;">na.rm=</span><span class="cn" style="color: #8f5902;">TRUE</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb45-22">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(year))<span class="sc" style="color: #5E5E5E;">&lt;</span>max_treatment_time)</span>
<span id="cb45-23"></span>
<span id="cb45-24"><span class="fu" style="color: #4758AB;">plot_data</span>(df5) </span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/twfe-twm-and-did_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1">treatment_years5 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb46-2">  data5 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb46-3">  <span class="fu" style="color: #4758AB;">count</span>(treat, year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb46-4">  <span class="fu" style="color: #4758AB;">filter</span>(treat<span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">1</span> ) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb46-5">  <span class="fu" style="color: #4758AB;">pull</span>(year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb46-6">  <span class="fu" style="color: #4758AB;">as.vector</span>()</span>
<span id="cb46-7"></span>
<span id="cb46-8">treatment_groups5_ <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb46-9">  <span class="fu" style="color: #4758AB;">unique</span>(data5[data5<span class="sc" style="color: #5E5E5E;">$</span>treatment_time <span class="sc" style="color: #5E5E5E;">!=</span> <span class="dv" style="color: #AD0000;">0</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> <span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(data5<span class="sc" style="color: #5E5E5E;">$</span>treatment_time),]<span class="sc" style="color: #5E5E5E;">$</span>treatment_time) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb46-10">  <span class="fu" style="color: #4758AB;">paste</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb46-11">  <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(.))</span>
<span id="cb46-12">  </span>
<span id="cb46-13"><span class="co" style="color: #5E5E5E;"># Remove the last year since we have no control group for it. </span></span>
<span id="cb46-14"></span>
<span id="cb46-15">treatment_groups5 <span class="ot" style="color: #003B4F;">&lt;-</span> treatment_groups5_[treatment_groups5_<span class="sc" style="color: #5E5E5E;">&lt;</span><span class="fu" style="color: #4758AB;">max</span>(<span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(data5<span class="sc" style="color: #5E5E5E;">$</span>year)),<span class="at" style="color: #657422;">na.rm =</span> <span class="cn" style="color: #8f5902;">TRUE</span>)]</span>
<span id="cb46-16">  </span>
<span id="cb46-17">treatment_years5 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb46-18">  data5 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb46-19">  <span class="fu" style="color: #4758AB;">count</span>(treat, year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb46-20">  <span class="fu" style="color: #4758AB;">filter</span>(treat<span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">1</span> ) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb46-21">  <span class="fu" style="color: #4758AB;">pull</span>(year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb46-22">  <span class="fu" style="color: #4758AB;">as.vector</span>()</span>
<span id="cb46-23"></span>
<span id="cb46-24">treatment_interactions5 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb46-25">  <span class="fu" style="color: #4758AB;">crossing</span>(treatment_groups5,treatment_years5) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb46-26">    <span class="fu" style="color: #4758AB;">filter</span>(treatment_years5<span class="sc" style="color: #5E5E5E;">&gt;=</span> treatment_groups5) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb46-27">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">interaction =</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"d{treatment_groups5} : f{treatment_years5}"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb46-28">    <span class="fu" style="color: #4758AB;">pull</span>(interaction) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb46-29">    <span class="fu" style="color: #4758AB;">as.vector</span>()</span>
<span id="cb46-30"></span>
<span id="cb46-31">df5_ <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb46-32">  data5 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb46-33">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">treatment_time =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(<span class="fu" style="color: #4758AB;">is.na</span>(treatment_time),<span class="dv" style="color: #AD0000;">0</span>,<span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(treatment_time)))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb46-34">  <span class="fu" style="color: #4758AB;">select</span>(<span class="at" style="color: #657422;">y =</span> dep_var,<span class="at" style="color: #657422;">w =</span> treat, <span class="at" style="color: #657422;">id =</span> unit,year, treatment_time) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb46-35">  fastDummies<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">dummy_cols</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"year"</span>,<span class="st" style="color: #20794D;">"treatment_time"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb46-36">  <span class="fu" style="color: #4758AB;">select_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(y,w,id,year,treatment_time,<span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"year_{treatment_years5}"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.vector</span>(),</span>
<span id="cb46-37">                 <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"treatment_time_{treatment_groups5}"</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb46-38">  <span class="fu" style="color: #4758AB;">rename_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"year_"</span>)),<span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"year_"</span>,<span class="st" style="color: #20794D;">"f"</span>,.)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb46-39">  <span class="fu" style="color: #4758AB;">rename_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"treatment_time_"</span>)),<span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"treatment_time_"</span>,<span class="st" style="color: #20794D;">"d"</span>,.))</span></code></pre></div>
</details>
</div>
<section id="estimate-models-6" class="level2">
<h2 class="anchored" data-anchor-id="estimate-models-6">Estimate Models</h2>
<p>We next estimate the models</p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>Command</th>
<th>Design Variables</th>
<th>Fixed or Random Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Two-Way Fixed Effects</td>
<td><code>feols()</code></td>
<td><code>d* : f*</code> + <code>f*</code></td>
<td>Unit Fixed Effect</td>
</tr>
<tr class="even">
<td>Pooled OLS</td>
<td><code>lm()</code></td>
<td><code>d* : f*</code> + <code>f*</code> + <code>d*</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Two-Way Mundlak</td>
<td><code>lmer()</code></td>
<td><code>d* : f*</code> + <code>f*</code> + <code>d*</code></td>
<td>Unit Random Effect</td>
</tr>
</tbody>
</table>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1">fmla_twfe5 <span class="ot" style="color: #003B4F;">&lt;-</span>   fmla <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"y ~ {paste0(treatment_interactions5, collapse = ' + ')} + {paste0('f',treatment_years5,collapse=' + ')} | id"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.formula</span>()</span>
<span id="cb47-2">fit_twfe5 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">feols</span>(fmla_twfe5, <span class="at" style="color: #657422;">data =</span> df5_)</span>
<span id="cb47-3"></span>
<span id="cb47-4">fmla_lm5 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"y ~ {paste0(treatment_interactions5, collapse = ' + ')} + {paste0('f',treatment_years5,collapse=' + ')} + {paste0('d',treatment_groups5,collapse=' + ')}"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.formula</span>()</span>
<span id="cb47-5">fit_lm5 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">lm</span>(fmla_lm5, <span class="at" style="color: #657422;">data =</span> df5_) </span>
<span id="cb47-6"></span>
<span id="cb47-7">fmla_twm5 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"y ~ {paste0(treatment_interactions5, collapse = ' + ')} + {paste0('f',treatment_years5,collapse=' + ')} + {paste0('d',treatment_groups5,collapse=' + ')} + (1|id)"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.formula</span>()</span>
<span id="cb47-8">fit_twm5 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">lmer</span>( fmla_twm5 , <span class="at" style="color: #657422;">data =</span> df5_) </span>
<span id="cb47-9"></span>
<span id="cb47-10"><span class="fu" style="color: #4758AB;">tibble</span>(<span class="at" style="color: #657422;">method =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"TWFE"</span>,<span class="st" style="color: #20794D;">"POLS"</span>,<span class="st" style="color: #20794D;">"TWM"</span>),</span>
<span id="cb47-11">         <span class="at" style="color: #657422;">formula =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"feols({Reduce(paste,deparse(fmla_twfe5))}, data = df_)"</span>),</span>
<span id="cb47-12">                     <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lm({Reduce(paste,deparse(fmla_lm5))}, data = df_)"</span>),</span>
<span id="cb47-13">                     <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lmer({Reduce(paste,deparse(fmla_twm5))}, data = df_)"</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb47-14">  <span class="fu" style="color: #4758AB;">gt</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb47-15">  <span class="fu" style="color: #4758AB;">cols_label</span>(<span class="st" style="color: #20794D;">"method"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="st" style="color: #20794D;">"Estimator"</span>,</span>
<span id="cb47-16">             <span class="st" style="color: #20794D;">"formula"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="st" style="color: #20794D;">"Regression Call"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">

<div id="hfmsprrfil" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#hfmsprrfil .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hfmsprrfil .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hfmsprrfil .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hfmsprrfil .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hfmsprrfil .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hfmsprrfil .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hfmsprrfil .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hfmsprrfil .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hfmsprrfil .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hfmsprrfil .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hfmsprrfil .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hfmsprrfil .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#hfmsprrfil .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hfmsprrfil .gt_from_md > :first-child {
  margin-top: 0;
}

#hfmsprrfil .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hfmsprrfil .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hfmsprrfil .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hfmsprrfil .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hfmsprrfil .gt_row_group_first td {
  border-top-width: 2px;
}

#hfmsprrfil .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hfmsprrfil .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hfmsprrfil .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hfmsprrfil .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hfmsprrfil .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hfmsprrfil .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hfmsprrfil .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#hfmsprrfil .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hfmsprrfil .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hfmsprrfil .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hfmsprrfil .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hfmsprrfil .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hfmsprrfil .gt_left {
  text-align: left;
}

#hfmsprrfil .gt_center {
  text-align: center;
}

#hfmsprrfil .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hfmsprrfil .gt_font_normal {
  font-weight: normal;
}

#hfmsprrfil .gt_font_bold {
  font-weight: bold;
}

#hfmsprrfil .gt_font_italic {
  font-style: italic;
}

#hfmsprrfil .gt_super {
  font-size: 65%;
}

#hfmsprrfil .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#hfmsprrfil .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hfmsprrfil .gt_indent_1 {
  text-indent: 5px;
}

#hfmsprrfil .gt_indent_2 {
  text-indent: 10px;
}

#hfmsprrfil .gt_indent_3 {
  text-indent: 15px;
}

#hfmsprrfil .gt_indent_4 {
  text-indent: 20px;
}

#hfmsprrfil .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Estimator</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Regression Call</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">TWFE</td>
<td class="gt_row gt_left">feols(y ~ d1989:f1989 + d1989:f1990 + d1989:f1991 + d1989:f1992 + d1989:f1993 +      d1989:f1994 + d1989:f1995 + d1989:f1996 + d1989:f1997 + d1989:f1998 +      d1989:f1999 + d1989:f2000 + d1989:f2001 + d1989:f2002 + d1989:f2003 +      d1989:f2004 + d1989:f2005 + d1989:f2006 + d1998:f1998 + d1998:f1999 +      d1998:f2000 + d1998:f2001 + d1998:f2002 + d1998:f2003 + d1998:f2004 +      d1998:f2005 + d1998:f2006 + f1989 + f1990 + f1991 + f1992 +      f1993 + f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 +      f2001 + f2002 + f2003 + f2004 + f2005 + f2006 | id, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">POLS</td>
<td class="gt_row gt_left">lm(y ~ d1989:f1989 + d1989:f1990 + d1989:f1991 + d1989:f1992 + d1989:f1993 +      d1989:f1994 + d1989:f1995 + d1989:f1996 + d1989:f1997 + d1989:f1998 +      d1989:f1999 + d1989:f2000 + d1989:f2001 + d1989:f2002 + d1989:f2003 +      d1989:f2004 + d1989:f2005 + d1989:f2006 + d1998:f1998 + d1998:f1999 +      d1998:f2000 + d1998:f2001 + d1998:f2002 + d1998:f2003 + d1998:f2004 +      d1998:f2005 + d1998:f2006 + f1989 + f1990 + f1991 + f1992 +      f1993 + f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 +      f2001 + f2002 + f2003 + f2004 + f2005 + f2006 + d1989 + d1998, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">TWM</td>
<td class="gt_row gt_left">lmer(y ~ d1989:f1989 + d1989:f1990 + d1989:f1991 + d1989:f1992 + d1989:f1993 +      d1989:f1994 + d1989:f1995 + d1989:f1996 + d1989:f1997 + d1989:f1998 +      d1989:f1999 + d1989:f2000 + d1989:f2001 + d1989:f2002 + d1989:f2003 +      d1989:f2004 + d1989:f2005 + d1989:f2006 + d1998:f1998 + d1998:f1999 +      d1998:f2000 + d1998:f2001 + d1998:f2002 + d1998:f2003 + d1998:f2004 +      d1998:f2005 + d1998:f2006 + f1989 + f1990 + f1991 + f1992 +      f1993 + f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 +      f2001 + f2002 + f2003 + f2004 + f2005 + f2006 + d1989 + d1998 +      (1 | id), data = df_)</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><span class="co" style="color: #5E5E5E;"># CS</span></span>
<span id="cb48-2">data5_cs <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb48-3">  data5 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb48-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(year)),</span>
<span id="cb48-5">         <span class="at" style="color: #657422;">treatment_time =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(treatment_time)))  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb48-6">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">treatment_time =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(<span class="fu" style="color: #4758AB;">is.na</span>(treatment_time),<span class="dv" style="color: #AD0000;">0</span>,treatment_time))</span>
<span id="cb48-7"></span>
<span id="cb48-8"></span>
<span id="cb48-9">fit_cs5 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">att_gt</span>(<span class="at" style="color: #657422;">yname =</span> <span class="st" style="color: #20794D;">"dep_var"</span>,</span>
<span id="cb48-10">                  <span class="at" style="color: #657422;">tname =</span> <span class="st" style="color: #20794D;">"year"</span>,</span>
<span id="cb48-11">                  <span class="at" style="color: #657422;">idname =</span> <span class="st" style="color: #20794D;">"unit"</span>,</span>
<span id="cb48-12">                  <span class="at" style="color: #657422;">gname =</span> <span class="st" style="color: #20794D;">"treatment_time"</span>,</span>
<span id="cb48-13">                  <span class="at" style="color: #657422;">control_group =</span> <span class="st" style="color: #20794D;">"notyettreated"</span>,</span>
<span id="cb48-14">                  <span class="at" style="color: #657422;">data =</span> data5_cs</span>
<span id="cb48-15">)</span>
<span id="cb48-16"></span>
<span id="cb48-17">est_cs5 <span class="ot" style="color: #003B4F;">&lt;-</span>  <span class="fu" style="color: #4758AB;">tibble</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">paste0</span>(fit_cs5<span class="sc" style="color: #5E5E5E;">$</span>group), <span class="at" style="color: #657422;">year =</span> fit_cs5<span class="sc" style="color: #5E5E5E;">$</span>t, <span class="at" style="color: #657422;">estimate =</span> fit_cs5<span class="sc" style="color: #5E5E5E;">$</span>att) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb48-18">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"CS"</span>)  </span></code></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1">est_twfe5 <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb49-2">  fit_twfe5 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">tidy</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-3">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"TWFE"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">call =</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"feols({Reduce(paste,deparse(fmla_twfe5))}, data = df5_)"</span>))</span>
<span id="cb49-5"></span>
<span id="cb49-6">est_lm5 <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb49-7">  fit_lm5 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">tidy</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-8">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">call =</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lm({Reduce(paste,deparse(fmla_lm5))}, data = df5_)"</span>))  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-9">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"POLS"</span>)</span>
<span id="cb49-10"></span>
<span id="cb49-11">est_twm5 <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb49-12">  fit_twm5  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">summary</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-13">  <span class="fu" style="color: #4758AB;">coef</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-14">  <span class="fu" style="color: #4758AB;">data.frame</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-15">  <span class="fu" style="color: #4758AB;">rownames_to_column</span>(<span class="at" style="color: #657422;">var =</span> <span class="st" style="color: #20794D;">"term"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-16">  janitor<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">clean_names</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-17">  <span class="fu" style="color: #4758AB;">as_tibble</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-18">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"TWM"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-19">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">call =</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lmer({Reduce(paste,deparse(fmla_twm5))}, data = df5_)"</span>))</span>
<span id="cb49-20"></span>
<span id="cb49-21">est5 <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb49-22">  est_twfe5 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-23">  <span class="fu" style="color: #4758AB;">bind_rows</span>(est_lm5) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-24">  <span class="fu" style="color: #4758AB;">bind_rows</span>(est_twm5) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-25">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="fu" style="color: #4758AB;">grepl</span>(<span class="st" style="color: #20794D;">"^f|^d"</span>,term)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-26">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="fu" style="color: #4758AB;">grepl</span>(<span class="st" style="color: #20794D;">":"</span>,term)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span>   </span>
<span id="cb49-27">  <span class="co" style="color: #5E5E5E;">#data.frame() %&gt;% select(term,estimate) %&gt;% </span></span>
<span id="cb49-28">  <span class="fu" style="color: #4758AB;">separate</span>(term,<span class="at" style="color: #657422;">into=</span><span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"one"</span>,<span class="st" style="color: #20794D;">"two"</span>), <span class="at" style="color: #657422;">sep =</span> <span class="st" style="color: #20794D;">":"</span>)  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-29">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">case_when</span>(<span class="fu" style="color: #4758AB;">grepl</span>(<span class="st" style="color: #20794D;">"^d"</span>,one) <span class="sc" style="color: #5E5E5E;">~</span> one, </span>
<span id="cb49-30">                           <span class="cn" style="color: #8f5902;">TRUE</span> <span class="sc" style="color: #5E5E5E;">~</span> two)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-31">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">case_when</span>(<span class="fu" style="color: #4758AB;">grepl</span>(<span class="st" style="color: #20794D;">"^f"</span>,one) <span class="sc" style="color: #5E5E5E;">~</span> one, </span>
<span id="cb49-32">                           <span class="cn" style="color: #8f5902;">TRUE</span> <span class="sc" style="color: #5E5E5E;">~</span> two))     <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-33">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"d"</span>,<span class="st" style="color: #20794D;">""</span>,group)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-34">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(group)))  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-35">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"f"</span>,<span class="st" style="color: #20794D;">""</span>,year)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span>     </span>
<span id="cb49-36">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(year))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-37">  <span class="fu" style="color: #4758AB;">select</span>(<span class="sc" style="color: #5E5E5E;">-</span>one,<span class="sc" style="color: #5E5E5E;">-</span>two) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-38">  <span class="fu" style="color: #4758AB;">bind_rows</span>(est_cs5 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(group))))</span>
<span id="cb49-39"></span>
<span id="cb49-40">df_est5 <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb49-41">  <span class="fu" style="color: #4758AB;">crossing</span>(<span class="at" style="color: #657422;">group=</span> treatment_groups5, <span class="at" style="color: #657422;">year =</span> treatment_years5) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-42">  <span class="fu" style="color: #4758AB;">as_tibble</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb49-43">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(year))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-44">  <span class="fu" style="color: #4758AB;">left_join</span>(est5, <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"group"</span>,<span class="st" style="color: #20794D;">"year"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-45">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(year))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-46">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(estimate))</span>
<span id="cb49-47"></span>
<span id="cb49-48">df_est5 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-49">  <span class="fu" style="color: #4758AB;">select</span>(group, year,estimate,method) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-50">  <span class="fu" style="color: #4758AB;">spread</span>(method,estimate) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-51">  <span class="fu" style="color: #4758AB;">select</span>(group, year,TWFE,POLS,TWM,CS) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-52">  <span class="fu" style="color: #4758AB;">na.omit</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-53">  <span class="fu" style="color: #4758AB;">gt</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb49-54">  <span class="fu" style="color: #4758AB;">fmt_number</span>(<span class="at" style="color: #657422;">columns=</span><span class="fu" style="color: #4758AB;">c</span>(TWFE,POLS,TWM,CS),<span class="at" style="color: #657422;">decimals=</span><span class="dv" style="color: #AD0000;">3</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">

<div id="askyxszgtx" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#askyxszgtx .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#askyxszgtx .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#askyxszgtx .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#askyxszgtx .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#askyxszgtx .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#askyxszgtx .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#askyxszgtx .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#askyxszgtx .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#askyxszgtx .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#askyxszgtx .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#askyxszgtx .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#askyxszgtx .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#askyxszgtx .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#askyxszgtx .gt_from_md > :first-child {
  margin-top: 0;
}

#askyxszgtx .gt_from_md > :last-child {
  margin-bottom: 0;
}

#askyxszgtx .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#askyxszgtx .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#askyxszgtx .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#askyxszgtx .gt_row_group_first td {
  border-top-width: 2px;
}

#askyxszgtx .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#askyxszgtx .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#askyxszgtx .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#askyxszgtx .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#askyxszgtx .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#askyxszgtx .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#askyxszgtx .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#askyxszgtx .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#askyxszgtx .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#askyxszgtx .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#askyxszgtx .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#askyxszgtx .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#askyxszgtx .gt_left {
  text-align: left;
}

#askyxszgtx .gt_center {
  text-align: center;
}

#askyxszgtx .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#askyxszgtx .gt_font_normal {
  font-weight: normal;
}

#askyxszgtx .gt_font_bold {
  font-weight: bold;
}

#askyxszgtx .gt_font_italic {
  font-style: italic;
}

#askyxszgtx .gt_super {
  font-size: 65%;
}

#askyxszgtx .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#askyxszgtx .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#askyxszgtx .gt_indent_1 {
  text-indent: 5px;
}

#askyxszgtx .gt_indent_2 {
  text-indent: 10px;
}

#askyxszgtx .gt_indent_3 {
  text-indent: 15px;
}

#askyxszgtx .gt_indent_4 {
  text-indent: 20px;
}

#askyxszgtx .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">group</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">year</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWFE</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">POLS</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWM</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">CS</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">0.205</td>
<td class="gt_row gt_right">0.205</td>
<td class="gt_row gt_right">0.205</td>
<td class="gt_row gt_right">0.120</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1990</td>
<td class="gt_row gt_right">0.504</td>
<td class="gt_row gt_right">0.504</td>
<td class="gt_row gt_right">0.504</td>
<td class="gt_row gt_right">0.419</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1991</td>
<td class="gt_row gt_right">0.792</td>
<td class="gt_row gt_right">0.792</td>
<td class="gt_row gt_right">0.792</td>
<td class="gt_row gt_right">0.706</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1992</td>
<td class="gt_row gt_right">1.053</td>
<td class="gt_row gt_right">1.053</td>
<td class="gt_row gt_right">1.053</td>
<td class="gt_row gt_right">0.968</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1993</td>
<td class="gt_row gt_right">1.359</td>
<td class="gt_row gt_right">1.359</td>
<td class="gt_row gt_right">1.359</td>
<td class="gt_row gt_right">1.274</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1994</td>
<td class="gt_row gt_right">1.740</td>
<td class="gt_row gt_right">1.740</td>
<td class="gt_row gt_right">1.740</td>
<td class="gt_row gt_right">1.655</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1995</td>
<td class="gt_row gt_right">2.056</td>
<td class="gt_row gt_right">2.056</td>
<td class="gt_row gt_right">2.056</td>
<td class="gt_row gt_right">1.971</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1996</td>
<td class="gt_row gt_right">2.167</td>
<td class="gt_row gt_right">2.167</td>
<td class="gt_row gt_right">2.167</td>
<td class="gt_row gt_right">2.082</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1997</td>
<td class="gt_row gt_right">2.500</td>
<td class="gt_row gt_right">2.500</td>
<td class="gt_row gt_right">2.500</td>
<td class="gt_row gt_right">2.415</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2.628</td>
<td class="gt_row gt_right">2.628</td>
<td class="gt_row gt_right">2.628</td>
<td class="gt_row gt_right">2.609</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1999</td>
<td class="gt_row gt_right">3.005</td>
<td class="gt_row gt_right">3.005</td>
<td class="gt_row gt_right">3.005</td>
<td class="gt_row gt_right">2.986</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">2000</td>
<td class="gt_row gt_right">3.310</td>
<td class="gt_row gt_right">3.310</td>
<td class="gt_row gt_right">3.310</td>
<td class="gt_row gt_right">3.291</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">2001</td>
<td class="gt_row gt_right">3.550</td>
<td class="gt_row gt_right">3.550</td>
<td class="gt_row gt_right">3.550</td>
<td class="gt_row gt_right">3.531</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">2002</td>
<td class="gt_row gt_right">3.890</td>
<td class="gt_row gt_right">3.890</td>
<td class="gt_row gt_right">3.890</td>
<td class="gt_row gt_right">3.870</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">2003</td>
<td class="gt_row gt_right">4.261</td>
<td class="gt_row gt_right">4.261</td>
<td class="gt_row gt_right">4.261</td>
<td class="gt_row gt_right">4.242</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">2004</td>
<td class="gt_row gt_right">4.366</td>
<td class="gt_row gt_right">4.366</td>
<td class="gt_row gt_right">4.366</td>
<td class="gt_row gt_right">4.346</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">2005</td>
<td class="gt_row gt_right">4.743</td>
<td class="gt_row gt_right">4.743</td>
<td class="gt_row gt_right">4.743</td>
<td class="gt_row gt_right">4.724</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">2006</td>
<td class="gt_row gt_right">5.018</td>
<td class="gt_row gt_right">5.018</td>
<td class="gt_row gt_right">5.018</td>
<td class="gt_row gt_right">4.998</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">0.177</td>
<td class="gt_row gt_right">0.177</td>
<td class="gt_row gt_right">0.177</td>
<td class="gt_row gt_right">0.281</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">1999</td>
<td class="gt_row gt_right">0.624</td>
<td class="gt_row gt_right">0.624</td>
<td class="gt_row gt_right">0.624</td>
<td class="gt_row gt_right">0.728</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2000</td>
<td class="gt_row gt_right">0.860</td>
<td class="gt_row gt_right">0.860</td>
<td class="gt_row gt_right">0.860</td>
<td class="gt_row gt_right">0.964</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2001</td>
<td class="gt_row gt_right">1.174</td>
<td class="gt_row gt_right">1.174</td>
<td class="gt_row gt_right">1.174</td>
<td class="gt_row gt_right">1.278</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2002</td>
<td class="gt_row gt_right">1.487</td>
<td class="gt_row gt_right">1.487</td>
<td class="gt_row gt_right">1.487</td>
<td class="gt_row gt_right">1.591</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2003</td>
<td class="gt_row gt_right">1.871</td>
<td class="gt_row gt_right">1.871</td>
<td class="gt_row gt_right">1.871</td>
<td class="gt_row gt_right">1.975</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2004</td>
<td class="gt_row gt_right">2.031</td>
<td class="gt_row gt_right">2.031</td>
<td class="gt_row gt_right">2.031</td>
<td class="gt_row gt_right">2.135</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2005</td>
<td class="gt_row gt_right">2.495</td>
<td class="gt_row gt_right">2.495</td>
<td class="gt_row gt_right">2.495</td>
<td class="gt_row gt_right">2.599</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2006</td>
<td class="gt_row gt_right">2.703</td>
<td class="gt_row gt_right">2.703</td>
<td class="gt_row gt_right">2.703</td>
<td class="gt_row gt_right">2.807</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</section>
<section id="summary-of-estimates-6" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-estimates-6">Summary of Estimates</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><span class="fu" style="color: #4758AB;">plot_data</span>(df5)  <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb50-2">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">data =</span> df_est5, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> year, <span class="at" style="color: #657422;">y =</span> estimate, <span class="at" style="color: #657422;">colour =</span> <span class="fu" style="color: #4758AB;">factor</span>(group),<span class="at" style="color: #657422;">lty=</span><span class="fu" style="color: #4758AB;">factor</span>(method)), <span class="at" style="color: #657422;">lwd=</span><span class="dv" style="color: #AD0000;">2</span>)  <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb50-3">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position=</span><span class="st" style="color: #20794D;">"bottom"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot-case5" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/twfe-twm-and-did_files/figure-html/fig-plot-case5-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 15: Treatment Effect Estimates - Multiple Treatment Periods and Constant Dynamic Treatment Effects</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1">df_est5 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb51-2">  <span class="fu" style="color: #4758AB;">select</span>(group,year, estimate,method) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb51-3">  <span class="fu" style="color: #4758AB;">filter</span>(method <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"TWFE"</span>,<span class="st" style="color: #20794D;">"CS"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb51-4">  <span class="fu" style="color: #4758AB;">spread</span>(method,estimate) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb51-5">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> TWFE, <span class="at" style="color: #657422;">y =</span> CS, <span class="at" style="color: #657422;">group =</span> year, <span class="at" style="color: #657422;">colour =</span> <span class="fu" style="color: #4758AB;">factor</span>(group)))<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb51-6">  <span class="fu" style="color: #4758AB;">geom_point</span>() <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb51-7">  <span class="co" style="color: #5E5E5E;">#facet_wrap(~group) + </span></span>
<span id="cb51-8">  <span class="fu" style="color: #4758AB;">theme_few</span>() <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb51-9">  <span class="fu" style="color: #4758AB;">geom_abline</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">slope=</span><span class="dv" style="color: #AD0000;">1</span>,<span class="at" style="color: #657422;">intercept=</span><span class="dv" style="color: #AD0000;">0</span>),<span class="at" style="color: #657422;">lty=</span><span class="dv" style="color: #AD0000;">3</span>)  <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb51-10">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position =</span> <span class="st" style="color: #20794D;">"bottom"</span>) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb51-11">  ggsci<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">scale_color_aaas</span>(<span class="at" style="color: #657422;">name=</span><span class="st" style="color: #20794D;">"Treatment Cohort"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot-case5-comp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/twfe-twm-and-did_files/figure-html/fig-plot-case5-comp-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 16: Comparison of Treatment Effect Estimates - Multiple Treatment Periods and Constant Dynamic Treatment Effects</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="case-6-multiple-treatment-periods-and-heterogeneous-dynamic-treatment-effects" class="level1">
<h1>Case 6 : Multiple Treatment Periods and Heterogeneous Dynamic Treatment Effects</h1>
<p>In this case we need to first limit our sample to years &lt; the maximum treatment time.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1">params6<span class="ot" style="color: #003B4F;">=</span>  <span class="fu" style="color: #4758AB;">list</span>(</span>
<span id="cb52-2">  <span class="at" style="color: #657422;">mu =</span> <span class="fu" style="color: #4758AB;">list</span>(<span class="st" style="color: #20794D;">"1989"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">0</span>,</span>
<span id="cb52-3">            <span class="st" style="color: #20794D;">"1998"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">0</span>,</span>
<span id="cb52-4">            <span class="st" style="color: #20794D;">"2007"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">0</span>),</span>
<span id="cb52-5">  <span class="at" style="color: #657422;">mu_t =</span> <span class="fu" style="color: #4758AB;">list</span>(<span class="st" style="color: #20794D;">"1989"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="fl" style="color: #AD0000;">0.5</span>,</span>
<span id="cb52-6">              <span class="st" style="color: #20794D;">"1998"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="fl" style="color: #AD0000;">0.3</span>,</span>
<span id="cb52-7">              <span class="st" style="color: #20794D;">"2007"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="fl" style="color: #AD0000;">0.1</span>),</span>
<span id="cb52-8">  <span class="at" style="color: #657422;">tx =</span> <span class="fu" style="color: #4758AB;">list</span>(<span class="st" style="color: #20794D;">"1989"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">17</span>,</span>
<span id="cb52-9">            <span class="st" style="color: #20794D;">"1998"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">18</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">35</span>,</span>
<span id="cb52-10">            <span class="st" style="color: #20794D;">"2007"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">36</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">50</span>),</span>
<span id="cb52-11">  <span class="at" style="color: #657422;">bin =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">5</span>,<span class="dv" style="color: #AD0000;">5</span>))</span>
<span id="cb52-12"></span>
<span id="cb52-13"></span>
<span id="cb52-14"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">123</span>)</span>
<span id="cb52-15">df6 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">make_data</span>(params6,<span class="at" style="color: #657422;">N=</span><span class="dv" style="color: #AD0000;">200</span>) </span>
<span id="cb52-16"></span>
<span id="cb52-17">data6 <span class="ot" style="color: #003B4F;">&lt;-</span> df6<span class="sc" style="color: #5E5E5E;">$</span>df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb52-18">  <span class="fu" style="color: #4758AB;">select</span>(dep_var,<span class="at" style="color: #657422;">treatment_time =</span> group, state,unit, year, treat) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb52-19">  <span class="fu" style="color: #4758AB;">mutate_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(treatment_time, year), factor) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb52-20">  <span class="co" style="color: #5E5E5E;"># Impose sample restriction</span></span>
<span id="cb52-21">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">max_treatment_time=</span> <span class="fu" style="color: #4758AB;">max</span>(<span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(treatment_time)),<span class="at" style="color: #657422;">na.rm=</span><span class="cn" style="color: #8f5902;">TRUE</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb52-22">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(year))<span class="sc" style="color: #5E5E5E;">&lt;</span>max_treatment_time)</span>
<span id="cb52-23"></span>
<span id="cb52-24"><span class="fu" style="color: #4758AB;">plot_data</span>(df6) </span></code></pre></div>
</details>
<div class="cell-output-display">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/twfe-twm-and-did_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1">treatment_years6 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb53-2">  data6 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb53-3">  <span class="fu" style="color: #4758AB;">count</span>(treat, year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb53-4">  <span class="fu" style="color: #4758AB;">filter</span>(treat<span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">1</span> ) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb53-5">  <span class="fu" style="color: #4758AB;">pull</span>(year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb53-6">  <span class="fu" style="color: #4758AB;">as.vector</span>()</span>
<span id="cb53-7"></span>
<span id="cb53-8">treatment_groups6_ <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb53-9">  <span class="fu" style="color: #4758AB;">unique</span>(data6[data6<span class="sc" style="color: #5E5E5E;">$</span>treatment_time <span class="sc" style="color: #5E5E5E;">!=</span> <span class="dv" style="color: #AD0000;">0</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> <span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(data6<span class="sc" style="color: #5E5E5E;">$</span>treatment_time),]<span class="sc" style="color: #5E5E5E;">$</span>treatment_time) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb53-10">  <span class="fu" style="color: #4758AB;">paste</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb53-11">  <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(.))</span>
<span id="cb53-12">  </span>
<span id="cb53-13"><span class="co" style="color: #5E5E5E;"># Remove the last year since we have no control group for it. </span></span>
<span id="cb53-14"></span>
<span id="cb53-15">treatment_groups6 <span class="ot" style="color: #003B4F;">&lt;-</span> treatment_groups6_[treatment_groups6_<span class="sc" style="color: #5E5E5E;">&lt;</span><span class="fu" style="color: #4758AB;">max</span>(<span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(data6<span class="sc" style="color: #5E5E5E;">$</span>year)),<span class="at" style="color: #657422;">na.rm =</span> <span class="cn" style="color: #8f5902;">TRUE</span>)]</span>
<span id="cb53-16">  </span>
<span id="cb53-17">treatment_years6 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb53-18">  data6 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb53-19">  <span class="fu" style="color: #4758AB;">count</span>(treat, year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb53-20">  <span class="fu" style="color: #4758AB;">filter</span>(treat<span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">1</span> ) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb53-21">  <span class="fu" style="color: #4758AB;">pull</span>(year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb53-22">  <span class="fu" style="color: #4758AB;">as.vector</span>()</span>
<span id="cb53-23"></span>
<span id="cb53-24">treatment_interactions6 <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb53-25">  <span class="fu" style="color: #4758AB;">crossing</span>(treatment_groups6,treatment_years6) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb53-26">    <span class="fu" style="color: #4758AB;">filter</span>(treatment_years6<span class="sc" style="color: #5E5E5E;">&gt;=</span> treatment_groups6) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb53-27">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">interaction =</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"d{treatment_groups6} : f{treatment_years6}"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb53-28">    <span class="fu" style="color: #4758AB;">pull</span>(interaction) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb53-29">    <span class="fu" style="color: #4758AB;">as.vector</span>()</span>
<span id="cb53-30"></span>
<span id="cb53-31">df6_ <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb53-32">  data6 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb53-33">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">treatment_time =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(<span class="fu" style="color: #4758AB;">is.na</span>(treatment_time),<span class="dv" style="color: #AD0000;">0</span>,<span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(treatment_time)))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb53-34">  <span class="fu" style="color: #4758AB;">select</span>(<span class="at" style="color: #657422;">y =</span> dep_var,<span class="at" style="color: #657422;">w =</span> treat, <span class="at" style="color: #657422;">id =</span> unit,year, treatment_time) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb53-35">  fastDummies<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">dummy_cols</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"year"</span>,<span class="st" style="color: #20794D;">"treatment_time"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb53-36">  <span class="fu" style="color: #4758AB;">select_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(y,w,id,year,treatment_time,<span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"year_{treatment_years6}"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.vector</span>(),</span>
<span id="cb53-37">                 <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"treatment_time_{treatment_groups6}"</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb53-38">  <span class="fu" style="color: #4758AB;">rename_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"year_"</span>)),<span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"year_"</span>,<span class="st" style="color: #20794D;">"f"</span>,.)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb53-39">  <span class="fu" style="color: #4758AB;">rename_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(<span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"treatment_time_"</span>)),<span class="sc" style="color: #5E5E5E;">~</span><span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"treatment_time_"</span>,<span class="st" style="color: #20794D;">"d"</span>,.))</span></code></pre></div>
</details>
</div>
<section id="estimate-models-7" class="level2">
<h2 class="anchored" data-anchor-id="estimate-models-7">Estimate Models</h2>
<p>We next estimate the models</p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>Command</th>
<th>Design Variables</th>
<th>Fixed or Random Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Two-Way Fixed Effects</td>
<td><code>feols()</code></td>
<td><code>d* : f*</code> + <code>f*</code></td>
<td>Unit Fixed Effect</td>
</tr>
<tr class="even">
<td>Pooled OLS</td>
<td><code>lm()</code></td>
<td><code>d* : f*</code> + <code>f*</code> + <code>d*</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Two-Way Mundlak</td>
<td><code>lmer()</code></td>
<td><code>d* : f*</code> + <code>f*</code> + <code>d*</code></td>
<td>Unit Random Effect</td>
</tr>
</tbody>
</table>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1">fmla_twfe6 <span class="ot" style="color: #003B4F;">&lt;-</span>   fmla <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"y ~ {paste0(treatment_interactions6, collapse = ' + ')} + {paste0('f',treatment_years6,collapse=' + ')} | id"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.formula</span>()</span>
<span id="cb54-2">fit_twfe6 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">feols</span>(fmla_twfe6, <span class="at" style="color: #657422;">data =</span> df6_)</span>
<span id="cb54-3"></span>
<span id="cb54-4">fmla_lm6 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"y ~ {paste0(treatment_interactions6, collapse = ' + ')} + {paste0('f',treatment_years6,collapse=' + ')} + {paste0('d',treatment_groups6,collapse=' + ')}"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.formula</span>()</span>
<span id="cb54-5">fit_lm6 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">lm</span>(fmla_lm6, <span class="at" style="color: #657422;">data =</span> df6_) </span>
<span id="cb54-6"></span>
<span id="cb54-7">fmla_twm6 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"y ~ {paste0(treatment_interactions6, collapse = ' + ')} + {paste0('f',treatment_years6,collapse=' + ')} + {paste0('d',treatment_groups6,collapse=' + ')} + (1|id)"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.formula</span>()</span>
<span id="cb54-8">fit_twm6 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">lmer</span>( fmla_twm6 , <span class="at" style="color: #657422;">data =</span> df6_) </span>
<span id="cb54-9"></span>
<span id="cb54-10"><span class="fu" style="color: #4758AB;">tibble</span>(<span class="at" style="color: #657422;">method =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"TWFE"</span>,<span class="st" style="color: #20794D;">"POLS"</span>,<span class="st" style="color: #20794D;">"TWM"</span>),</span>
<span id="cb54-11">         <span class="at" style="color: #657422;">formula =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"feols({Reduce(paste,deparse(fmla_twfe6))}, data = df_)"</span>),</span>
<span id="cb54-12">                     <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lm({Reduce(paste,deparse(fmla_lm6))}, data = df_)"</span>),</span>
<span id="cb54-13">                     <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lmer({Reduce(paste,deparse(fmla_twm6))}, data = df_)"</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb54-14">  <span class="fu" style="color: #4758AB;">gt</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb54-15">  <span class="fu" style="color: #4758AB;">cols_label</span>(<span class="st" style="color: #20794D;">"method"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="st" style="color: #20794D;">"Estimator"</span>,</span>
<span id="cb54-16">             <span class="st" style="color: #20794D;">"formula"</span> <span class="ot" style="color: #003B4F;">=</span> <span class="st" style="color: #20794D;">"Regression Call"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">

<div id="hfmsprrfil" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#hfmsprrfil .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hfmsprrfil .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hfmsprrfil .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hfmsprrfil .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hfmsprrfil .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hfmsprrfil .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hfmsprrfil .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hfmsprrfil .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hfmsprrfil .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hfmsprrfil .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hfmsprrfil .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hfmsprrfil .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#hfmsprrfil .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hfmsprrfil .gt_from_md > :first-child {
  margin-top: 0;
}

#hfmsprrfil .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hfmsprrfil .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hfmsprrfil .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hfmsprrfil .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hfmsprrfil .gt_row_group_first td {
  border-top-width: 2px;
}

#hfmsprrfil .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hfmsprrfil .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hfmsprrfil .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hfmsprrfil .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hfmsprrfil .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hfmsprrfil .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hfmsprrfil .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#hfmsprrfil .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hfmsprrfil .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hfmsprrfil .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hfmsprrfil .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hfmsprrfil .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hfmsprrfil .gt_left {
  text-align: left;
}

#hfmsprrfil .gt_center {
  text-align: center;
}

#hfmsprrfil .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hfmsprrfil .gt_font_normal {
  font-weight: normal;
}

#hfmsprrfil .gt_font_bold {
  font-weight: bold;
}

#hfmsprrfil .gt_font_italic {
  font-style: italic;
}

#hfmsprrfil .gt_super {
  font-size: 65%;
}

#hfmsprrfil .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#hfmsprrfil .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hfmsprrfil .gt_indent_1 {
  text-indent: 5px;
}

#hfmsprrfil .gt_indent_2 {
  text-indent: 10px;
}

#hfmsprrfil .gt_indent_3 {
  text-indent: 15px;
}

#hfmsprrfil .gt_indent_4 {
  text-indent: 20px;
}

#hfmsprrfil .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Estimator</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Regression Call</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">TWFE</td>
<td class="gt_row gt_left">feols(y ~ d1989:f1989 + d1989:f1990 + d1989:f1991 + d1989:f1992 + d1989:f1993 +      d1989:f1994 + d1989:f1995 + d1989:f1996 + d1989:f1997 + d1989:f1998 +      d1989:f1999 + d1989:f2000 + d1989:f2001 + d1989:f2002 + d1989:f2003 +      d1989:f2004 + d1989:f2005 + d1989:f2006 + d1998:f1998 + d1998:f1999 +      d1998:f2000 + d1998:f2001 + d1998:f2002 + d1998:f2003 + d1998:f2004 +      d1998:f2005 + d1998:f2006 + f1989 + f1990 + f1991 + f1992 +      f1993 + f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 +      f2001 + f2002 + f2003 + f2004 + f2005 + f2006 | id, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">POLS</td>
<td class="gt_row gt_left">lm(y ~ d1989:f1989 + d1989:f1990 + d1989:f1991 + d1989:f1992 + d1989:f1993 +      d1989:f1994 + d1989:f1995 + d1989:f1996 + d1989:f1997 + d1989:f1998 +      d1989:f1999 + d1989:f2000 + d1989:f2001 + d1989:f2002 + d1989:f2003 +      d1989:f2004 + d1989:f2005 + d1989:f2006 + d1998:f1998 + d1998:f1999 +      d1998:f2000 + d1998:f2001 + d1998:f2002 + d1998:f2003 + d1998:f2004 +      d1998:f2005 + d1998:f2006 + f1989 + f1990 + f1991 + f1992 +      f1993 + f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 +      f2001 + f2002 + f2003 + f2004 + f2005 + f2006 + d1989 + d1998, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">TWM</td>
<td class="gt_row gt_left">lmer(y ~ d1989:f1989 + d1989:f1990 + d1989:f1991 + d1989:f1992 + d1989:f1993 +      d1989:f1994 + d1989:f1995 + d1989:f1996 + d1989:f1997 + d1989:f1998 +      d1989:f1999 + d1989:f2000 + d1989:f2001 + d1989:f2002 + d1989:f2003 +      d1989:f2004 + d1989:f2005 + d1989:f2006 + d1998:f1998 + d1998:f1999 +      d1998:f2000 + d1998:f2001 + d1998:f2002 + d1998:f2003 + d1998:f2004 +      d1998:f2005 + d1998:f2006 + f1989 + f1990 + f1991 + f1992 +      f1993 + f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 +      f2001 + f2002 + f2003 + f2004 + f2005 + f2006 + d1989 + d1998 +      (1 | id), data = df_)</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><span class="co" style="color: #5E5E5E;"># CS</span></span>
<span id="cb55-2">data6_cs <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb55-3">  data6 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb55-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(year)),</span>
<span id="cb55-5">         <span class="at" style="color: #657422;">treatment_time =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(treatment_time)))  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb55-6">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">treatment_time =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(<span class="fu" style="color: #4758AB;">is.na</span>(treatment_time),<span class="dv" style="color: #AD0000;">0</span>,treatment_time))</span>
<span id="cb55-7"></span>
<span id="cb55-8"></span>
<span id="cb55-9">fit_cs6 <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">att_gt</span>(<span class="at" style="color: #657422;">yname =</span> <span class="st" style="color: #20794D;">"dep_var"</span>,</span>
<span id="cb55-10">                  <span class="at" style="color: #657422;">tname =</span> <span class="st" style="color: #20794D;">"year"</span>,</span>
<span id="cb55-11">                  <span class="at" style="color: #657422;">idname =</span> <span class="st" style="color: #20794D;">"unit"</span>,</span>
<span id="cb55-12">                  <span class="at" style="color: #657422;">gname =</span> <span class="st" style="color: #20794D;">"treatment_time"</span>,</span>
<span id="cb55-13">                  <span class="at" style="color: #657422;">control_group =</span> <span class="st" style="color: #20794D;">"notyettreated"</span>,</span>
<span id="cb55-14">                  <span class="at" style="color: #657422;">data =</span> data6_cs</span>
<span id="cb55-15">)</span>
<span id="cb55-16"></span>
<span id="cb55-17">est_cs6 <span class="ot" style="color: #003B4F;">&lt;-</span>  <span class="fu" style="color: #4758AB;">tibble</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">paste0</span>(fit_cs6<span class="sc" style="color: #5E5E5E;">$</span>group), <span class="at" style="color: #657422;">year =</span> fit_cs6<span class="sc" style="color: #5E5E5E;">$</span>t, <span class="at" style="color: #657422;">estimate =</span> fit_cs6<span class="sc" style="color: #5E5E5E;">$</span>att) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb55-18">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"CS"</span>)  </span></code></pre></div>
</details>
</div>
</section>
<section id="summary-of-estimates-7" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-estimates-7">Summary of Estimates</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1">est_twfe6 <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb56-2">  fit_twfe6 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">tidy</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-3">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"TWFE"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">call =</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"feols({Reduce(paste,deparse(fmla_twfe6))}, data = df6_)"</span>))</span>
<span id="cb56-5"></span>
<span id="cb56-6">est_lm6 <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb56-7">  fit_lm6 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">tidy</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-8">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">call =</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lm({Reduce(paste,deparse(fmla_lm6))}, data = df6_)"</span>))  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-9">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"POLS"</span>)</span>
<span id="cb56-10"></span>
<span id="cb56-11">est_twm6 <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb56-12">  fit_twm6  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">summary</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-13">  <span class="fu" style="color: #4758AB;">coef</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-14">  <span class="fu" style="color: #4758AB;">data.frame</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-15">  <span class="fu" style="color: #4758AB;">rownames_to_column</span>(<span class="at" style="color: #657422;">var =</span> <span class="st" style="color: #20794D;">"term"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-16">  janitor<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">clean_names</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-17">  <span class="fu" style="color: #4758AB;">as_tibble</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-18">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">method =</span> <span class="st" style="color: #20794D;">"TWM"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-19">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">call =</span> <span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">"lmer({Reduce(paste,deparse(fmla_twm6))}, data = df6_)"</span>))</span>
<span id="cb56-20"></span>
<span id="cb56-21">est6 <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb56-22">  est_twfe6 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-23">  <span class="fu" style="color: #4758AB;">bind_rows</span>(est_lm6) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-24">  <span class="fu" style="color: #4758AB;">bind_rows</span>(est_twm6) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-25">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="fu" style="color: #4758AB;">grepl</span>(<span class="st" style="color: #20794D;">"^f|^d"</span>,term)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-26">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="fu" style="color: #4758AB;">grepl</span>(<span class="st" style="color: #20794D;">":"</span>,term)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span>   </span>
<span id="cb56-27">  <span class="co" style="color: #5E5E5E;">#data.frame() %&gt;% select(term,estimate) %&gt;% </span></span>
<span id="cb56-28">  <span class="fu" style="color: #4758AB;">separate</span>(term,<span class="at" style="color: #657422;">into=</span><span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"one"</span>,<span class="st" style="color: #20794D;">"two"</span>), <span class="at" style="color: #657422;">sep =</span> <span class="st" style="color: #20794D;">":"</span>)  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-29">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">case_when</span>(<span class="fu" style="color: #4758AB;">grepl</span>(<span class="st" style="color: #20794D;">"^d"</span>,one) <span class="sc" style="color: #5E5E5E;">~</span> one, </span>
<span id="cb56-30">                           <span class="cn" style="color: #8f5902;">TRUE</span> <span class="sc" style="color: #5E5E5E;">~</span> two)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-31">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">case_when</span>(<span class="fu" style="color: #4758AB;">grepl</span>(<span class="st" style="color: #20794D;">"^f"</span>,one) <span class="sc" style="color: #5E5E5E;">~</span> one, </span>
<span id="cb56-32">                           <span class="cn" style="color: #8f5902;">TRUE</span> <span class="sc" style="color: #5E5E5E;">~</span> two))     <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-33">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"d"</span>,<span class="st" style="color: #20794D;">""</span>,group)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-34">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(group)))  <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-35">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"f"</span>,<span class="st" style="color: #20794D;">""</span>,year)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span>     </span>
<span id="cb56-36">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(year))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-37">  <span class="fu" style="color: #4758AB;">select</span>(<span class="sc" style="color: #5E5E5E;">-</span>one,<span class="sc" style="color: #5E5E5E;">-</span>two) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-38">  <span class="fu" style="color: #4758AB;">bind_rows</span>(est_cs6 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">group =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(group))))</span>
<span id="cb56-39"></span>
<span id="cb56-40">df_est6 <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb56-41">  <span class="fu" style="color: #4758AB;">crossing</span>(<span class="at" style="color: #657422;">group=</span> treatment_groups6, <span class="at" style="color: #657422;">year =</span> treatment_years6) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-42">  <span class="fu" style="color: #4758AB;">as_tibble</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb56-43">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(year))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-44">  <span class="fu" style="color: #4758AB;">left_join</span>(est6, <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"group"</span>,<span class="st" style="color: #20794D;">"year"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-45">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">year =</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">paste0</span>(year))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-46">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(estimate))</span>
<span id="cb56-47"></span>
<span id="cb56-48">df_est6 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-49">  <span class="fu" style="color: #4758AB;">select</span>(group, year,estimate,method) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-50">  <span class="fu" style="color: #4758AB;">spread</span>(method,estimate) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-51">  <span class="fu" style="color: #4758AB;">select</span>(group, year,TWFE,POLS,TWM,CS) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-52">  <span class="fu" style="color: #4758AB;">na.omit</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-53">  <span class="fu" style="color: #4758AB;">gt</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb56-54">  <span class="fu" style="color: #4758AB;">fmt_number</span>(<span class="at" style="color: #657422;">columns=</span><span class="fu" style="color: #4758AB;">c</span>(TWFE,POLS,TWM,CS),<span class="at" style="color: #657422;">decimals=</span><span class="dv" style="color: #AD0000;">3</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">

<div id="askyxszgtx" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#askyxszgtx .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#askyxszgtx .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#askyxszgtx .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#askyxszgtx .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#askyxszgtx .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#askyxszgtx .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#askyxszgtx .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#askyxszgtx .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#askyxszgtx .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#askyxszgtx .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#askyxszgtx .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#askyxszgtx .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#askyxszgtx .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#askyxszgtx .gt_from_md > :first-child {
  margin-top: 0;
}

#askyxszgtx .gt_from_md > :last-child {
  margin-bottom: 0;
}

#askyxszgtx .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#askyxszgtx .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#askyxszgtx .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#askyxszgtx .gt_row_group_first td {
  border-top-width: 2px;
}

#askyxszgtx .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#askyxszgtx .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#askyxszgtx .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#askyxszgtx .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#askyxszgtx .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#askyxszgtx .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#askyxszgtx .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#askyxszgtx .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#askyxszgtx .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#askyxszgtx .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#askyxszgtx .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#askyxszgtx .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#askyxszgtx .gt_left {
  text-align: left;
}

#askyxszgtx .gt_center {
  text-align: center;
}

#askyxszgtx .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#askyxszgtx .gt_font_normal {
  font-weight: normal;
}

#askyxszgtx .gt_font_bold {
  font-weight: bold;
}

#askyxszgtx .gt_font_italic {
  font-style: italic;
}

#askyxszgtx .gt_super {
  font-size: 65%;
}

#askyxszgtx .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#askyxszgtx .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#askyxszgtx .gt_indent_1 {
  text-indent: 5px;
}

#askyxszgtx .gt_indent_2 {
  text-indent: 10px;
}

#askyxszgtx .gt_indent_3 {
  text-indent: 15px;
}

#askyxszgtx .gt_indent_4 {
  text-indent: 20px;
}

#askyxszgtx .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">group</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">year</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWFE</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">POLS</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWM</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">CS</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">0.405</td>
<td class="gt_row gt_right">0.405</td>
<td class="gt_row gt_right">0.405</td>
<td class="gt_row gt_right">0.320</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1990</td>
<td class="gt_row gt_right">0.904</td>
<td class="gt_row gt_right">0.904</td>
<td class="gt_row gt_right">0.904</td>
<td class="gt_row gt_right">0.819</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1991</td>
<td class="gt_row gt_right">1.392</td>
<td class="gt_row gt_right">1.392</td>
<td class="gt_row gt_right">1.392</td>
<td class="gt_row gt_right">1.306</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1992</td>
<td class="gt_row gt_right">1.853</td>
<td class="gt_row gt_right">1.853</td>
<td class="gt_row gt_right">1.853</td>
<td class="gt_row gt_right">1.768</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1993</td>
<td class="gt_row gt_right">2.359</td>
<td class="gt_row gt_right">2.359</td>
<td class="gt_row gt_right">2.359</td>
<td class="gt_row gt_right">2.274</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1994</td>
<td class="gt_row gt_right">2.940</td>
<td class="gt_row gt_right">2.940</td>
<td class="gt_row gt_right">2.940</td>
<td class="gt_row gt_right">2.855</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1995</td>
<td class="gt_row gt_right">3.456</td>
<td class="gt_row gt_right">3.456</td>
<td class="gt_row gt_right">3.456</td>
<td class="gt_row gt_right">3.371</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1996</td>
<td class="gt_row gt_right">3.767</td>
<td class="gt_row gt_right">3.767</td>
<td class="gt_row gt_right">3.767</td>
<td class="gt_row gt_right">3.682</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1997</td>
<td class="gt_row gt_right">4.300</td>
<td class="gt_row gt_right">4.300</td>
<td class="gt_row gt_right">4.300</td>
<td class="gt_row gt_right">4.215</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">4.628</td>
<td class="gt_row gt_right">4.628</td>
<td class="gt_row gt_right">4.628</td>
<td class="gt_row gt_right">4.609</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1999</td>
<td class="gt_row gt_right">5.205</td>
<td class="gt_row gt_right">5.205</td>
<td class="gt_row gt_right">5.205</td>
<td class="gt_row gt_right">5.186</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">2000</td>
<td class="gt_row gt_right">5.710</td>
<td class="gt_row gt_right">5.710</td>
<td class="gt_row gt_right">5.710</td>
<td class="gt_row gt_right">5.691</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">2001</td>
<td class="gt_row gt_right">6.150</td>
<td class="gt_row gt_right">6.150</td>
<td class="gt_row gt_right">6.150</td>
<td class="gt_row gt_right">6.131</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">2002</td>
<td class="gt_row gt_right">6.690</td>
<td class="gt_row gt_right">6.690</td>
<td class="gt_row gt_right">6.690</td>
<td class="gt_row gt_right">6.670</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">2003</td>
<td class="gt_row gt_right">7.261</td>
<td class="gt_row gt_right">7.261</td>
<td class="gt_row gt_right">7.261</td>
<td class="gt_row gt_right">7.242</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">2004</td>
<td class="gt_row gt_right">7.566</td>
<td class="gt_row gt_right">7.566</td>
<td class="gt_row gt_right">7.566</td>
<td class="gt_row gt_right">7.546</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">2005</td>
<td class="gt_row gt_right">8.143</td>
<td class="gt_row gt_right">8.143</td>
<td class="gt_row gt_right">8.143</td>
<td class="gt_row gt_right">8.124</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">2006</td>
<td class="gt_row gt_right">8.618</td>
<td class="gt_row gt_right">8.618</td>
<td class="gt_row gt_right">8.618</td>
<td class="gt_row gt_right">8.598</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">0.177</td>
<td class="gt_row gt_right">0.177</td>
<td class="gt_row gt_right">0.177</td>
<td class="gt_row gt_right">0.281</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">1999</td>
<td class="gt_row gt_right">0.624</td>
<td class="gt_row gt_right">0.624</td>
<td class="gt_row gt_right">0.624</td>
<td class="gt_row gt_right">0.728</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2000</td>
<td class="gt_row gt_right">0.860</td>
<td class="gt_row gt_right">0.860</td>
<td class="gt_row gt_right">0.860</td>
<td class="gt_row gt_right">0.964</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2001</td>
<td class="gt_row gt_right">1.174</td>
<td class="gt_row gt_right">1.174</td>
<td class="gt_row gt_right">1.174</td>
<td class="gt_row gt_right">1.278</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2002</td>
<td class="gt_row gt_right">1.487</td>
<td class="gt_row gt_right">1.487</td>
<td class="gt_row gt_right">1.487</td>
<td class="gt_row gt_right">1.591</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2003</td>
<td class="gt_row gt_right">1.871</td>
<td class="gt_row gt_right">1.871</td>
<td class="gt_row gt_right">1.871</td>
<td class="gt_row gt_right">1.975</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2004</td>
<td class="gt_row gt_right">2.031</td>
<td class="gt_row gt_right">2.031</td>
<td class="gt_row gt_right">2.031</td>
<td class="gt_row gt_right">2.135</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2005</td>
<td class="gt_row gt_right">2.495</td>
<td class="gt_row gt_right">2.495</td>
<td class="gt_row gt_right">2.495</td>
<td class="gt_row gt_right">2.599</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2006</td>
<td class="gt_row gt_right">2.703</td>
<td class="gt_row gt_right">2.703</td>
<td class="gt_row gt_right">2.703</td>
<td class="gt_row gt_right">2.807</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><span class="fu" style="color: #4758AB;">plot_data</span>(df6) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb57-2">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #657422;">data =</span> df_est6, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> year, <span class="at" style="color: #657422;">y =</span> estimate, <span class="at" style="color: #657422;">colour =</span> <span class="fu" style="color: #4758AB;">factor</span>(group),<span class="at" style="color: #657422;">lty=</span><span class="fu" style="color: #4758AB;">factor</span>(method)), <span class="at" style="color: #657422;">lwd=</span><span class="dv" style="color: #AD0000;">2</span>)  <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb57-3">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position=</span><span class="st" style="color: #20794D;">"bottom"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot-case6" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/twfe-twm-and-did_files/figure-html/fig-plot-case6-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 17: Treatment Effect Estimates - Multiple Treatment Periods and Heterogeneous Dynamic Treatment Effects</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1">df_est6 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb58-2">  <span class="fu" style="color: #4758AB;">select</span>(group,year, estimate,method) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb58-3">  <span class="fu" style="color: #4758AB;">filter</span>(method <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"TWFE"</span>,<span class="st" style="color: #20794D;">"CS"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb58-4">  <span class="fu" style="color: #4758AB;">spread</span>(method,estimate) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb58-5">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> TWFE, <span class="at" style="color: #657422;">y =</span> CS, <span class="at" style="color: #657422;">group =</span> year, <span class="at" style="color: #657422;">colour =</span> <span class="fu" style="color: #4758AB;">factor</span>(group)))<span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb58-6">  <span class="fu" style="color: #4758AB;">geom_point</span>() <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb58-7">  <span class="co" style="color: #5E5E5E;">#facet_wrap(~group) + </span></span>
<span id="cb58-8">  <span class="fu" style="color: #4758AB;">theme_few</span>() <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb58-9">  <span class="fu" style="color: #4758AB;">geom_abline</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">slope=</span><span class="dv" style="color: #AD0000;">1</span>,<span class="at" style="color: #657422;">intercept=</span><span class="dv" style="color: #AD0000;">0</span>),<span class="at" style="color: #657422;">lty=</span><span class="dv" style="color: #AD0000;">3</span>) <span class="sc" style="color: #5E5E5E;">+</span>  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #657422;">legend.position =</span> <span class="st" style="color: #20794D;">"bottom"</span>) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb58-10">  ggsci<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">scale_color_aaas</span>(<span class="at" style="color: #657422;">name=</span><span class="st" style="color: #20794D;">"Treatment Cohort"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot-case6-comp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://graveja0.github.io/HPOL8539-F2022/blog/posts/twfe-twm-and-did_files/figure-html/fig-plot-case6-comp-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 18: Comparison of Treatment Effect Estimates - Multiple Treatment Periods and Heterogeneous Dynamic Treatment Effects</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><a href="https://www.res.org.uk/resources-page/res2022-special-session-ectj-the-new-difference-in-differences.html">Nice video discussion</a> of hte above.</p>


</section>
</section>

 ]]></description>
  <guid>https://graveja0.github.io/HPOL8539-F2022/blog/posts/twfe-twm-and-did.html</guid>
  <pubDate>Wed, 07 Sep 2022 02:25:17 GMT</pubDate>
</item>
<item>
  <title>Quasi-Demeaning: The Relationship Between Fixed and Random Effects</title>
  <link>https://graveja0.github.io/HPOL8539-F2022/blog/posts/quasi-demeaning.html</link>
  <description><![CDATA[ 



<section id="setup" class="level1">
<h1>Setup</h1>
<p>Assume the following data generation process:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AY_%7Bit%7D%20=%20%5Cmathbf%7BX%7D_%7Bi%7D'%5Cbeta%20+%20%5Ctau%20D_%7Bit%7D%20+%20U_i%20+%5Cepsilon_%7Bit%7D%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?i"> indexes individual units and <img src="https://latex.codecogs.com/png.latex?t"> indexes time, <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BX%7D_i"> are unit-level attributes, <img src="https://latex.codecogs.com/png.latex?D_%7Bit%7D"> is a treatment indicator (set to 1 if the observation is treated and in the post-treatment period). Finally, <img src="https://latex.codecogs.com/png.latex?U_i"> captures unobserved unit-level heterogeneity.</p>
<section id="estimation-random-vs.-fixed-effects" class="level2">
<h2 class="anchored" data-anchor-id="estimation-random-vs.-fixed-effects">Estimation: Random vs.&nbsp;Fixed Effects</h2>
<ul>
<li><p>Random effects uses an approach called “quasi-demeaning” or “partial pooling.”</p></li>
<li><p>The random effects model can be represented as:</p></li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign%7D%0A(Y_%7Bit%7D-%5Ctheta%20%5Cbar%7BY_i%7D)%20=%20(%5Cmathbf%7BX%7D_%7Bit%7D-%5Ctheta%20%5Cbar%7B%5Cmathbf%7BX%7D_i%7D)'%5Cbeta%20+%20%5Ctau%20(D_%7Bit%7D-%5Ctheta%20%5Cbar%7BD_i%7D)%20%20+%20(%5Cepsilon_%7Bit%7D%20-%20%5Ctheta%20%5Cbar%7B%5Cepsilon_i%7D)%20%5Cquad%20%5Cquad%20%5Cquad%20Eq.%209%0A%5Cend%7Balign%7D%0A"></p>
<p>where</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctheta%20=%201%20-%20%5Cbigg%20%5B%5Cfrac%7B%5Csigma%5E2_%5Cepsilon%7D%7B(%5Csigma%5E2_%5Cepsilon%20+%20T%5Csigma%5E2_u)%7D%5Cbigg%20%5D%5E%7B1/2%7D%0A"></p>
<p>In the above, <img src="https://latex.codecogs.com/png.latex?%5Csigma_u"> is the variance of unit-level heterogeneity, and <img src="https://latex.codecogs.com/png.latex?%5Csigma_%7B%5Cepsilon%7D"> is the variance of <img src="https://latex.codecogs.com/png.latex?%5Cepsilon_%7Bit%7D">. And recall <img src="https://latex.codecogs.com/png.latex?T"> is the total number of repeated unit-level observations in our panel (e.g., the total number of time periods, the total number of patients for a given physician, etc.)</p>
<ul>
<li><p>When <img src="https://latex.codecogs.com/png.latex?%5Ctheta%20=%200">, it just reduces pooled regression.</p></li>
<li><p>When <img src="https://latex.codecogs.com/png.latex?%5Ctheta%20=%201">, it is equivalent to fixed effects regression. This <em>only</em> isolates variation within units to estimate the regression coefficients (i.e., units are only compared to themselves, which is why the unobserved heterogeneity is accounted for).</p></li>
<li><p>Essentially, when you fit a random effects regression, Stata estimates <img src="https://latex.codecogs.com/png.latex?%5Ctheta"> and then plugs that estimate it into the above model.</p></li>
<li><p>(When you fit a fixed effects regression, Stata uses the demeaning approach–unless, of course, you manually fit a dummy variable model)</p></li>
<li><p>Often <img src="https://latex.codecogs.com/png.latex?0%20%3C%20%5Ctheta%20%3C%201">, hence the term “partial-pooling.” That is, the regression draws on both variation “within” units and variation “between” units.</p></li>
<li><p>The degree to which within and between variation is used depends on the data context.</p></li>
<li><p>Remember, when <img src="https://latex.codecogs.com/png.latex?%5Ctheta=0"> the random effects regression reduces to pooled OLS. When is this the case?</p>
<ul>
<li>If the term <img src="https://latex.codecogs.com/png.latex?T%5Csigma%5E2_u"> is 0, i.e., <img src="https://latex.codecogs.com/png.latex?%5Csigma%5E2_u=0"> or there is no variation in individual heterogeneity.</li>
</ul></li>
<li><p>Remember, when <img src="https://latex.codecogs.com/png.latex?%5Ctheta=1"> the random effects regression reduces to fixed effects. When is this the case?</p>
<ul>
<li><p>If the term <img src="https://latex.codecogs.com/png.latex?T%5Csigma%5E2_u"> gets super large (more formally, it would need to blast off towards infinity…).</p></li>
<li><p>If we have a very “large” panel of observations on each unit (i.e., large <img src="https://latex.codecogs.com/png.latex?T">) there is sufficient “within” variation and we really don’t need to do any pooling across units.</p></li>
</ul></li>
</ul>
</section>
</section>
<section id="setup-1" class="level1">
<h1>Setup</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──
✔ ggplot2 3.3.6     ✔ purrr   0.3.4
✔ tibble  3.1.8     ✔ dplyr   1.0.9
✔ tidyr   1.2.0     ✔ stringr 1.4.1
✔ readr   2.1.2     ✔ forcats 0.5.2
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;">library</span>(lme4)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Matrix

Attaching package: 'Matrix'

The following objects are masked from 'package:tidyr':

    expand, pack, unpack</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;">library</span>(broom)</span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;">library</span>(knitr)</span>
<span id="cb5-3"><span class="fu" style="color: #4758AB;">theme_set</span>(<span class="fu" style="color: #4758AB;">theme_bw</span>())</span></code></pre></div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">params_panel <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">list</span>(</span>
<span id="cb6-2">  <span class="at" style="color: #657422;">N =</span> <span class="dv" style="color: #AD0000;">1000</span>,</span>
<span id="cb6-3">  <span class="at" style="color: #657422;">T =</span> <span class="dv" style="color: #AD0000;">2</span>,</span>
<span id="cb6-4">  <span class="at" style="color: #657422;">tx_time =</span> <span class="dv" style="color: #AD0000;">2</span>, </span>
<span id="cb6-5">  <span class="at" style="color: #657422;">rho_t =</span> <span class="fl" style="color: #AD0000;">0.8</span>,</span>
<span id="cb6-6">  <span class="at" style="color: #657422;">beta_0 =</span> <span class="fl" style="color: #AD0000;">0.5</span>,</span>
<span id="cb6-7">  <span class="at" style="color: #657422;">beta_1 =</span> <span class="dv" style="color: #AD0000;">2</span>,</span>
<span id="cb6-8">  <span class="at" style="color: #657422;">tau =</span> <span class="fl" style="color: #AD0000;">0.5</span>,</span>
<span id="cb6-9">  <span class="at" style="color: #657422;">p_d =</span> <span class="fl" style="color: #AD0000;">0.5</span></span>
<span id="cb6-10">)</span>
<span id="cb6-11"></span>
<span id="cb6-12">dgp_panel <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(params) {</span>
<span id="cb6-13">  <span class="fu" style="color: #4758AB;">with</span>(params, {</span>
<span id="cb6-14"></span>
<span id="cb6-15">    <span class="co" style="color: #5E5E5E;"># Time effects</span></span>
<span id="cb6-16">    t_ <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb6-17">      <span class="fu" style="color: #4758AB;">data.frame</span>(<span class="at" style="color: #657422;">t =</span> <span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span>T,</span>
<span id="cb6-18">                 <span class="at" style="color: #657422;">gamma_t =</span> <span class="fu" style="color: #4758AB;">arima.sim</span>(<span class="at" style="color: #657422;">n=</span>T, <span class="fu" style="color: #4758AB;">list</span>(<span class="at" style="color: #657422;">ar =</span> rho_t, <span class="at" style="color: #657422;">order=</span><span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">1</span>,<span class="dv" style="color: #AD0000;">0</span>,<span class="dv" style="color: #AD0000;">0</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">as.vector</span>())</span>
<span id="cb6-19"></span>
<span id="cb6-20">    <span class="co" style="color: #5E5E5E;"># Individual measures and effects</span></span>
<span id="cb6-21">    i_ <span class="ot" style="color: #003B4F;">&lt;-</span></span>
<span id="cb6-22">      <span class="fu" style="color: #4758AB;">data.frame</span>(</span>
<span id="cb6-23">        <span class="at" style="color: #657422;">unit_id =</span> <span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span>N,</span>
<span id="cb6-24">        <span class="at" style="color: #657422;">x_i =</span> <span class="fu" style="color: #4758AB;">rnorm</span>(N, <span class="at" style="color: #657422;">mean =</span> <span class="dv" style="color: #AD0000;">0</span>, <span class="at" style="color: #657422;">sd =</span> <span class="dv" style="color: #AD0000;">1</span>),</span>
<span id="cb6-25">        <span class="at" style="color: #657422;">u_i =</span> <span class="fu" style="color: #4758AB;">rnorm</span>(N, <span class="at" style="color: #657422;">mean =</span> <span class="dv" style="color: #AD0000;">0</span>, <span class="at" style="color: #657422;">sd =</span> <span class="dv" style="color: #AD0000;">1</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-26">      <span class="fu" style="color: #4758AB;">rowwise</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="co" style="color: #5E5E5E;"># This allows us to get each value's pr_treated in the line below. </span></span>
<span id="cb6-27">      <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">pr_treated =</span> boot<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">inv.logit</span>(u_i)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-28">      <span class="fu" style="color: #4758AB;">ungroup</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span>  <span class="co" style="color: #5E5E5E;"># This undoes the rowwise </span></span>
<span id="cb6-29">      <span class="co" style="color: #5E5E5E;"># Treatment indicator</span></span>
<span id="cb6-30">      <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">d_i =</span> <span class="fu" style="color: #4758AB;">rbinom</span>(N, <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">1</span>, <span class="at" style="color: #657422;">prob =</span> pr_treated)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-31">      <span class="fu" style="color: #4758AB;">ungroup</span>()</span>
<span id="cb6-32"></span>
<span id="cb6-33">    <span class="fu" style="color: #4758AB;">crossing</span>(<span class="at" style="color: #657422;">unit_id =</span> i_<span class="sc" style="color: #5E5E5E;">$</span>unit_id,<span class="at" style="color: #657422;">t =</span> t_<span class="sc" style="color: #5E5E5E;">$</span>t) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-34">      <span class="fu" style="color: #4758AB;">left_join</span>(i_,<span class="st" style="color: #20794D;">"unit_id"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-35">      <span class="fu" style="color: #4758AB;">left_join</span>(t_,<span class="st" style="color: #20794D;">"t"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-36">      <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">d_i =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(t<span class="sc" style="color: #5E5E5E;">&lt;</span>tx_time,<span class="dv" style="color: #AD0000;">0</span>,d_i)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-37">      <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">y_i =</span> beta_0 <span class="sc" style="color: #5E5E5E;">+</span> beta_1 <span class="sc" style="color: #5E5E5E;">*</span> x_i <span class="sc" style="color: #5E5E5E;">+</span> tau <span class="sc" style="color: #5E5E5E;">*</span> d_i <span class="sc" style="color: #5E5E5E;">+</span> u_i <span class="sc" style="color: #5E5E5E;">+</span> gamma_t <span class="sc" style="color: #5E5E5E;">+</span> <span class="fu" style="color: #4758AB;">rnorm</span>(N, <span class="at" style="color: #657422;">mean =</span> <span class="dv" style="color: #AD0000;">0</span>, <span class="at" style="color: #657422;">sd =</span> <span class="dv" style="color: #AD0000;">1</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-38">      <span class="fu" style="color: #4758AB;">select</span>(unit_id, t, y_i , x_i, d_i)</span>
<span id="cb6-39">  })</span>
<span id="cb6-40">}</span>
<span id="cb6-41"></span>
<span id="cb6-42">estimator_fn_re <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(df) {</span>
<span id="cb6-43">  <span class="fu" style="color: #4758AB;">lmer</span>(y_i <span class="sc" style="color: #5E5E5E;">~</span>  d_i <span class="sc" style="color: #5E5E5E;">+</span> (<span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">|</span>unit_id) , df)</span>
<span id="cb6-44">}</span>
<span id="cb6-45"></span>
<span id="cb6-46">disc_fn_re <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(fit) {</span>
<span id="cb6-47">  fit <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">summary</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">pluck</span>(<span class="st" style="color: #20794D;">"coefficients"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-48">    <span class="fu" style="color: #4758AB;">data.frame</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-49">    <span class="fu" style="color: #4758AB;">rownames_to_column</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-50">    janitor<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">clean_names</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-51">    <span class="fu" style="color: #4758AB;">filter</span>(rowname<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"d_i"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-52">    <span class="fu" style="color: #4758AB;">pull</span>(estimate) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-53">    <span class="fu" style="color: #4758AB;">as.vector</span>()</span>
<span id="cb6-54">}</span>
<span id="cb6-55"></span>
<span id="cb6-56">generate_estimate_discriminate_re <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(params) {</span>
<span id="cb6-57">  params <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="co" style="color: #5E5E5E;"># Step 1: Parameterize the problem</span></span>
<span id="cb6-58">      <span class="fu" style="color: #4758AB;">dgp_panel</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span>  <span class="co" style="color: #5E5E5E;"># Step 2: Define the data generation process</span></span>
<span id="cb6-59">        <span class="fu" style="color: #4758AB;">estimator_fn_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span>  <span class="co" style="color: #5E5E5E;"># Step 3: Estimate </span></span>
<span id="cb6-60">          <span class="fu" style="color: #4758AB;">disc_fn_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="co" style="color: #5E5E5E;"># Step 4: Pull out what you need</span></span>
<span id="cb6-61">            <span class="fu" style="color: #4758AB;">data.frame</span>(<span class="at" style="color: #657422;">tau_hat =</span> .) <span class="co" style="color: #5E5E5E;"># store the result as a data frame object</span></span>
<span id="cb6-62">}</span>
<span id="cb6-63"></span>
<span id="cb6-64">construct_dm <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(df) {</span>
<span id="cb6-65">  df_ <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb6-66">    df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-67">      <span class="co" style="color: #5E5E5E;"># mutate(y_i = y_i + mean(y_i),</span></span>
<span id="cb6-68">      <span class="co" style="color: #5E5E5E;">#       d_i = d_i + mean(d_i)) %&gt;% </span></span>
<span id="cb6-69">      <span class="co" style="color: #5E5E5E;">#       group_by(t) %&gt;% </span></span>
<span id="cb6-70">      <span class="co" style="color: #5E5E5E;">#       mutate(y_i = y_i - mean(y_i),</span></span>
<span id="cb6-71">      <span class="co" style="color: #5E5E5E;">#       d_i = d_i - mean(d_i)) %&gt;% </span></span>
<span id="cb6-72">            <span class="fu" style="color: #4758AB;">group_by</span>(unit_id) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-73">            <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">y_i =</span> y_i <span class="sc" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">mean</span>(y_i),</span>
<span id="cb6-74">            <span class="at" style="color: #657422;">d_i =</span> d_i <span class="sc" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">mean</span>(d_i))</span>
<span id="cb6-75"></span>
<span id="cb6-76">  <span class="fu" style="color: #4758AB;">return</span>(df_)</span>
<span id="cb6-77">}</span>
<span id="cb6-78"></span>
<span id="cb6-79">estimate_dm <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(df) {</span>
<span id="cb6-80">  <span class="fu" style="color: #4758AB;">lm</span>(y_i <span class="sc" style="color: #5E5E5E;">~</span> d_i   , <span class="at" style="color: #657422;">data =</span> df)</span>
<span id="cb6-81">}</span>
<span id="cb6-82"></span>
<span id="cb6-83">disc_fn_dm <span class="ot" style="color: #003B4F;">=</span> <span class="cf" style="color: #003B4F;">function</span>(fit) {</span>
<span id="cb6-84">  fit_ <span class="ot" style="color: #003B4F;">=</span>broom<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">tidy</span>(fit)   <span class="co" style="color: #5E5E5E;"># This cleans up the fitted regression object</span></span>
<span id="cb6-85">  out <span class="ot" style="color: #003B4F;">=</span>fit_ <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-86">    <span class="fu" style="color: #4758AB;">filter</span>(term<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"d_i"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-87">    <span class="fu" style="color: #4758AB;">pull</span>(estimate)</span>
<span id="cb6-88">  </span>
<span id="cb6-89">  <span class="fu" style="color: #4758AB;">return</span>(out)</span>
<span id="cb6-90">}</span>
<span id="cb6-91"></span>
<span id="cb6-92"></span>
<span id="cb6-93"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">123</span>)</span>
<span id="cb6-94">df_c <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb6-95">  <span class="fu" style="color: #4758AB;">modifyList</span>(params_panel,<span class="fu" style="color: #4758AB;">list</span>(<span class="at" style="color: #657422;">T=</span><span class="dv" style="color: #AD0000;">400</span>,<span class="at" style="color: #657422;">tx_time=</span><span class="dv" style="color: #AD0000;">200</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-96">  <span class="fu" style="color: #4758AB;">dgp_panel</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-97">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">index =</span> t<span class="dv" style="color: #AD0000;">-200</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-98">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">T2=</span> <span class="fu" style="color: #4758AB;">as.integer</span>(index <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>,<span class="dv" style="color: #AD0000;">0</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-99">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">T4 =</span> <span class="fu" style="color: #4758AB;">as.integer</span>(index <span class="sc" style="color: #5E5E5E;">&gt;</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">3</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> index <span class="sc" style="color: #5E5E5E;">&lt;</span><span class="dv" style="color: #AD0000;">2</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-100">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">T10 =</span> <span class="fu" style="color: #4758AB;">as.integer</span>(index <span class="sc" style="color: #5E5E5E;">&gt;=</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">5</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> index<span class="sc" style="color: #5E5E5E;">&lt;</span><span class="dv" style="color: #AD0000;">5</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-101">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">T20 =</span> <span class="fu" style="color: #4758AB;">as.integer</span>(index <span class="sc" style="color: #5E5E5E;">&gt;=</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">10</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> index <span class="sc" style="color: #5E5E5E;">&lt;</span><span class="dv" style="color: #AD0000;">10</span> )) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-102">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">T50 =</span> <span class="dv" style="color: #AD0000;">1</span> ) </span>
<span id="cb6-103"></span>
<span id="cb6-104">df <span class="ot" style="color: #003B4F;">&lt;-</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(T4<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>)</span>
<span id="cb6-105"></span>
<span id="cb6-106">params_panel <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-107">  <span class="fu" style="color: #4758AB;">dgp_panel</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-108">  <span class="fu" style="color: #4758AB;">head</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-109">  <span class="fu" style="color: #4758AB;">kable</span>(<span class="at" style="color: #657422;">digits=</span><span class="dv" style="color: #AD0000;">3</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: right;">unit_id</th>
<th style="text-align: right;">t</th>
<th style="text-align: right;">y_i</th>
<th style="text-align: right;">x_i</th>
<th style="text-align: right;">d_i</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.855</td>
<td style="text-align: right;">0.502</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2.825</td>
<td style="text-align: right;">0.502</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5.893</td>
<td style="text-align: right;">1.434</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">7.620</td>
<td style="text-align: right;">1.434</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.225</td>
<td style="text-align: right;">2.166</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">6.555</td>
<td style="text-align: right;">2.166</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Let’s first show the equivalance between the random effect model and a quasi-demeaned linear regression model. We’ll do so by focusing on a case where <img src="https://latex.codecogs.com/png.latex?T=4">.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">fit_re <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb7-2">  df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;">estimator_fn_re</span>()</span>
<span id="cb7-4"></span>
<span id="cb7-5"><span class="fu" style="color: #4758AB;">summary</span>(fit_re)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: y_i ~ d_i + (1 | unit_id)
   Data: df

REML criterion at convergence: 14733.6

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.0705 -0.7249  0.1037  0.6245  2.0637 

Random effects:
 Groups   Name        Variance Std.Dev.
 unit_id  (Intercept) 5.462    2.337   
 Residual             1.085    1.041   
Number of obs: 4000, groups:  unit_id, 1000

Fixed effects:
            Estimate Std. Error t value
(Intercept)  0.29151    0.07661   3.805
d_i         -0.51889    0.04550 -11.403

Correlation of Fixed Effects:
    (Intr)
d_i -0.152</code></pre>
</div>
</div>
<ul>
<li>Notice the use of the term “fixed effects” is based on a traditional statistical definition–these are the regression parameters not assumed to come from a stochastic (statsitical) distribution, such as the random effects.</li>
</ul>
<p>Let’s now extract out the variance parameter estimates <img src="https://latex.codecogs.com/png.latex?%5Csigma%5E2_%7B%5Cepsilon%7D"> and <img src="https://latex.codecogs.com/png.latex?%5Csigma%5E2_u">:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">get_re <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(fit) {</span>
<span id="cb9-2">    x <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">VarCorr</span>(fit) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">data.frame</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb9-3">    <span class="fu" style="color: #4758AB;">tibble</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb9-4">    <span class="fu" style="color: #4758AB;">select</span>(grp,var1,vcov)</span>
<span id="cb9-5">}</span>
<span id="cb9-6"></span>
<span id="cb9-7">re_est <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb9-8">  fit_re <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb9-9">  <span class="fu" style="color: #4758AB;">get_re</span>()</span></code></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">grp</th>
<th style="text-align: left;">var1</th>
<th style="text-align: right;">vcov</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">unit_id</td>
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">5.462082</td>
</tr>
<tr class="even">
<td style="text-align: left;">Residual</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">1.084670</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We can then use these to calculatate <img src="https://latex.codecogs.com/png.latex?%5Ctheta">:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">sigma2_e <span class="ot" style="color: #003B4F;">=</span> fit_re <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">get_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(grp<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"Residual"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">pull</span>(vcov)</span>
<span id="cb10-2">sigma2_ui <span class="ot" style="color: #003B4F;">=</span> fit_re <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">get_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(grp<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"unit_id"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">pull</span>(vcov)</span>
<span id="cb10-3">theta_i <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">1</span> <span class="sc" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">sqrt</span>(sigma2_e<span class="sc" style="color: #5E5E5E;">/</span>(<span class="dv" style="color: #AD0000;">4</span><span class="sc" style="color: #5E5E5E;">*</span>sigma2_ui <span class="sc" style="color: #5E5E5E;">+</span> sigma2_e))</span>
<span id="cb10-4"></span>
<span id="cb10-5">theta_i</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7825205</code></pre>
</div>
</div>
<p>Next we will create a quasi-demeaned version of our input data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">df_ <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb12-2">  df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;">group_by</span>(unit_id) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb12-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">y_i =</span> y_i <span class="sc" style="color: #5E5E5E;">-</span> theta_i <span class="sc" style="color: #5E5E5E;">*</span> <span class="fu" style="color: #4758AB;">mean</span>(y_i),</span>
<span id="cb12-5">         <span class="at" style="color: #657422;">d_i =</span> d_i <span class="sc" style="color: #5E5E5E;">-</span> theta_i <span class="sc" style="color: #5E5E5E;">*</span> <span class="fu" style="color: #4758AB;">mean</span>(d_i))</span></code></pre></div>
</div>
<p>We now fit a quasi-demeaned</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">fit_qdm <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">lm</span>(y_i <span class="sc" style="color: #5E5E5E;">~</span> d_i, <span class="at" style="color: #657422;">data =</span> df_)</span>
<span id="cb13-2"><span class="fu" style="color: #4758AB;">summary</span>(fit_qdm)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y_i ~ d_i, data = df_)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.1586 -0.7768  0.0980  0.7425  3.2119 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.06340    0.01666   3.805 0.000144 ***
d_i         -0.51889    0.04550 -11.403  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.041 on 3998 degrees of freedom
Multiple R-squared:  0.0315,    Adjusted R-squared:  0.03126 
F-statistic:   130 on 1 and 3998 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Now let’s compare:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">res <span class="ot" style="color: #003B4F;">&lt;-</span> </span>
<span id="cb15-2">  fit_qdm <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">tidy</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb15-3">  <span class="fu" style="color: #4758AB;">select</span>(term,<span class="at" style="color: #657422;">estimate_qdm =</span> estimate) </span>
<span id="cb15-4"></span>
<span id="cb15-5"><span class="fu" style="color: #4758AB;">cbind</span>(res,df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">estimator_fn_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">summary</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">pluck</span>(<span class="st" style="color: #20794D;">"coefficients"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb15-6">  <span class="fu" style="color: #4758AB;">data.frame</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb15-7">  <span class="fu" style="color: #4758AB;">select</span>(<span class="at" style="color: #657422;">estimate_re =</span> Estimate)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb15-8">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">theta =</span> theta_i) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb15-9">  <span class="fu" style="color: #4758AB;">select</span>(term, estimate_re, estimate_qdm, theta) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb15-10">  <span class="fu" style="color: #4758AB;">remove_rownames</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb15-11">  <span class="fu" style="color: #4758AB;">kable</span>(<span class="at" style="color: #657422;">digits =</span> <span class="dv" style="color: #AD0000;">3</span>)</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate_re</th>
<th style="text-align: right;">estimate_qdm</th>
<th style="text-align: right;">theta</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">0.292</td>
<td style="text-align: right;">0.063</td>
<td style="text-align: right;">0.783</td>
</tr>
<tr class="even">
<td style="text-align: left;">d_i</td>
<td style="text-align: right;">-0.519</td>
<td style="text-align: right;">-0.519</td>
<td style="text-align: right;">0.783</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">get_theta <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(fit) {</span>
<span id="cb16-2">  sigma2_e <span class="ot" style="color: #003B4F;">=</span> fit <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">get_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(grp<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"Residual"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">pull</span>(vcov)</span>
<span id="cb16-3">  sigma2_ui <span class="ot" style="color: #003B4F;">=</span> fit <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">get_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(grp<span class="sc" style="color: #5E5E5E;">==</span><span class="st" style="color: #20794D;">"unit_id"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">pull</span>(vcov)</span>
<span id="cb16-4">  theta <span class="ot" style="color: #003B4F;">=</span> <span class="dv" style="color: #AD0000;">1</span> <span class="sc" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">sqrt</span>(sigma2_e<span class="sc" style="color: #5E5E5E;">/</span>(<span class="dv" style="color: #AD0000;">4</span><span class="sc" style="color: #5E5E5E;">*</span>sigma2_ui <span class="sc" style="color: #5E5E5E;">+</span> sigma2_e))</span>
<span id="cb16-5">  theta </span>
<span id="cb16-6">}</span>
<span id="cb16-7"></span>
<span id="cb16-8">t_qdm <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">tibble</span>(</span>
<span id="cb16-9">  <span class="at" style="color: #657422;">T2 =</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(T2<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">estimator_fn_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">disc_fn_re</span>(),</span>
<span id="cb16-10">  <span class="at" style="color: #657422;">theta2  =</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(T2<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">estimator_fn_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">get_theta</span>(),</span>
<span id="cb16-11">  <span class="at" style="color: #657422;">T2fe =</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(T2<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">construct_dm</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">estimate_dm</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">disc_fn_dm</span>()  ,</span>
<span id="cb16-12">  <span class="at" style="color: #657422;">T4 =</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(T4<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">estimator_fn_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">disc_fn_re</span>(),</span>
<span id="cb16-13">  <span class="at" style="color: #657422;">theta4  =</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(T4<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">estimator_fn_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">get_theta</span>(),</span>
<span id="cb16-14">  <span class="at" style="color: #657422;">T4fe =</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(T4<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">construct_dm</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">estimate_dm</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">disc_fn_dm</span>()    ,</span>
<span id="cb16-15">  <span class="at" style="color: #657422;">T10 =</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(T10<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">estimator_fn_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">disc_fn_re</span>(),</span>
<span id="cb16-16">  <span class="at" style="color: #657422;">theta10  =</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(T10<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">estimator_fn_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">get_theta</span>(),  </span>
<span id="cb16-17">  <span class="at" style="color: #657422;">T10fe =</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(T10<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">construct_dm</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">estimate_dm</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">disc_fn_dm</span>()   ,</span>
<span id="cb16-18">  <span class="at" style="color: #657422;">T20 =</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(T20<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">estimator_fn_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">disc_fn_re</span>(),</span>
<span id="cb16-19">  <span class="at" style="color: #657422;">theta20  =</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(T20<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">estimator_fn_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">get_theta</span>(),  </span>
<span id="cb16-20">  <span class="at" style="color: #657422;">T20fe =</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">filter</span>(T20<span class="sc" style="color: #5E5E5E;">==</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">construct_dm</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">estimate_dm</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">disc_fn_dm</span>()  ,</span>
<span id="cb16-21">  <span class="at" style="color: #657422;">T400 =</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span>  <span class="fu" style="color: #4758AB;">estimator_fn_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">disc_fn_re</span>(),</span>
<span id="cb16-22">  <span class="at" style="color: #657422;">theta400 =</span>  df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span>  <span class="fu" style="color: #4758AB;">estimator_fn_re</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">get_theta</span>(),</span>
<span id="cb16-23">  <span class="at" style="color: #657422;">T400fe =</span> df_c <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">construct_dm</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">estimate_dm</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">disc_fn_dm</span>()</span>
<span id="cb16-24">)</span>
<span id="cb16-25">  </span>
<span id="cb16-26">t_qdm <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb16-27">  <span class="fu" style="color: #4758AB;">select</span>(<span class="sc" style="color: #5E5E5E;">-</span><span class="fu" style="color: #4758AB;">starts_with</span>(<span class="st" style="color: #20794D;">"theta"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb16-28">  <span class="fu" style="color: #4758AB;">gather</span>(measure,value) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb16-29">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">method =</span> <span class="fu" style="color: #4758AB;">ifelse</span>(<span class="fu" style="color: #4758AB;">grepl</span>(<span class="st" style="color: #20794D;">"fe"</span>,measure),<span class="st" style="color: #20794D;">"FE"</span>,<span class="st" style="color: #20794D;">"RE"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb16-30">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">measure =</span> <span class="fu" style="color: #4758AB;">gsub</span>(<span class="st" style="color: #20794D;">"fe"</span>,<span class="st" style="color: #20794D;">""</span>,measure)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb16-31">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">measure =</span> <span class="fu" style="color: #4758AB;">case_when</span>(measure <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"T2"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"T = 2"</span>,</span>
<span id="cb16-32">                             measure <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"T4"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"T = 4"</span>,</span>
<span id="cb16-33">                             measure <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"T10"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"T = 10"</span>,</span>
<span id="cb16-34">                             measure <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"T20"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"T = 20"</span>,</span>
<span id="cb16-35">                             measure <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"T400"</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"T = 400"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb16-36">  <span class="fu" style="color: #4758AB;">rename</span>(<span class="at" style="color: #657422;">time_periods =</span> measure) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb16-37">  <span class="fu" style="color: #4758AB;">spread</span>(method, value) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb16-38">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">time_periods =</span> <span class="fu" style="color: #4758AB;">factor</span>(time_periods, <span class="at" style="color: #657422;">levels =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"T = 2"</span>,<span class="st" style="color: #20794D;">"T = 4"</span>, <span class="st" style="color: #20794D;">"T = 10"</span>,<span class="st" style="color: #20794D;">"T = 20"</span> , <span class="st" style="color: #20794D;">"T = 400"</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb16-39">  <span class="fu" style="color: #4758AB;">arrange</span>(time_periods) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb16-40">  <span class="fu" style="color: #4758AB;">kable</span>()</span></code></pre></div>
</details>
</div>


</section>

 ]]></description>
  <guid>https://graveja0.github.io/HPOL8539-F2022/blog/posts/quasi-demeaning.html</guid>
  <pubDate>Wed, 07 Sep 2022 02:25:17 GMT</pubDate>
</item>
</channel>
</rss>
