<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Advanced Program and Policy Evaluation (HPOL8539) - Two-Way Fixed Effects, the Two-Way Mundlak Regression, and Difference-in-Difference Estimators</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Two-Way Fixed Effects, the Two-Way Mundlak Regression, and Difference-in-Difference Estimators</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Advanced Program and Policy Evaluation (HPOL8539)</a> 
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">Advanced Program and Policy Evaluation</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">Slides</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/lec_introduction.html" class="sidebar-item-text sidebar-link">Introduction and Course Details</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">Case Studies</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://graves-vanderbilt.shinyapps.io/HPOL8539-Simulation/" class="sidebar-item-text sidebar-link">1. Simulation as a Guide for Study Design and Inference</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://graves-vanderbilt.shinyapps.io/HPOL8539-panel-data-1/" class="sidebar-item-text sidebar-link">2. Panel Data Methods I - Fixed, Random and Correlated Random Effects</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blog/index.html" class="sidebar-item-text sidebar-link">Blog</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">Useful Links</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://github.com/graveja0/HPOL8539-F2022/raw/main/current-syllabus.pdf" class="sidebar-item-text sidebar-link">Current Syllabus</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://mixtape.scunning.com/" class="sidebar-item-text sidebar-link">Causal Inference - The Mixtape (Cunningham)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://theeffectbook.net/" class="sidebar-item-text sidebar-link">The Effect (Huntington-Klein)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://diff.healthpolicydatascience.org/" class="sidebar-item-text sidebar-link">Comprehensive Discussion of Difference-in-Differences</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://asjadnaqvi.github.io/DiD/" class="sidebar-item-text sidebar-link">Difference-in-Differences Respository (code, packages, etc.)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://kylebutts.com/did2s/articles/event_study.html" class="sidebar-item-text sidebar-link">Resources on multiple nextGen DID estimators</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://github.com/Mixtape-Sessions" class="sidebar-item-text sidebar-link">Mixtape Seesiosn</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#case-1-common-treatment-time-constant-treatment-effects" id="toc-case-1-common-treatment-time-constant-treatment-effects" class="nav-link active" data-scroll-target="#case-1-common-treatment-time-constant-treatment-effects">Case 1: Common Treatment Time, Constant Treatment Effects</a>
  <ul class="collapse">
  <li><a href="#data-setup" id="toc-data-setup" class="nav-link" data-scroll-target="#data-setup">Data Setup</a>
  <ul class="collapse">
  <li><a href="#define-all-the-years-where-at-least-one-group-is-treated-treatment_years" id="toc-define-all-the-years-where-at-least-one-group-is-treated-treatment_years" class="nav-link" data-scroll-target="#define-all-the-years-where-at-least-one-group-is-treated-treatment_years">1. Define all the years where at least one group is treated (<code>treatment_years</code>)</a></li>
  <li><a href="#define-all-the-treated-groups-treatment_groups" id="toc-define-all-the-treated-groups-treatment_groups" class="nav-link" data-scroll-target="#define-all-the-treated-groups-treatment_groups">2. Define all the treated groups (<code>treatment_groups</code>)</a></li>
  </ul></li>
  <li><a href="#estimate-models" id="toc-estimate-models" class="nav-link" data-scroll-target="#estimate-models">Estimate Models</a></li>
  <li><a href="#summary-of-estimates" id="toc-summary-of-estimates" class="nav-link" data-scroll-target="#summary-of-estimates">Summary of Estimates</a></li>
  </ul></li>
  <li><a href="#case-2-common-treatment-time-dynamic-treatment-effects" id="toc-case-2-common-treatment-time-dynamic-treatment-effects" class="nav-link" data-scroll-target="#case-2-common-treatment-time-dynamic-treatment-effects">Case 2: Common Treatment Time, Dynamic Treatment Effects</a>
  <ul class="collapse">
  <li><a href="#estimate-models-1" id="toc-estimate-models-1" class="nav-link" data-scroll-target="#estimate-models-1">Estimate Models</a></li>
  <li><a href="#summary-of-estimates-1" id="toc-summary-of-estimates-1" class="nav-link" data-scroll-target="#summary-of-estimates-1">Summary of Estimates</a></li>
  </ul></li>
  <li><a href="#case-3-multiple-treatment-periods-and-constant-equal-treatment-effects" id="toc-case-3-multiple-treatment-periods-and-constant-equal-treatment-effects" class="nav-link" data-scroll-target="#case-3-multiple-treatment-periods-and-constant-equal-treatment-effects">Case 3: Multiple Treatment Periods and Constant Equal Treatment Effects</a>
  <ul class="collapse">
  <li><a href="#estimate-models-2" id="toc-estimate-models-2" class="nav-link" data-scroll-target="#estimate-models-2">Estimate Models</a></li>
  <li><a href="#summary-of-estimates-2" id="toc-summary-of-estimates-2" class="nav-link" data-scroll-target="#summary-of-estimates-2">Summary of Estimates</a></li>
  </ul></li>
  <li><a href="#case-4a-multiple-treatment-periods-and-constant-different-treatment-effects" id="toc-case-4a-multiple-treatment-periods-and-constant-different-treatment-effects" class="nav-link" data-scroll-target="#case-4a-multiple-treatment-periods-and-constant-different-treatment-effects">Case 4a: Multiple Treatment Periods and Constant Different Treatment Effects</a>
  <ul class="collapse">
  <li><a href="#estimate-models-3" id="toc-estimate-models-3" class="nav-link" data-scroll-target="#estimate-models-3">Estimate Models</a></li>
  <li><a href="#summary-of-estimates-3" id="toc-summary-of-estimates-3" class="nav-link" data-scroll-target="#summary-of-estimates-3">Summary of Estimates</a></li>
  </ul></li>
  <li><a href="#case-4b-multiple-treatment-periods-and-constant-different-treatment-effects" id="toc-case-4b-multiple-treatment-periods-and-constant-different-treatment-effects" class="nav-link" data-scroll-target="#case-4b-multiple-treatment-periods-and-constant-different-treatment-effects">Case 4b: Multiple Treatment Periods and Constant Different Treatment Effects</a>
  <ul class="collapse">
  <li><a href="#estimate-models-4" id="toc-estimate-models-4" class="nav-link" data-scroll-target="#estimate-models-4">Estimate Models</a></li>
  <li><a href="#summary-of-estimates-4" id="toc-summary-of-estimates-4" class="nav-link" data-scroll-target="#summary-of-estimates-4">Summary of Estimates</a></li>
  </ul></li>
  <li><a href="#case-4c-multiple-treatment-periods-and-constant-different-treatment-effects---never-treated-as-control" id="toc-case-4c-multiple-treatment-periods-and-constant-different-treatment-effects---never-treated-as-control" class="nav-link" data-scroll-target="#case-4c-multiple-treatment-periods-and-constant-different-treatment-effects---never-treated-as-control">Case 4c: Multiple Treatment Periods and Constant Different Treatment Effects - Never Treated as Control</a>
  <ul class="collapse">
  <li><a href="#define-all-the-years-where-at-least-one-group-is-treated-treatment_years-1" id="toc-define-all-the-years-where-at-least-one-group-is-treated-treatment_years-1" class="nav-link" data-scroll-target="#define-all-the-years-where-at-least-one-group-is-treated-treatment_years-1">1. Define all the years where at least one group is treated (<code>treatment_years</code>)</a></li>
  <li><a href="#estimate-models-5" id="toc-estimate-models-5" class="nav-link" data-scroll-target="#estimate-models-5">Estimate Models</a></li>
  <li><a href="#summary-of-estimates-5" id="toc-summary-of-estimates-5" class="nav-link" data-scroll-target="#summary-of-estimates-5">Summary of Estimates</a></li>
  </ul></li>
  <li><a href="#case-5-multiple-treatment-periods-and-constant-dynamic-treatment-effects" id="toc-case-5-multiple-treatment-periods-and-constant-dynamic-treatment-effects" class="nav-link" data-scroll-target="#case-5-multiple-treatment-periods-and-constant-dynamic-treatment-effects">Case 5: Multiple Treatment Periods and Constant Dynamic Treatment Effects</a>
  <ul class="collapse">
  <li><a href="#estimate-models-6" id="toc-estimate-models-6" class="nav-link" data-scroll-target="#estimate-models-6">Estimate Models</a></li>
  <li><a href="#summary-of-estimates-6" id="toc-summary-of-estimates-6" class="nav-link" data-scroll-target="#summary-of-estimates-6">Summary of Estimates</a></li>
  </ul></li>
  <li><a href="#case-6-multiple-treatment-periods-and-heterogeneous-dynamic-treatment-effects" id="toc-case-6-multiple-treatment-periods-and-heterogeneous-dynamic-treatment-effects" class="nav-link" data-scroll-target="#case-6-multiple-treatment-periods-and-heterogeneous-dynamic-treatment-effects">Case 6 : Multiple Treatment Periods and Heterogeneous Dynamic Treatment Effects</a>
  <ul class="collapse">
  <li><a href="#estimate-models-7" id="toc-estimate-models-7" class="nav-link" data-scroll-target="#estimate-models-7">Estimate Models</a></li>
  <li><a href="#summary-of-estimates-7" id="toc-summary-of-estimates-7" class="nav-link" data-scroll-target="#summary-of-estimates-7">Summary of Estimates</a></li>
  </ul></li>
  </ul>
</nav>
    <div class="quarto-margin-footer"><div class="margin-footer-item">
<p><img src="vu-logo.png" class="img-fluid"></p>
</div></div></div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Two-Way Fixed Effects, the Two-Way Mundlak Regression, and Difference-in-Difference Estimators</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>The objective of this posting is to walk through various data structuring and estimation issues for fitting two-way fixed effects, two-way Mundlak regressions, and difference-in-difference estimators.</p>
<p>Note that this is adapted from <code>staggered_6.do</code>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fastDummies)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fixest)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(directlabels)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(did)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">"RStata.StataPath"</span> <span class="ot">=</span> <span class="st">"/Applications/Stata/StataSE.app/Contents/MacOS/stata-se"</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">"RStata.StataVersion"</span> <span class="ot">=</span> <span class="dv">16</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">dplyr.summarise.inform =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>theme_tufte_grid <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">base_size =</span> <span class="dv">16</span>, <span class="at">base_family =</span> <span class="st">"Gill Sans"</span>, <span class="at">ticks =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_family =</span> base_family, <span class="at">base_size =</span> base_size) <span class="sc">+</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.line =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.ticks =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.3</span>),</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">vjust =</span> <span class="fl">0.8</span>),</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.background =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.key =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"plain"</span>),</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.border =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.background =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.background =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>ticks) {</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    ret <span class="ot">&lt;-</span> ret <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">axis.ticks =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>())</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>  ret</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>invthm <span class="ot">&lt;-</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="cn">NA</span>), </span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">colour =</span> <span class="cn">NA</span>),</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"black"</span>),</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"black"</span>),</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">'none'</span>,</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">angle =</span> <span class="dv">360</span>)</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>make_data <span class="ot">&lt;-</span> <span class="cf">function</span>(params, <span class="at">N =</span> <span class="dv">1000</span>, <span class="at">start =</span> <span class="dv">1980</span>, <span class="at">stop =</span> <span class="dv">2015</span>) {</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> params<span class="sc">$</span>mu</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>  mu_t <span class="ot">&lt;-</span> params<span class="sc">$</span>mu_t</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>  tx <span class="ot">=</span> params<span class="sc">$</span>tx</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>  bin <span class="ot">&lt;-</span> params<span class="sc">$</span>bin</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># year fixed effects</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>  year <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> start<span class="sc">:</span>stop,</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">year_fe =</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(start<span class="sc">:</span>stop), <span class="dv">0</span>, <span class="fl">0.5</span>))</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>  df_truth_ <span class="ot">&lt;-</span><span class="fu">suppressWarnings</span>({</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(tx,<span class="sc">~</span>(.x <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>())) <span class="sc">%&gt;%</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"tx"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>      <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">"group"</span>,<span class="st">"state"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>      <span class="fu">suppressMessages</span>(<span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(group)))) <span class="sc">%&gt;%</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>        <span class="fu">map</span>(mu,<span class="sc">~</span>(.x <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>())) <span class="sc">%&gt;%</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>          <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"tx"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>          <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">"group"</span>,<span class="st">"mu"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>          <span class="fu">inner_join</span>(</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>            <span class="fu">map</span>(mu_t,<span class="sc">~</span>(.x <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>())) <span class="sc">%&gt;%</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>              <span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"tx"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>              <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">"group"</span>,<span class="st">"mu_t"</span>)),<span class="st">"group"</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>          ), <span class="fu">c</span>(<span class="st">"group"</span>)</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(group),<span class="fu">as.numeric</span>(<span class="fu">paste0</span>(group)),<span class="cn">NA</span>))</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>  <span class="co"># For dynamic treatment effects</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>  df_truth_t <span class="ot">&lt;-</span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>    <span class="fu">crossing</span>(<span class="at">state =</span> <span class="fu">unique</span>(df_truth_<span class="sc">$</span>state), <span class="at">year =</span> <span class="fu">unique</span>(year<span class="sc">$</span>year)) <span class="sc">%&gt;%</span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(df_truth_,<span class="st">"state"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">rel_time =</span> <span class="fu">pmax</span>(year<span class="sc">-</span>group)) <span class="sc">%&gt;%</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">tau =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(mu) <span class="sc">&amp;</span> rel_time<span class="sc">&gt;=</span><span class="dv">0</span>,mu,<span class="dv">0</span>),</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>           <span class="at">tau_t =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(mu_t) <span class="sc">&amp;</span>rel_time<span class="sc">&gt;=</span><span class="dv">0</span>,mu_t,<span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(group, state) <span class="sc">%&gt;%</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cumtau =</span> tau <span class="sc">+</span> <span class="fu">cumsum</span>(tau_t))   <span class="sc">%&gt;%</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(rel_time) <span class="sc">%&gt;%</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">mu_truth =</span> <span class="fu">mean</span>(cumtau)) <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>()</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>  df_truth <span class="ot">&lt;-</span></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>    <span class="fu">crossing</span>(<span class="at">state =</span> <span class="fu">unique</span>(df_truth_<span class="sc">$</span>state), <span class="at">year =</span> <span class="fu">unique</span>(year<span class="sc">$</span>year)) <span class="sc">%&gt;%</span></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(df_truth_,<span class="st">"state"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">rel_time =</span> <span class="fu">pmax</span>(year<span class="sc">-</span>group)) <span class="sc">%&gt;%</span></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">tau =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(mu) <span class="sc">&amp;</span> rel_time<span class="sc">&gt;=</span><span class="dv">0</span>,mu,<span class="dv">0</span>),</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>           <span class="at">tau_t =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(mu_t) <span class="sc">&amp;</span>rel_time<span class="sc">&gt;=</span><span class="dv">0</span>,mu_t,<span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(group, state) <span class="sc">%&gt;%</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cumtau =</span> tau <span class="sc">+</span> <span class="fu">cumsum</span>(tau_t)) <span class="sc">%&gt;%</span></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">max_time_post =</span> <span class="fu">max</span>(year<span class="sc">-</span>group)) <span class="sc">%&gt;%</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">max_time_post =</span> <span class="fu">min</span>(max_time_post,<span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>    <span class="co">#filter(rel_time &lt;= max_time_post) %&gt;%</span></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(cumtau<span class="sc">&gt;</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(group) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(cumtau)) <span class="sc">%&gt;%</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>      tx <span class="sc">%&gt;%</span> <span class="fu">map_dbl</span>(<span class="sc">~</span>(<span class="fu">length</span>(.x))) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"group"</span>) <span class="sc">%&gt;%</span> <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">"group"</span>,<span class="st">"weight"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(group <span class="sc">!=</span> <span class="st">"NA"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">total_weight =</span> <span class="fu">sum</span>(weight)) <span class="sc">%&gt;%</span></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(group))),</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>      <span class="st">"group"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">mu_truth =</span> mean<span class="sc">*</span>weight<span class="sc">/</span>total_weight) <span class="sc">%&gt;%</span></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">mu_truth =</span> <span class="fu">sum</span>(mu_truth)) <span class="sc">%&gt;%</span></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">rel_time =</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">"Static"</span>)  <span class="sc">%&gt;%</span></span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>      df_truth_t <span class="sc">%&gt;%</span></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">"Dynamic"</span>)</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Units</span></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>  unit <span class="ot">&lt;-</span> </span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(</span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>    <span class="at">unit =</span> <span class="dv">1</span><span class="sc">:</span>N,</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>    <span class="at">unit_fe =</span> <span class="fu">rnorm</span>(N, <span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>    <span class="co"># generate state</span></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>    <span class="at">state =</span> <span class="fu">sample</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>, N<span class="sc">/</span><span class="dv">50</span>), N, <span class="at">replace =</span> <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(</span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>      df_truth_,<span class="fu">c</span>(<span class="st">"state"</span>)</span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">evertreated =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(<span class="fu">as.numeric</span>(group)),<span class="st">"C"</span>,<span class="st">"T"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hat_gamma =</span> mu) <span class="sc">%&gt;%</span></span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hat_gamma_t =</span> mu_t) <span class="sc">%&gt;%</span></span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>    <span class="co"># generate unit specific yearly treatment effects</span></span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">gamma =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, hat_gamma, .<span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">gamma_t =</span> <span class="fu">ifelse</span>(mu_t<span class="sc">!=</span><span class="dv">0</span>,<span class="fu">rnorm</span>(<span class="dv">1</span>,hat_gamma_t,<span class="fl">0.2</span>),<span class="dv">0</span>))</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>  <span class="co"># full interaction of unit X year</span></span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">crossing</span>(unit, year) <span class="sc">%&gt;%</span></span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make error term and get treatment indicators and treatment effects</span></span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">error =</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(.), <span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>           <span class="at">treat =</span> <span class="fu">ifelse</span>(year <span class="sc">&gt;=</span> group <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(group), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>           <span class="at">tau =</span> <span class="fu">ifelse</span>(treat <span class="sc">==</span> <span class="dv">1</span>, gamma, <span class="dv">0</span>),</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>           <span class="at">tau_t =</span> <span class="fu">ifelse</span>(treat<span class="sc">==</span><span class="dv">1</span>,gamma_t,<span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate the dep variable</span></span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(unit) <span class="sc">%&gt;%</span></span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cumtau =</span> tau <span class="sc">+</span> <span class="fu">cumsum</span>(tau_t)) <span class="sc">%&gt;%</span></span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">dep_var =</span> unit_fe <span class="sc">+</span> year_fe <span class="sc">+</span> cumtau <span class="sc">+</span> error) <span class="sc">%&gt;%</span></span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">rel_year =</span> year <span class="sc">-</span> <span class="fu">as.numeric</span>(group)) <span class="sc">%&gt;%</span></span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">rel_year =</span> <span class="fu">ifelse</span>(rel_year <span class="sc">==</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="cn">NA</span>, rel_year))<span class="sc">%&gt;%</span></span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dummy_cols</span>(<span class="at">select_columns =</span> <span class="st">"rel_year"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"rel_year_"</span>), <span class="sc">~</span><span class="fu">replace_na</span>(., <span class="dv">0</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>    <span class="co"># generate pre and post dummies</span></span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Pre =</span> <span class="fu">ifelse</span>((rel_year <span class="sc">&lt;</span> bin[<span class="dv">1</span>]) <span class="sc">*</span> (<span class="sc">!</span><span class="fu">is.na</span>(rel_year)), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>           <span class="at">Post =</span> <span class="fu">ifelse</span>((rel_year <span class="sc">&gt;</span> bin[<span class="dv">2</span>]) <span class="sc">*</span> (<span class="sc">!</span><span class="fu">is.na</span>(rel_year)), <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">bin1 =</span> bin[<span class="dv">1</span>],</span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>           <span class="at">bin2 =</span> bin[<span class="dv">2</span>])</span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>    <span class="at">df =</span> df,</span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>    <span class="at">truth =</span>   df_truth,</span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>    <span class="at">truth_g =</span> df_truth_,</span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>    <span class="at">params =</span> params</span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>  year_range <span class="ot">&lt;-</span> <span class="fu">range</span>(df<span class="sc">$</span>df<span class="sc">$</span>year)</span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>  staggered <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">na.omit</span>(df<span class="sc">$</span>df<span class="sc">$</span>group)))<span class="sc">&gt;</span><span class="dv">1</span>,<span class="st">"Staggered"</span>,<span class="st">"Single Treatment Time"</span>)</span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>  control <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"C"</span> <span class="sc">%in%</span> <span class="fu">unique</span>(df<span class="sc">$</span>df<span class="sc">$</span>evertreated),<span class="cn">TRUE</span>,<span class="cn">FALSE</span>)</span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (control) {</span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>    df_ <span class="ot">&lt;-</span> df<span class="sc">$</span>df <span class="sc">%&gt;%</span></span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">ifelse</span>(evertreated<span class="sc">==</span><span class="st">"C"</span>,<span class="st">"Never Treated"</span>,<span class="fu">paste0</span>(group)))</span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>    df_ <span class="ot">&lt;-</span> df<span class="sc">$</span>df</span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>  unique_groups <span class="ot">&lt;-</span> <span class="fu">unique</span>(df_<span class="sc">$</span>group)</span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a>  colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#A7473A"</span>,<span class="st">"#4B5F6C"</span>,<span class="st">"#51806a"</span>)[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(unique_groups)]</span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(colors) <span class="ot">=</span> <span class="fu">unique</span>(df_<span class="sc">$</span>group)</span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a>  df_vline <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>({</span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">group =</span> <span class="fu">unique</span>(df_<span class="sc">$</span>group),<span class="at">xintercept =</span> <span class="fu">unique</span>(<span class="fu">as.numeric</span>(df_<span class="sc">$</span>group)) <span class="sc">-</span> <span class="fl">0.5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">color =</span> colors[<span class="fu">factor</span>(group)])</span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">suppressWarnings</span>({</span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a>    df_ <span class="sc">%&gt;%</span></span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> dep_var)) <span class="sc">+</span></span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a>      <span class="co"># unit specific lines</span></span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>, <span class="at">color =</span> <span class="st">"grey"</span>,<span class="fu">aes</span>(<span class="at">group =</span> unit)) <span class="sc">+</span></span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>      <span class="co"># group specific averages</span></span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(</span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> . <span class="sc">%&gt;%</span></span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a>          <span class="fu">group_by</span>(group, year) <span class="sc">%&gt;%</span></span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a>          <span class="fu">summarize</span>(<span class="at">dep_var =</span> <span class="fu">mean</span>(dep_var)) ,</span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a>        <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> dep_var, <span class="at">group =</span> <span class="fu">factor</span>(group),</span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="fu">factor</span>(group)), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">color =</span> <span class="st">"Group"</span>) <span class="sc">+</span></span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_vline</span>(<span class="at">data =</span> df_vline, <span class="fu">aes</span>(<span class="at">xintercept =</span> xintercept, <span class="at">color =</span> <span class="fu">factor</span>(group)),<span class="at">linetype=</span><span class="st">"dashed"</span>,<span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a>      ggsci<span class="sc">::</span><span class="fu">scale_color_aaas</span>()<span class="sc">+</span></span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_dl</span>(<span class="at">data =</span></span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a>                . <span class="sc">%&gt;%</span></span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a>                <span class="fu">group_by</span>(group, year) <span class="sc">%&gt;%</span></span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a>                <span class="fu">summarize</span>(<span class="at">dep_var =</span> <span class="fu">mean</span>(dep_var)), <span class="at">method =</span> <span class="st">"last.bumpup"</span>,<span class="fu">aes</span>(<span class="at">label =</span> group)) <span class="sc">+</span></span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a>      <span class="co">#labs(subtitle = expression(paste("Staggered + Dynamic/Unequal ", tau))) +</span></span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a>      <span class="co"># theme_clean() + theme(plot.background = element_blank()) +</span></span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a>      <span class="co"># theme(legend.position = 'none',</span></span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a>      <span class="co">#       legend.title = element_blank(),</span></span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a>      <span class="co">#       plot.title = element_text(hjust = 0.5),</span></span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a>      <span class="co">#       plot.subtitle = element_text(hjust = 0.5),</span></span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a>      <span class="co">#       axis.title.y = element_text(hjust = 0.5, vjust = 0.5, angle = 360))+</span></span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> year_range) <span class="sc">+</span> </span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.25</span>,<span class="dv">0</span>)) <span class="sc">+</span> invthm</span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="case-1-common-treatment-time-constant-treatment-effects" class="level1">
<h1>Case 1: Common Treatment Time, Constant Treatment Effects</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>params1 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu =</span> <span class="fu">list</span>(<span class="st">"1998"</span> <span class="ot">=</span> <span class="dv">2</span>),</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu_t =</span> <span class="fu">list</span>(<span class="st">"1998"</span> <span class="ot">=</span> <span class="dv">0</span>),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">tx =</span> <span class="fu">list</span>(<span class="st">"1998"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">"NA"</span> <span class="ot">=</span> <span class="dv">26</span><span class="sc">:</span><span class="dv">50</span>),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">bin =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">5</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">make_data</span>(params1,<span class="at">N=</span><span class="dv">200</span>) </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>data1 <span class="ot">&lt;-</span> df1<span class="sc">$</span>df <span class="sc">%&gt;%</span> </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dep_var,<span class="at">treatment_time =</span> group, state,unit, year, treat) <span class="sc">%&gt;%</span> </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(treatment_time, year), factor)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_data</span>(df1) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="twfe-twm-and-did_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> data1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="data-setup" class="level2">
<h2 class="anchored" data-anchor-id="data-setup">Data Setup</h2>
<p>Figure <a href="#fig-df-raw">Figure&nbsp;1</a> shows the first five rows of the raw data frame.</p>
<ul>
<li><code>dep_var</code> is the outcome</li>
<li><code>treatment_time</code> is the treatment group indicator set to the first treatment year for those treated, and set to missing for nontreated units.</li>
<li><code>state</code> is the state of residence for the underlying unit.</li>
<li><code>unit</code> is the individual unit identifier</li>
<li><code>year</code> is the time variable</li>
<li><code>treat</code> takes a value of 1 if the unit is treated and the observation is in the post-treatment period.</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n=</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"400px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-df-raw" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:400px; overflow-x: scroll; width:100%; ">

<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
dep_var
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
treatment_time
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
state
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
unit
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
year
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
treat
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0.1832233
</td>
<td style="text-align:left;">
1998
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1980
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
0.0480280
</td>
<td style="text-align:left;">
1998
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1981
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
1.0665383
</td>
<td style="text-align:left;">
1998
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1982
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
0.4692419
</td>
<td style="text-align:left;">
1998
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1983
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
1.0057100
</td>
<td style="text-align:left;">
1998
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1984
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>

</table>
</div>
<p></p><figcaption class="figure-caption">Figure 1: First five rows of data</figcaption><p></p>
</figure>
</div>
</div>
<p>We next need to construct a series of dummy indicators</p>
<ol type="1">
<li>Define all the years where at least one group is treated (<code>treatment_years</code>)</li>
<li>Define all the treated groups (<code>treatment_groups</code>)</li>
</ol>
<section id="define-all-the-years-where-at-least-one-group-is-treated-treatment_years" class="level3">
<h3 class="anchored" data-anchor-id="define-all-the-years-where-at-least-one-group-is-treated-treatment_years">1. Define all the years where at least one group is treated (<code>treatment_years</code>)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>treatment_years <span class="ot">&lt;-</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(treat, year) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(treat<span class="sc">==</span> <span class="dv">1</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.vector</span>()</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>treatment_years</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "1998" "1999" "2000" "2001" "2002" "2003" "2004" "2005" "2006" "2007"
[11] "2008" "2009" "2010" "2011" "2012" "2013" "2014" "2015"</code></pre>
</div>
</div>
</section>
<section id="define-all-the-treated-groups-treatment_groups" class="level3">
<h3 class="anchored" data-anchor-id="define-all-the-treated-groups-treatment_groups">2. Define all the treated groups (<code>treatment_groups</code>)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>treatment_groups <span class="ot">&lt;-</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>(df[df<span class="sc">$</span>treatment_time <span class="sc">!=</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>treatment_time),]<span class="sc">$</span>treatment_time) <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>()</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>treatment_groups</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1998"</code></pre>
</div>
</div>
<p>We will next structure the model matrix to fit the regression models. This involves:</p>
<ol type="1">
<li><p>Creating dummy variables for all treatment times, but limiting the final set to only those times identified by <code>treatment_times</code> above.</p></li>
<li><p>Creating dummy variables for all treatment groups.</p></li>
</ol>
<p>We will also prefix all dummy variables created in (1) with <code>f</code> and those created in (2) with <code>d</code>. Figure <a href="#fig-df-model-matrix">Figure&nbsp;2</a> shows the final data frame used for the regressions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df_ <span class="ot">&lt;-</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(treatment_time),<span class="dv">0</span>,<span class="fu">as.numeric</span>(<span class="fu">paste0</span>(treatment_time)))) <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">y =</span> dep_var,<span class="at">w =</span> treat, <span class="at">id =</span> unit,year, treatment_time) <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  fastDummies<span class="sc">::</span><span class="fu">dummy_cols</span>(<span class="fu">c</span>(<span class="st">"year"</span>,<span class="st">"treatment_time"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_at</span>(<span class="fu">vars</span>(y,w,id,year,<span class="fu">glue</span>(<span class="st">"year_{treatment_years}"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.vector</span>(),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">glue</span>(<span class="st">"treatment_time_{treatment_groups}"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_at</span>(<span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">"year_"</span>)),<span class="sc">~</span><span class="fu">gsub</span>(<span class="st">"year_"</span>,<span class="st">"f"</span>,.)) <span class="sc">%&gt;%</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_at</span>(<span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">"treatment_time_"</span>)),<span class="sc">~</span><span class="fu">gsub</span>(<span class="st">"treatment_time_"</span>,<span class="st">"d"</span>,.))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df_ <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n=</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"300px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-df-model-matrix" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:300px; overflow-x: scroll; width:100%; ">

<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
y
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
w
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
id
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
year
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f1998
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f1999
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2000
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2001
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2002
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2003
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2004
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2005
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2006
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2007
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2008
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2009
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2010
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2011
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2012
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2013
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2014
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
f2015
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
d1998
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0.1832233
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1980
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
0.0480280
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1981
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1.0665383
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1982
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
0.4692419
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1983
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1.0057100
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1984
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>

</table>
</div>
<p></p><figcaption class="figure-caption">Figure 2: First five rows of data</figcaption><p></p>
</figure>
</div>
</div>
</section>
</section>
<section id="estimate-models" class="level2">
<h2 class="anchored" data-anchor-id="estimate-models">Estimate Models</h2>
<p>We next estimate the models</p>
<table class="table">
<colgroup>
<col style="width: 29%">
<col style="width: 14%">
<col style="width: 24%">
<col style="width: 31%">
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>Command</th>
<th>Design Variables</th>
<th>Fixed or Random Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Two-Way Fixed Effects</td>
<td><code>feols()</code></td>
<td><code>w</code> + <code>f*</code></td>
<td>Unit Fixed Effect</td>
</tr>
<tr class="even">
<td>Pooled OLS</td>
<td><code>lm()</code></td>
<td><code>w</code> + <code>f*</code> + <code>d*</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Two-Way Mundlak</td>
<td><code>lmer()</code></td>
<td><code>w</code> + <code>f*</code> + <code>d*</code></td>
<td>Unit Random Effect</td>
</tr>
</tbody>
</table>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># TWFE</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>fmla_twfe1 <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"y ~ w + {paste0('f',treatment_years,collapse= '+')} | id "</span>) <span class="sc">%&gt;%</span> <span class="fu">as.formula</span>()</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>fit_twfe1 <span class="ot">&lt;-</span> <span class="fu">feols</span>(fmla_twfe1, <span class="at">data =</span> df_)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>est_twfe1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">method =</span> <span class="st">"TWFE"</span>, <span class="at">estimate =</span> <span class="fu">coef</span>(fit_twfe1)[<span class="st">"w"</span>], <span class="at">formula =</span> <span class="fu">glue</span>(<span class="st">"feols({Reduce(paste,deparse(fmla_twfe1))}, data = df_)"</span>))</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternative version based on a standard TWFE regression. </span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>fmla_twfe1_v2 <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"y ~ w + factor(year) | id "</span>) <span class="sc">%&gt;%</span> <span class="fu">as.formula</span>()</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>fit_twfe1_v2 <span class="ot">&lt;-</span> <span class="fu">feols</span>(fmla_twfe1_v2, <span class="at">data =</span> df_) </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>est_twfe1_v2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">method =</span> <span class="st">"TWFE-V2"</span>, <span class="at">estimate =</span> <span class="fu">coef</span>(fit_twfe1_v2)[<span class="st">"w"</span>], <span class="at">formula =</span> <span class="fu">glue</span>(<span class="st">"feols({Reduce(paste,deparse(fmla_twfe1_v2))}, data = df_)"</span>))</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co"># POLS</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>fmla_lm1 <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"y ~ w + {paste0('f',treatment_years,collapse= '+')} + {paste0('d',treatment_groups,collapse= '+')}"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.formula</span>()</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>fit_lm1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(fmla_lm1, <span class="at">data =</span> df_) </span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>est_lm1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">method =</span> <span class="st">"POLS"</span>, <span class="at">estimate =</span> <span class="fu">coef</span>(fit_lm1)[<span class="st">"w"</span>], <span class="at">formula =</span> <span class="fu">glue</span>(<span class="st">"lm({Reduce(paste,deparse(fmla_lm1))}, data = df_)"</span>))</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co"># TWM </span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>fmla_twm1 <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"y ~ w + {paste0('f',treatment_years,collapse= '+')} + {paste0('d',treatment_groups,collapse= '+')} + (1|id)"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.formula</span>()</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>fit_twm1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>( fmla_twm1 , <span class="at">data =</span> df_) </span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>est_twm1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">method =</span> <span class="st">"TWM"</span>, <span class="at">estimate =</span> <span class="fu">coef</span>(<span class="fu">summary</span>(fit_twm1))[<span class="st">"w"</span>,][<span class="dv">1</span>] <span class="sc">%&gt;%</span> <span class="fu">unname</span>(), <span class="at">formula =</span> <span class="fu">glue</span>(<span class="st">"lmer({Reduce(paste,deparse(fmla_twm1))}, data = df_)"</span>))</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co"># CS</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>data1_cs <span class="ot">&lt;-</span> </span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  data1 <span class="sc">%&gt;%</span> </span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(year)),</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">treatment_time =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(treatment_time)))  <span class="sc">%&gt;%</span> </span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(treatment_time),<span class="dv">0</span>,treatment_time))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_mutate(quo): NAs introduced by coercion</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>fit_cs1 <span class="ot">&lt;-</span> <span class="fu">att_gt</span>(<span class="at">yname =</span> <span class="st">"dep_var"</span>,</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">tname =</span> <span class="st">"year"</span>,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">idname =</span> <span class="st">"unit"</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">gname =</span> <span class="st">"treatment_time"</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">control_group =</span> <span class="st">"notyettreated"</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> data1_cs</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>est_cs1 <span class="ot">&lt;-</span>  <span class="fu">tibble</span>(<span class="at">group =</span> <span class="fu">paste0</span>(fit_cs1<span class="sc">$</span>group), <span class="at">year =</span> fit_cs1<span class="sc">$</span>t, <span class="at">estimate =</span> fit_cs1<span class="sc">$</span>att) <span class="sc">%&gt;%</span> </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"CS"</span>) </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">method =</span> <span class="fu">c</span>(<span class="st">"TWFE"</span>,<span class="st">"TWFE-V2"</span>,<span class="st">"POLS"</span>,<span class="st">"TWM"</span>),</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">formula =</span> <span class="fu">c</span>(<span class="fu">glue</span>(<span class="st">"feols({Reduce(paste,deparse(fmla_twfe1))}, data = df_)"</span>),</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">glue</span>(<span class="st">"feols({Reduce(paste,deparse(fmla_twfe1_v2))}, data = df_)"</span>),</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">glue</span>(<span class="st">"lm({Reduce(paste,deparse(fmla_lm1))}, data = df_)"</span>),</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">glue</span>(<span class="st">"lmer({Reduce(paste,deparse(fmla_twm1))}, data = df_)"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(<span class="st">"method"</span> <span class="ot">=</span> <span class="st">"Estimator"</span>,</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>             <span class="st">"formula"</span> <span class="ot">=</span> <span class="st">"Regression Call"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="voxbdjkcvt" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#voxbdjkcvt .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#voxbdjkcvt .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#voxbdjkcvt .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#voxbdjkcvt .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#voxbdjkcvt .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#voxbdjkcvt .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#voxbdjkcvt .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#voxbdjkcvt .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#voxbdjkcvt .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#voxbdjkcvt .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#voxbdjkcvt .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#voxbdjkcvt .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#voxbdjkcvt .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#voxbdjkcvt .gt_from_md > :first-child {
  margin-top: 0;
}

#voxbdjkcvt .gt_from_md > :last-child {
  margin-bottom: 0;
}

#voxbdjkcvt .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#voxbdjkcvt .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#voxbdjkcvt .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#voxbdjkcvt .gt_row_group_first td {
  border-top-width: 2px;
}

#voxbdjkcvt .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#voxbdjkcvt .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#voxbdjkcvt .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#voxbdjkcvt .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#voxbdjkcvt .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#voxbdjkcvt .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#voxbdjkcvt .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#voxbdjkcvt .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#voxbdjkcvt .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#voxbdjkcvt .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#voxbdjkcvt .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#voxbdjkcvt .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#voxbdjkcvt .gt_left {
  text-align: left;
}

#voxbdjkcvt .gt_center {
  text-align: center;
}

#voxbdjkcvt .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#voxbdjkcvt .gt_font_normal {
  font-weight: normal;
}

#voxbdjkcvt .gt_font_bold {
  font-weight: bold;
}

#voxbdjkcvt .gt_font_italic {
  font-style: italic;
}

#voxbdjkcvt .gt_super {
  font-size: 65%;
}

#voxbdjkcvt .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#voxbdjkcvt .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#voxbdjkcvt .gt_indent_1 {
  text-indent: 5px;
}

#voxbdjkcvt .gt_indent_2 {
  text-indent: 10px;
}

#voxbdjkcvt .gt_indent_3 {
  text-indent: 15px;
}

#voxbdjkcvt .gt_indent_4 {
  text-indent: 20px;
}

#voxbdjkcvt .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Estimator</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Regression Call</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">TWFE</td>
<td class="gt_row gt_left">feols(y ~ w + f1998 + f1999 + f2000 + f2001 + f2002 + f2003 + f2004 +      f2005 + f2006 + f2007 + f2008 + f2009 + f2010 + f2011 + f2012 +      f2013 + f2014 + f2015 | id, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">TWFE-V2</td>
<td class="gt_row gt_left">feols(y ~ w + factor(year) | id, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">POLS</td>
<td class="gt_row gt_left">lm(y ~ w + f1998 + f1999 + f2000 + f2001 + f2002 + f2003 + f2004 +      f2005 + f2006 + f2007 + f2008 + f2009 + f2010 + f2011 + f2012 +      f2013 + f2014 + f2015 + d1998, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">TWM</td>
<td class="gt_row gt_left">lmer(y ~ w + f1998 + f1999 + f2000 + f2001 + f2002 + f2003 + f2004 +      f2005 + f2006 + f2007 + f2008 + f2009 + f2010 + f2011 + f2012 +      f2013 + f2014 + f2015 + d1998 + (1 | id), data = df_)</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</section>
<section id="summary-of-estimates" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-estimates">Summary of Estimates</h2>
<p>Table <a href="#fig-sum-case1">Figure&nbsp;3</a> summarizes the treatment effect estimates across all three approaches. These estimates are also plotted as lines in <a href="#fig-plot-case1">Figure&nbsp;4</a>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>est1 <span class="ot">&lt;-</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  est_twfe1 <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est_twfe1_v2) <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est_lm1) <span class="sc">%&gt;%</span> </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est_twm1) </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>est1 <span class="sc">%&gt;%</span> </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>formula) <span class="sc">%&gt;%</span> </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="st">"Intervention"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(method,estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">truth =</span> df1<span class="sc">$</span>truth <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type<span class="sc">==</span><span class="st">"Static"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(mu_truth))  <span class="sc">%&gt;%</span> </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">c</span>(TWFE,<span class="st">`</span><span class="at">TWFE-V2</span><span class="st">`</span>,TWM, POLS),<span class="at">decimals=</span><span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(<span class="st">"group"</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>             <span class="st">"truth"</span><span class="ot">=</span> <span class="st">"Truth"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-sum-case1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div id="ysolqpgmnr" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ysolqpgmnr .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ysolqpgmnr .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ysolqpgmnr .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ysolqpgmnr .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ysolqpgmnr .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ysolqpgmnr .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ysolqpgmnr .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ysolqpgmnr .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ysolqpgmnr .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ysolqpgmnr .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ysolqpgmnr .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ysolqpgmnr .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#ysolqpgmnr .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ysolqpgmnr .gt_from_md > :first-child {
  margin-top: 0;
}

#ysolqpgmnr .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ysolqpgmnr .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ysolqpgmnr .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ysolqpgmnr .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ysolqpgmnr .gt_row_group_first td {
  border-top-width: 2px;
}

#ysolqpgmnr .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ysolqpgmnr .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ysolqpgmnr .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ysolqpgmnr .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ysolqpgmnr .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ysolqpgmnr .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ysolqpgmnr .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ysolqpgmnr .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ysolqpgmnr .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ysolqpgmnr .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ysolqpgmnr .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ysolqpgmnr .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ysolqpgmnr .gt_left {
  text-align: left;
}

#ysolqpgmnr .gt_center {
  text-align: center;
}

#ysolqpgmnr .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ysolqpgmnr .gt_font_normal {
  font-weight: normal;
}

#ysolqpgmnr .gt_font_bold {
  font-weight: bold;
}

#ysolqpgmnr .gt_font_italic {
  font-style: italic;
}

#ysolqpgmnr .gt_super {
  font-size: 65%;
}

#ysolqpgmnr .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#ysolqpgmnr .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ysolqpgmnr .gt_indent_1 {
  text-indent: 5px;
}

#ysolqpgmnr .gt_indent_2 {
  text-indent: 10px;
}

#ysolqpgmnr .gt_indent_3 {
  text-indent: 15px;
}

#ysolqpgmnr .gt_indent_4 {
  text-indent: 20px;
}

#ysolqpgmnr .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col"></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">POLS</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWFE</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWFE-V2</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWM</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">Truth</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">Intervention</td>
<td class="gt_row gt_right">1.983</td>
<td class="gt_row gt_right">1.983</td>
<td class="gt_row gt_right">1.983</td>
<td class="gt_row gt_right">1.983</td>
<td class="gt_row gt_right">2</td></tr>
  </tbody>
  
  
</table>
</div>
<p></p><figcaption class="figure-caption">Figure 3: Summary of Estimates - Common Treatment Time, Constant Treatment Effects</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df_est1 <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">group=</span> treatment_groups, <span class="at">year =</span> treatment_years) <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">mutate</span>(<span class="at">tmp =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">left_join</span>(est1 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">tmp=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(year))) <span class="sc">%&gt;%</span> </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est_cs1 )</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_data</span>(df1) <span class="sc">+</span> </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df_est1, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> estimate, <span class="at">colour =</span> <span class="fu">factor</span>(group),<span class="at">lty=</span><span class="fu">factor</span>(method)), <span class="at">lwd=</span><span class="dv">2</span>)  <span class="sc">+</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"bottom"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot-case1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="twfe-twm-and-did_files/figure-html/fig-plot-case1-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 4: Treatment Effect Estimates</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="case-2-common-treatment-time-dynamic-treatment-effects" class="level1">
<h1>Case 2: Common Treatment Time, Dynamic Treatment Effects</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>params2<span class="ot">=</span>  <span class="fu">list</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu =</span> <span class="fu">list</span>(<span class="st">"1998"</span> <span class="ot">=</span> <span class="dv">0</span>),</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu_t =</span> <span class="fu">list</span>(<span class="st">"1998"</span> <span class="ot">=</span> <span class="fl">0.3</span>),</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">tx =</span> <span class="fu">list</span>(<span class="st">"1998"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">"NA"</span> <span class="ot">=</span> <span class="dv">26</span><span class="sc">:</span><span class="dv">50</span>),</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">bin =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">5</span>))</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">make_data</span>(params2,<span class="at">N=</span><span class="dv">200</span>) </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>data2 <span class="ot">&lt;-</span> df2<span class="sc">$</span>df <span class="sc">%&gt;%</span> </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dep_var,<span class="at">treatment_time =</span> group, state,unit, year, treat) <span class="sc">%&gt;%</span> </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(treatment_time, year), factor)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_data</span>(df2) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="twfe-twm-and-did_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>treatment_years2 <span class="ot">&lt;-</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  data2 <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(treat, year) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(treat<span class="sc">==</span> <span class="dv">1</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.vector</span>()</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>treatment_groups2 <span class="ot">&lt;-</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>(data2[data2<span class="sc">$</span>treatment_time <span class="sc">!=</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(data2<span class="sc">$</span>treatment_time),]<span class="sc">$</span>treatment_time) <span class="sc">%&gt;%</span> </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>()</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>df_ <span class="ot">&lt;-</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  data2 <span class="sc">%&gt;%</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(treatment_time),<span class="dv">0</span>,<span class="fu">as.numeric</span>(<span class="fu">paste0</span>(treatment_time)))) <span class="sc">%&gt;%</span> </span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">y =</span> dep_var,<span class="at">w =</span> treat, <span class="at">id =</span> unit,year, treatment_time) <span class="sc">%&gt;%</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  fastDummies<span class="sc">::</span><span class="fu">dummy_cols</span>(<span class="fu">c</span>(<span class="st">"year"</span>,<span class="st">"treatment_time"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_at</span>(<span class="fu">vars</span>(y,w,id,year,<span class="fu">glue</span>(<span class="st">"year_{treatment_years2}"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.vector</span>(),</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">glue</span>(<span class="st">"treatment_time_{treatment_groups2}"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_at</span>(<span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">"year_"</span>)),<span class="sc">~</span><span class="fu">gsub</span>(<span class="st">"year_"</span>,<span class="st">"f"</span>,.)) <span class="sc">%&gt;%</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_at</span>(<span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">"treatment_time_"</span>)),<span class="sc">~</span><span class="fu">gsub</span>(<span class="st">"treatment_time_"</span>,<span class="st">"d"</span>,.))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="estimate-models-1" class="level2">
<h2 class="anchored" data-anchor-id="estimate-models-1">Estimate Models</h2>
<p>We next estimate the models</p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>Command</th>
<th>Design Variables</th>
<th>Fixed or Random Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Two-Way Fixed Effects</td>
<td><code>feols()</code></td>
<td><code>w : f*</code> + <code>f*</code></td>
<td>Unit Fixed Effect</td>
</tr>
<tr class="even">
<td>Pooled OLS</td>
<td><code>lm()</code></td>
<td><code>w : f*</code> + <code>f*</code> + <code>d*</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Two-Way Mundlak</td>
<td><code>lmer()</code></td>
<td><code>w : f*</code> + <code>f*</code> + <code>d*</code></td>
<td>Unit Random Effect</td>
</tr>
</tbody>
</table>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>fmla_twfe2 <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"y ~ {paste0('w : ',paste0('f',treatment_years2), collapse = ' + ')} + {paste0('f',treatment_years2,collapse=' + ')} | id"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.formula</span>()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>fit_twfe2 <span class="ot">&lt;-</span> <span class="fu">feols</span>(fmla_twfe2, <span class="at">data =</span> df_)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>fmla_lm2 <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"y ~ {paste0('w : ',paste0('f',treatment_years2), collapse = ' + ')} + {paste0('f',treatment_years2,collapse=' + ')} + {paste0('d',treatment_groups2,collapse= '+')}"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.formula</span>()</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>fit_lm2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(fmla_lm2, <span class="at">data =</span> df_) </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>fmla_twm2 <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"y ~ {paste0('w : ',paste0('f',treatment_years2), collapse = ' + ')} + {paste0('f',treatment_years2,collapse=' + ')} + {paste0('d',treatment_groups2,collapse= '+')} + (1|id)"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.formula</span>()</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>fit_twm2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>( fmla_twm2 , <span class="at">data =</span> df_) </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co"># CS</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>data2_cs <span class="ot">&lt;-</span> </span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  data2 <span class="sc">%&gt;%</span> </span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(year)),</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">treatment_time =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(treatment_time)))  <span class="sc">%&gt;%</span> </span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(treatment_time),<span class="dv">0</span>,treatment_time))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_mutate(quo): NAs introduced by coercion</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>fit_cs2 <span class="ot">&lt;-</span> <span class="fu">att_gt</span>(<span class="at">yname =</span> <span class="st">"dep_var"</span>,</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">tname =</span> <span class="st">"year"</span>,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">idname =</span> <span class="st">"unit"</span>,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">gname =</span> <span class="st">"treatment_time"</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">control_group =</span> <span class="st">"notyettreated"</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> data2_cs</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>est_cs2 <span class="ot">&lt;-</span>  <span class="fu">tibble</span>(<span class="at">group =</span> <span class="fu">paste0</span>(fit_cs2<span class="sc">$</span>group), <span class="at">year =</span> fit_cs2<span class="sc">$</span>t, <span class="at">estimate =</span> fit_cs2<span class="sc">$</span>att) <span class="sc">%&gt;%</span> </span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"CS"</span>)  </span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">method =</span> <span class="fu">c</span>(<span class="st">"TWFE"</span>,<span class="st">"POLS"</span>,<span class="st">"TWM"</span>),</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">formula =</span> <span class="fu">c</span>(<span class="fu">glue</span>(<span class="st">"feols({Reduce(paste,deparse(fmla_twfe2))}, data = df_)"</span>),</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">glue</span>(<span class="st">"lm({Reduce(paste,deparse(fmla_lm2))}, data = df_)"</span>),</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">glue</span>(<span class="st">"lmer({Reduce(paste,deparse(fmla_twm2))}, data = df_)"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(<span class="st">"method"</span> <span class="ot">=</span> <span class="st">"Estimator"</span>,</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>             <span class="st">"formula"</span> <span class="ot">=</span> <span class="st">"Regression Call"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="cueyqyprtn" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#cueyqyprtn .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#cueyqyprtn .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cueyqyprtn .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#cueyqyprtn .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#cueyqyprtn .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cueyqyprtn .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cueyqyprtn .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#cueyqyprtn .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#cueyqyprtn .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#cueyqyprtn .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#cueyqyprtn .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#cueyqyprtn .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#cueyqyprtn .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#cueyqyprtn .gt_from_md > :first-child {
  margin-top: 0;
}

#cueyqyprtn .gt_from_md > :last-child {
  margin-bottom: 0;
}

#cueyqyprtn .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#cueyqyprtn .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#cueyqyprtn .gt_row_group_first td {
  border-top-width: 2px;
}

#cueyqyprtn .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#cueyqyprtn .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#cueyqyprtn .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cueyqyprtn .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#cueyqyprtn .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#cueyqyprtn .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cueyqyprtn .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cueyqyprtn .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cueyqyprtn .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_left {
  text-align: left;
}

#cueyqyprtn .gt_center {
  text-align: center;
}

#cueyqyprtn .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#cueyqyprtn .gt_font_normal {
  font-weight: normal;
}

#cueyqyprtn .gt_font_bold {
  font-weight: bold;
}

#cueyqyprtn .gt_font_italic {
  font-style: italic;
}

#cueyqyprtn .gt_super {
  font-size: 65%;
}

#cueyqyprtn .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#cueyqyprtn .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#cueyqyprtn .gt_indent_1 {
  text-indent: 5px;
}

#cueyqyprtn .gt_indent_2 {
  text-indent: 10px;
}

#cueyqyprtn .gt_indent_3 {
  text-indent: 15px;
}

#cueyqyprtn .gt_indent_4 {
  text-indent: 20px;
}

#cueyqyprtn .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Estimator</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Regression Call</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">TWFE</td>
<td class="gt_row gt_left">feols(y ~ w:f1998 + w:f1999 + w:f2000 + w:f2001 + w:f2002 + w:f2003 +      w:f2004 + w:f2005 + w:f2006 + w:f2007 + w:f2008 + w:f2009 +      w:f2010 + w:f2011 + w:f2012 + w:f2013 + w:f2014 + w:f2015 +      f1998 + f1999 + f2000 + f2001 + f2002 + f2003 + f2004 + f2005 +      f2006 + f2007 + f2008 + f2009 + f2010 + f2011 + f2012 + f2013 +      f2014 + f2015 | id, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">POLS</td>
<td class="gt_row gt_left">lm(y ~ w:f1998 + w:f1999 + w:f2000 + w:f2001 + w:f2002 + w:f2003 +      w:f2004 + w:f2005 + w:f2006 + w:f2007 + w:f2008 + w:f2009 +      w:f2010 + w:f2011 + w:f2012 + w:f2013 + w:f2014 + w:f2015 +      f1998 + f1999 + f2000 + f2001 + f2002 + f2003 + f2004 + f2005 +      f2006 + f2007 + f2008 + f2009 + f2010 + f2011 + f2012 + f2013 +      f2014 + f2015 + d1998, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">TWM</td>
<td class="gt_row gt_left">lmer(y ~ w:f1998 + w:f1999 + w:f2000 + w:f2001 + w:f2002 + w:f2003 +      w:f2004 + w:f2005 + w:f2006 + w:f2007 + w:f2008 + w:f2009 +      w:f2010 + w:f2011 + w:f2012 + w:f2013 + w:f2014 + w:f2015 +      f1998 + f1999 + f2000 + f2001 + f2002 + f2003 + f2004 + f2005 +      f2006 + f2007 + f2008 + f2009 + f2010 + f2011 + f2012 + f2013 +      f2014 + f2015 + d1998 + (1 | id), data = df_)</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</section>
<section id="summary-of-estimates-1" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-estimates-1">Summary of Estimates</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>est_twfe2 <span class="ot">&lt;-</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  fit_twfe2 <span class="sc">%&gt;%</span> <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"TWFE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">call =</span> <span class="fu">glue</span>(<span class="st">"feols({Reduce(paste,deparse(fmla_twfe2))}, data = df_)"</span>))</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>est_lm2 <span class="ot">&lt;-</span> </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  fit_lm2 <span class="sc">%&gt;%</span> <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">call =</span> <span class="fu">glue</span>(<span class="st">"lm({Reduce(paste,deparse(fmla_lm2))}, data = df_)"</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"POLS"</span>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>est_twm2 <span class="ot">&lt;-</span> </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  fit_twm2  <span class="sc">%&gt;%</span> <span class="fu">summary</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"term"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"TWM"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">call =</span> <span class="fu">glue</span>(<span class="st">"lmer({Reduce(paste,deparse(fmla_twm2))}, data = df_)"</span>))</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>est2 <span class="ot">&lt;-</span> </span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  est_twfe2 <span class="sc">%&gt;%</span> </span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est_lm2) <span class="sc">%&gt;%</span> </span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est_twm2) <span class="sc">%&gt;%</span> </span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"^w:"</span>,term)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(term,<span class="at">into=</span><span class="fu">c</span>(<span class="st">"tmp"</span>,<span class="st">"year"</span>), <span class="at">sep =</span> <span class="st">":"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">gsub</span>(<span class="st">"f"</span>,<span class="st">""</span>,year)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(year))) <span class="sc">%&gt;%</span> </span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>tmp) <span class="sc">%&gt;%</span> </span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est_cs2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(group))) <span class="sc">%&gt;%</span> </span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>group)</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>df_est2 <span class="ot">&lt;-</span> </span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(<span class="at">group=</span> treatment_groups, <span class="at">year =</span> treatment_years) <span class="sc">%&gt;%</span> </span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(year))) <span class="sc">%&gt;%</span> </span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(est2, <span class="st">"year"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(year))) </span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>df_est2 <span class="sc">%&gt;%</span> </span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year,estimate,method) <span class="sc">%&gt;%</span> </span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(method,estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year,TWFE,POLS,TWM, CS) <span class="sc">%&gt;%</span> </span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns=</span><span class="fu">c</span>(TWFE,POLS,TWM,CS),<span class="at">decimals=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-sum-case2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div id="ftgjihjymh" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ftgjihjymh .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ftgjihjymh .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ftgjihjymh .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ftgjihjymh .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ftgjihjymh .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ftgjihjymh .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ftgjihjymh .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ftgjihjymh .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ftgjihjymh .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ftgjihjymh .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ftgjihjymh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ftgjihjymh .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#ftgjihjymh .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ftgjihjymh .gt_from_md > :first-child {
  margin-top: 0;
}

#ftgjihjymh .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ftgjihjymh .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ftgjihjymh .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ftgjihjymh .gt_row_group_first td {
  border-top-width: 2px;
}

#ftgjihjymh .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ftgjihjymh .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ftgjihjymh .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ftgjihjymh .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ftgjihjymh .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ftgjihjymh .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ftgjihjymh .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ftgjihjymh .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ftgjihjymh .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_left {
  text-align: left;
}

#ftgjihjymh .gt_center {
  text-align: center;
}

#ftgjihjymh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ftgjihjymh .gt_font_normal {
  font-weight: normal;
}

#ftgjihjymh .gt_font_bold {
  font-weight: bold;
}

#ftgjihjymh .gt_font_italic {
  font-style: italic;
}

#ftgjihjymh .gt_super {
  font-size: 65%;
}

#ftgjihjymh .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#ftgjihjymh .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ftgjihjymh .gt_indent_1 {
  text-indent: 5px;
}

#ftgjihjymh .gt_indent_2 {
  text-indent: 10px;
}

#ftgjihjymh .gt_indent_3 {
  text-indent: 15px;
}

#ftgjihjymh .gt_indent_4 {
  text-indent: 20px;
}

#ftgjihjymh .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">year</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWFE</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">POLS</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWM</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">CS</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">0.273</td>
<td class="gt_row gt_right">0.273</td>
<td class="gt_row gt_right">0.273</td>
<td class="gt_row gt_right">0.288</td></tr>
    <tr><td class="gt_row gt_right">1999</td>
<td class="gt_row gt_right">0.489</td>
<td class="gt_row gt_right">0.489</td>
<td class="gt_row gt_right">0.489</td>
<td class="gt_row gt_right">0.504</td></tr>
    <tr><td class="gt_row gt_right">2000</td>
<td class="gt_row gt_right">0.909</td>
<td class="gt_row gt_right">0.909</td>
<td class="gt_row gt_right">0.909</td>
<td class="gt_row gt_right">0.924</td></tr>
    <tr><td class="gt_row gt_right">2001</td>
<td class="gt_row gt_right">1.291</td>
<td class="gt_row gt_right">1.291</td>
<td class="gt_row gt_right">1.291</td>
<td class="gt_row gt_right">1.306</td></tr>
    <tr><td class="gt_row gt_right">2002</td>
<td class="gt_row gt_right">1.714</td>
<td class="gt_row gt_right">1.714</td>
<td class="gt_row gt_right">1.714</td>
<td class="gt_row gt_right">1.729</td></tr>
    <tr><td class="gt_row gt_right">2003</td>
<td class="gt_row gt_right">1.898</td>
<td class="gt_row gt_right">1.898</td>
<td class="gt_row gt_right">1.898</td>
<td class="gt_row gt_right">1.913</td></tr>
    <tr><td class="gt_row gt_right">2004</td>
<td class="gt_row gt_right">2.226</td>
<td class="gt_row gt_right">2.226</td>
<td class="gt_row gt_right">2.226</td>
<td class="gt_row gt_right">2.241</td></tr>
    <tr><td class="gt_row gt_right">2005</td>
<td class="gt_row gt_right">2.434</td>
<td class="gt_row gt_right">2.434</td>
<td class="gt_row gt_right">2.434</td>
<td class="gt_row gt_right">2.449</td></tr>
    <tr><td class="gt_row gt_right">2006</td>
<td class="gt_row gt_right">2.759</td>
<td class="gt_row gt_right">2.759</td>
<td class="gt_row gt_right">2.759</td>
<td class="gt_row gt_right">2.774</td></tr>
    <tr><td class="gt_row gt_right">2007</td>
<td class="gt_row gt_right">3.190</td>
<td class="gt_row gt_right">3.190</td>
<td class="gt_row gt_right">3.190</td>
<td class="gt_row gt_right">3.205</td></tr>
    <tr><td class="gt_row gt_right">2008</td>
<td class="gt_row gt_right">3.471</td>
<td class="gt_row gt_right">3.471</td>
<td class="gt_row gt_right">3.471</td>
<td class="gt_row gt_right">3.486</td></tr>
    <tr><td class="gt_row gt_right">2009</td>
<td class="gt_row gt_right">3.676</td>
<td class="gt_row gt_right">3.676</td>
<td class="gt_row gt_right">3.676</td>
<td class="gt_row gt_right">3.691</td></tr>
    <tr><td class="gt_row gt_right">2010</td>
<td class="gt_row gt_right">4.097</td>
<td class="gt_row gt_right">4.097</td>
<td class="gt_row gt_right">4.097</td>
<td class="gt_row gt_right">4.112</td></tr>
    <tr><td class="gt_row gt_right">2011</td>
<td class="gt_row gt_right">4.328</td>
<td class="gt_row gt_right">4.328</td>
<td class="gt_row gt_right">4.328</td>
<td class="gt_row gt_right">4.343</td></tr>
    <tr><td class="gt_row gt_right">2012</td>
<td class="gt_row gt_right">4.783</td>
<td class="gt_row gt_right">4.783</td>
<td class="gt_row gt_right">4.783</td>
<td class="gt_row gt_right">4.799</td></tr>
    <tr><td class="gt_row gt_right">2013</td>
<td class="gt_row gt_right">4.994</td>
<td class="gt_row gt_right">4.994</td>
<td class="gt_row gt_right">4.994</td>
<td class="gt_row gt_right">5.009</td></tr>
    <tr><td class="gt_row gt_right">2014</td>
<td class="gt_row gt_right">5.278</td>
<td class="gt_row gt_right">5.278</td>
<td class="gt_row gt_right">5.278</td>
<td class="gt_row gt_right">5.293</td></tr>
    <tr><td class="gt_row gt_right">2015</td>
<td class="gt_row gt_right">5.718</td>
<td class="gt_row gt_right">5.718</td>
<td class="gt_row gt_right">5.718</td>
<td class="gt_row gt_right">5.733</td></tr>
  </tbody>
  
  
</table>
</div>
<p></p><figcaption class="figure-caption">Figure 5: Summary of Estimates - Common Treatment Time, Dynamic Treatment Effects</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_data</span>(df2) <span class="sc">+</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df_est2, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> estimate, <span class="at">colour =</span> <span class="fu">factor</span>(group),<span class="at">lty=</span><span class="fu">factor</span>(method)), <span class="at">lwd=</span><span class="dv">2</span>)  <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot-case2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="twfe-twm-and-did_files/figure-html/fig-plot-case2-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 6: Treatment Effect Estimates</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="case-3-multiple-treatment-periods-and-constant-equal-treatment-effects" class="level1">
<h1>Case 3: Multiple Treatment Periods and Constant Equal Treatment Effects</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Case 3: Multiple Treatment Periods and Constant Equal Treatment Effects</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>params3<span class="ot">=</span>  <span class="fu">list</span>(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu =</span> <span class="fu">list</span>(<span class="st">"1989"</span> <span class="ot">=</span> <span class="dv">3</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">"1998"</span> <span class="ot">=</span> <span class="dv">3</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">"2007"</span> <span class="ot">=</span> <span class="dv">3</span>),</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu_t =</span> <span class="fu">list</span>(<span class="st">"1989"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>              <span class="st">"1998"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>              <span class="st">"2007"</span> <span class="ot">=</span> <span class="dv">0</span>),</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">tx =</span> <span class="fu">list</span>(<span class="st">"1989"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">17</span>,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"1998"</span> <span class="ot">=</span> <span class="dv">18</span><span class="sc">:</span><span class="dv">35</span>,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">"2007"</span> <span class="ot">=</span> <span class="dv">36</span><span class="sc">:</span><span class="dv">50</span>),</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">bin =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">5</span>))</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> <span class="fu">make_data</span>(params3,<span class="at">N=</span><span class="dv">200</span>) </span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>data3 <span class="ot">&lt;-</span> df3<span class="sc">$</span>df <span class="sc">%&gt;%</span> </span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dep_var,<span class="at">treatment_time =</span> group, state,unit, year, treat) <span class="sc">%&gt;%</span> </span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(treatment_time, year), factor)</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_data</span>(df3) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="twfe-twm-and-did_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>treatment_years3 <span class="ot">&lt;-</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  data3 <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(treat, year) <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(treat<span class="sc">==</span> <span class="dv">1</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.vector</span>()</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>treatment_groups3 <span class="ot">&lt;-</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>(data3[data3<span class="sc">$</span>treatment_time <span class="sc">!=</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(data3<span class="sc">$</span>treatment_time),]<span class="sc">$</span>treatment_time) <span class="sc">%&gt;%</span> </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>()</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>df_ <span class="ot">&lt;-</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  data3 <span class="sc">%&gt;%</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(treatment_time),<span class="dv">0</span>,<span class="fu">as.numeric</span>(<span class="fu">paste0</span>(treatment_time)))) <span class="sc">%&gt;%</span> </span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">y =</span> dep_var,<span class="at">w =</span> treat, <span class="at">id =</span> unit,year, treatment_time) <span class="sc">%&gt;%</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  fastDummies<span class="sc">::</span><span class="fu">dummy_cols</span>(<span class="fu">c</span>(<span class="st">"year"</span>,<span class="st">"treatment_time"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_at</span>(<span class="fu">vars</span>(y,w,id,year,<span class="fu">glue</span>(<span class="st">"year_{treatment_years3}"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.vector</span>(),</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">glue</span>(<span class="st">"treatment_time_{treatment_groups3}"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_at</span>(<span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">"year_"</span>)),<span class="sc">~</span><span class="fu">gsub</span>(<span class="st">"year_"</span>,<span class="st">"f"</span>,.)) <span class="sc">%&gt;%</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_at</span>(<span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">"treatment_time_"</span>)),<span class="sc">~</span><span class="fu">gsub</span>(<span class="st">"treatment_time_"</span>,<span class="st">"d"</span>,.))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="estimate-models-2" class="level2">
<h2 class="anchored" data-anchor-id="estimate-models-2">Estimate Models</h2>
<p>We next estimate the models</p>
<table class="table">
<colgroup>
<col style="width: 29%">
<col style="width: 14%">
<col style="width: 24%">
<col style="width: 31%">
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>Command</th>
<th>Design Variables</th>
<th>Fixed or Random Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Two-Way Fixed Effects</td>
<td><code>feols()</code></td>
<td><code>w</code> + <code>f*</code></td>
<td>Unit Fixed Effect</td>
</tr>
<tr class="even">
<td>Pooled OLS</td>
<td><code>lm()</code></td>
<td><code>w</code> + <code>f*</code> + <code>d*</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Two-Way Mundlak</td>
<td><code>lmer()</code></td>
<td><code>w</code> + <code>f*</code> + <code>d*</code></td>
<td>Unit Random Effect</td>
</tr>
</tbody>
</table>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>fmla_twfe3 <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"y ~ w + {paste0('f',treatment_years3,collapse= '+')} | id "</span>) <span class="sc">%&gt;%</span> <span class="fu">as.formula</span>()</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>fit_twfe3 <span class="ot">&lt;-</span> <span class="fu">feols</span>(fmla_twfe3, <span class="at">data =</span> df_)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>est_twfe3 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">method =</span> <span class="st">"TWFE"</span>, <span class="at">estimate =</span> <span class="fu">coef</span>(fit_twfe3)[<span class="st">"w"</span>], <span class="at">formula =</span> <span class="fu">glue</span>(<span class="st">"feols({Reduce(paste,deparse(fmla_twfe3))}, data = df_)"</span>))</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>fmla_lm3 <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"y ~ w + {paste0('f',treatment_years3,collapse= '+')} + {paste0('d',treatment_groups3,collapse= '+')}"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.formula</span>()</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>fit_lm3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(fmla_lm3, <span class="at">data =</span> df_) </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>est_lm3 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">method =</span> <span class="st">"POLS"</span>, <span class="at">estimate =</span> <span class="fu">coef</span>(fit_lm3)[<span class="st">"w"</span>], <span class="at">formula =</span> <span class="fu">glue</span>(<span class="st">"lm({Reduce(paste,deparse(fmla_lm3))}, data = df_)"</span>))</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>fmla_twm3 <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"y ~ w + {paste0('f',treatment_years3,collapse= '+')} + {paste0('d',treatment_groups3,collapse= '+')} + (1|id)"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.formula</span>()</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>fit_twm3 <span class="ot">&lt;-</span> <span class="fu">lmer</span>( fmla_twm3 , <span class="at">data =</span> df_) </span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>est_twm3 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">method =</span> <span class="st">"TWM"</span>, <span class="at">estimate =</span> <span class="fu">coef</span>(<span class="fu">summary</span>(fit_twm3))[<span class="st">"w"</span>,][<span class="dv">1</span>] <span class="sc">%&gt;%</span> <span class="fu">unname</span>(), <span class="at">formula =</span> <span class="fu">glue</span>(<span class="st">"lmer({Reduce(paste,deparse(fmla_twm3))}, data = df_)"</span>))</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co"># CS</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>data3_cs <span class="ot">&lt;-</span> </span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  data3 <span class="sc">%&gt;%</span> </span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(year)),</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">treatment_time =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(treatment_time)))  <span class="sc">%&gt;%</span> </span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(treatment_time),<span class="dv">0</span>,treatment_time))</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>fit_cs3 <span class="ot">&lt;-</span> <span class="fu">att_gt</span>(<span class="at">yname =</span> <span class="st">"dep_var"</span>,</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>                  <span class="at">tname =</span> <span class="st">"year"</span>,</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">idname =</span> <span class="st">"unit"</span>,</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>                  <span class="at">gname =</span> <span class="st">"treatment_time"</span>,</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>                  <span class="at">control_group =</span> <span class="st">"notyettreated"</span>,</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> data3_cs</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>est_cs3 <span class="ot">&lt;-</span>  <span class="fu">tibble</span>(<span class="at">group =</span> <span class="fu">paste0</span>(fit_cs3<span class="sc">$</span>group), <span class="at">year =</span> fit_cs3<span class="sc">$</span>t, <span class="at">estimate =</span> fit_cs3<span class="sc">$</span>att) <span class="sc">%&gt;%</span> </span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"CS"</span>) </span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">method =</span> <span class="fu">c</span>(<span class="st">"TWFE"</span>,<span class="st">"POLS"</span>,<span class="st">"TWM"</span>),</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">formula =</span> <span class="fu">c</span>(<span class="fu">glue</span>(<span class="st">"feols({Reduce(paste,deparse(fmla_twfe3))}, data = df_)"</span>),</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">glue</span>(<span class="st">"lm({Reduce(paste,deparse(fmla_lm3))}, data = df_)"</span>),</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">glue</span>(<span class="st">"lmer({Reduce(paste,deparse(fmla_twm3))}, data = df_)"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(<span class="st">"method"</span> <span class="ot">=</span> <span class="st">"Estimator"</span>,</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>             <span class="st">"formula"</span> <span class="ot">=</span> <span class="st">"Regression Call"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="cueyqyprtn" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#cueyqyprtn .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#cueyqyprtn .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cueyqyprtn .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#cueyqyprtn .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#cueyqyprtn .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cueyqyprtn .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cueyqyprtn .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#cueyqyprtn .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#cueyqyprtn .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#cueyqyprtn .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#cueyqyprtn .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#cueyqyprtn .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#cueyqyprtn .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#cueyqyprtn .gt_from_md > :first-child {
  margin-top: 0;
}

#cueyqyprtn .gt_from_md > :last-child {
  margin-bottom: 0;
}

#cueyqyprtn .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#cueyqyprtn .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#cueyqyprtn .gt_row_group_first td {
  border-top-width: 2px;
}

#cueyqyprtn .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#cueyqyprtn .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#cueyqyprtn .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cueyqyprtn .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#cueyqyprtn .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#cueyqyprtn .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cueyqyprtn .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cueyqyprtn .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cueyqyprtn .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_left {
  text-align: left;
}

#cueyqyprtn .gt_center {
  text-align: center;
}

#cueyqyprtn .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#cueyqyprtn .gt_font_normal {
  font-weight: normal;
}

#cueyqyprtn .gt_font_bold {
  font-weight: bold;
}

#cueyqyprtn .gt_font_italic {
  font-style: italic;
}

#cueyqyprtn .gt_super {
  font-size: 65%;
}

#cueyqyprtn .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#cueyqyprtn .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#cueyqyprtn .gt_indent_1 {
  text-indent: 5px;
}

#cueyqyprtn .gt_indent_2 {
  text-indent: 10px;
}

#cueyqyprtn .gt_indent_3 {
  text-indent: 15px;
}

#cueyqyprtn .gt_indent_4 {
  text-indent: 20px;
}

#cueyqyprtn .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Estimator</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Regression Call</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">TWFE</td>
<td class="gt_row gt_left">feols(y ~ w + f1989 + f1990 + f1991 + f1992 + f1993 + f1994 + f1995 +      f1996 + f1997 + f1998 + f1999 + f2000 + f2001 + f2002 + f2003 +      f2004 + f2005 + f2006 + f2007 + f2008 + f2009 + f2010 + f2011 +      f2012 + f2013 + f2014 + f2015 | id, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">POLS</td>
<td class="gt_row gt_left">lm(y ~ w + f1989 + f1990 + f1991 + f1992 + f1993 + f1994 + f1995 +      f1996 + f1997 + f1998 + f1999 + f2000 + f2001 + f2002 + f2003 +      f2004 + f2005 + f2006 + f2007 + f2008 + f2009 + f2010 + f2011 +      f2012 + f2013 + f2014 + f2015 + d1989 + d1998 + d2007, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">TWM</td>
<td class="gt_row gt_left">lmer(y ~ w + f1989 + f1990 + f1991 + f1992 + f1993 + f1994 + f1995 +      f1996 + f1997 + f1998 + f1999 + f2000 + f2001 + f2002 + f2003 +      f2004 + f2005 + f2006 + f2007 + f2008 + f2009 + f2010 + f2011 +      f2012 + f2013 + f2014 + f2015 + d1989 + d1998 + d2007 + (1 |      id), data = df_)</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</section>
<section id="summary-of-estimates-2" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-estimates-2">Summary of Estimates</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>est3 <span class="ot">&lt;-</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  est_twfe3 <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est_lm3) <span class="sc">%&gt;%</span> </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est_twm3) </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>est3 <span class="sc">%&gt;%</span> </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>formula) <span class="sc">%&gt;%</span> </span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="st">"Intervention"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(method,estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">c</span>(TWFE,TWM, POLS),<span class="at">decimals=</span><span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(<span class="st">"group"</span> <span class="ot">=</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-sum-case3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div id="ftgjihjymh" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ftgjihjymh .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ftgjihjymh .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ftgjihjymh .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ftgjihjymh .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ftgjihjymh .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ftgjihjymh .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ftgjihjymh .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ftgjihjymh .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ftgjihjymh .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ftgjihjymh .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ftgjihjymh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ftgjihjymh .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#ftgjihjymh .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ftgjihjymh .gt_from_md > :first-child {
  margin-top: 0;
}

#ftgjihjymh .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ftgjihjymh .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ftgjihjymh .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ftgjihjymh .gt_row_group_first td {
  border-top-width: 2px;
}

#ftgjihjymh .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ftgjihjymh .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ftgjihjymh .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ftgjihjymh .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ftgjihjymh .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ftgjihjymh .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ftgjihjymh .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ftgjihjymh .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ftgjihjymh .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_left {
  text-align: left;
}

#ftgjihjymh .gt_center {
  text-align: center;
}

#ftgjihjymh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ftgjihjymh .gt_font_normal {
  font-weight: normal;
}

#ftgjihjymh .gt_font_bold {
  font-weight: bold;
}

#ftgjihjymh .gt_font_italic {
  font-style: italic;
}

#ftgjihjymh .gt_super {
  font-size: 65%;
}

#ftgjihjymh .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#ftgjihjymh .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ftgjihjymh .gt_indent_1 {
  text-indent: 5px;
}

#ftgjihjymh .gt_indent_2 {
  text-indent: 10px;
}

#ftgjihjymh .gt_indent_3 {
  text-indent: 15px;
}

#ftgjihjymh .gt_indent_4 {
  text-indent: 20px;
}

#ftgjihjymh .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col"></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">POLS</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWFE</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWM</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">Intervention</td>
<td class="gt_row gt_right">3.009</td>
<td class="gt_row gt_right">3.009</td>
<td class="gt_row gt_right">3.009</td></tr>
  </tbody>
  
  
</table>
</div>
<p></p><figcaption class="figure-caption">Figure 7: Summary of Estimates - Common Treatment Time, Constant Treatment Effects</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>df_est3 <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">group=</span> treatment_groups3, <span class="at">year =</span> treatment_years3) <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">mutate</span>(<span class="at">tmp =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">left_join</span>(est3 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">tmp=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(year))) <span class="sc">%&gt;%</span> </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est_cs3)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_data</span>(df3)  <span class="sc">+</span> </span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df_est3, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> estimate, <span class="at">colour =</span> <span class="fu">factor</span>(group),<span class="at">lty=</span><span class="fu">factor</span>(method)), <span class="at">lwd=</span><span class="dv">2</span>)  <span class="sc">+</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot-case3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="twfe-twm-and-did_files/figure-html/fig-plot-case3-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 8: Treatment Effect Estimates</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="case-4a-multiple-treatment-periods-and-constant-different-treatment-effects" class="level1">
<h1>Case 4a: Multiple Treatment Periods and Constant Different Treatment Effects</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>params4a <span class="ot">=</span>  <span class="fu">list</span>(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu =</span> <span class="fu">list</span>(<span class="st">"1989"</span> <span class="ot">=</span> <span class="dv">5</span>,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">"1998"</span> <span class="ot">=</span> <span class="dv">3</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">"2007"</span> <span class="ot">=</span> <span class="dv">1</span>),</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu_t =</span> <span class="fu">list</span>(<span class="st">"1989"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>              <span class="st">"1998"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>              <span class="st">"2007"</span> <span class="ot">=</span> <span class="dv">0</span>),</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">tx =</span> <span class="fu">list</span>(<span class="st">"1989"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">17</span>,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"1998"</span> <span class="ot">=</span> <span class="dv">18</span><span class="sc">:</span><span class="dv">35</span>,</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"2007"</span> <span class="ot">=</span> <span class="dv">36</span><span class="sc">:</span><span class="dv">50</span>),</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">bin =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">5</span>))</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>df4a <span class="ot">&lt;-</span> <span class="fu">make_data</span>(params4a,<span class="at">N=</span><span class="dv">200</span>) </span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>data4a <span class="ot">&lt;-</span> df4a<span class="sc">$</span>df <span class="sc">%&gt;%</span> </span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dep_var,<span class="at">treatment_time =</span> group, state,unit, year, treat) <span class="sc">%&gt;%</span> </span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(treatment_time, year), factor)</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_data</span>(df4a) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="twfe-twm-and-did_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>treatment_years4a <span class="ot">&lt;-</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  data4a <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(treat, year) <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(treat<span class="sc">==</span> <span class="dv">1</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.vector</span>()</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>treatment_groups4a <span class="ot">&lt;-</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>(data4a[data4a<span class="sc">$</span>treatment_time <span class="sc">!=</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(data4a<span class="sc">$</span>treatment_time),]<span class="sc">$</span>treatment_time) <span class="sc">%&gt;%</span> </span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>()</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>df4a_ <span class="ot">&lt;-</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  data4a <span class="sc">%&gt;%</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(treatment_time),<span class="dv">0</span>,<span class="fu">as.numeric</span>(<span class="fu">paste0</span>(treatment_time)))) <span class="sc">%&gt;%</span> </span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">y =</span> dep_var,<span class="at">w =</span> treat, <span class="at">id =</span> unit,year, treatment_time) <span class="sc">%&gt;%</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  fastDummies<span class="sc">::</span><span class="fu">dummy_cols</span>(<span class="fu">c</span>(<span class="st">"year"</span>,<span class="st">"treatment_time"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_at</span>(<span class="fu">vars</span>(y,w,id,year,<span class="fu">glue</span>(<span class="st">"year_{treatment_years4a}"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.vector</span>(),</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">glue</span>(<span class="st">"treatment_time_{treatment_groups4a}"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_at</span>(<span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">"year_"</span>)),<span class="sc">~</span><span class="fu">gsub</span>(<span class="st">"year_"</span>,<span class="st">"f"</span>,.)) <span class="sc">%&gt;%</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_at</span>(<span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">"treatment_time_"</span>)),<span class="sc">~</span><span class="fu">gsub</span>(<span class="st">"treatment_time_"</span>,<span class="st">"d"</span>,.))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="estimate-models-3" class="level2">
<h2 class="anchored" data-anchor-id="estimate-models-3">Estimate Models</h2>
<p>We next estimate the models</p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>Command</th>
<th>Design Variables</th>
<th>Fixed or Random Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Two-Way Fixed Effects</td>
<td><code>feols()</code></td>
<td><code>w : d*</code> + <code>f*</code></td>
<td>Unit Fixed Effect</td>
</tr>
<tr class="even">
<td>Pooled OLS</td>
<td><code>lm()</code></td>
<td><code>w : d*</code> + <code>f*</code> + <code>d*</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Two-Way Mundlak</td>
<td><code>lmer()</code></td>
<td><code>w : d*</code> + <code>f*</code> + <code>d*</code></td>
<td>Unit Random Effect</td>
</tr>
</tbody>
</table>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>fmla_twfe4a <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"y ~ {paste0('w : ',paste0('d',treatment_groups4a), collapse = ' + ')} + {paste0('f',treatment_years4a,collapse=' + ')} | id"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.formula</span>()</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>fit_twfe4a <span class="ot">&lt;-</span> <span class="fu">feols</span>(fmla_twfe4a, <span class="at">data =</span> df4a_)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>fmla_lm4a <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"y ~ {paste0('w : ',paste0('d',treatment_groups4a), collapse = ' + ')} + {paste0('f',treatment_years4a,collapse=' + ')} + {paste0('d',treatment_groups4a,collapse=' + ')}"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.formula</span>()</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>fit_lm4a <span class="ot">&lt;-</span> <span class="fu">lm</span>(fmla_lm4a, <span class="at">data =</span> df4a_) </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>fmla_twm4a <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"y ~ {paste0('w : ',paste0('d',treatment_groups4a), collapse = ' + ')} + {paste0('f',treatment_years4a,collapse=' + ')} + {paste0('d',treatment_groups4a,collapse=' + ')} + (1|id)"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.formula</span>()</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>fit_twm4a <span class="ot">&lt;-</span> <span class="fu">lmer</span>( fmla_twm4a , <span class="at">data =</span> df4a_) </span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co"># CS</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>data4a_cs <span class="ot">&lt;-</span> </span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  data4a <span class="sc">%&gt;%</span> </span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(year)),</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">treatment_time =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(treatment_time)))  <span class="sc">%&gt;%</span> </span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(treatment_time),<span class="dv">0</span>,treatment_time))</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>fit_cs4a <span class="ot">&lt;-</span> <span class="fu">att_gt</span>(<span class="at">yname =</span> <span class="st">"dep_var"</span>,</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">tname =</span> <span class="st">"year"</span>,</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">idname =</span> <span class="st">"unit"</span>,</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>                  <span class="at">gname =</span> <span class="st">"treatment_time"</span>,</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">control_group =</span> <span class="st">"notyettreated"</span>,</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> data4a_cs</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>est_cs4a <span class="ot">&lt;-</span>  <span class="fu">tibble</span>(<span class="at">group =</span> <span class="fu">paste0</span>(fit_cs4a<span class="sc">$</span>group), <span class="at">year =</span> fit_cs4a<span class="sc">$</span>t, <span class="at">estimate =</span> fit_cs4a<span class="sc">$</span>att) <span class="sc">%&gt;%</span> </span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"CS"</span>)  </span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">method =</span> <span class="fu">c</span>(<span class="st">"TWFE"</span>,<span class="st">"POLS"</span>,<span class="st">"TWM"</span>),</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">formula =</span> <span class="fu">c</span>(<span class="fu">glue</span>(<span class="st">"feols({Reduce(paste,deparse(fmla_twfe4a))}, data = df_)"</span>),</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">glue</span>(<span class="st">"lm({Reduce(paste,deparse(fmla_lm4a))}, data = df_)"</span>),</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">glue</span>(<span class="st">"lmer({Reduce(paste,deparse(fmla_twm4a))}, data = df_)"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(<span class="st">"method"</span> <span class="ot">=</span> <span class="st">"Estimator"</span>,</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>             <span class="st">"formula"</span> <span class="ot">=</span> <span class="st">"Regression Call"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="cueyqyprtn" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#cueyqyprtn .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#cueyqyprtn .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cueyqyprtn .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#cueyqyprtn .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#cueyqyprtn .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cueyqyprtn .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cueyqyprtn .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#cueyqyprtn .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#cueyqyprtn .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#cueyqyprtn .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#cueyqyprtn .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#cueyqyprtn .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#cueyqyprtn .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#cueyqyprtn .gt_from_md > :first-child {
  margin-top: 0;
}

#cueyqyprtn .gt_from_md > :last-child {
  margin-bottom: 0;
}

#cueyqyprtn .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#cueyqyprtn .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#cueyqyprtn .gt_row_group_first td {
  border-top-width: 2px;
}

#cueyqyprtn .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#cueyqyprtn .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#cueyqyprtn .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cueyqyprtn .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#cueyqyprtn .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#cueyqyprtn .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cueyqyprtn .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cueyqyprtn .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cueyqyprtn .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cueyqyprtn .gt_left {
  text-align: left;
}

#cueyqyprtn .gt_center {
  text-align: center;
}

#cueyqyprtn .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#cueyqyprtn .gt_font_normal {
  font-weight: normal;
}

#cueyqyprtn .gt_font_bold {
  font-weight: bold;
}

#cueyqyprtn .gt_font_italic {
  font-style: italic;
}

#cueyqyprtn .gt_super {
  font-size: 65%;
}

#cueyqyprtn .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#cueyqyprtn .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#cueyqyprtn .gt_indent_1 {
  text-indent: 5px;
}

#cueyqyprtn .gt_indent_2 {
  text-indent: 10px;
}

#cueyqyprtn .gt_indent_3 {
  text-indent: 15px;
}

#cueyqyprtn .gt_indent_4 {
  text-indent: 20px;
}

#cueyqyprtn .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Estimator</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Regression Call</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">TWFE</td>
<td class="gt_row gt_left">feols(y ~ w:d1989 + w:d1998 + w:d2007 + f1989 + f1990 + f1991 + f1992 +      f1993 + f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 +      f2001 + f2002 + f2003 + f2004 + f2005 + f2006 + f2007 + f2008 +      f2009 + f2010 + f2011 + f2012 + f2013 + f2014 + f2015 | id, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">POLS</td>
<td class="gt_row gt_left">lm(y ~ w:d1989 + w:d1998 + w:d2007 + f1989 + f1990 + f1991 + f1992 +      f1993 + f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 +      f2001 + f2002 + f2003 + f2004 + f2005 + f2006 + f2007 + f2008 +      f2009 + f2010 + f2011 + f2012 + f2013 + f2014 + f2015 + d1989 +      d1998 + d2007, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">TWM</td>
<td class="gt_row gt_left">lmer(y ~ w:d1989 + w:d1998 + w:d2007 + f1989 + f1990 + f1991 + f1992 +      f1993 + f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 +      f2001 + f2002 + f2003 + f2004 + f2005 + f2006 + f2007 + f2008 +      f2009 + f2010 + f2011 + f2012 + f2013 + f2014 + f2015 + d1989 +      d1998 + d2007 + (1 | id), data = df_)</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>est_twfe4a <span class="ot">&lt;-</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  fit_twfe4a <span class="sc">%&gt;%</span> <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"TWFE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">call =</span> <span class="fu">glue</span>(<span class="st">"feols({Reduce(paste,deparse(fmla_twfe4a))}, data = df4a_)"</span>))</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>est_lm4a <span class="ot">&lt;-</span> </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  fit_lm4a <span class="sc">%&gt;%</span> <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">call =</span> <span class="fu">glue</span>(<span class="st">"lm({Reduce(paste,deparse(fmla_lm4a))}, data = df4a_)"</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"POLS"</span>)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>est_twm4a <span class="ot">&lt;-</span> </span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  fit_twm4a  <span class="sc">%&gt;%</span> <span class="fu">summary</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"term"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"TWM"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">call =</span> <span class="fu">glue</span>(<span class="st">"lmer({Reduce(paste,deparse(fmla_twm4a))}, data = df4a_)"</span>))</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>est4a <span class="ot">&lt;-</span> </span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>  est_twfe4a <span class="sc">%&gt;%</span> </span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est_lm4a) <span class="sc">%&gt;%</span> </span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est_twm4a) <span class="sc">%&gt;%</span> </span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"^w:"</span>,term)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(term,<span class="at">into=</span><span class="fu">c</span>(<span class="st">"tmp"</span>,<span class="st">"group"</span>), <span class="at">sep =</span> <span class="st">":"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">gsub</span>(<span class="st">"d"</span>,<span class="st">""</span>,group)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>tmp) <span class="co">#%&gt;% </span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">#bind_rows(est_cs4a %&gt;% filter(!is.na(group))) </span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>df_est4a <span class="ot">&lt;-</span> </span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(<span class="at">group=</span> treatment_groups4a) <span class="sc">%&gt;%</span> </span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(est4a, <span class="st">"group"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">factor</span>(group))</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>df_est4a <span class="sc">%&gt;%</span> </span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(group,estimate,method) <span class="sc">%&gt;%</span> </span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(method,estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(group,TWFE,POLS,TWM) <span class="sc">%&gt;%</span> </span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns=</span><span class="fu">c</span>(TWFE,POLS,TWM),<span class="at">decimals=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-sum-case4a" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div id="ftgjihjymh" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ftgjihjymh .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ftgjihjymh .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ftgjihjymh .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ftgjihjymh .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ftgjihjymh .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ftgjihjymh .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ftgjihjymh .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ftgjihjymh .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ftgjihjymh .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ftgjihjymh .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ftgjihjymh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ftgjihjymh .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#ftgjihjymh .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ftgjihjymh .gt_from_md > :first-child {
  margin-top: 0;
}

#ftgjihjymh .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ftgjihjymh .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ftgjihjymh .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ftgjihjymh .gt_row_group_first td {
  border-top-width: 2px;
}

#ftgjihjymh .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ftgjihjymh .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ftgjihjymh .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ftgjihjymh .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ftgjihjymh .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ftgjihjymh .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ftgjihjymh .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ftgjihjymh .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ftgjihjymh .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ftgjihjymh .gt_left {
  text-align: left;
}

#ftgjihjymh .gt_center {
  text-align: center;
}

#ftgjihjymh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ftgjihjymh .gt_font_normal {
  font-weight: normal;
}

#ftgjihjymh .gt_font_bold {
  font-weight: bold;
}

#ftgjihjymh .gt_font_italic {
  font-style: italic;
}

#ftgjihjymh .gt_super {
  font-size: 65%;
}

#ftgjihjymh .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#ftgjihjymh .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ftgjihjymh .gt_indent_1 {
  text-indent: 5px;
}

#ftgjihjymh .gt_indent_2 {
  text-indent: 10px;
}

#ftgjihjymh .gt_indent_3 {
  text-indent: 15px;
}

#ftgjihjymh .gt_indent_4 {
  text-indent: 20px;
}

#ftgjihjymh .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col">group</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWFE</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">POLS</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWM</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_center">1989</td>
<td class="gt_row gt_right">4.951</td>
<td class="gt_row gt_right">4.951</td>
<td class="gt_row gt_right">4.951</td></tr>
    <tr><td class="gt_row gt_center">1998</td>
<td class="gt_row gt_right">3.036</td>
<td class="gt_row gt_right">3.036</td>
<td class="gt_row gt_right">3.036</td></tr>
    <tr><td class="gt_row gt_center">2007</td>
<td class="gt_row gt_right">1.029</td>
<td class="gt_row gt_right">1.029</td>
<td class="gt_row gt_right">1.029</td></tr>
  </tbody>
  
  
</table>
</div>
<p></p><figcaption class="figure-caption">Figure 9: Summary of Estimates - Multiple Treatment Periods and Constant Different Treatment Effects</figcaption><p></p>
</figure>
</div>
</div>
</section>
<section id="summary-of-estimates-3" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-estimates-3">Summary of Estimates</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>df_est4a_ <span class="ot">&lt;-</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(<span class="at">year =</span> treatment_years4a,<span class="at">group =</span> treatment_groups4a) <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(group))) <span class="sc">%&gt;%</span> </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(year))) <span class="sc">%&gt;%</span> </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year<span class="sc">&gt;=</span>group) <span class="sc">%&gt;%</span> </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">factor</span>(group)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    df_est4a,<span class="st">"group"</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est_cs4a)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_data</span>(df4a) <span class="sc">+</span> </span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df_est4a_, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> estimate, <span class="at">colour =</span> <span class="fu">factor</span>(group),<span class="at">lty=</span><span class="fu">factor</span>(method)), <span class="at">lwd=</span><span class="dv">2</span>)  <span class="sc">+</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot-case4a" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="twfe-twm-and-did_files/figure-html/fig-plot-case4a-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 10: Treatment Effect Estimates - Multiple Treatment Periods and Constant Different Treatment Effects</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="case-4b-multiple-treatment-periods-and-constant-different-treatment-effects" class="level1">
<h1>Case 4b: Multiple Treatment Periods and Constant Different Treatment Effects</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>params4b <span class="ot">=</span>  <span class="fu">list</span>(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu =</span> <span class="fu">list</span>(<span class="st">"1989"</span> <span class="ot">=</span> <span class="dv">5</span>,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">"1998"</span> <span class="ot">=</span> <span class="dv">3</span>),</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu_t =</span> <span class="fu">list</span>(<span class="st">"1989"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>              <span class="st">"1998"</span> <span class="ot">=</span> <span class="dv">0</span>),</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tx =</span> <span class="fu">list</span>(<span class="st">"1989"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">17</span>,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"1998"</span> <span class="ot">=</span> <span class="dv">18</span><span class="sc">:</span><span class="dv">35</span>,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"NA"</span> <span class="ot">=</span> <span class="dv">36</span><span class="sc">:</span><span class="dv">50</span>),</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">bin =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">5</span>))</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>df4b <span class="ot">&lt;-</span> <span class="fu">make_data</span>(params4b,<span class="at">N=</span><span class="dv">200</span>) </span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>data4b <span class="ot">&lt;-</span> df4b<span class="sc">$</span>df <span class="sc">%&gt;%</span> </span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dep_var,<span class="at">treatment_time =</span> group, state,unit, year, treat) <span class="sc">%&gt;%</span> </span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(treatment_time, year), factor)</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_data</span>(df4b) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="twfe-twm-and-did_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>treatment_years4b <span class="ot">&lt;-</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  data4b <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(treat, year) <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(treat<span class="sc">==</span> <span class="dv">1</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.vector</span>()</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>treatment_groups4b <span class="ot">&lt;-</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>(data4b[data4b<span class="sc">$</span>treatment_time <span class="sc">!=</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(data4b<span class="sc">$</span>treatment_time),]<span class="sc">$</span>treatment_time) <span class="sc">%&gt;%</span> </span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>()</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>df4b_ <span class="ot">&lt;-</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  data4b <span class="sc">%&gt;%</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(treatment_time),<span class="dv">0</span>,<span class="fu">as.numeric</span>(<span class="fu">paste0</span>(treatment_time)))) <span class="sc">%&gt;%</span> </span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">y =</span> dep_var,<span class="at">w =</span> treat, <span class="at">id =</span> unit,year, treatment_time) <span class="sc">%&gt;%</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  fastDummies<span class="sc">::</span><span class="fu">dummy_cols</span>(<span class="fu">c</span>(<span class="st">"year"</span>,<span class="st">"treatment_time"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_at</span>(<span class="fu">vars</span>(y,w,id,year,treatment_time,<span class="fu">glue</span>(<span class="st">"year_{treatment_years4b}"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.vector</span>(),</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">glue</span>(<span class="st">"treatment_time_{treatment_groups4b}"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_at</span>(<span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">"year_"</span>)),<span class="sc">~</span><span class="fu">gsub</span>(<span class="st">"year_"</span>,<span class="st">"f"</span>,.)) <span class="sc">%&gt;%</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_at</span>(<span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">"treatment_time_"</span>)),<span class="sc">~</span><span class="fu">gsub</span>(<span class="st">"treatment_time_"</span>,<span class="st">"d"</span>,.))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="estimate-models-4" class="level2">
<h2 class="anchored" data-anchor-id="estimate-models-4">Estimate Models</h2>
<p>We next estimate the models</p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>Command</th>
<th>Design Variables</th>
<th>Fixed or Random Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Two-Way Fixed Effects</td>
<td><code>feols()</code></td>
<td><code>w : d*</code> + <code>f*</code></td>
<td>Unit Fixed Effect</td>
</tr>
<tr class="even">
<td>Pooled OLS</td>
<td><code>lm()</code></td>
<td><code>w : d*</code> + <code>f*</code> + <code>d*</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Two-Way Mundlak</td>
<td><code>lmer()</code></td>
<td><code>w : d*</code> + <code>f*</code> + <code>d*</code></td>
<td>Unit Random Effect</td>
</tr>
</tbody>
</table>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>fmla_twfe4b <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"y ~ {paste0('w : ',paste0('d',treatment_groups4b), collapse = ' + ')} + {paste0('f',treatment_years4b,collapse=' + ')} | id"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.formula</span>()</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>fit_twfe4b <span class="ot">&lt;-</span> <span class="fu">feols</span>(fmla_twfe4b, <span class="at">data =</span> df4b_)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>fmla_lm4b <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"y ~ {paste0('w : ',paste0('d',treatment_groups4b), collapse = ' + ')} + {paste0('f',treatment_years4b,collapse=' + ')} + {paste0('d',treatment_groups4b,collapse=' + ')}"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.formula</span>()</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>fit_lm4b <span class="ot">&lt;-</span> <span class="fu">lm</span>(fmla_lm4b, <span class="at">data =</span> df4b_) </span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>fmla_twm4b <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"y ~ {paste0('w : ',paste0('d',treatment_groups4b), collapse = ' + ')} + {paste0('f',treatment_years4b,collapse=' + ')} + {paste0('d',treatment_groups4b,collapse=' + ')} + (1|id)"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.formula</span>()</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>fit_twm4b <span class="ot">&lt;-</span> <span class="fu">lmer</span>( fmla_twm4b , <span class="at">data =</span> df4b_) </span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">method =</span> <span class="fu">c</span>(<span class="st">"TWFE"</span>,<span class="st">"POLS"</span>,<span class="st">"TWM"</span>),</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">formula =</span> <span class="fu">c</span>(<span class="fu">glue</span>(<span class="st">"feols({Reduce(paste,deparse(fmla_twfe4b))}, data = df_)"</span>),</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">glue</span>(<span class="st">"lm({Reduce(paste,deparse(fmla_lm4b))}, data = df_)"</span>),</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">glue</span>(<span class="st">"lmer({Reduce(paste,deparse(fmla_twm4b))}, data = df_)"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(<span class="st">"method"</span> <span class="ot">=</span> <span class="st">"Estimator"</span>,</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>             <span class="st">"formula"</span> <span class="ot">=</span> <span class="st">"Regression Call"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="fbguytibxb" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#fbguytibxb .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#fbguytibxb .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fbguytibxb .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#fbguytibxb .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#fbguytibxb .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fbguytibxb .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fbguytibxb .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#fbguytibxb .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#fbguytibxb .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#fbguytibxb .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#fbguytibxb .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#fbguytibxb .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#fbguytibxb .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#fbguytibxb .gt_from_md > :first-child {
  margin-top: 0;
}

#fbguytibxb .gt_from_md > :last-child {
  margin-bottom: 0;
}

#fbguytibxb .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#fbguytibxb .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#fbguytibxb .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#fbguytibxb .gt_row_group_first td {
  border-top-width: 2px;
}

#fbguytibxb .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fbguytibxb .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#fbguytibxb .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#fbguytibxb .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fbguytibxb .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fbguytibxb .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#fbguytibxb .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#fbguytibxb .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fbguytibxb .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fbguytibxb .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fbguytibxb .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fbguytibxb .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fbguytibxb .gt_left {
  text-align: left;
}

#fbguytibxb .gt_center {
  text-align: center;
}

#fbguytibxb .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#fbguytibxb .gt_font_normal {
  font-weight: normal;
}

#fbguytibxb .gt_font_bold {
  font-weight: bold;
}

#fbguytibxb .gt_font_italic {
  font-style: italic;
}

#fbguytibxb .gt_super {
  font-size: 65%;
}

#fbguytibxb .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#fbguytibxb .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#fbguytibxb .gt_indent_1 {
  text-indent: 5px;
}

#fbguytibxb .gt_indent_2 {
  text-indent: 10px;
}

#fbguytibxb .gt_indent_3 {
  text-indent: 15px;
}

#fbguytibxb .gt_indent_4 {
  text-indent: 20px;
}

#fbguytibxb .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Estimator</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Regression Call</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">TWFE</td>
<td class="gt_row gt_left">feols(y ~ w:d1989 + w:d1998 + f1989 + f1990 + f1991 + f1992 + f1993 +      f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 + f2001 +      f2002 + f2003 + f2004 + f2005 + f2006 + f2007 + f2008 + f2009 +      f2010 + f2011 + f2012 + f2013 + f2014 + f2015 | id, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">POLS</td>
<td class="gt_row gt_left">lm(y ~ w:d1989 + w:d1998 + f1989 + f1990 + f1991 + f1992 + f1993 +      f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 + f2001 +      f2002 + f2003 + f2004 + f2005 + f2006 + f2007 + f2008 + f2009 +      f2010 + f2011 + f2012 + f2013 + f2014 + f2015 + d1989 + d1998, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">TWM</td>
<td class="gt_row gt_left">lmer(y ~ w:d1989 + w:d1998 + f1989 + f1990 + f1991 + f1992 + f1993 +      f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 + f2001 +      f2002 + f2003 + f2004 + f2005 + f2006 + f2007 + f2008 + f2009 +      f2010 + f2011 + f2012 + f2013 + f2014 + f2015 + d1989 + d1998 +      (1 | id), data = df_)</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CS</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>data4b_cs <span class="ot">&lt;-</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  data4b <span class="sc">%&gt;%</span> </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(year)),</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">treatment_time =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(treatment_time)))  <span class="sc">%&gt;%</span> </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(treatment_time),<span class="dv">0</span>,treatment_time))</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>fit_cs4b <span class="ot">&lt;-</span> <span class="fu">att_gt</span>(<span class="at">yname =</span> <span class="st">"dep_var"</span>,</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">tname =</span> <span class="st">"year"</span>,</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">idname =</span> <span class="st">"unit"</span>,</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">gname =</span> <span class="st">"treatment_time"</span>,</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">control_group =</span> <span class="st">"nevertreated"</span>,</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> data4b_cs</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>est_cs4b <span class="ot">&lt;-</span>  <span class="fu">tibble</span>(<span class="at">group =</span> <span class="fu">paste0</span>(fit_cs4b<span class="sc">$</span>group), <span class="at">year =</span> fit_cs4b<span class="sc">$</span>t, <span class="at">estimate =</span> fit_cs4b<span class="sc">$</span>att) <span class="sc">%&gt;%</span> </span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"CS"</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="summary-of-estimates-4" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-estimates-4">Summary of Estimates</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>est_twfe4b <span class="ot">&lt;-</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  fit_twfe4b <span class="sc">%&gt;%</span> <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"TWFE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">call =</span> <span class="fu">glue</span>(<span class="st">"feols({Reduce(paste,deparse(fmla_twfe4b))}, data = df4b_)"</span>)) </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>est_lm4b <span class="ot">&lt;-</span> </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  fit_lm4b <span class="sc">%&gt;%</span> <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">call =</span> <span class="fu">glue</span>(<span class="st">"lm({Reduce(paste,deparse(fmla_lm4b))}, data = df4b_)"</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"POLS"</span>)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>est_twm4b <span class="ot">&lt;-</span> </span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  fit_twm4b  <span class="sc">%&gt;%</span> <span class="fu">summary</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"term"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"TWM"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">call =</span> <span class="fu">glue</span>(<span class="st">"lmer({Reduce(paste,deparse(fmla_twm4b))}, data = df4b_)"</span>))</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>est4b <span class="ot">&lt;-</span> </span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>  est_twfe4b <span class="sc">%&gt;%</span> </span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est_lm4b) <span class="sc">%&gt;%</span> </span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est_twm4b) <span class="sc">%&gt;%</span> </span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"^w:"</span>,term)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(term,<span class="at">into=</span><span class="fu">c</span>(<span class="st">"tmp"</span>,<span class="st">"group"</span>), <span class="at">sep =</span> <span class="st">":"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">gsub</span>(<span class="st">"d"</span>,<span class="st">""</span>,group)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(group))) <span class="sc">%&gt;%</span> </span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>tmp) <span class="sc">%&gt;%</span> </span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">factor</span>(group))</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>df_est4b <span class="ot">&lt;-</span> </span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(<span class="at">group=</span> treatment_groups4b) <span class="sc">%&gt;%</span> </span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(est4b, <span class="st">"group"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">factor</span>(group))</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>df_est4b <span class="sc">%&gt;%</span> </span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(group,estimate,method) <span class="sc">%&gt;%</span> </span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(method,estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(group,TWFE,POLS,TWM) <span class="sc">%&gt;%</span> </span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns=</span><span class="fu">c</span>(TWFE,POLS,TWM),<span class="at">decimals=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-sum-case4b" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div id="xryyodlbmy" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#xryyodlbmy .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#xryyodlbmy .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xryyodlbmy .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#xryyodlbmy .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#xryyodlbmy .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xryyodlbmy .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xryyodlbmy .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#xryyodlbmy .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#xryyodlbmy .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#xryyodlbmy .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#xryyodlbmy .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#xryyodlbmy .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#xryyodlbmy .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#xryyodlbmy .gt_from_md > :first-child {
  margin-top: 0;
}

#xryyodlbmy .gt_from_md > :last-child {
  margin-bottom: 0;
}

#xryyodlbmy .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#xryyodlbmy .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#xryyodlbmy .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#xryyodlbmy .gt_row_group_first td {
  border-top-width: 2px;
}

#xryyodlbmy .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xryyodlbmy .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#xryyodlbmy .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#xryyodlbmy .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xryyodlbmy .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xryyodlbmy .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#xryyodlbmy .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#xryyodlbmy .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xryyodlbmy .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xryyodlbmy .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xryyodlbmy .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xryyodlbmy .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xryyodlbmy .gt_left {
  text-align: left;
}

#xryyodlbmy .gt_center {
  text-align: center;
}

#xryyodlbmy .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#xryyodlbmy .gt_font_normal {
  font-weight: normal;
}

#xryyodlbmy .gt_font_bold {
  font-weight: bold;
}

#xryyodlbmy .gt_font_italic {
  font-style: italic;
}

#xryyodlbmy .gt_super {
  font-size: 65%;
}

#xryyodlbmy .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#xryyodlbmy .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#xryyodlbmy .gt_indent_1 {
  text-indent: 5px;
}

#xryyodlbmy .gt_indent_2 {
  text-indent: 10px;
}

#xryyodlbmy .gt_indent_3 {
  text-indent: 15px;
}

#xryyodlbmy .gt_indent_4 {
  text-indent: 20px;
}

#xryyodlbmy .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col">group</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWFE</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">POLS</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWM</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_center">1989</td>
<td class="gt_row gt_right">5.055</td>
<td class="gt_row gt_right">5.055</td>
<td class="gt_row gt_right">5.055</td></tr>
    <tr><td class="gt_row gt_center">1998</td>
<td class="gt_row gt_right">2.983</td>
<td class="gt_row gt_right">2.983</td>
<td class="gt_row gt_right">2.983</td></tr>
  </tbody>
  
  
</table>
</div>
<p></p><figcaption class="figure-caption">Figure 11: Summary of Estimates - Multiple Treatment Periods and Constant Different Treatment Effects</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>df_est4b_ <span class="ot">&lt;-</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(<span class="at">year =</span> treatment_years4b,<span class="at">group =</span> treatment_groups4b) <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(group))) <span class="sc">%&gt;%</span> </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(year))) <span class="sc">%&gt;%</span> </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year<span class="sc">&gt;=</span>group) <span class="sc">%&gt;%</span> </span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">factor</span>(group)) <span class="sc">%&gt;%</span> </span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    df_est4b,<span class="st">"group"</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est_cs4b)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_data</span>(df4b) <span class="sc">+</span> </span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df_est4b_, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> estimate, <span class="at">colour =</span> <span class="fu">factor</span>(group),<span class="at">lty=</span><span class="fu">factor</span>(method)), <span class="at">lwd=</span><span class="dv">2</span>)  <span class="sc">+</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot-case4b" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="twfe-twm-and-did_files/figure-html/fig-plot-case4b-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 12: Treatment Effect Estimates - Multiple Treatment Periods and Constant Different Treatment Effects</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="case-4c-multiple-treatment-periods-and-constant-different-treatment-effects---never-treated-as-control" class="level1">
<h1>Case 4c: Multiple Treatment Periods and Constant Different Treatment Effects - Never Treated as Control</h1>
<section id="define-all-the-years-where-at-least-one-group-is-treated-treatment_years-1" class="level3">
<h3 class="anchored" data-anchor-id="define-all-the-years-where-at-least-one-group-is-treated-treatment_years-1">1. Define all the years where at least one group is treated (<code>treatment_years</code>)</h3>
<p>Note that we define these years across <em>the entire sample</em> and do not restrict to only post-treatment years, as we did above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>treatment_years4b_nev <span class="ot">&lt;-</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  data4b <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(treat, year) <span class="sc">%&gt;%</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#!!!! </span><span class="al">NOTE</span><span class="co"> THAT WE DON'T RESTRICT TO POST-TREATMENT YEARS AS BEFORE</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(treat== 1 ) %&gt;%</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.vector</span>()</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>treatment_years4b_nev</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "1980" "1981" "1982" "1983" "1984" "1985" "1986" "1987" "1988" "1989"
[11] "1990" "1991" "1992" "1993" "1994" "1995" "1996" "1997" "1998" "1999"
[21] "2000" "2001" "2002" "2003" "2004" "2005" "2006" "2007" "2008" "2009"
[31] "2010" "2011" "2012" "2013" "2014" "2015" "1989" "1990" "1991" "1992"
[41] "1993" "1994" "1995" "1996" "1997" "1998" "1999" "2000" "2001" "2002"
[51] "2003" "2004" "2005" "2006" "2007" "2008" "2009" "2010" "2011" "2012"
[61] "2013" "2014" "2015"</code></pre>
</div>
</div>
</section>
<section id="estimate-models-5" class="level2">
<h2 class="anchored" data-anchor-id="estimate-models-5">Estimate Models</h2>
<p>We next estimate the models</p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>Command</th>
<th>Design Variables</th>
<th>Fixed or Random Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Two-Way Fixed Effects</td>
<td><code>feols()</code></td>
<td><code>w : d*</code> + <code>f*</code></td>
<td>Unit Fixed Effect</td>
</tr>
<tr class="even">
<td>Pooled OLS</td>
<td><code>lm()</code></td>
<td><code>w : d*</code> + <code>f*</code> + <code>d*</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Two-Way Mundlak</td>
<td><code>lmer()</code></td>
<td><code>w : d*</code> + <code>f*</code> + <code>d*</code></td>
<td>Unit Random Effect</td>
</tr>
</tbody>
</table>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df4b_nev_ <span class="ot">&lt;-</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  data4b <span class="sc">%&gt;%</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(treatment_time),<span class="dv">0</span>,<span class="fu">as.numeric</span>(<span class="fu">paste0</span>(treatment_time)))) <span class="sc">%&gt;%</span> </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">y =</span> dep_var,<span class="at">w =</span> treat, <span class="at">id =</span> unit,year, treatment_time) <span class="sc">%&gt;%</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  fastDummies<span class="sc">::</span><span class="fu">dummy_cols</span>(<span class="fu">c</span>(<span class="st">"year"</span>,<span class="st">"treatment_time"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_at</span>(<span class="fu">vars</span>(y,w,id,year,treatment_time,<span class="fu">glue</span>(<span class="st">"year_{treatment_years4b_nev}"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.vector</span>(),</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">glue</span>(<span class="st">"treatment_time_{treatment_groups4b}"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_at</span>(<span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">"year_"</span>)),<span class="sc">~</span><span class="fu">gsub</span>(<span class="st">"year_"</span>,<span class="st">"f"</span>,.)) <span class="sc">%&gt;%</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_at</span>(<span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">"treatment_time_"</span>)),<span class="sc">~</span><span class="fu">gsub</span>(<span class="st">"treatment_time_"</span>,<span class="st">"d"</span>,.))</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>fmla_twfe4b_nev <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"y ~ {paste0('w : ',paste0('d',treatment_groups4b), collapse = ' + ')} + {paste0('f',treatment_years4b_nev[-1],collapse=' + ')} | id"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.formula</span>()</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>fit_twfe4b_nev <span class="ot">&lt;-</span> <span class="fu">feols</span>(fmla_twfe4b_nev, <span class="at">data =</span> df4b_nev_)</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>fmla_lm4b_nev <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"y ~ {paste0('w : ',paste0('d',treatment_groups4b), collapse = ' + ')} + {paste0('f',treatment_years4b_nev[-1],collapse=' + ')} + {paste0('d',treatment_groups4b,collapse=' + ')}"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.formula</span>()</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>fit_lm4b_nev <span class="ot">&lt;-</span> <span class="fu">lm</span>(fmla_lm4b_nev, <span class="at">data =</span> df4b_nev_) </span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>fmla_twm4b_nev <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"y ~ {paste0('w : ',paste0('d',treatment_groups4b), collapse = ' + ')} + {paste0('f',treatment_years4b_nev[-1],collapse=' + ')} + {paste0('d',treatment_groups4b,collapse=' + ')} + (1|id)"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.formula</span>()</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>fit_twm4b_nev <span class="ot">&lt;-</span> <span class="fu">lmer</span>( fmla_twm4b_nev , <span class="at">data =</span> df4b_nev_) </span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">method =</span> <span class="fu">c</span>(<span class="st">"TWFE"</span>,<span class="st">"POLS"</span>,<span class="st">"TWM"</span>),</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">formula =</span> <span class="fu">c</span>(<span class="fu">glue</span>(<span class="st">"feols({Reduce(paste,deparse(fmla_twfe4b_nev))}, data = df_)"</span>),</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">glue</span>(<span class="st">"lm({Reduce(paste,deparse(fmla_lm4b_nev))}, data = df_)"</span>),</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">glue</span>(<span class="st">"lmer({Reduce(paste,deparse(fmla_twm4b_nev))}, data = df_)"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(<span class="st">"method"</span> <span class="ot">=</span> <span class="st">"Estimator"</span>,</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>             <span class="st">"formula"</span> <span class="ot">=</span> <span class="st">"Regression Call"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="gcsjrhlxtg" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#gcsjrhlxtg .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#gcsjrhlxtg .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gcsjrhlxtg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#gcsjrhlxtg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#gcsjrhlxtg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gcsjrhlxtg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gcsjrhlxtg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#gcsjrhlxtg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#gcsjrhlxtg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#gcsjrhlxtg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#gcsjrhlxtg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#gcsjrhlxtg .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#gcsjrhlxtg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#gcsjrhlxtg .gt_from_md > :first-child {
  margin-top: 0;
}

#gcsjrhlxtg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#gcsjrhlxtg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#gcsjrhlxtg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#gcsjrhlxtg .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#gcsjrhlxtg .gt_row_group_first td {
  border-top-width: 2px;
}

#gcsjrhlxtg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gcsjrhlxtg .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#gcsjrhlxtg .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#gcsjrhlxtg .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gcsjrhlxtg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gcsjrhlxtg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#gcsjrhlxtg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#gcsjrhlxtg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gcsjrhlxtg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gcsjrhlxtg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gcsjrhlxtg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gcsjrhlxtg .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gcsjrhlxtg .gt_left {
  text-align: left;
}

#gcsjrhlxtg .gt_center {
  text-align: center;
}

#gcsjrhlxtg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#gcsjrhlxtg .gt_font_normal {
  font-weight: normal;
}

#gcsjrhlxtg .gt_font_bold {
  font-weight: bold;
}

#gcsjrhlxtg .gt_font_italic {
  font-style: italic;
}

#gcsjrhlxtg .gt_super {
  font-size: 65%;
}

#gcsjrhlxtg .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#gcsjrhlxtg .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#gcsjrhlxtg .gt_indent_1 {
  text-indent: 5px;
}

#gcsjrhlxtg .gt_indent_2 {
  text-indent: 10px;
}

#gcsjrhlxtg .gt_indent_3 {
  text-indent: 15px;
}

#gcsjrhlxtg .gt_indent_4 {
  text-indent: 20px;
}

#gcsjrhlxtg .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Estimator</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Regression Call</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">TWFE</td>
<td class="gt_row gt_left">feols(y ~ w:d1989 + w:d1998 + f1981 + f1982 + f1983 + f1984 + f1985 +      f1986 + f1987 + f1988 + f1989 + f1990 + f1991 + f1992 + f1993 +      f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 + f2001 +      f2002 + f2003 + f2004 + f2005 + f2006 + f2007 + f2008 + f2009 +      f2010 + f2011 + f2012 + f2013 + f2014 + f2015 + f1989 + f1990 +      f1991 + f1992 + f1993 + f1994 + f1995 + f1996 + f1997 + f1998 +      f1999 + f2000 + f2001 + f2002 + f2003 + f2004 + f2005 + f2006 +      f2007 + f2008 + f2009 + f2010 + f2011 + f2012 + f2013 + f2014 +      f2015 | id, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">POLS</td>
<td class="gt_row gt_left">lm(y ~ w:d1989 + w:d1998 + f1981 + f1982 + f1983 + f1984 + f1985 +      f1986 + f1987 + f1988 + f1989 + f1990 + f1991 + f1992 + f1993 +      f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 + f2001 +      f2002 + f2003 + f2004 + f2005 + f2006 + f2007 + f2008 + f2009 +      f2010 + f2011 + f2012 + f2013 + f2014 + f2015 + f1989 + f1990 +      f1991 + f1992 + f1993 + f1994 + f1995 + f1996 + f1997 + f1998 +      f1999 + f2000 + f2001 + f2002 + f2003 + f2004 + f2005 + f2006 +      f2007 + f2008 + f2009 + f2010 + f2011 + f2012 + f2013 + f2014 +      f2015 + d1989 + d1998, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">TWM</td>
<td class="gt_row gt_left">lmer(y ~ w:d1989 + w:d1998 + f1981 + f1982 + f1983 + f1984 + f1985 +      f1986 + f1987 + f1988 + f1989 + f1990 + f1991 + f1992 + f1993 +      f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 + f2001 +      f2002 + f2003 + f2004 + f2005 + f2006 + f2007 + f2008 + f2009 +      f2010 + f2011 + f2012 + f2013 + f2014 + f2015 + f1989 + f1990 +      f1991 + f1992 + f1993 + f1994 + f1995 + f1996 + f1997 + f1998 +      f1999 + f2000 + f2001 + f2002 + f2003 + f2004 + f2005 + f2006 +      f2007 + f2008 + f2009 + f2010 + f2011 + f2012 + f2013 + f2014 +      f2015 + d1989 + d1998 + (1 | id), data = df_)</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CS</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>data4b_nev_cs <span class="ot">&lt;-</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  data4b <span class="sc">%&gt;%</span> </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(year)),</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">treatment_time =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(treatment_time)))  <span class="sc">%&gt;%</span> </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(treatment_time),<span class="dv">0</span>,treatment_time))</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>fit_cs4b_nev <span class="ot">&lt;-</span> <span class="fu">att_gt</span>(<span class="at">yname =</span> <span class="st">"dep_var"</span>,</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">tname =</span> <span class="st">"year"</span>,</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">idname =</span> <span class="st">"unit"</span>,</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">gname =</span> <span class="st">"treatment_time"</span>,</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">control_group =</span> <span class="st">"nevertreated"</span>,</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> data4b_nev_cs</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>est_cs4b_nev <span class="ot">&lt;-</span>  <span class="fu">tibble</span>(<span class="at">group =</span> <span class="fu">paste0</span>(fit_cs4b<span class="sc">$</span>group), <span class="at">year =</span> fit_cs4b<span class="sc">$</span>t, <span class="at">estimate =</span> fit_cs4b<span class="sc">$</span>att) <span class="sc">%&gt;%</span> </span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"CS"</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="summary-of-estimates-5" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-estimates-5">Summary of Estimates</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>est_twfe4b_nev <span class="ot">&lt;-</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  fit_twfe4b_nev <span class="sc">%&gt;%</span> <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"TWFE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">call =</span> <span class="fu">glue</span>(<span class="st">"feols({Reduce(paste,deparse(fmla_twfe4b_nev))}, data = df4b_nev_)"</span>))</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>est_lm4b_nev <span class="ot">&lt;-</span> </span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  fit_lm4b_nev <span class="sc">%&gt;%</span> <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">call =</span> <span class="fu">glue</span>(<span class="st">"lm({Reduce(paste,deparse(fmla_lm4b_nev))}, data = df4b_nev_)"</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"POLS"</span>)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>est_twm4b_nev <span class="ot">&lt;-</span> </span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  fit_twm4b_nev  <span class="sc">%&gt;%</span> <span class="fu">summary</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"term"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"TWM"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">call =</span> <span class="fu">glue</span>(<span class="st">"lmer({Reduce(paste,deparse(fmla_twm4b_nev))}, data = df4b_nev_)"</span>))</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>est4b_nev <span class="ot">&lt;-</span> </span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>  est_twfe4b_nev <span class="sc">%&gt;%</span> </span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est_lm4b_nev) <span class="sc">%&gt;%</span> </span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est_twm4b_nev) <span class="sc">%&gt;%</span> </span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"^w:"</span>,term)) <span class="sc">%&gt;%</span> </span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(term,<span class="at">into=</span><span class="fu">c</span>(<span class="st">"tmp"</span>,<span class="st">"group"</span>), <span class="at">sep =</span> <span class="st">":"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">gsub</span>(<span class="st">"d"</span>,<span class="st">""</span>,group)) <span class="sc">%&gt;%</span> </span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(group))) <span class="sc">%&gt;%</span> </span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>tmp) <span class="sc">%&gt;%</span> </span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">factor</span>(group))</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>df_est4b_nev <span class="ot">&lt;-</span> </span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(<span class="at">group=</span> treatment_groups4b) <span class="sc">%&gt;%</span> </span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(est4b_nev, <span class="st">"group"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">factor</span>(group))</span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>df_est4b_nev <span class="sc">%&gt;%</span> </span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(group,estimate,method) <span class="sc">%&gt;%</span> </span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(method,estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(group,TWFE,POLS,TWM) <span class="sc">%&gt;%</span> </span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns=</span><span class="fu">c</span>(TWFE,POLS,TWM),<span class="at">decimals=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-sum-case4b-nev" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div id="gyanjrujsb" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#gyanjrujsb .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#gyanjrujsb .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gyanjrujsb .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#gyanjrujsb .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#gyanjrujsb .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gyanjrujsb .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gyanjrujsb .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#gyanjrujsb .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#gyanjrujsb .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#gyanjrujsb .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#gyanjrujsb .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#gyanjrujsb .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#gyanjrujsb .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#gyanjrujsb .gt_from_md > :first-child {
  margin-top: 0;
}

#gyanjrujsb .gt_from_md > :last-child {
  margin-bottom: 0;
}

#gyanjrujsb .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#gyanjrujsb .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#gyanjrujsb .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#gyanjrujsb .gt_row_group_first td {
  border-top-width: 2px;
}

#gyanjrujsb .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gyanjrujsb .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#gyanjrujsb .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#gyanjrujsb .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gyanjrujsb .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gyanjrujsb .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#gyanjrujsb .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#gyanjrujsb .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gyanjrujsb .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gyanjrujsb .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gyanjrujsb .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gyanjrujsb .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gyanjrujsb .gt_left {
  text-align: left;
}

#gyanjrujsb .gt_center {
  text-align: center;
}

#gyanjrujsb .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#gyanjrujsb .gt_font_normal {
  font-weight: normal;
}

#gyanjrujsb .gt_font_bold {
  font-weight: bold;
}

#gyanjrujsb .gt_font_italic {
  font-style: italic;
}

#gyanjrujsb .gt_super {
  font-size: 65%;
}

#gyanjrujsb .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#gyanjrujsb .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#gyanjrujsb .gt_indent_1 {
  text-indent: 5px;
}

#gyanjrujsb .gt_indent_2 {
  text-indent: 10px;
}

#gyanjrujsb .gt_indent_3 {
  text-indent: 15px;
}

#gyanjrujsb .gt_indent_4 {
  text-indent: 20px;
}

#gyanjrujsb .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col">group</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWFE</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">POLS</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWM</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_center">1989</td>
<td class="gt_row gt_right">5.055</td>
<td class="gt_row gt_right">5.055</td>
<td class="gt_row gt_right">5.055</td></tr>
    <tr><td class="gt_row gt_center">1998</td>
<td class="gt_row gt_right">2.983</td>
<td class="gt_row gt_right">2.983</td>
<td class="gt_row gt_right">2.983</td></tr>
  </tbody>
  
  
</table>
</div>
<p></p><figcaption class="figure-caption">Figure 13: Summary of Estimates - Multiple Treatment Periods and Constant Different Treatment Effects (Never Treated as Only Control)</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>df_est4b_nev_ <span class="ot">&lt;-</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(<span class="at">year =</span> treatment_years4b_nev,<span class="at">group =</span> treatment_groups4b) <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(group))) <span class="sc">%&gt;%</span> </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(year))) <span class="sc">%&gt;%</span> </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year<span class="sc">&gt;=</span>group) <span class="sc">%&gt;%</span> </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">factor</span>(group)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    df_est4b,<span class="st">"group"</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est_cs4b)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_data</span>(df4b) <span class="sc">+</span> </span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df_est4b_nev_, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> estimate, <span class="at">colour =</span> <span class="fu">factor</span>(group),<span class="at">lty=</span><span class="fu">factor</span>(method)), <span class="at">lwd=</span><span class="dv">2</span>)  <span class="sc">+</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot-case4b-nev" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="twfe-twm-and-did_files/figure-html/fig-plot-case4b-nev-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 14: Treatment Effect Estimates - Multiple Treatment Periods and Constant Different Treatment Effects (Never Treated as Only Control)</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="case-5-multiple-treatment-periods-and-constant-dynamic-treatment-effects" class="level1">
<h1>Case 5: Multiple Treatment Periods and Constant Dynamic Treatment Effects</h1>
<p>In this case we need to first limit our sample to years &lt; the maximum treatment time.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>params5<span class="ot">=</span>  <span class="fu">list</span>(</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu =</span> <span class="fu">list</span>(<span class="st">"1989"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">"1998"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">"2007"</span> <span class="ot">=</span> <span class="dv">0</span>),</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu_t =</span> <span class="fu">list</span>(<span class="st">"1989"</span> <span class="ot">=</span> <span class="fl">0.3</span>,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>              <span class="st">"1998"</span> <span class="ot">=</span> <span class="fl">0.3</span>,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>              <span class="st">"2007"</span> <span class="ot">=</span> <span class="fl">0.3</span>),</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">tx =</span> <span class="fu">list</span>(<span class="st">"1989"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">17</span>,</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"1998"</span> <span class="ot">=</span> <span class="dv">18</span><span class="sc">:</span><span class="dv">35</span>,</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"2007"</span> <span class="ot">=</span> <span class="dv">36</span><span class="sc">:</span><span class="dv">50</span>),</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">bin =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">5</span>))</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>df5 <span class="ot">&lt;-</span> <span class="fu">make_data</span>(params5,<span class="at">N=</span><span class="dv">200</span>) </span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>data5 <span class="ot">&lt;-</span> df5<span class="sc">$</span>df <span class="sc">%&gt;%</span> </span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dep_var,<span class="at">treatment_time =</span> group, state,unit, year, treat) <span class="sc">%&gt;%</span> </span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(treatment_time, year), factor) <span class="sc">%&gt;%</span> </span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Impose sample restriction</span></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">max_treatment_time=</span> <span class="fu">max</span>(<span class="fu">as.numeric</span>(<span class="fu">paste0</span>(treatment_time)),<span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">as.numeric</span>(<span class="fu">paste0</span>(year))<span class="sc">&lt;</span>max_treatment_time)</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_data</span>(df5) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="twfe-twm-and-did_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>treatment_years5 <span class="ot">&lt;-</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  data5 <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(treat, year) <span class="sc">%&gt;%</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(treat<span class="sc">==</span> <span class="dv">1</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.vector</span>()</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>treatment_groups5_ <span class="ot">&lt;-</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>(data5[data5<span class="sc">$</span>treatment_time <span class="sc">!=</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(data5<span class="sc">$</span>treatment_time),]<span class="sc">$</span>treatment_time) <span class="sc">%&gt;%</span> </span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(.))</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the last year since we have no control group for it. </span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>treatment_groups5 <span class="ot">&lt;-</span> treatment_groups5_[treatment_groups5_<span class="sc">&lt;</span><span class="fu">max</span>(<span class="fu">as.numeric</span>(<span class="fu">paste0</span>(data5<span class="sc">$</span>year)),<span class="at">na.rm =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>treatment_years5 <span class="ot">&lt;-</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>  data5 <span class="sc">%&gt;%</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(treat, year) <span class="sc">%&gt;%</span></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(treat<span class="sc">==</span> <span class="dv">1</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.vector</span>()</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>treatment_interactions5 <span class="ot">&lt;-</span></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(treatment_groups5,treatment_years5) <span class="sc">%&gt;%</span></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(treatment_years5<span class="sc">&gt;=</span> treatment_groups5) <span class="sc">%&gt;%</span></span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">interaction =</span> <span class="fu">glue</span>(<span class="st">"d{treatment_groups5} : f{treatment_years5}"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(interaction) <span class="sc">%&gt;%</span></span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.vector</span>()</span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>df5_ <span class="ot">&lt;-</span></span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a>  data5 <span class="sc">%&gt;%</span></span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(treatment_time),<span class="dv">0</span>,<span class="fu">as.numeric</span>(<span class="fu">paste0</span>(treatment_time)))) <span class="sc">%&gt;%</span> </span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">y =</span> dep_var,<span class="at">w =</span> treat, <span class="at">id =</span> unit,year, treatment_time) <span class="sc">%&gt;%</span></span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a>  fastDummies<span class="sc">::</span><span class="fu">dummy_cols</span>(<span class="fu">c</span>(<span class="st">"year"</span>,<span class="st">"treatment_time"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_at</span>(<span class="fu">vars</span>(y,w,id,year,treatment_time,<span class="fu">glue</span>(<span class="st">"year_{treatment_years5}"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.vector</span>(),</span>
<span id="cb46-37"><a href="#cb46-37" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">glue</span>(<span class="st">"treatment_time_{treatment_groups5}"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb46-38"><a href="#cb46-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_at</span>(<span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">"year_"</span>)),<span class="sc">~</span><span class="fu">gsub</span>(<span class="st">"year_"</span>,<span class="st">"f"</span>,.)) <span class="sc">%&gt;%</span></span>
<span id="cb46-39"><a href="#cb46-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_at</span>(<span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">"treatment_time_"</span>)),<span class="sc">~</span><span class="fu">gsub</span>(<span class="st">"treatment_time_"</span>,<span class="st">"d"</span>,.))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="estimate-models-6" class="level2">
<h2 class="anchored" data-anchor-id="estimate-models-6">Estimate Models</h2>
<p>We next estimate the models</p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>Command</th>
<th>Design Variables</th>
<th>Fixed or Random Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Two-Way Fixed Effects</td>
<td><code>feols()</code></td>
<td><code>d* : f*</code> + <code>f*</code></td>
<td>Unit Fixed Effect</td>
</tr>
<tr class="even">
<td>Pooled OLS</td>
<td><code>lm()</code></td>
<td><code>d* : f*</code> + <code>f*</code> + <code>d*</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Two-Way Mundlak</td>
<td><code>lmer()</code></td>
<td><code>d* : f*</code> + <code>f*</code> + <code>d*</code></td>
<td>Unit Random Effect</td>
</tr>
</tbody>
</table>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>fmla_twfe5 <span class="ot">&lt;-</span>   fmla <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"y ~ {paste0(treatment_interactions5, collapse = ' + ')} + {paste0('f',treatment_years5,collapse=' + ')} | id"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.formula</span>()</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>fit_twfe5 <span class="ot">&lt;-</span> <span class="fu">feols</span>(fmla_twfe5, <span class="at">data =</span> df5_)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>fmla_lm5 <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"y ~ {paste0(treatment_interactions5, collapse = ' + ')} + {paste0('f',treatment_years5,collapse=' + ')} + {paste0('d',treatment_groups5,collapse=' + ')}"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.formula</span>()</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>fit_lm5 <span class="ot">&lt;-</span> <span class="fu">lm</span>(fmla_lm5, <span class="at">data =</span> df5_) </span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>fmla_twm5 <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"y ~ {paste0(treatment_interactions5, collapse = ' + ')} + {paste0('f',treatment_years5,collapse=' + ')} + {paste0('d',treatment_groups5,collapse=' + ')} + (1|id)"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.formula</span>()</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>fit_twm5 <span class="ot">&lt;-</span> <span class="fu">lmer</span>( fmla_twm5 , <span class="at">data =</span> df5_) </span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">method =</span> <span class="fu">c</span>(<span class="st">"TWFE"</span>,<span class="st">"POLS"</span>,<span class="st">"TWM"</span>),</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">formula =</span> <span class="fu">c</span>(<span class="fu">glue</span>(<span class="st">"feols({Reduce(paste,deparse(fmla_twfe5))}, data = df_)"</span>),</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">glue</span>(<span class="st">"lm({Reduce(paste,deparse(fmla_lm5))}, data = df_)"</span>),</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">glue</span>(<span class="st">"lmer({Reduce(paste,deparse(fmla_twm5))}, data = df_)"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(<span class="st">"method"</span> <span class="ot">=</span> <span class="st">"Estimator"</span>,</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>             <span class="st">"formula"</span> <span class="ot">=</span> <span class="st">"Regression Call"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="hfmsprrfil" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#hfmsprrfil .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hfmsprrfil .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hfmsprrfil .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hfmsprrfil .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hfmsprrfil .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hfmsprrfil .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hfmsprrfil .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hfmsprrfil .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hfmsprrfil .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hfmsprrfil .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hfmsprrfil .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hfmsprrfil .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#hfmsprrfil .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hfmsprrfil .gt_from_md > :first-child {
  margin-top: 0;
}

#hfmsprrfil .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hfmsprrfil .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hfmsprrfil .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hfmsprrfil .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hfmsprrfil .gt_row_group_first td {
  border-top-width: 2px;
}

#hfmsprrfil .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hfmsprrfil .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hfmsprrfil .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hfmsprrfil .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hfmsprrfil .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hfmsprrfil .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hfmsprrfil .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#hfmsprrfil .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hfmsprrfil .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hfmsprrfil .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hfmsprrfil .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hfmsprrfil .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hfmsprrfil .gt_left {
  text-align: left;
}

#hfmsprrfil .gt_center {
  text-align: center;
}

#hfmsprrfil .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hfmsprrfil .gt_font_normal {
  font-weight: normal;
}

#hfmsprrfil .gt_font_bold {
  font-weight: bold;
}

#hfmsprrfil .gt_font_italic {
  font-style: italic;
}

#hfmsprrfil .gt_super {
  font-size: 65%;
}

#hfmsprrfil .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#hfmsprrfil .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hfmsprrfil .gt_indent_1 {
  text-indent: 5px;
}

#hfmsprrfil .gt_indent_2 {
  text-indent: 10px;
}

#hfmsprrfil .gt_indent_3 {
  text-indent: 15px;
}

#hfmsprrfil .gt_indent_4 {
  text-indent: 20px;
}

#hfmsprrfil .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Estimator</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Regression Call</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">TWFE</td>
<td class="gt_row gt_left">feols(y ~ d1989:f1989 + d1989:f1990 + d1989:f1991 + d1989:f1992 + d1989:f1993 +      d1989:f1994 + d1989:f1995 + d1989:f1996 + d1989:f1997 + d1989:f1998 +      d1989:f1999 + d1989:f2000 + d1989:f2001 + d1989:f2002 + d1989:f2003 +      d1989:f2004 + d1989:f2005 + d1989:f2006 + d1998:f1998 + d1998:f1999 +      d1998:f2000 + d1998:f2001 + d1998:f2002 + d1998:f2003 + d1998:f2004 +      d1998:f2005 + d1998:f2006 + f1989 + f1990 + f1991 + f1992 +      f1993 + f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 +      f2001 + f2002 + f2003 + f2004 + f2005 + f2006 | id, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">POLS</td>
<td class="gt_row gt_left">lm(y ~ d1989:f1989 + d1989:f1990 + d1989:f1991 + d1989:f1992 + d1989:f1993 +      d1989:f1994 + d1989:f1995 + d1989:f1996 + d1989:f1997 + d1989:f1998 +      d1989:f1999 + d1989:f2000 + d1989:f2001 + d1989:f2002 + d1989:f2003 +      d1989:f2004 + d1989:f2005 + d1989:f2006 + d1998:f1998 + d1998:f1999 +      d1998:f2000 + d1998:f2001 + d1998:f2002 + d1998:f2003 + d1998:f2004 +      d1998:f2005 + d1998:f2006 + f1989 + f1990 + f1991 + f1992 +      f1993 + f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 +      f2001 + f2002 + f2003 + f2004 + f2005 + f2006 + d1989 + d1998, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">TWM</td>
<td class="gt_row gt_left">lmer(y ~ d1989:f1989 + d1989:f1990 + d1989:f1991 + d1989:f1992 + d1989:f1993 +      d1989:f1994 + d1989:f1995 + d1989:f1996 + d1989:f1997 + d1989:f1998 +      d1989:f1999 + d1989:f2000 + d1989:f2001 + d1989:f2002 + d1989:f2003 +      d1989:f2004 + d1989:f2005 + d1989:f2006 + d1998:f1998 + d1998:f1999 +      d1998:f2000 + d1998:f2001 + d1998:f2002 + d1998:f2003 + d1998:f2004 +      d1998:f2005 + d1998:f2006 + f1989 + f1990 + f1991 + f1992 +      f1993 + f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 +      f2001 + f2002 + f2003 + f2004 + f2005 + f2006 + d1989 + d1998 +      (1 | id), data = df_)</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CS</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>data5_cs <span class="ot">&lt;-</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  data5 <span class="sc">%&gt;%</span> </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(year)),</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">treatment_time =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(treatment_time)))  <span class="sc">%&gt;%</span> </span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(treatment_time),<span class="dv">0</span>,treatment_time))</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>fit_cs5 <span class="ot">&lt;-</span> <span class="fu">att_gt</span>(<span class="at">yname =</span> <span class="st">"dep_var"</span>,</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">tname =</span> <span class="st">"year"</span>,</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">idname =</span> <span class="st">"unit"</span>,</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">gname =</span> <span class="st">"treatment_time"</span>,</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">control_group =</span> <span class="st">"notyettreated"</span>,</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> data5_cs</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>est_cs5 <span class="ot">&lt;-</span>  <span class="fu">tibble</span>(<span class="at">group =</span> <span class="fu">paste0</span>(fit_cs5<span class="sc">$</span>group), <span class="at">year =</span> fit_cs5<span class="sc">$</span>t, <span class="at">estimate =</span> fit_cs5<span class="sc">$</span>att) <span class="sc">%&gt;%</span> </span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"CS"</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>est_twfe5 <span class="ot">&lt;-</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  fit_twfe5 <span class="sc">%&gt;%</span> <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"TWFE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">call =</span> <span class="fu">glue</span>(<span class="st">"feols({Reduce(paste,deparse(fmla_twfe5))}, data = df5_)"</span>))</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>est_lm5 <span class="ot">&lt;-</span> </span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  fit_lm5 <span class="sc">%&gt;%</span> <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">call =</span> <span class="fu">glue</span>(<span class="st">"lm({Reduce(paste,deparse(fmla_lm5))}, data = df5_)"</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"POLS"</span>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>est_twm5 <span class="ot">&lt;-</span> </span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  fit_twm5  <span class="sc">%&gt;%</span> <span class="fu">summary</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"term"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"TWM"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">call =</span> <span class="fu">glue</span>(<span class="st">"lmer({Reduce(paste,deparse(fmla_twm5))}, data = df5_)"</span>))</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>est5 <span class="ot">&lt;-</span> </span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>  est_twfe5 <span class="sc">%&gt;%</span> </span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est_lm5) <span class="sc">%&gt;%</span> </span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est_twm5) <span class="sc">%&gt;%</span> </span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"^f|^d"</span>,term)) <span class="sc">%&gt;%</span> </span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">":"</span>,term)) <span class="sc">%&gt;%</span>   </span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">#data.frame() %&gt;% select(term,estimate) %&gt;% </span></span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(term,<span class="at">into=</span><span class="fu">c</span>(<span class="st">"one"</span>,<span class="st">"two"</span>), <span class="at">sep =</span> <span class="st">":"</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">case_when</span>(<span class="fu">grepl</span>(<span class="st">"^d"</span>,one) <span class="sc">~</span> one, </span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>                           <span class="cn">TRUE</span> <span class="sc">~</span> two)) <span class="sc">%&gt;%</span> </span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">case_when</span>(<span class="fu">grepl</span>(<span class="st">"^f"</span>,one) <span class="sc">~</span> one, </span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>                           <span class="cn">TRUE</span> <span class="sc">~</span> two))     <span class="sc">%&gt;%</span> </span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">gsub</span>(<span class="st">"d"</span>,<span class="st">""</span>,group)) <span class="sc">%&gt;%</span> </span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(group)))  <span class="sc">%&gt;%</span> </span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">gsub</span>(<span class="st">"f"</span>,<span class="st">""</span>,year)) <span class="sc">%&gt;%</span>     </span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(year))) <span class="sc">%&gt;%</span> </span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>one,<span class="sc">-</span>two) <span class="sc">%&gt;%</span> </span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est_cs5 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(group))))</span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a>df_est5 <span class="ot">&lt;-</span> </span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(<span class="at">group=</span> treatment_groups5, <span class="at">year =</span> treatment_years5) <span class="sc">%&gt;%</span> </span>
<span id="cb49-42"><a href="#cb49-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(year))) <span class="sc">%&gt;%</span> </span>
<span id="cb49-44"><a href="#cb49-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(est5, <span class="fu">c</span>(<span class="st">"group"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb49-45"><a href="#cb49-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(year))) <span class="sc">%&gt;%</span> </span>
<span id="cb49-46"><a href="#cb49-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(estimate))</span>
<span id="cb49-47"><a href="#cb49-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-48"><a href="#cb49-48" aria-hidden="true" tabindex="-1"></a>df_est5 <span class="sc">%&gt;%</span> </span>
<span id="cb49-49"><a href="#cb49-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(group, year,estimate,method) <span class="sc">%&gt;%</span> </span>
<span id="cb49-50"><a href="#cb49-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(method,estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb49-51"><a href="#cb49-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(group, year,TWFE,POLS,TWM,CS) <span class="sc">%&gt;%</span> </span>
<span id="cb49-52"><a href="#cb49-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb49-53"><a href="#cb49-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb49-54"><a href="#cb49-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns=</span><span class="fu">c</span>(TWFE,POLS,TWM,CS),<span class="at">decimals=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="askyxszgtx" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#askyxszgtx .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#askyxszgtx .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#askyxszgtx .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#askyxszgtx .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#askyxszgtx .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#askyxszgtx .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#askyxszgtx .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#askyxszgtx .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#askyxszgtx .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#askyxszgtx .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#askyxszgtx .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#askyxszgtx .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#askyxszgtx .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#askyxszgtx .gt_from_md > :first-child {
  margin-top: 0;
}

#askyxszgtx .gt_from_md > :last-child {
  margin-bottom: 0;
}

#askyxszgtx .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#askyxszgtx .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#askyxszgtx .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#askyxszgtx .gt_row_group_first td {
  border-top-width: 2px;
}

#askyxszgtx .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#askyxszgtx .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#askyxszgtx .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#askyxszgtx .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#askyxszgtx .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#askyxszgtx .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#askyxszgtx .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#askyxszgtx .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#askyxszgtx .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#askyxszgtx .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#askyxszgtx .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#askyxszgtx .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#askyxszgtx .gt_left {
  text-align: left;
}

#askyxszgtx .gt_center {
  text-align: center;
}

#askyxszgtx .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#askyxszgtx .gt_font_normal {
  font-weight: normal;
}

#askyxszgtx .gt_font_bold {
  font-weight: bold;
}

#askyxszgtx .gt_font_italic {
  font-style: italic;
}

#askyxszgtx .gt_super {
  font-size: 65%;
}

#askyxszgtx .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#askyxszgtx .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#askyxszgtx .gt_indent_1 {
  text-indent: 5px;
}

#askyxszgtx .gt_indent_2 {
  text-indent: 10px;
}

#askyxszgtx .gt_indent_3 {
  text-indent: 15px;
}

#askyxszgtx .gt_indent_4 {
  text-indent: 20px;
}

#askyxszgtx .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">group</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">year</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWFE</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">POLS</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWM</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">CS</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">0.205</td>
<td class="gt_row gt_right">0.205</td>
<td class="gt_row gt_right">0.205</td>
<td class="gt_row gt_right">0.120</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1990</td>
<td class="gt_row gt_right">0.504</td>
<td class="gt_row gt_right">0.504</td>
<td class="gt_row gt_right">0.504</td>
<td class="gt_row gt_right">0.419</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1991</td>
<td class="gt_row gt_right">0.792</td>
<td class="gt_row gt_right">0.792</td>
<td class="gt_row gt_right">0.792</td>
<td class="gt_row gt_right">0.706</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1992</td>
<td class="gt_row gt_right">1.053</td>
<td class="gt_row gt_right">1.053</td>
<td class="gt_row gt_right">1.053</td>
<td class="gt_row gt_right">0.968</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1993</td>
<td class="gt_row gt_right">1.359</td>
<td class="gt_row gt_right">1.359</td>
<td class="gt_row gt_right">1.359</td>
<td class="gt_row gt_right">1.274</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1994</td>
<td class="gt_row gt_right">1.740</td>
<td class="gt_row gt_right">1.740</td>
<td class="gt_row gt_right">1.740</td>
<td class="gt_row gt_right">1.655</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1995</td>
<td class="gt_row gt_right">2.056</td>
<td class="gt_row gt_right">2.056</td>
<td class="gt_row gt_right">2.056</td>
<td class="gt_row gt_right">1.971</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1996</td>
<td class="gt_row gt_right">2.167</td>
<td class="gt_row gt_right">2.167</td>
<td class="gt_row gt_right">2.167</td>
<td class="gt_row gt_right">2.082</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1997</td>
<td class="gt_row gt_right">2.500</td>
<td class="gt_row gt_right">2.500</td>
<td class="gt_row gt_right">2.500</td>
<td class="gt_row gt_right">2.415</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2.628</td>
<td class="gt_row gt_right">2.628</td>
<td class="gt_row gt_right">2.628</td>
<td class="gt_row gt_right">2.609</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1999</td>
<td class="gt_row gt_right">3.005</td>
<td class="gt_row gt_right">3.005</td>
<td class="gt_row gt_right">3.005</td>
<td class="gt_row gt_right">2.986</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">2000</td>
<td class="gt_row gt_right">3.310</td>
<td class="gt_row gt_right">3.310</td>
<td class="gt_row gt_right">3.310</td>
<td class="gt_row gt_right">3.291</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">2001</td>
<td class="gt_row gt_right">3.550</td>
<td class="gt_row gt_right">3.550</td>
<td class="gt_row gt_right">3.550</td>
<td class="gt_row gt_right">3.531</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">2002</td>
<td class="gt_row gt_right">3.890</td>
<td class="gt_row gt_right">3.890</td>
<td class="gt_row gt_right">3.890</td>
<td class="gt_row gt_right">3.870</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">2003</td>
<td class="gt_row gt_right">4.261</td>
<td class="gt_row gt_right">4.261</td>
<td class="gt_row gt_right">4.261</td>
<td class="gt_row gt_right">4.242</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">2004</td>
<td class="gt_row gt_right">4.366</td>
<td class="gt_row gt_right">4.366</td>
<td class="gt_row gt_right">4.366</td>
<td class="gt_row gt_right">4.346</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">2005</td>
<td class="gt_row gt_right">4.743</td>
<td class="gt_row gt_right">4.743</td>
<td class="gt_row gt_right">4.743</td>
<td class="gt_row gt_right">4.724</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">2006</td>
<td class="gt_row gt_right">5.018</td>
<td class="gt_row gt_right">5.018</td>
<td class="gt_row gt_right">5.018</td>
<td class="gt_row gt_right">4.998</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">0.177</td>
<td class="gt_row gt_right">0.177</td>
<td class="gt_row gt_right">0.177</td>
<td class="gt_row gt_right">0.281</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">1999</td>
<td class="gt_row gt_right">0.624</td>
<td class="gt_row gt_right">0.624</td>
<td class="gt_row gt_right">0.624</td>
<td class="gt_row gt_right">0.728</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2000</td>
<td class="gt_row gt_right">0.860</td>
<td class="gt_row gt_right">0.860</td>
<td class="gt_row gt_right">0.860</td>
<td class="gt_row gt_right">0.964</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2001</td>
<td class="gt_row gt_right">1.174</td>
<td class="gt_row gt_right">1.174</td>
<td class="gt_row gt_right">1.174</td>
<td class="gt_row gt_right">1.278</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2002</td>
<td class="gt_row gt_right">1.487</td>
<td class="gt_row gt_right">1.487</td>
<td class="gt_row gt_right">1.487</td>
<td class="gt_row gt_right">1.591</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2003</td>
<td class="gt_row gt_right">1.871</td>
<td class="gt_row gt_right">1.871</td>
<td class="gt_row gt_right">1.871</td>
<td class="gt_row gt_right">1.975</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2004</td>
<td class="gt_row gt_right">2.031</td>
<td class="gt_row gt_right">2.031</td>
<td class="gt_row gt_right">2.031</td>
<td class="gt_row gt_right">2.135</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2005</td>
<td class="gt_row gt_right">2.495</td>
<td class="gt_row gt_right">2.495</td>
<td class="gt_row gt_right">2.495</td>
<td class="gt_row gt_right">2.599</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2006</td>
<td class="gt_row gt_right">2.703</td>
<td class="gt_row gt_right">2.703</td>
<td class="gt_row gt_right">2.703</td>
<td class="gt_row gt_right">2.807</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</section>
<section id="summary-of-estimates-6" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-estimates-6">Summary of Estimates</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_data</span>(df5)  <span class="sc">+</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df_est5, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> estimate, <span class="at">colour =</span> <span class="fu">factor</span>(group),<span class="at">lty=</span><span class="fu">factor</span>(method)), <span class="at">lwd=</span><span class="dv">2</span>)  <span class="sc">+</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot-case5" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="twfe-twm-and-did_files/figure-html/fig-plot-case5-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 15: Treatment Effect Estimates - Multiple Treatment Periods and Constant Dynamic Treatment Effects</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>df_est5 <span class="sc">%&gt;%</span> </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(group,year, estimate,method) <span class="sc">%&gt;%</span> </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(method <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"TWFE"</span>,<span class="st">"CS"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(method,estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> TWFE, <span class="at">y =</span> CS, <span class="at">group =</span> year, <span class="at">colour =</span> <span class="fu">factor</span>(group)))<span class="sc">+</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#facet_wrap(~group) + </span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_few</span>() <span class="sc">+</span> </span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">slope=</span><span class="dv">1</span>,<span class="at">intercept=</span><span class="dv">0</span>),<span class="at">lty=</span><span class="dv">3</span>)  <span class="sc">+</span> </span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span> </span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  ggsci<span class="sc">::</span><span class="fu">scale_color_aaas</span>(<span class="at">name=</span><span class="st">"Treatment Cohort"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot-case5-comp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="twfe-twm-and-did_files/figure-html/fig-plot-case5-comp-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 16: Comparison of Treatment Effect Estimates - Multiple Treatment Periods and Constant Dynamic Treatment Effects</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="case-6-multiple-treatment-periods-and-heterogeneous-dynamic-treatment-effects" class="level1">
<h1>Case 6 : Multiple Treatment Periods and Heterogeneous Dynamic Treatment Effects</h1>
<p>In this case we need to first limit our sample to years &lt; the maximum treatment time.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>params6<span class="ot">=</span>  <span class="fu">list</span>(</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu =</span> <span class="fu">list</span>(<span class="st">"1989"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">"1998"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">"2007"</span> <span class="ot">=</span> <span class="dv">0</span>),</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu_t =</span> <span class="fu">list</span>(<span class="st">"1989"</span> <span class="ot">=</span> <span class="fl">0.5</span>,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>              <span class="st">"1998"</span> <span class="ot">=</span> <span class="fl">0.3</span>,</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>              <span class="st">"2007"</span> <span class="ot">=</span> <span class="fl">0.1</span>),</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">tx =</span> <span class="fu">list</span>(<span class="st">"1989"</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">17</span>,</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"1998"</span> <span class="ot">=</span> <span class="dv">18</span><span class="sc">:</span><span class="dv">35</span>,</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"2007"</span> <span class="ot">=</span> <span class="dv">36</span><span class="sc">:</span><span class="dv">50</span>),</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">bin =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">5</span>))</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>df6 <span class="ot">&lt;-</span> <span class="fu">make_data</span>(params6,<span class="at">N=</span><span class="dv">200</span>) </span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>data6 <span class="ot">&lt;-</span> df6<span class="sc">$</span>df <span class="sc">%&gt;%</span> </span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dep_var,<span class="at">treatment_time =</span> group, state,unit, year, treat) <span class="sc">%&gt;%</span> </span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(treatment_time, year), factor) <span class="sc">%&gt;%</span> </span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Impose sample restriction</span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">max_treatment_time=</span> <span class="fu">max</span>(<span class="fu">as.numeric</span>(<span class="fu">paste0</span>(treatment_time)),<span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">as.numeric</span>(<span class="fu">paste0</span>(year))<span class="sc">&lt;</span>max_treatment_time)</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_data</span>(df6) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="twfe-twm-and-did_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>treatment_years6 <span class="ot">&lt;-</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  data6 <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(treat, year) <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(treat<span class="sc">==</span> <span class="dv">1</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.vector</span>()</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>treatment_groups6_ <span class="ot">&lt;-</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>(data6[data6<span class="sc">$</span>treatment_time <span class="sc">!=</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(data6<span class="sc">$</span>treatment_time),]<span class="sc">$</span>treatment_time) <span class="sc">%&gt;%</span> </span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(.))</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the last year since we have no control group for it. </span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>treatment_groups6 <span class="ot">&lt;-</span> treatment_groups6_[treatment_groups6_<span class="sc">&lt;</span><span class="fu">max</span>(<span class="fu">as.numeric</span>(<span class="fu">paste0</span>(data6<span class="sc">$</span>year)),<span class="at">na.rm =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>treatment_years6 <span class="ot">&lt;-</span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>  data6 <span class="sc">%&gt;%</span></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(treat, year) <span class="sc">%&gt;%</span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(treat<span class="sc">==</span> <span class="dv">1</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.vector</span>()</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>treatment_interactions6 <span class="ot">&lt;-</span></span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(treatment_groups6,treatment_years6) <span class="sc">%&gt;%</span></span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(treatment_years6<span class="sc">&gt;=</span> treatment_groups6) <span class="sc">%&gt;%</span></span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">interaction =</span> <span class="fu">glue</span>(<span class="st">"d{treatment_groups6} : f{treatment_years6}"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(interaction) <span class="sc">%&gt;%</span></span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.vector</span>()</span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a>df6_ <span class="ot">&lt;-</span></span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a>  data6 <span class="sc">%&gt;%</span></span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(treatment_time),<span class="dv">0</span>,<span class="fu">as.numeric</span>(<span class="fu">paste0</span>(treatment_time)))) <span class="sc">%&gt;%</span> </span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">y =</span> dep_var,<span class="at">w =</span> treat, <span class="at">id =</span> unit,year, treatment_time) <span class="sc">%&gt;%</span></span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true" tabindex="-1"></a>  fastDummies<span class="sc">::</span><span class="fu">dummy_cols</span>(<span class="fu">c</span>(<span class="st">"year"</span>,<span class="st">"treatment_time"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb53-36"><a href="#cb53-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_at</span>(<span class="fu">vars</span>(y,w,id,year,treatment_time,<span class="fu">glue</span>(<span class="st">"year_{treatment_years6}"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.vector</span>(),</span>
<span id="cb53-37"><a href="#cb53-37" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">glue</span>(<span class="st">"treatment_time_{treatment_groups6}"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb53-38"><a href="#cb53-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_at</span>(<span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">"year_"</span>)),<span class="sc">~</span><span class="fu">gsub</span>(<span class="st">"year_"</span>,<span class="st">"f"</span>,.)) <span class="sc">%&gt;%</span></span>
<span id="cb53-39"><a href="#cb53-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_at</span>(<span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">"treatment_time_"</span>)),<span class="sc">~</span><span class="fu">gsub</span>(<span class="st">"treatment_time_"</span>,<span class="st">"d"</span>,.))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="estimate-models-7" class="level2">
<h2 class="anchored" data-anchor-id="estimate-models-7">Estimate Models</h2>
<p>We next estimate the models</p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Method</th>
<th>Command</th>
<th>Design Variables</th>
<th>Fixed or Random Effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Two-Way Fixed Effects</td>
<td><code>feols()</code></td>
<td><code>d* : f*</code> + <code>f*</code></td>
<td>Unit Fixed Effect</td>
</tr>
<tr class="even">
<td>Pooled OLS</td>
<td><code>lm()</code></td>
<td><code>d* : f*</code> + <code>f*</code> + <code>d*</code></td>
<td></td>
</tr>
<tr class="odd">
<td>Two-Way Mundlak</td>
<td><code>lmer()</code></td>
<td><code>d* : f*</code> + <code>f*</code> + <code>d*</code></td>
<td>Unit Random Effect</td>
</tr>
</tbody>
</table>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>fmla_twfe6 <span class="ot">&lt;-</span>   fmla <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"y ~ {paste0(treatment_interactions6, collapse = ' + ')} + {paste0('f',treatment_years6,collapse=' + ')} | id"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.formula</span>()</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>fit_twfe6 <span class="ot">&lt;-</span> <span class="fu">feols</span>(fmla_twfe6, <span class="at">data =</span> df6_)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>fmla_lm6 <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"y ~ {paste0(treatment_interactions6, collapse = ' + ')} + {paste0('f',treatment_years6,collapse=' + ')} + {paste0('d',treatment_groups6,collapse=' + ')}"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.formula</span>()</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>fit_lm6 <span class="ot">&lt;-</span> <span class="fu">lm</span>(fmla_lm6, <span class="at">data =</span> df6_) </span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>fmla_twm6 <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"y ~ {paste0(treatment_interactions6, collapse = ' + ')} + {paste0('f',treatment_years6,collapse=' + ')} + {paste0('d',treatment_groups6,collapse=' + ')} + (1|id)"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.formula</span>()</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>fit_twm6 <span class="ot">&lt;-</span> <span class="fu">lmer</span>( fmla_twm6 , <span class="at">data =</span> df6_) </span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">method =</span> <span class="fu">c</span>(<span class="st">"TWFE"</span>,<span class="st">"POLS"</span>,<span class="st">"TWM"</span>),</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">formula =</span> <span class="fu">c</span>(<span class="fu">glue</span>(<span class="st">"feols({Reduce(paste,deparse(fmla_twfe6))}, data = df_)"</span>),</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">glue</span>(<span class="st">"lm({Reduce(paste,deparse(fmla_lm6))}, data = df_)"</span>),</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">glue</span>(<span class="st">"lmer({Reduce(paste,deparse(fmla_twm6))}, data = df_)"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(<span class="st">"method"</span> <span class="ot">=</span> <span class="st">"Estimator"</span>,</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>             <span class="st">"formula"</span> <span class="ot">=</span> <span class="st">"Regression Call"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="hfmsprrfil" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#hfmsprrfil .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hfmsprrfil .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hfmsprrfil .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hfmsprrfil .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hfmsprrfil .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hfmsprrfil .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hfmsprrfil .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hfmsprrfil .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hfmsprrfil .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hfmsprrfil .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hfmsprrfil .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hfmsprrfil .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#hfmsprrfil .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hfmsprrfil .gt_from_md > :first-child {
  margin-top: 0;
}

#hfmsprrfil .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hfmsprrfil .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hfmsprrfil .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hfmsprrfil .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hfmsprrfil .gt_row_group_first td {
  border-top-width: 2px;
}

#hfmsprrfil .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hfmsprrfil .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hfmsprrfil .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hfmsprrfil .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hfmsprrfil .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hfmsprrfil .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hfmsprrfil .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#hfmsprrfil .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hfmsprrfil .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hfmsprrfil .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hfmsprrfil .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hfmsprrfil .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hfmsprrfil .gt_left {
  text-align: left;
}

#hfmsprrfil .gt_center {
  text-align: center;
}

#hfmsprrfil .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hfmsprrfil .gt_font_normal {
  font-weight: normal;
}

#hfmsprrfil .gt_font_bold {
  font-weight: bold;
}

#hfmsprrfil .gt_font_italic {
  font-style: italic;
}

#hfmsprrfil .gt_super {
  font-size: 65%;
}

#hfmsprrfil .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#hfmsprrfil .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hfmsprrfil .gt_indent_1 {
  text-indent: 5px;
}

#hfmsprrfil .gt_indent_2 {
  text-indent: 10px;
}

#hfmsprrfil .gt_indent_3 {
  text-indent: 15px;
}

#hfmsprrfil .gt_indent_4 {
  text-indent: 20px;
}

#hfmsprrfil .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Estimator</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">Regression Call</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">TWFE</td>
<td class="gt_row gt_left">feols(y ~ d1989:f1989 + d1989:f1990 + d1989:f1991 + d1989:f1992 + d1989:f1993 +      d1989:f1994 + d1989:f1995 + d1989:f1996 + d1989:f1997 + d1989:f1998 +      d1989:f1999 + d1989:f2000 + d1989:f2001 + d1989:f2002 + d1989:f2003 +      d1989:f2004 + d1989:f2005 + d1989:f2006 + d1998:f1998 + d1998:f1999 +      d1998:f2000 + d1998:f2001 + d1998:f2002 + d1998:f2003 + d1998:f2004 +      d1998:f2005 + d1998:f2006 + f1989 + f1990 + f1991 + f1992 +      f1993 + f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 +      f2001 + f2002 + f2003 + f2004 + f2005 + f2006 | id, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">POLS</td>
<td class="gt_row gt_left">lm(y ~ d1989:f1989 + d1989:f1990 + d1989:f1991 + d1989:f1992 + d1989:f1993 +      d1989:f1994 + d1989:f1995 + d1989:f1996 + d1989:f1997 + d1989:f1998 +      d1989:f1999 + d1989:f2000 + d1989:f2001 + d1989:f2002 + d1989:f2003 +      d1989:f2004 + d1989:f2005 + d1989:f2006 + d1998:f1998 + d1998:f1999 +      d1998:f2000 + d1998:f2001 + d1998:f2002 + d1998:f2003 + d1998:f2004 +      d1998:f2005 + d1998:f2006 + f1989 + f1990 + f1991 + f1992 +      f1993 + f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 +      f2001 + f2002 + f2003 + f2004 + f2005 + f2006 + d1989 + d1998, data = df_)</td></tr>
    <tr><td class="gt_row gt_left">TWM</td>
<td class="gt_row gt_left">lmer(y ~ d1989:f1989 + d1989:f1990 + d1989:f1991 + d1989:f1992 + d1989:f1993 +      d1989:f1994 + d1989:f1995 + d1989:f1996 + d1989:f1997 + d1989:f1998 +      d1989:f1999 + d1989:f2000 + d1989:f2001 + d1989:f2002 + d1989:f2003 +      d1989:f2004 + d1989:f2005 + d1989:f2006 + d1998:f1998 + d1998:f1999 +      d1998:f2000 + d1998:f2001 + d1998:f2002 + d1998:f2003 + d1998:f2004 +      d1998:f2005 + d1998:f2006 + f1989 + f1990 + f1991 + f1992 +      f1993 + f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 +      f2001 + f2002 + f2003 + f2004 + f2005 + f2006 + d1989 + d1998 +      (1 | id), data = df_)</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CS</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>data6_cs <span class="ot">&lt;-</span> </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  data6 <span class="sc">%&gt;%</span> </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(year)),</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">treatment_time =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(treatment_time)))  <span class="sc">%&gt;%</span> </span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(treatment_time),<span class="dv">0</span>,treatment_time))</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>fit_cs6 <span class="ot">&lt;-</span> <span class="fu">att_gt</span>(<span class="at">yname =</span> <span class="st">"dep_var"</span>,</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">tname =</span> <span class="st">"year"</span>,</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">idname =</span> <span class="st">"unit"</span>,</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">gname =</span> <span class="st">"treatment_time"</span>,</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">control_group =</span> <span class="st">"notyettreated"</span>,</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> data6_cs</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>est_cs6 <span class="ot">&lt;-</span>  <span class="fu">tibble</span>(<span class="at">group =</span> <span class="fu">paste0</span>(fit_cs6<span class="sc">$</span>group), <span class="at">year =</span> fit_cs6<span class="sc">$</span>t, <span class="at">estimate =</span> fit_cs6<span class="sc">$</span>att) <span class="sc">%&gt;%</span> </span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"CS"</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="summary-of-estimates-7" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-estimates-7">Summary of Estimates</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>est_twfe6 <span class="ot">&lt;-</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  fit_twfe6 <span class="sc">%&gt;%</span> <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"TWFE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">call =</span> <span class="fu">glue</span>(<span class="st">"feols({Reduce(paste,deparse(fmla_twfe6))}, data = df6_)"</span>))</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>est_lm6 <span class="ot">&lt;-</span> </span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  fit_lm6 <span class="sc">%&gt;%</span> <span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">call =</span> <span class="fu">glue</span>(<span class="st">"lm({Reduce(paste,deparse(fmla_lm6))}, data = df6_)"</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"POLS"</span>)</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>est_twm6 <span class="ot">&lt;-</span> </span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  fit_twm6  <span class="sc">%&gt;%</span> <span class="fu">summary</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"term"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"TWM"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">call =</span> <span class="fu">glue</span>(<span class="st">"lmer({Reduce(paste,deparse(fmla_twm6))}, data = df6_)"</span>))</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>est6 <span class="ot">&lt;-</span> </span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>  est_twfe6 <span class="sc">%&gt;%</span> </span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est_lm6) <span class="sc">%&gt;%</span> </span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est_twm6) <span class="sc">%&gt;%</span> </span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"^f|^d"</span>,term)) <span class="sc">%&gt;%</span> </span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">":"</span>,term)) <span class="sc">%&gt;%</span>   </span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">#data.frame() %&gt;% select(term,estimate) %&gt;% </span></span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(term,<span class="at">into=</span><span class="fu">c</span>(<span class="st">"one"</span>,<span class="st">"two"</span>), <span class="at">sep =</span> <span class="st">":"</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">case_when</span>(<span class="fu">grepl</span>(<span class="st">"^d"</span>,one) <span class="sc">~</span> one, </span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>                           <span class="cn">TRUE</span> <span class="sc">~</span> two)) <span class="sc">%&gt;%</span> </span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">case_when</span>(<span class="fu">grepl</span>(<span class="st">"^f"</span>,one) <span class="sc">~</span> one, </span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>                           <span class="cn">TRUE</span> <span class="sc">~</span> two))     <span class="sc">%&gt;%</span> </span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">gsub</span>(<span class="st">"d"</span>,<span class="st">""</span>,group)) <span class="sc">%&gt;%</span> </span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(group)))  <span class="sc">%&gt;%</span> </span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">gsub</span>(<span class="st">"f"</span>,<span class="st">""</span>,year)) <span class="sc">%&gt;%</span>     </span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(year))) <span class="sc">%&gt;%</span> </span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>one,<span class="sc">-</span>two) <span class="sc">%&gt;%</span> </span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est_cs6 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(group))))</span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>df_est6 <span class="ot">&lt;-</span> </span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(<span class="at">group=</span> treatment_groups6, <span class="at">year =</span> treatment_years6) <span class="sc">%&gt;%</span> </span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(year))) <span class="sc">%&gt;%</span> </span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(est6, <span class="fu">c</span>(<span class="st">"group"</span>,<span class="st">"year"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(year))) <span class="sc">%&gt;%</span> </span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(estimate))</span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a>df_est6 <span class="sc">%&gt;%</span> </span>
<span id="cb56-49"><a href="#cb56-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(group, year,estimate,method) <span class="sc">%&gt;%</span> </span>
<span id="cb56-50"><a href="#cb56-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(method,estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb56-51"><a href="#cb56-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(group, year,TWFE,POLS,TWM,CS) <span class="sc">%&gt;%</span> </span>
<span id="cb56-52"><a href="#cb56-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb56-53"><a href="#cb56-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb56-54"><a href="#cb56-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns=</span><span class="fu">c</span>(TWFE,POLS,TWM,CS),<span class="at">decimals=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="askyxszgtx" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#askyxszgtx .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#askyxszgtx .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#askyxszgtx .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#askyxszgtx .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#askyxszgtx .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#askyxszgtx .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#askyxszgtx .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#askyxszgtx .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#askyxszgtx .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#askyxszgtx .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#askyxszgtx .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#askyxszgtx .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#askyxszgtx .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#askyxszgtx .gt_from_md > :first-child {
  margin-top: 0;
}

#askyxszgtx .gt_from_md > :last-child {
  margin-bottom: 0;
}

#askyxszgtx .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#askyxszgtx .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#askyxszgtx .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#askyxszgtx .gt_row_group_first td {
  border-top-width: 2px;
}

#askyxszgtx .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#askyxszgtx .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#askyxszgtx .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#askyxszgtx .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#askyxszgtx .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#askyxszgtx .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#askyxszgtx .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#askyxszgtx .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#askyxszgtx .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#askyxszgtx .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#askyxszgtx .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#askyxszgtx .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#askyxszgtx .gt_left {
  text-align: left;
}

#askyxszgtx .gt_center {
  text-align: center;
}

#askyxszgtx .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#askyxszgtx .gt_font_normal {
  font-weight: normal;
}

#askyxszgtx .gt_font_bold {
  font-weight: bold;
}

#askyxszgtx .gt_font_italic {
  font-style: italic;
}

#askyxszgtx .gt_super {
  font-size: 65%;
}

#askyxszgtx .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#askyxszgtx .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#askyxszgtx .gt_indent_1 {
  text-indent: 5px;
}

#askyxszgtx .gt_indent_2 {
  text-indent: 10px;
}

#askyxszgtx .gt_indent_3 {
  text-indent: 15px;
}

#askyxszgtx .gt_indent_4 {
  text-indent: 20px;
}

#askyxszgtx .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">group</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">year</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWFE</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">POLS</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">TWM</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">CS</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">0.405</td>
<td class="gt_row gt_right">0.405</td>
<td class="gt_row gt_right">0.405</td>
<td class="gt_row gt_right">0.320</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1990</td>
<td class="gt_row gt_right">0.904</td>
<td class="gt_row gt_right">0.904</td>
<td class="gt_row gt_right">0.904</td>
<td class="gt_row gt_right">0.819</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1991</td>
<td class="gt_row gt_right">1.392</td>
<td class="gt_row gt_right">1.392</td>
<td class="gt_row gt_right">1.392</td>
<td class="gt_row gt_right">1.306</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1992</td>
<td class="gt_row gt_right">1.853</td>
<td class="gt_row gt_right">1.853</td>
<td class="gt_row gt_right">1.853</td>
<td class="gt_row gt_right">1.768</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1993</td>
<td class="gt_row gt_right">2.359</td>
<td class="gt_row gt_right">2.359</td>
<td class="gt_row gt_right">2.359</td>
<td class="gt_row gt_right">2.274</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1994</td>
<td class="gt_row gt_right">2.940</td>
<td class="gt_row gt_right">2.940</td>
<td class="gt_row gt_right">2.940</td>
<td class="gt_row gt_right">2.855</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1995</td>
<td class="gt_row gt_right">3.456</td>
<td class="gt_row gt_right">3.456</td>
<td class="gt_row gt_right">3.456</td>
<td class="gt_row gt_right">3.371</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1996</td>
<td class="gt_row gt_right">3.767</td>
<td class="gt_row gt_right">3.767</td>
<td class="gt_row gt_right">3.767</td>
<td class="gt_row gt_right">3.682</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1997</td>
<td class="gt_row gt_right">4.300</td>
<td class="gt_row gt_right">4.300</td>
<td class="gt_row gt_right">4.300</td>
<td class="gt_row gt_right">4.215</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">4.628</td>
<td class="gt_row gt_right">4.628</td>
<td class="gt_row gt_right">4.628</td>
<td class="gt_row gt_right">4.609</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">1999</td>
<td class="gt_row gt_right">5.205</td>
<td class="gt_row gt_right">5.205</td>
<td class="gt_row gt_right">5.205</td>
<td class="gt_row gt_right">5.186</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">2000</td>
<td class="gt_row gt_right">5.710</td>
<td class="gt_row gt_right">5.710</td>
<td class="gt_row gt_right">5.710</td>
<td class="gt_row gt_right">5.691</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">2001</td>
<td class="gt_row gt_right">6.150</td>
<td class="gt_row gt_right">6.150</td>
<td class="gt_row gt_right">6.150</td>
<td class="gt_row gt_right">6.131</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">2002</td>
<td class="gt_row gt_right">6.690</td>
<td class="gt_row gt_right">6.690</td>
<td class="gt_row gt_right">6.690</td>
<td class="gt_row gt_right">6.670</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">2003</td>
<td class="gt_row gt_right">7.261</td>
<td class="gt_row gt_right">7.261</td>
<td class="gt_row gt_right">7.261</td>
<td class="gt_row gt_right">7.242</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">2004</td>
<td class="gt_row gt_right">7.566</td>
<td class="gt_row gt_right">7.566</td>
<td class="gt_row gt_right">7.566</td>
<td class="gt_row gt_right">7.546</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">2005</td>
<td class="gt_row gt_right">8.143</td>
<td class="gt_row gt_right">8.143</td>
<td class="gt_row gt_right">8.143</td>
<td class="gt_row gt_right">8.124</td></tr>
    <tr><td class="gt_row gt_right">1989</td>
<td class="gt_row gt_right">2006</td>
<td class="gt_row gt_right">8.618</td>
<td class="gt_row gt_right">8.618</td>
<td class="gt_row gt_right">8.618</td>
<td class="gt_row gt_right">8.598</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">0.177</td>
<td class="gt_row gt_right">0.177</td>
<td class="gt_row gt_right">0.177</td>
<td class="gt_row gt_right">0.281</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">1999</td>
<td class="gt_row gt_right">0.624</td>
<td class="gt_row gt_right">0.624</td>
<td class="gt_row gt_right">0.624</td>
<td class="gt_row gt_right">0.728</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2000</td>
<td class="gt_row gt_right">0.860</td>
<td class="gt_row gt_right">0.860</td>
<td class="gt_row gt_right">0.860</td>
<td class="gt_row gt_right">0.964</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2001</td>
<td class="gt_row gt_right">1.174</td>
<td class="gt_row gt_right">1.174</td>
<td class="gt_row gt_right">1.174</td>
<td class="gt_row gt_right">1.278</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2002</td>
<td class="gt_row gt_right">1.487</td>
<td class="gt_row gt_right">1.487</td>
<td class="gt_row gt_right">1.487</td>
<td class="gt_row gt_right">1.591</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2003</td>
<td class="gt_row gt_right">1.871</td>
<td class="gt_row gt_right">1.871</td>
<td class="gt_row gt_right">1.871</td>
<td class="gt_row gt_right">1.975</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2004</td>
<td class="gt_row gt_right">2.031</td>
<td class="gt_row gt_right">2.031</td>
<td class="gt_row gt_right">2.031</td>
<td class="gt_row gt_right">2.135</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2005</td>
<td class="gt_row gt_right">2.495</td>
<td class="gt_row gt_right">2.495</td>
<td class="gt_row gt_right">2.495</td>
<td class="gt_row gt_right">2.599</td></tr>
    <tr><td class="gt_row gt_right">1998</td>
<td class="gt_row gt_right">2006</td>
<td class="gt_row gt_right">2.703</td>
<td class="gt_row gt_right">2.703</td>
<td class="gt_row gt_right">2.703</td>
<td class="gt_row gt_right">2.807</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_data</span>(df6) <span class="sc">+</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df_est6, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> estimate, <span class="at">colour =</span> <span class="fu">factor</span>(group),<span class="at">lty=</span><span class="fu">factor</span>(method)), <span class="at">lwd=</span><span class="dv">2</span>)  <span class="sc">+</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot-case6" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="twfe-twm-and-did_files/figure-html/fig-plot-case6-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 17: Treatment Effect Estimates - Multiple Treatment Periods and Heterogeneous Dynamic Treatment Effects</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>df_est6 <span class="sc">%&gt;%</span> </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(group,year, estimate,method) <span class="sc">%&gt;%</span> </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(method <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"TWFE"</span>,<span class="st">"CS"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(method,estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> TWFE, <span class="at">y =</span> CS, <span class="at">group =</span> year, <span class="at">colour =</span> <span class="fu">factor</span>(group)))<span class="sc">+</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#facet_wrap(~group) + </span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_few</span>() <span class="sc">+</span> </span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">slope=</span><span class="dv">1</span>,<span class="at">intercept=</span><span class="dv">0</span>),<span class="at">lty=</span><span class="dv">3</span>) <span class="sc">+</span>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span> </span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>  ggsci<span class="sc">::</span><span class="fu">scale_color_aaas</span>(<span class="at">name=</span><span class="st">"Treatment Cohort"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-plot-case6-comp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="twfe-twm-and-did_files/figure-html/fig-plot-case6-comp-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 18: Comparison of Treatment Effect Estimates - Multiple Treatment Periods and Heterogeneous Dynamic Treatment Effects</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><a href="https://www.res.org.uk/resources-page/res2022-special-session-ectj-the-new-difference-in-differences.html">Nice video discussion</a> of hte above.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>