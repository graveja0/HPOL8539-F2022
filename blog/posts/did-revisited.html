<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Advanced Program and Policy Evaluation (HPOL8539) - Simulate DID Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Simulate DID Data</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Advanced Program and Policy Evaluation (HPOL8539)</a> 
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">HPOL8539-F2022</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../schedule.html" class="sidebar-item-text sidebar-link">Schedule</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blog/index.html" class="sidebar-item-text sidebar-link">Blog</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#plot-data" id="toc-plot-data" class="nav-link active" data-scroll-target="#plot-data">Plot Data</a></li>
  <li><a href="#extended-twfe-model" id="toc-extended-twfe-model" class="nav-link" data-scroll-target="#extended-twfe-model">Extended TWFE Model</a>
  <ul class="collapse">
  <li><a href="#debugging" id="toc-debugging" class="nav-link" data-scroll-target="#debugging">Debugging</a></li>
  <li><a href="#structuring-the-data" id="toc-structuring-the-data" class="nav-link" data-scroll-target="#structuring-the-data">Structuring the data</a></li>
  </ul></li>
  <li><a href="#estimate-cs" id="toc-estimate-cs" class="nav-link" data-scroll-target="#estimate-cs">Estimate CS</a></li>
  <li><a href="#compare" id="toc-compare" class="nav-link" data-scroll-target="#compare">Compare</a></li>
  </ul>
</nav>
    <div class="quarto-margin-footer"><div class="margin-footer-item">
<p><img src="vu-logo.png" class="img-fluid"></p>
</div></div></div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Simulate DID Data</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<div class="cell">

</div>
<div class="cell">

</div>
<section id="plot-data" class="level2">
<h2 class="anchored" data-anchor-id="plot-data">Plot Data</h2>
<div class="cell">
<div class="cell-output-display">
<p><img src="did-revisited_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="did-revisited_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="extended-twfe-model" class="level2">
<h2 class="anchored" data-anchor-id="extended-twfe-model">Extended TWFE Model</h2>
<p>The problem I’m running into here is as follows. In a panel where there is a later treated unit (e.g., 2007) there should be no interactions with years at or above this. The problem is that when I run it this way, the constant term that is fit in Stata is not fit in R,so the coefficients are off. Only if I allow for these interactions will the coefficients be correct for the <em>first</em> treated groups, but not the latter.</p>
<p>Maybe see <a href="https://www.statalist.org/forums/forum/general-stata-discussion/general/630290-interpreting-the-constant-in-reghdfe">here</a>?</p>
<section id="debugging" class="level3">
<h3 class="anchored" data-anchor-id="debugging">Debugging</h3>
</section>
<section id="structuring-the-data" class="level3">
<h3 class="anchored" data-anchor-id="structuring-the-data">Structuring the data</h3>
<ul>
<li>Need to only make interactions between group (<code>treatment_time</code>) and time (<code>year</code>) where <code>year&gt;treatment_time</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This data frame is structured to use not-yet-treated groups as controls.</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>df_etwfe6 <span class="ot">&lt;-</span> </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  data6 <span class="sc">%&gt;%</span> </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(treatment_time,year), <span class="cf">function</span>(x) <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(x))) <span class="sc">%&gt;%</span> </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">max_treat =</span> <span class="fu">max</span>(treatment_time, <span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># DROP ALL OBSERVATIONS THAT AREN'T iDENTIFIED</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;</span> max_treat) <span class="sc">%&gt;%</span> </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year_lt_treatment_time =</span> <span class="fu">as.integer</span>(year <span class="sc">&lt;</span> treatment_time)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year_tmp =</span> <span class="fu">case_when</span>(year <span class="sc">&gt;=</span> treatment_time <span class="sc">~</span> year)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mutate(year_tmp = case_when(year &gt;= treatment_time &amp; year &lt; max(treatment_time,na.rm=TRUE) ~ year)) %&gt;%  THIS IS THE PROBLEMATIC LINE</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time_tmp =</span> <span class="fu">case_when</span>(year <span class="sc">&gt;=</span> treatment_time <span class="sc">~</span> treatment_time)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(treatment_time),<span class="dv">0</span>,treatment_time)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time =</span> <span class="fu">factor</span>(treatment_time),</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">year =</span> <span class="fu">factor</span>(year)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time_tmp =</span> <span class="fu">factor</span>(treatment_time_tmp),</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">year_tmp =</span> <span class="fu">factor</span>(year_tmp)) <span class="sc">%&gt;%</span>   </span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">i =</span> <span class="fu">interaction</span>(treat,treatment_time_tmp,year_tmp,<span class="at">sep=</span><span class="st">":"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">i =</span> <span class="fu">paste0</span>(i)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dummy_cols</span>(<span class="st">"i"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="all-groups-eventually-treated" class="level4">
<h4 class="anchored" data-anchor-id="all-groups-eventually-treated">All Groups Eventually Treated</h4>
<p>Using group fixed effects.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#1a  jwdid  dep_var , ivar(unit) tvar(year) gvar(treatment_time)  group</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>fmla1a <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">glue</span>(<span class="st">"dep_var ~ {paste0(grep('i_1_',colnames(df_etwfe6),value=TRUE),collapse = '+')} | treatment_time + year"</span>))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>fmla1a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>dep_var ~ i_1_1989_1989 + i_1_1989_1990 + i_1_1989_1991 + i_1_1989_1992 + 
    i_1_1989_1993 + i_1_1989_1994 + i_1_1989_1995 + i_1_1989_1996 + 
    i_1_1989_1997 + i_1_1989_1998 + i_1_1989_1999 + i_1_1989_2000 + 
    i_1_1989_2001 + i_1_1989_2002 + i_1_1989_2003 + i_1_1989_2004 + 
    i_1_1989_2005 + i_1_1989_2006 + i_1_1998_1998 + i_1_1998_1999 + 
    i_1_1998_2000 + i_1_1998_2001 + i_1_1998_2002 + i_1_1998_2003 + 
    i_1_1998_2004 + i_1_1998_2005 + i_1_1998_2006 | treatment_time + 
    year</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>fit1a <span class="ot">&lt;-</span> <span class="fu">feols</span>(fmla1a,df_etwfe6); fit1a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>OLS estimation, Dep. Var.: dep_var
Observations: 5,508 
Fixed-effects: treatment_time: 3,  year: 27
Standard-errors: Clustered (treatment_time) 
              Estimate Std. Error   t value   Pr(&gt;|t|)    
i_1_1989_1989 0.550551   0.083236   6.61432 2.2103e-02 *  
i_1_1989_1990 1.097450   0.029460  37.25211 7.1983e-04 ***
i_1_1989_1991 1.649690   0.032895  50.14942 3.9738e-04 ***
i_1_1989_1992 2.091558   0.018832 111.06601 8.1056e-05 ***
i_1_1989_1993 2.706269   0.044696  60.54856 2.7266e-04 ***
i_1_1989_1994 3.117833   0.009088 343.06036 8.4968e-06 ***
i_1_1989_1995 3.548997   0.005236 677.86613 2.1763e-06 ***
i_1_1989_1996 4.190584   0.008500 493.02953 4.1139e-06 ***
... 19 coefficients remaining (display them with summary() or use argument n)
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 1.55415     Adj. R2: 0.688456
                Within R2: 0.433584</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>est1a <span class="ot">&lt;-</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>(fit1a) <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(term, <span class="at">into =</span><span class="fu">c</span>(<span class="st">"tmp"</span>,<span class="st">"tmp2"</span>,<span class="st">"group"</span>,<span class="st">"year"</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">att =</span> estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(group, year , att) <span class="sc">%&gt;%</span> </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">estimator =</span> <span class="st">"ETWFE - Group FE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(group,year), as.numeric)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">stata</span>(<span class="st">"jwdid  dep_var , ivar(unit) tvar(year) gvar(treatment_time)  group"</span>, <span class="at">data.in =</span> data6 <span class="sc">%&gt;%</span> <span class="fu">mutate_at</span>(<span class="fu">vars</span>(year,treatment_time),<span class="cf">function</span>(x) <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(x))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>. jwdid  dep_var , ivar(unit) tvar(year) gvar(treatment_time)  group
WARNING: Singleton observations not dropped; statistical significance is biased
&gt;  (link)
(MWFE estimator converged in 2 iterations)

HDFE Linear regression                            Number of obs   =      5,508
Absorbing 2 HDFE groups                           F(  27,    199) =      29.74
Statistics robust to heteroskedasticity           Prob &gt; F        =     0.0000
                                                  R-squared       =     0.6916
                                                  Adj R-squared   =     0.6885
                                                  Within R-sq.    =     0.4336
Number of clusters (unit)    =        200         Root MSE        =     1.5621

                                 (Std. Err. adjusted for 200 clusters in unit)
------------------------------------------------------------------------------
             |               Robust
     dep_var |      Coef.   Std. Err.      t    P&gt;|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
treatment_~e#|
        year#|
    c.__tr__ |
  1989 1989  |   .5505505   .0856819     6.43   0.000     .3815895    .7195116
  1989 1990  |    1.09745   .1012055    10.84   0.000     .8978769    1.297023
  1989 1991  |    1.64969   .0984294    16.76   0.000     1.455591    1.843788
  1989 1992  |   2.091558   .1270886    16.46   0.000     1.840945    2.342172
  1989 1993  |   2.706269   .1405392    19.26   0.000     2.429132    2.983406
  1989 1994  |   3.117833   .1547081    20.15   0.000     2.812755     3.42291
  1989 1995  |   3.548997   .1871525    18.96   0.000      3.17994    3.918054
  1989 1996  |   4.190584   .2031831    20.62   0.000     3.789915    4.591252
  1989 1997  |   4.560902   .2223433    20.51   0.000      4.12245    4.999353
  1989 1998  |   5.274783   .2381306    22.15   0.000     4.805199    5.744366
  1989 1999  |   5.799933   .2777758    20.88   0.000     5.252171    6.347695
  1989 2000  |    6.12532   .2842315    21.55   0.000     5.564828    6.685812
  1989 2001  |   6.657937   .3127127    21.29   0.000     6.041281    7.274593
  1989 2002  |   7.132307   .3291643    21.67   0.000      6.48321    7.781405
  1989 2003  |   7.846859   .3622341    21.66   0.000     7.132549    8.561169
  1989 2004  |   8.352164    .380407    21.96   0.000     7.602018     9.10231
  1989 2005  |   8.761887   .3908817    22.42   0.000     7.991085    9.532689
  1989 2006  |   9.213217   .4329893    21.28   0.000     8.359381    10.06705
  1998 1998  |   .4548369   .0974278     4.67   0.000     .2627134    .6469604
  1998 1999  |   .6896868   .0978636     7.05   0.000      .496704    .8826696
  1998 2000  |   .8477485   .1120189     7.57   0.000     .6268522    1.068645
  1998 2001  |   1.223767   .1228332     9.96   0.000     .9815457    1.465989
  1998 2002  |   1.424722   .1439758     9.90   0.000     1.140808    1.708637
  1998 2003  |    1.89068   .1665003    11.36   0.000     1.562349    2.219011
  1998 2004  |    2.13663   .1823018    11.72   0.000     1.777139    2.496121
  1998 2005  |   2.578458   .2068636    12.46   0.000     2.170532    2.986384
  1998 2006  |   2.820769   .2196635    12.84   0.000     2.387602    3.253936
             |
       _cons |  -.0060328   .0754332    -0.08   0.936    -.1547838    .1427183
------------------------------------------------------------------------------

Absorbed degrees of freedom:
--------------------------------------------------------+
    Absorbed FE | Categories  - Redundant  = Num. Coefs |
----------------+---------------------------------------|
 treatment_time |         3           0           3     |
           year |        27           1          26     |
--------------------------------------------------------+</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>est1a <span class="sc">%&gt;%</span> <span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: right;">group</th>
<th style="text-align: right;">year</th>
<th style="text-align: right;">att</th>
<th style="text-align: left;">estimator</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1989</td>
<td style="text-align: right;">1989</td>
<td style="text-align: right;">0.5505505</td>
<td style="text-align: left;">ETWFE - Group FE</td>
</tr>
<tr class="even">
<td style="text-align: right;">1989</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">1.0974499</td>
<td style="text-align: left;">ETWFE - Group FE</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1989</td>
<td style="text-align: right;">1991</td>
<td style="text-align: right;">1.6496898</td>
<td style="text-align: left;">ETWFE - Group FE</td>
</tr>
<tr class="even">
<td style="text-align: right;">1989</td>
<td style="text-align: right;">1992</td>
<td style="text-align: right;">2.0915583</td>
<td style="text-align: left;">ETWFE - Group FE</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1989</td>
<td style="text-align: right;">1993</td>
<td style="text-align: right;">2.7062687</td>
<td style="text-align: left;">ETWFE - Group FE</td>
</tr>
<tr class="even">
<td style="text-align: right;">1989</td>
<td style="text-align: right;">1994</td>
<td style="text-align: right;">3.1178326</td>
<td style="text-align: left;">ETWFE - Group FE</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1989</td>
<td style="text-align: right;">1995</td>
<td style="text-align: right;">3.5489970</td>
<td style="text-align: left;">ETWFE - Group FE</td>
</tr>
<tr class="even">
<td style="text-align: right;">1989</td>
<td style="text-align: right;">1996</td>
<td style="text-align: right;">4.1905836</td>
<td style="text-align: left;">ETWFE - Group FE</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1989</td>
<td style="text-align: right;">1997</td>
<td style="text-align: right;">4.5609016</td>
<td style="text-align: left;">ETWFE - Group FE</td>
</tr>
<tr class="even">
<td style="text-align: right;">1989</td>
<td style="text-align: right;">1998</td>
<td style="text-align: right;">5.2747825</td>
<td style="text-align: left;">ETWFE - Group FE</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1989</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">5.7999327</td>
<td style="text-align: left;">ETWFE - Group FE</td>
</tr>
<tr class="even">
<td style="text-align: right;">1989</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">6.1253203</td>
<td style="text-align: left;">ETWFE - Group FE</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1989</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">6.6579370</td>
<td style="text-align: left;">ETWFE - Group FE</td>
</tr>
<tr class="even">
<td style="text-align: right;">1989</td>
<td style="text-align: right;">2002</td>
<td style="text-align: right;">7.1323074</td>
<td style="text-align: left;">ETWFE - Group FE</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1989</td>
<td style="text-align: right;">2003</td>
<td style="text-align: right;">7.8468588</td>
<td style="text-align: left;">ETWFE - Group FE</td>
</tr>
<tr class="even">
<td style="text-align: right;">1989</td>
<td style="text-align: right;">2004</td>
<td style="text-align: right;">8.3521641</td>
<td style="text-align: left;">ETWFE - Group FE</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1989</td>
<td style="text-align: right;">2005</td>
<td style="text-align: right;">8.7618869</td>
<td style="text-align: left;">ETWFE - Group FE</td>
</tr>
<tr class="even">
<td style="text-align: right;">1989</td>
<td style="text-align: right;">2006</td>
<td style="text-align: right;">9.2132170</td>
<td style="text-align: left;">ETWFE - Group FE</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1998</td>
<td style="text-align: right;">0.4548369</td>
<td style="text-align: left;">ETWFE - Group FE</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">0.6896868</td>
<td style="text-align: left;">ETWFE - Group FE</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">2000</td>
<td style="text-align: right;">0.8477485</td>
<td style="text-align: left;">ETWFE - Group FE</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">1.2237674</td>
<td style="text-align: left;">ETWFE - Group FE</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">2002</td>
<td style="text-align: right;">1.4247225</td>
<td style="text-align: left;">ETWFE - Group FE</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">2003</td>
<td style="text-align: right;">1.8906801</td>
<td style="text-align: left;">ETWFE - Group FE</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">2004</td>
<td style="text-align: right;">2.1366302</td>
<td style="text-align: left;">ETWFE - Group FE</td>
</tr>
<tr class="even">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">2005</td>
<td style="text-align: right;">2.5784581</td>
<td style="text-align: left;">ETWFE - Group FE</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1998</td>
<td style="text-align: right;">2006</td>
<td style="text-align: right;">2.8207688</td>
<td style="text-align: left;">ETWFE - Group FE</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Using unit fixed effects – this one runs into p</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#2b jwdid  dep_var , ivar(unit) tvar(year) gvar(treatment_time) </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>fmla1b <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">glue</span>(<span class="st">"dep_var ~ {paste0(grep('i_1_',colnames(df_etwfe6),value=TRUE),collapse = '+')} | unit + year"</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>fit1b <span class="ot">&lt;-</span> <span class="fu">feols</span>(fmla1b,df_etwfe6)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>est1b <span class="ot">&lt;-</span> </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>(fit1b) <span class="sc">%&gt;%</span> </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(term, <span class="at">into =</span><span class="fu">c</span>(<span class="st">"tmp"</span>,<span class="st">"tmp2"</span>,<span class="st">"group"</span>,<span class="st">"year"</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">att =</span> estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(group, year , att) <span class="sc">%&gt;%</span> </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">estimator =</span> <span class="st">"ETWFE - Unit FE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(group,year), as.numeric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="only-use-a-never-treated-group-as-control" class="level4">
<h4 class="anchored" data-anchor-id="only-use-a-never-treated-group-as-control">Only Use a Never Treated Group as Control</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df_etwfe6b <span class="ot">&lt;-</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  data6b <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(treatment_time,year), <span class="cf">function</span>(x) <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(x))) <span class="sc">%&gt;%</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treatment_time) <span class="sc">%&gt;%</span> </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(treatment_time,year) <span class="sc">%&gt;%</span> </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">first_year =</span> <span class="fu">as.integer</span>(<span class="fu">row_number</span>()<span class="sc">==</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(treatment_time),<span class="dv">0</span>,treatment_time)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year_tmp =</span> <span class="fu">case_when</span>(year <span class="sc">&gt;=</span> treatment_time  <span class="sc">~</span> year)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time_tmp =</span> <span class="fu">case_when</span>(year <span class="sc">&gt;=</span> treatment_time<span class="sc">~</span> treatment_time)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time =</span> <span class="fu">factor</span>(treatment_time),</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">year =</span> <span class="fu">factor</span>(year)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time_tmp =</span> <span class="fu">factor</span>(treatment_time_tmp),</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">year_tmp =</span> <span class="fu">factor</span>(year_tmp)) <span class="sc">%&gt;%</span>   </span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">i =</span> <span class="fu">interaction</span>(treat,treatment_time_tmp,year_tmp,<span class="at">sep=</span><span class="st">":"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">i =</span> <span class="fu">paste0</span>(i)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dummy_cols</span>(<span class="st">"i"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>i_na)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="co"># This data frame is structured to only use never-treated groups as controls. </span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>df_etwfe6b_nt <span class="ot">&lt;-</span> </span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  data6b <span class="sc">%&gt;%</span> </span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(treatment_time,year), <span class="cf">function</span>(x) <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(x))) <span class="sc">%&gt;%</span> </span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treat =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(treatment_time),<span class="dv">0</span>,treatment_time)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treatment_time) <span class="sc">%&gt;%</span> </span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">first_year =</span> <span class="fu">as.integer</span>(year <span class="sc">==</span> <span class="fu">min</span>(year,<span class="at">na.rm=</span><span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()  <span class="sc">%&gt;%</span> </span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mutate(year_tmp = year,</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>         <span class="co"># treatment_time_tmp = treatment_time) %&gt;% </span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year_tmp =</span> <span class="fu">case_when</span>(first_year<span class="sc">!=</span><span class="dv">1</span>  <span class="sc">~</span> year)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time_tmp =</span> <span class="fu">case_when</span>( first_year <span class="sc">!=</span> <span class="dv">1</span><span class="sc">~</span> treatment_time)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time_tmp =</span> <span class="fu">factor</span>(treatment_time_tmp),</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>         <span class="at">year_tmp =</span> <span class="fu">factor</span>(year_tmp)) <span class="sc">%&gt;%</span>   </span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time =</span> <span class="fu">factor</span>(treatment_time),</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>         <span class="at">year =</span> <span class="fu">factor</span>(year)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">i =</span> <span class="fu">interaction</span>(treat,treatment_time_tmp,year_tmp,<span class="at">sep=</span><span class="st">":"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">i =</span> <span class="fu">paste0</span>(i)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dummy_cols</span>(<span class="st">"i"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">"i_1_0_"</span>))</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span>(<span class="st">'i_1_'</span>,<span class="fu">colnames</span>(df_etwfe6b_nt),<span class="at">value=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "i_1_1989_1981" "i_1_1989_1982" "i_1_1989_1983" "i_1_1989_1984"
 [5] "i_1_1989_1985" "i_1_1989_1986" "i_1_1989_1987" "i_1_1989_1988"
 [9] "i_1_1989_1989" "i_1_1989_1990" "i_1_1989_1991" "i_1_1989_1992"
[13] "i_1_1989_1993" "i_1_1989_1994" "i_1_1989_1995" "i_1_1989_1996"
[17] "i_1_1989_1997" "i_1_1989_1998" "i_1_1989_1999" "i_1_1989_2000"
[21] "i_1_1989_2001" "i_1_1989_2002" "i_1_1989_2003" "i_1_1989_2004"
[25] "i_1_1989_2005" "i_1_1989_2006" "i_1_1989_2007" "i_1_1989_2008"
[29] "i_1_1989_2009" "i_1_1989_2010" "i_1_1989_2011" "i_1_1989_2012"
[33] "i_1_1989_2013" "i_1_1989_2014" "i_1_1989_2015" "i_1_1998_1981"
[37] "i_1_1998_1982" "i_1_1998_1983" "i_1_1998_1984" "i_1_1998_1985"
[41] "i_1_1998_1986" "i_1_1998_1987" "i_1_1998_1988" "i_1_1998_1989"
[45] "i_1_1998_1990" "i_1_1998_1991" "i_1_1998_1992" "i_1_1998_1993"
[49] "i_1_1998_1994" "i_1_1998_1995" "i_1_1998_1996" "i_1_1998_1997"
[53] "i_1_1998_1998" "i_1_1998_1999" "i_1_1998_2000" "i_1_1998_2001"
[57] "i_1_1998_2002" "i_1_1998_2003" "i_1_1998_2004" "i_1_1998_2005"
[61] "i_1_1998_2006" "i_1_1998_2007" "i_1_1998_2008" "i_1_1998_2009"
[65] "i_1_1998_2010" "i_1_1998_2011" "i_1_1998_2012" "i_1_1998_2013"
[69] "i_1_1998_2014" "i_1_1998_2015"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#2a  jwdid  dep_var , ivar(unit) tvar(year) gvar(treatment_time)  group</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>fmla2a <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">glue</span>(<span class="st">"dep_var ~ {paste0(grep('i_1_',colnames(df_etwfe6b),value=TRUE),collapse = '+')} | treatment_time + year"</span>))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>fmla2a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>dep_var ~ i_1_1989_1989 + i_1_1989_1990 + i_1_1989_1991 + i_1_1989_1992 + 
    i_1_1989_1993 + i_1_1989_1994 + i_1_1989_1995 + i_1_1989_1996 + 
    i_1_1989_1997 + i_1_1989_1998 + i_1_1989_1999 + i_1_1989_2000 + 
    i_1_1989_2001 + i_1_1989_2002 + i_1_1989_2003 + i_1_1989_2004 + 
    i_1_1989_2005 + i_1_1989_2006 + i_1_1989_2007 + i_1_1989_2008 + 
    i_1_1989_2009 + i_1_1989_2010 + i_1_1989_2011 + i_1_1989_2012 + 
    i_1_1989_2013 + i_1_1989_2014 + i_1_1989_2015 + i_1_1998_1998 + 
    i_1_1998_1999 + i_1_1998_2000 + i_1_1998_2001 + i_1_1998_2002 + 
    i_1_1998_2003 + i_1_1998_2004 + i_1_1998_2005 + i_1_1998_2006 + 
    i_1_1998_2007 + i_1_1998_2008 + i_1_1998_2009 + i_1_1998_2010 + 
    i_1_1998_2011 + i_1_1998_2012 + i_1_1998_2013 + i_1_1998_2014 + 
    i_1_1998_2015 | treatment_time + year</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>fit2a <span class="ot">&lt;-</span> <span class="fu">feols</span>(fmla2a,df_etwfe6b)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>est2a <span class="ot">&lt;-</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>(fit2a) <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(term, <span class="at">into =</span><span class="fu">c</span>(<span class="st">"tmp"</span>,<span class="st">"tmp2"</span>,<span class="st">"group"</span>,<span class="st">"year"</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">att =</span> estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(group, year , att) <span class="sc">%&gt;%</span> </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">estimator =</span> <span class="st">"ETWFE - Group FE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(group,year), as.numeric)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">#2b  jwdid  dep_var , ivar(unit) tvar(year) gvar(treatment_time)  </span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>fmla2b <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">glue</span>(<span class="st">"dep_var ~ {paste0(grep('i_1_',colnames(df_etwfe6b),value=TRUE),collapse = '+')} | unit + year"</span>))</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>fmla2b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>dep_var ~ i_1_1989_1989 + i_1_1989_1990 + i_1_1989_1991 + i_1_1989_1992 + 
    i_1_1989_1993 + i_1_1989_1994 + i_1_1989_1995 + i_1_1989_1996 + 
    i_1_1989_1997 + i_1_1989_1998 + i_1_1989_1999 + i_1_1989_2000 + 
    i_1_1989_2001 + i_1_1989_2002 + i_1_1989_2003 + i_1_1989_2004 + 
    i_1_1989_2005 + i_1_1989_2006 + i_1_1989_2007 + i_1_1989_2008 + 
    i_1_1989_2009 + i_1_1989_2010 + i_1_1989_2011 + i_1_1989_2012 + 
    i_1_1989_2013 + i_1_1989_2014 + i_1_1989_2015 + i_1_1998_1998 + 
    i_1_1998_1999 + i_1_1998_2000 + i_1_1998_2001 + i_1_1998_2002 + 
    i_1_1998_2003 + i_1_1998_2004 + i_1_1998_2005 + i_1_1998_2006 + 
    i_1_1998_2007 + i_1_1998_2008 + i_1_1998_2009 + i_1_1998_2010 + 
    i_1_1998_2011 + i_1_1998_2012 + i_1_1998_2013 + i_1_1998_2014 + 
    i_1_1998_2015 | unit + year</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>fit2b <span class="ot">&lt;-</span> <span class="fu">feols</span>(fmla2b,df_etwfe6b)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>est2b <span class="ot">&lt;-</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>(fit2b) <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(term, <span class="at">into =</span><span class="fu">c</span>(<span class="st">"tmp"</span>,<span class="st">"tmp2"</span>,<span class="st">"group"</span>,<span class="st">"year"</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">att =</span> estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(group, year , att) <span class="sc">%&gt;%</span> </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">estimator =</span> <span class="st">"ETWFE - Unit FE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(group,year), as.numeric)<span class="co">#2b  jwdid  dep_var , ivar(unit) tvar(year) gvar(treatment_time)  </span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>fmla2b <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">glue</span>(<span class="st">"dep_var ~ {paste0(grep('i_1_',colnames(df_etwfe6b),value=TRUE),collapse = '+')} | unit + year"</span>))</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>fmla2b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>dep_var ~ i_1_1989_1989 + i_1_1989_1990 + i_1_1989_1991 + i_1_1989_1992 + 
    i_1_1989_1993 + i_1_1989_1994 + i_1_1989_1995 + i_1_1989_1996 + 
    i_1_1989_1997 + i_1_1989_1998 + i_1_1989_1999 + i_1_1989_2000 + 
    i_1_1989_2001 + i_1_1989_2002 + i_1_1989_2003 + i_1_1989_2004 + 
    i_1_1989_2005 + i_1_1989_2006 + i_1_1989_2007 + i_1_1989_2008 + 
    i_1_1989_2009 + i_1_1989_2010 + i_1_1989_2011 + i_1_1989_2012 + 
    i_1_1989_2013 + i_1_1989_2014 + i_1_1989_2015 + i_1_1998_1998 + 
    i_1_1998_1999 + i_1_1998_2000 + i_1_1998_2001 + i_1_1998_2002 + 
    i_1_1998_2003 + i_1_1998_2004 + i_1_1998_2005 + i_1_1998_2006 + 
    i_1_1998_2007 + i_1_1998_2008 + i_1_1998_2009 + i_1_1998_2010 + 
    i_1_1998_2011 + i_1_1998_2012 + i_1_1998_2013 + i_1_1998_2014 + 
    i_1_1998_2015 | unit + year</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>fit2b <span class="ot">&lt;-</span> <span class="fu">feols</span>(fmla2b,df_etwfe6b)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>est2b <span class="ot">&lt;-</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>(fit2b) <span class="sc">%&gt;%</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(term, <span class="at">into =</span><span class="fu">c</span>(<span class="st">"tmp"</span>,<span class="st">"tmp2"</span>,<span class="st">"group"</span>,<span class="st">"year"</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">att =</span> estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(group, year , att) <span class="sc">%&gt;%</span> </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">estimator =</span> <span class="st">"ETWFE - Unit FE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(group,year), as.numeric)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="do">## NEED TO GET RID OF ONE MORE CATEGORY (1998 x 1980)</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co">#2c  jwdid  dep_var , ivar(unit) tvar(year) gvar(treatment_time) group never</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>fmla2c <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">glue</span>(<span class="st">"dep_var ~ {paste0(grep('i_1_',colnames(df_etwfe6b_nt),value=TRUE),collapse = '+')} | treatment_time + year"</span>))</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>fit2c <span class="ot">&lt;-</span> <span class="fu">feols</span>(fmla2c,df_etwfe6b_nt)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>est2c <span class="ot">&lt;-</span> </span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>(fit2c) <span class="sc">%&gt;%</span> </span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(term, <span class="at">into =</span><span class="fu">c</span>(<span class="st">"tmp"</span>,<span class="st">"tmp2"</span>,<span class="st">"group"</span>,<span class="st">"year"</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">att =</span> estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(group, year , att) <span class="sc">%&gt;%</span> </span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">estimator =</span> <span class="st">"ETWFE - NT Cx - Group FE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(group,year), as.numeric)</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="co">#2d jwdid  dep_var , ivar(unit) tvar(year) gvar(treatment_time) never !!!! THIS ONE SEEMS TO BE WRONG IN STATA ... </span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>fmla2d <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">glue</span>(<span class="st">"dep_var ~ {paste0(grep('i_1_',colnames(df_etwfe6b_nt),value=TRUE),collapse = '+')} | unit + year"</span>))</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>fit2d <span class="ot">&lt;-</span> <span class="fu">feols</span>(fmla2d,df_etwfe6b_nt <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">unit =</span> <span class="fu">factor</span>(unit)))</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>est2d <span class="ot">&lt;-</span> </span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>(fit2d) <span class="sc">%&gt;%</span> </span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(term, <span class="at">into =</span><span class="fu">c</span>(<span class="st">"tmp"</span>,<span class="st">"tmp2"</span>,<span class="st">"group"</span>,<span class="st">"year"</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">att =</span> estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(group, year , att) <span class="sc">%&gt;%</span> </span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">estimator =</span> <span class="st">"ETWFE - NT Cx - Unit FE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(group,year), as.numeric)</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a><span class="fu">stata</span>(<span class="st">"</span></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a><span class="st">      replace treatment_time = 0 if treatment_time==.</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a><span class="st">      jwdid  dep_var , ivar(unit) tvar(year) gvar(treatment_time) never</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a><span class="st">      "</span>, <span class="at">data.in =</span> data6b <span class="sc">%&gt;%</span> <span class="fu">mutate_at</span>(<span class="fu">vars</span>(year,treatment_time),<span class="cf">function</span>(x) <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(x))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>. 
.       replace treatment_time = 0 if treatment_time==.
(2,304 real changes made)
.       jwdid  dep_var , ivar(unit) tvar(year) gvar(treatment_time) never
WARNING: Singleton observations not dropped; statistical significance is biased
&gt;  (link)
(MWFE estimator converged in 2 iterations)

HDFE Linear regression                            Number of obs   =      7,344
Absorbing 2 HDFE groups                           F(  70,    199) =      11.60
Statistics robust to heteroskedasticity           Prob &gt; F        =     0.0000
                                                  R-squared       =     0.8801
                                                  Adj R-squared   =     0.8749
                                                  Within R-sq.    =     0.6290
Number of clusters (unit)    =        200         Root MSE        =     1.5535

                                 (Std. Err. adjusted for 200 clusters in unit)
------------------------------------------------------------------------------
             |               Robust
     dep_var |      Coef.   Std. Err.      t    P&gt;|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
treatment_~e#|
        year#|
    c.__tr__ |
  1989 1981  |  -1.547624   .7704777    -2.01   0.046    -3.066972   -.0282756
  1989 1982  |  -1.584289   .7772889    -2.04   0.043    -3.117069   -.0515092
  1989 1983  |  -1.642049   .7722397    -2.13   0.035    -3.164872   -.1192261
  1989 1984  |   -1.43341   .7549454    -1.90   0.059     -2.92213    .0553095
  1989 1985  |  -1.535311   .7726244    -1.99   0.048    -3.058893   -.0117291
  1989 1986  |  -1.648764   .7700177    -2.14   0.033    -3.167206    -.130323
  1989 1987  |  -1.481473   .7525563    -1.97   0.050    -2.965481    .0025358
  1989 1988  |  -1.518695   .7756531    -1.96   0.052    -3.048249    .0108597
  1989 1989  |  -.9574712   .7657142    -1.25   0.213    -2.467426     .552484
  1989 1990  |  -.3574772   .7526876    -0.47   0.635    -1.841744     1.12679
  1989 1991  |    .140598   .7517545     0.19   0.852    -1.341829    1.623025
  1989 1992  |   .6721532   .7727109     0.87   0.385    -.8515991    2.195905
  1989 1993  |   1.184797   .7764752     1.53   0.129    -.3463783    2.715972
  1989 1994  |   1.657065   .7854902     2.11   0.036     .1081125    3.206018
  1989 1995  |   2.168771   .7807311     2.78   0.006     .6292032    3.708339
  1989 1996  |   2.744621   .7966587     3.45   0.001     1.173644    4.315597
  1989 1997  |   3.236545    .802859     4.03   0.000     1.653342    4.819748
  1989 1998  |   3.702205   .8068537     4.59   0.000     2.111125    5.293285
  1989 1999  |    4.24945   .8216235     5.17   0.000     2.629244    5.869656
  1989 2000  |    4.81904   .8267467     5.83   0.000     3.188732    6.449349
  1989 2001  |   5.289953   .8324853     6.35   0.000     3.648329    6.931578
  1989 2002  |   5.852231   .8518576     6.87   0.000     4.172404    7.532057
  1989 2003  |    6.35007   .8571423     7.41   0.000     4.659822    8.040317
  1989 2004  |   6.756413    .880549     7.67   0.000     5.020009    8.492818
  1989 2005  |   7.538427   .8896723     8.47   0.000     5.784031    9.292822
  1989 2006  |   7.972006   .9043422     8.82   0.000     6.188682    9.755329
  1989 2007  |   8.576618   .9269071     9.25   0.000     6.748798    10.40444
  1989 2008  |   9.029933    .938673     9.62   0.000     7.178911    10.88096
  1989 2009  |   9.555117    .956706     9.99   0.000     7.668534     11.4417
  1989 2010  |   10.06048   .9658729    10.42   0.000     8.155825    11.96514
  1989 2011  |   10.58318   .9875133    10.72   0.000     8.635846    12.53051
  1989 2012  |    11.1655   1.003004    11.13   0.000     9.187621    13.14338
  1989 2013  |   11.69397   1.012015    11.56   0.000     9.698322    13.68962
  1989 2014  |   12.21836   1.044331    11.70   0.000     10.15898    14.27773
  1989 2015  |   12.81408    1.06626    12.02   0.000     10.71146    14.91669
  1998 1981  |  -2.891191     1.4403    -2.01   0.046    -5.731399   -.0509824
  1998 1982  |  -2.889899   1.438253    -2.01   0.046    -5.726071   -.0537267
  1998 1983  |    -2.9394   1.426655    -2.06   0.041    -5.752702   -.1260988
  1998 1984  |  -2.876048   1.426257    -2.02   0.045    -5.688565   -.0635305
  1998 1985  |  -2.842289   1.438295    -1.98   0.050    -5.678544   -.0060341
  1998 1986  |  -2.990234   1.422831    -2.10   0.037    -5.795996   -.1844721
  1998 1987  |   -2.71098   1.413242    -1.92   0.057    -5.497833    .0758717
  1998 1988  |   -2.78655   1.437245    -1.94   0.054    -5.620734    .0476345
  1998 1989  |  -2.832501    1.43221    -1.98   0.049    -5.656757   -.0082451
  1998 1990  |  -2.759115   1.420724    -1.94   0.054     -5.56072    .0424909
  1998 1991  |  -2.883721   1.399811    -2.06   0.041    -5.644088    -.123354
  1998 1992  |  -2.804369   1.423898    -1.97   0.050    -5.612234    .0034966
  1998 1993  |  -2.774502    1.41303    -1.96   0.051    -5.560936    .0119319
  1998 1994  |   -2.81939   1.425141    -1.98   0.049    -5.629705   -.0090743
  1998 1995  |  -2.815639   1.411897    -1.99   0.047    -5.599839   -.0314392
  1998 1996  |  -2.779294   1.440586    -1.93   0.055    -5.620068    .0614789
  1998 1997  |  -2.658515    1.43755    -1.85   0.066    -5.493302    .1762725
  1998 1998  |  -2.547614   1.415547    -1.80   0.073    -5.339012    .2437835
  1998 1999  |  -2.204368   1.404752    -1.57   0.118    -4.974479    .5657427
  1998 2000  |  -2.044966    1.40235    -1.46   0.146    -4.810338    .7204066
  1998 2001  |  -1.790538   1.391114    -1.29   0.200    -4.533754    .9526785
  1998 2002  |  -1.368831   1.383051    -0.99   0.324    -4.096148    1.358486
  1998 2003  |  -.9809712   1.370899    -0.72   0.475    -3.684325    1.722382
  1998 2004  |  -.7812189   1.377396    -0.57   0.571    -3.497384    1.934946
  1998 2005  |  -.3232407   1.389143    -0.23   0.816    -3.062571    2.416089
  1998 2006  |  -.1415136   1.365938    -0.10   0.918    -2.835083    2.552056
  1998 2007  |   .2364609   1.367123     0.17   0.863    -2.459446    2.932368
  1998 2008  |    .671513   1.368328     0.49   0.624    -2.026771    3.369797
  1998 2009  |   .8786274   1.373172     0.64   0.523    -1.829208    3.586462
  1998 2010  |   1.156292   1.368928     0.84   0.399    -1.543175    3.855758
  1998 2011  |     1.4396   1.375672     1.05   0.297    -1.273165    4.152365
  1998 2012  |   1.768957    1.35629     1.30   0.194    -.9055885    4.443502
  1998 2013  |   1.911296   1.353292     1.41   0.159    -.7573372    4.579929
  1998 2014  |   2.354145   1.354785     1.74   0.084    -.3174335    5.025723
  1998 2015  |   2.775042   1.364392     2.03   0.043     .0845195    5.465565
             |
       _cons |   1.455016   .7264596     2.00   0.047     .0224693    2.887563
------------------------------------------------------------------------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        unit |       200         200           0    *|
        year |        36           1          35     |
-----------------------------------------------------+
* = FE nested within cluster; treated as redundant for DoF computation
.       </code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="estimate-cs" class="level2">
<h2 class="anchored" data-anchor-id="estimate-cs">Estimate CS</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>data6_cs <span class="ot">&lt;-</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  data6 <span class="sc">%&gt;%</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(year)),</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">treatment_time =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(treatment_time)))  <span class="sc">%&gt;%</span> </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(treatment_time),<span class="dv">0</span>,treatment_time))</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>fit_cs6 <span class="ot">&lt;-</span> <span class="fu">att_gt</span>(<span class="at">yname =</span> <span class="st">"dep_var"</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">tname =</span> <span class="st">"year"</span>,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">idname =</span> <span class="st">"unit"</span>,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">gname =</span> <span class="st">"treatment_time"</span>,</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>                        <span class="at">control_group =</span> <span class="st">"notyettreated"</span>,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> data6_cs</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>                        )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in pre_process_did(yname = yname, tname = tname, idname = idname, :
Dropped 4 observations while converting to balanced panel.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>est_cs6 <span class="ot">&lt;-</span>  <span class="fu">tibble</span>(<span class="at">group =</span> fit_cs6<span class="sc">$</span>group, <span class="at">year =</span> fit_cs6<span class="sc">$</span>t, <span class="at">att =</span> fit_cs6<span class="sc">$</span>att) <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">estimator =</span> <span class="st">"CS"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>data6b_cs <span class="ot">&lt;-</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  data6b <span class="sc">%&gt;%</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(year)),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">treatment_time =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(treatment_time)))  <span class="sc">%&gt;%</span> </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_time =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(treatment_time),<span class="dv">0</span>,treatment_time))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_mutate(quo): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>fit_cs6b <span class="ot">&lt;-</span> <span class="fu">att_gt</span>(<span class="at">yname =</span> <span class="st">"dep_var"</span>,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">tname =</span> <span class="st">"year"</span>,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">idname =</span> <span class="st">"unit"</span>,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">gname =</span> <span class="st">"treatment_time"</span>,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">control_group =</span> <span class="st">"nevertreated"</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> data6b_cs</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>                        )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in pre_process_did(yname = yname, tname = tname, idname = idname, :
Dropped 4 observations while converting to balanced panel.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>est_cs6b <span class="ot">&lt;-</span>  <span class="fu">tibble</span>(<span class="at">group =</span> fit_cs6b<span class="sc">$</span>group, <span class="at">year =</span> fit_cs6b<span class="sc">$</span>t, <span class="at">att =</span> fit_cs6b<span class="sc">$</span>att) <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">estimator =</span> <span class="st">"CS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="compare" class="level2">
<h2 class="anchored" data-anchor-id="compare">Compare</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>est1a <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est1b) <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est_cs6) <span class="sc">%&gt;%</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> att, <span class="at">colour =</span> <span class="fu">factor</span>(group), <span class="at">pch =</span> estimator)) <span class="sc">+</span> </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_clean</span>() <span class="sc">+</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  ggsci<span class="sc">::</span><span class="fu">scale_color_aaas</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="did-revisited_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>est2a <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est2b) <span class="sc">%&gt;%</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est2c) <span class="sc">%&gt;%</span> </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est2d) <span class="sc">%&gt;%</span> </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(est_cs6b) <span class="sc">%&gt;%</span> </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> att, <span class="at">colour =</span> <span class="fu">factor</span>(group), <span class="at">pch =</span> estimator)) <span class="sc">+</span> </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_clean</span>() <span class="sc">+</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  ggsci<span class="sc">::</span><span class="fu">scale_color_aaas</span>() <span class="sc">+</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_shape_manual(values =c(19,4,3)) +</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="did-revisited_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><a href="https://friosavila.github.io/playingwithstata/main_jwdid.html">Source</a></p>
<p><a href="https://jonathandroth.github.io/assets/files/DiD_Review_Paper.pdf">Review paper</a></p>
<p><a href="https://twitter.com/jmwooldridge/status/1374555518623178757?lang=en">Wooldridge</a></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>