<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Advanced Program and Policy Evaluation (HPOL8539) â€“ holding-pen_quantile-tx-effects-changes-in-changes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">(Untitled)</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Advanced Program and Policy Evaluation (HPOL8539)</a> 
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">Advanced Program and Policy Evaluation</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">Slides</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/lec_introduction.html" class="sidebar-item-text sidebar-link">Course Introduction</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/peer-review-assignment.html" class="sidebar-item-text sidebar-link">Peer Review Assignment</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/difference-in-differences.html" class="sidebar-item-text sidebar-link">Extending Difference-in-Differences</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/next-gen-DID.html" class="sidebar-item-text sidebar-link">NextGen Difference-in-Differences Estimators</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/nonlinear-DID.html" class="sidebar-item-text sidebar-link">Nonlinear Difference-in-Differences</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/lec_inference.html" class="sidebar-item-text sidebar-link">Inference for Policy Evaluation</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/lec_conditionalDID-and-synthetic-control.html" class="sidebar-item-text sidebar-link">Synthetic Control Methods</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/lec_bounds.html" class="sidebar-item-text sidebar-link">Treatment Effect Bounds</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">Case Studies</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://graves-vanderbilt.shinyapps.io/HPOL8539-Simulation/" class="sidebar-item-text sidebar-link">1. Simulation as a Guide for Study Design and Inference</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://graves-vanderbilt.shinyapps.io/HPOL8539-panel-data-1/" class="sidebar-item-text sidebar-link">2. Panel Data Methods I - Fixed, Random and Correlated Random Effects</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://graves-vanderbilt.shinyapps.io/NextGenDID/" class="sidebar-item-text sidebar-link">4. NextGen DID</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blog/index.html" class="sidebar-item-text sidebar-link">Blog</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">Useful Links</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://github.com/graveja0/HPOL8539-F2022/raw/main/current-syllabus.pdf" class="sidebar-item-text sidebar-link">Current Syllabus</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://mixtape.scunning.com/" class="sidebar-item-text sidebar-link">Causal Inference - The Mixtape (Cunningham)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://theeffectbook.net/" class="sidebar-item-text sidebar-link">The Effect (Huntington-Klein)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://diff.healthpolicydatascience.org/" class="sidebar-item-text sidebar-link">Comprehensive Discussion of Difference-in-Differences</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://asjadnaqvi.github.io/DiD/" class="sidebar-item-text sidebar-link">Difference-in-Differences Respository (code, packages, etc.)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://kylebutts.com/did2s/articles/event_study.html" class="sidebar-item-text sidebar-link">Resources on multiple nextGen DID estimators</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://github.com/Mixtape-Sessions" class="sidebar-item-text sidebar-link">Mixtape Sessions</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://stata2r.github.io/" class="sidebar-item-text sidebar-link">Stata2R Translator</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.mathematica.org/download-media?MediaItemId=%7B2BB0E26B-F979-469B-9571-C23FF42E80DA%7D" class="sidebar-item-text sidebar-link">Model vs.&nbsp;Desgin-Based Inference</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://ies.ed.gov/ncee/pubs/20174026/pdf/20174026.pdf" class="sidebar-item-text sidebar-link">Comparison of RCTs evaluated under model vs.&nbsp;design-based inference</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#approach" id="toc-approach" class="nav-link active" data-scroll-target="#approach">Approach</a></li>
  <li><a href="#normal-distribution-pdf" id="toc-normal-distribution-pdf" class="nav-link" data-scroll-target="#normal-distribution-pdf">Normal Distribution: PDF</a></li>
  <li><a href="#normal-distribution-cdf" id="toc-normal-distribution-cdf" class="nav-link" data-scroll-target="#normal-distribution-cdf">Normal Distribution: CDF</a></li>
  <li><a href="#normal-distribution-pdf-to-cdf" id="toc-normal-distribution-pdf-to-cdf" class="nav-link" data-scroll-target="#normal-distribution-pdf-to-cdf">Normal Distribution: PDF to CDF</a></li>
  <li><a href="#quantile-treatment-effects-under-randomization" id="toc-quantile-treatment-effects-under-randomization" class="nav-link" data-scroll-target="#quantile-treatment-effects-under-randomization">Quantile Treatment Effects Under Randomization</a>
  <ul class="collapse">
  <li><a href="#qte-under-randomization" id="toc-qte-under-randomization" class="nav-link" data-scroll-target="#qte-under-randomization">QTE Under Randomization</a></li>
  <li><a href="#qte-under-randomization-1" id="toc-qte-under-randomization-1" class="nav-link" data-scroll-target="#qte-under-randomization-1">QTE Under Randomization</a></li>
  <li><a href="#qte-under-randomization-2" id="toc-qte-under-randomization-2" class="nav-link" data-scroll-target="#qte-under-randomization-2">QTE Under Randomization</a></li>
  <li><a href="#qte-under-randomization-3" id="toc-qte-under-randomization-3" class="nav-link" data-scroll-target="#qte-under-randomization-3">QTE Under Randomization</a></li>
  <li><a href="#qte-under-randomization-4" id="toc-qte-under-randomization-4" class="nav-link" data-scroll-target="#qte-under-randomization-4">QTE Under Randomization</a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1"></a></li>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2"></a></li>
  <li><a href="#section-3" id="toc-section-3" class="nav-link" data-scroll-target="#section-3"></a></li>
  <li><a href="#section-4" id="toc-section-4" class="nav-link" data-scroll-target="#section-4"></a></li>
  <li><a href="#quantile-difference-in-differences" id="toc-quantile-difference-in-differences" class="nav-link" data-scroll-target="#quantile-difference-in-differences">Quantile Difference-in-Differences</a></li>
  <li><a href="#section-5" id="toc-section-5" class="nav-link" data-scroll-target="#section-5"></a></li>
  <li><a href="#section-6" id="toc-section-6" class="nav-link" data-scroll-target="#section-6"></a></li>
  <li><a href="#section-7" id="toc-section-7" class="nav-link" data-scroll-target="#section-7"></a></li>
  <li><a href="#section-8" id="toc-section-8" class="nav-link" data-scroll-target="#section-8"></a></li>
  <li><a href="#section-9" id="toc-section-9" class="nav-link" data-scroll-target="#section-9"></a></li>
  <li><a href="#approach-1" id="toc-approach-1" class="nav-link" data-scroll-target="#approach-1">Approach</a></li>
  <li><a href="#normal-distribution-pdf-1" id="toc-normal-distribution-pdf-1" class="nav-link" data-scroll-target="#normal-distribution-pdf-1">Normal Distribution: PDF</a></li>
  <li><a href="#normal-distribution-cdf-1" id="toc-normal-distribution-cdf-1" class="nav-link" data-scroll-target="#normal-distribution-cdf-1">Normal Distribution: CDF</a></li>
  <li><a href="#normal-distribution-pdf-to-cdf-1" id="toc-normal-distribution-pdf-to-cdf-1" class="nav-link" data-scroll-target="#normal-distribution-pdf-to-cdf-1">Normal Distribution: PDF to CDF</a></li>
  </ul></li>
  <li><a href="#quantile-treatment-effects-under-randomization-1" id="toc-quantile-treatment-effects-under-randomization-1" class="nav-link" data-scroll-target="#quantile-treatment-effects-under-randomization-1">Quantile Treatment Effects Under Randomization</a>
  <ul class="collapse">
  <li><a href="#qte-under-randomization-5" id="toc-qte-under-randomization-5" class="nav-link" data-scroll-target="#qte-under-randomization-5">QTE Under Randomization</a></li>
  <li><a href="#qte-under-randomization-6" id="toc-qte-under-randomization-6" class="nav-link" data-scroll-target="#qte-under-randomization-6">QTE Under Randomization</a></li>
  <li><a href="#qte-under-randomization-7" id="toc-qte-under-randomization-7" class="nav-link" data-scroll-target="#qte-under-randomization-7">QTE Under Randomization</a></li>
  <li><a href="#qte-under-randomization-8" id="toc-qte-under-randomization-8" class="nav-link" data-scroll-target="#qte-under-randomization-8">QTE Under Randomization</a></li>
  <li><a href="#qte-under-randomization-9" id="toc-qte-under-randomization-9" class="nav-link" data-scroll-target="#qte-under-randomization-9">QTE Under Randomization</a></li>
  <li><a href="#section-10" id="toc-section-10" class="nav-link" data-scroll-target="#section-10"></a></li>
  <li><a href="#section-11" id="toc-section-11" class="nav-link" data-scroll-target="#section-11"></a></li>
  <li><a href="#section-12" id="toc-section-12" class="nav-link" data-scroll-target="#section-12"></a></li>
  <li><a href="#section-13" id="toc-section-13" class="nav-link" data-scroll-target="#section-13"></a></li>
  <li><a href="#section-14" id="toc-section-14" class="nav-link" data-scroll-target="#section-14"></a></li>
  <li><a href="#quantile-difference-in-differences-1" id="toc-quantile-difference-in-differences-1" class="nav-link" data-scroll-target="#quantile-difference-in-differences-1">Quantile Difference-in-Differences</a></li>
  <li><a href="#section-15" id="toc-section-15" class="nav-link" data-scroll-target="#section-15"></a></li>
  <li><a href="#section-16" id="toc-section-16" class="nav-link" data-scroll-target="#section-16"></a></li>
  <li><a href="#section-17" id="toc-section-17" class="nav-link" data-scroll-target="#section-17"></a></li>
  <li><a href="#section-18" id="toc-section-18" class="nav-link" data-scroll-target="#section-18"></a></li>
  <li><a href="#section-19" id="toc-section-19" class="nav-link" data-scroll-target="#section-19"></a></li>
  </ul></li>
  </ul>
</nav>
    <div class="quarto-margin-footer"><div class="margin-footer-item">
<p><img src="vu-logo.png" class="img-fluid"></p>
</div></div></div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="approach" class="level2">
<h2 class="anchored" data-anchor-id="approach">Approach</h2>
<p>There are two general approaches to understanding</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>â”€â”€ Attaching packages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse 1.3.2 â”€â”€
âœ” ggplot2 3.3.6      âœ” purrr   0.3.5 
âœ” tibble  3.1.8      âœ” dplyr   1.0.10
âœ” tidyr   1.2.1      âœ” stringr 1.4.1 
âœ” readr   2.1.3      âœ” forcats 0.5.2 
â”€â”€ Conflicts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse_conflicts() â”€â”€
âœ– dplyr::filter() masks stats::filter()
âœ– dplyr::lag()    masks stats::lag()</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'data.table'

The following objects are masked from 'package:dplyr':

    between, first, last

The following object is masked from 'package:purrr':

    transpose</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gganimate)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>here() starts at /Users/johngraves/Dropbox/teaching/HPOL8539/HPOL8539-F2022</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(qte)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'kableExtra'

The following object is masked from 'package:dplyr':

    group_rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>theme_tufte_revised <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">base_size =</span> <span class="dv">11</span>, <span class="at">base_family =</span> <span class="st">"Gill Sans"</span>, <span class="at">ticks =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_family =</span> base_family, <span class="at">base_size =</span> base_size) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.line =</span> ggplot2<span class="sc">::</span><span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">'black'</span>),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.3</span>),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">vjust =</span> <span class="fl">0.8</span>),</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.background =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.key =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"plain"</span>),</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.border =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.background =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.background =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>ticks) {</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    ret <span class="ot">&lt;-</span> ret <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">axis.ticks =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>())</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  ret</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>pdf_to_cdf <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">scene_to_show =</span> <span class="cn">NULL</span>, <span class="at">q_ =</span> <span class="fu">c</span>(.<span class="dv">9</span>), <span class="at">breaks_to_show =</span> <span class="cn">NULL</span> ) {</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  pdf <span class="ot">&lt;-</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    {df <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span> <span class="fu">geom_density</span>()} <span class="sc">%&gt;%</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot_build</span>() <span class="sc">%&gt;%</span> <span class="fu">pluck</span>(<span class="st">"data"</span>) <span class="sc">%&gt;%</span> <span class="fu">pluck</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(x,y) <span class="sc">%&gt;%</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.table</span>(<span class="at">key =</span> <span class="st">"x"</span>)</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>  cdf <span class="ot">&lt;-</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    {df <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span> <span class="fu">stat_ecdf</span>()} <span class="sc">%&gt;%</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot_build</span>() <span class="sc">%&gt;%</span> <span class="fu">pluck</span>(<span class="st">"data"</span>) <span class="sc">%&gt;%</span> <span class="fu">pluck</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(x,y) <span class="sc">%&gt;%</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.table</span>(<span class="at">key =</span> <span class="st">"y"</span>)</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>  q <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">q_ =</span> <span class="fu">map_dbl</span>(q_,<span class="sc">~</span>(cdf<span class="sc">$</span>x[<span class="fu">which</span>(cdf<span class="sc">$</span>y<span class="sc">&gt;=</span>.x)][<span class="dv">1</span>]))) <span class="sc">%&gt;%</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">deframe</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(q_) <span class="sc">%&gt;%</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(<span class="st">"x_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"quantile"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.table</span>(<span class="at">key =</span> <span class="st">"x_"</span>)</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>  scene2 <span class="ot">&lt;-</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>    pdf[q,roll<span class="ot">=</span><span class="st">"nearest"</span>] <span class="sc">%&gt;%</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(y,quantile) <span class="sc">%&gt;%</span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">right_join</span>(pdf,<span class="fu">c</span>(<span class="st">"y"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(x,y) <span class="sc">%&gt;%</span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">scene =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">quantile =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"{as.numeric(quantile)}"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(q,<span class="st">"quantile"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">x =</span> <span class="fu">coalesce</span>(x_,x))</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>  q2 <span class="ot">&lt;-</span></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>    q <span class="sc">%&gt;%</span></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">as.numeric</span>(quantile)) <span class="sc">%&gt;%</span></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.table</span>(<span class="at">key=</span><span class="st">"quantile"</span>)</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>  scene3 <span class="ot">&lt;-</span></span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>    cdf[cdf<span class="sc">$</span>x<span class="sc">==</span>q<span class="sc">$</span>x_,] <span class="sc">%&gt;%</span></span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">x_ =</span> q<span class="sc">$</span>x_) <span class="sc">%&gt;%</span></span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">y =</span> q<span class="sc">$</span>quantile) <span class="sc">%&gt;%</span></span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>      <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">"x"</span>,<span class="st">"quantile"</span>,<span class="st">"x_"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>x_) <span class="sc">%&gt;%</span></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>      <span class="fu">right_join</span>(cdf,<span class="st">"x"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(x,y)  <span class="sc">%&gt;%</span></span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">scene =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">quantile =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"{as.numeric(quantile)}"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">as.numeric</span>(quantile)) <span class="sc">|</span> <span class="fu">row_number</span>() <span class="sc">%in%</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.),<span class="dv">1000</span>, <span class="at">replace=</span><span class="cn">TRUE</span>)); <span class="fu">dim</span>(scene2)</span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>  p_df <span class="ot">&lt;-</span></span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>    scene2 <span class="sc">%&gt;%</span></span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">scene =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(scene2) <span class="sc">%&gt;%</span></span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(scene3) <span class="sc">%&gt;%</span></span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(scene3 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">scene=</span><span class="dv">4</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>    <span class="co">#bind_rows(scene3 %&gt;% mutate(scene=5)) %&gt;%</span></span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>    <span class="co">#bind_rows(scene3 %&gt;% mutate(scene=6)) %&gt;%</span></span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">ifelse</span>(quantile<span class="sc">==</span><span class="st">"NA"</span>,<span class="cn">NA</span>, quantile))</span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>  p_df_label <span class="ot">=</span></span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>    p_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(quantile)) <span class="sc">%&gt;%</span></span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(quantile))) <span class="sc">%&gt;%</span></span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">ifelse</span>(scene<span class="sc">==</span><span class="dv">1</span>,<span class="dv">0</span>,y)) <span class="sc">%&gt;%</span></span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">x =</span> <span class="fu">ifelse</span>(scene<span class="sc">==</span><span class="dv">4</span>,<span class="fu">min</span>(scene3<span class="sc">$</span>x),x)) <span class="sc">%&gt;%</span></span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">ifelse</span>(scene<span class="sc">==</span><span class="dv">6</span>,<span class="dv">0</span>,y)) <span class="sc">%&gt;%</span></span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">quantile =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">" q{round(quantile,2)}"</span>))</span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>  p_df <span class="ot">&lt;-</span></span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a>      p_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(scene<span class="sc">==</span>scene_to_show)</span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>  p_df_label <span class="ot">&lt;-</span></span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a>        p_df_label <span class="sc">%&gt;%</span> <span class="fu">filter</span>(scene<span class="sc">==</span>scene_to_show)</span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">p_df =</span> p_df , <span class="at">p_df_label =</span> p_df_label, <span class="at">cdf =</span> cdf, <span class="at">pdf =</span> pdf)</span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a><span class="co">#http://bcallaway11.github.io/qte/articles/R-QTEs.html</span></span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a><span class="co"># https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/LAK5DC</span></span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a><span class="co"># https://direct.mit.edu/rest/article/102/5/994/96756/Quantile-Treatment-Effects-in-the-Presence-of</span></span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a><span class="co"># https://watermark.silverchair.com/rest_a_00858.pdf?token=AQECAHi208BE49Ooan9kkhW_Ercy7Dm3ZL_9Cf3qfKAc485ysgAAAsYwggLCBgkqhkiG9w0BBwagggKzMIICrwIBADCCAqgGCSqGSIb3DQEHATAeBglghkgBZQMEAS4wEQQMxPCVV8nCAOyn3HdDAgEQgIICeVT7FEkNgEVp1U1LMaGWitdbw4MSLqMgCXK2ABWErAlq8TG3FgMi6mgcSpKGUF_QAAuRVbuaSJ-VIuhV1Mw0jdC2gvqD-zd93tvx_kXyZN4_6m1mYTGVDbdXd-6srVmLD9reQCRbYunkKLSrytZxEsI-aBUGM3593aI0vjwo7KbexCKRa2FFaj4w8rPK8v2908Bhg4igo2Yic3yDVp9Rpj1OdKDA8Xo99s4M3QlcVidEDZrA4EsF4XTR5i-Mke5rfIAHEhgQFl2IYxKDYwEq607O2cXudmNJaXthu6ndBghneG0coAMz_XT56hYsoCAEgOdnKu4UTh6x6Nq2sCJkgbBev3UuBO_02oUxFY_UIV8EhirzptXbxbg6FB9N11QK66RYYUqo-sCQt4JnI-WnVoy3677sAkpqGMQR5srhlUuhfGvBvB-Vh2ayMQNpPaCbPfp0t0BxOBj6dWndG6N-lraFD9awXX-BsdBCIRlM_knNVb9QOr3PLAeYbWEgo0JQwYlI4Ll3nXkX_LLSYmCimviOlF0OoB7WnRn1VbEZKrTVG_LUrQyUxmHdzDEx4ZSH68lkAc4XYJf87X3Zdf9mdBYcooswHUzBvAfLMwugMvg_EA2CEwb4TDvNLt6gqdZ5HjwAn9TOgex7IeNuqm66iAI4eK8SrP4-Bz_Hrrb2WJaJ-ucM6YpCUMN22vZJFPT9ssfBvbPnsGlwXweDEDlqqDIWKjK_h-l-dANM4DWqv-KvEzV_OWQ6RBOnbge6J-dkXCnVZ12AmpKvsCxCkwV660Szltj86WYIN8ubPVp_wuOZI4M2Fi-UgNxVVYBpbrZ29mtmghztFFFjwA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="holding-pen_quantile-tx-effects-changes-in-changes_cache/html/unnamed-chunk-2_e32c3682c2f00d5f22a2b5b2a19ec738">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">here</span>(<span class="st">"ignore/cicprograms/mvd.dat"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">fips =</span> V19) <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fips <span class="sc">==</span> <span class="dv">16</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">y =</span> V1,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">head =</span> V10,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">neck =</span> V11,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">upper_extr =</span> V12,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">trunk =</span> V13,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_back =</span> V14,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">lower_extr =</span> V15,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">occ_dis =</span> V16,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">male =</span> V5,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">marital =</span> V6,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">age =</span> V20,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">manu =</span> V8,</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">constr =</span> V9,</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">prev_earn =</span> V21) <span class="sc">%&gt;%</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ind =</span> <span class="fu">as.integer</span>((age<span class="sc">&lt;</span><span class="dv">99</span>) <span class="sc">&amp;</span> (marital<span class="sc">&lt;</span><span class="dv">8</span>) <span class="sc">&amp;</span> (male<span class="sc">&lt;</span><span class="dv">9</span>) <span class="sc">&amp;</span> (manu<span class="sc">&lt;</span><span class="dv">8</span>) <span class="sc">&amp;</span> (constr<span class="sc">&lt;</span><span class="dv">8</span>) <span class="sc">&amp;</span> (V18<span class="sc">&lt;</span><span class="dv">9</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">after =</span> V3,</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> V4) <span class="sc">%&gt;%</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a> <span class="co"># mutate(y = y + 0.25 *as.integer(y==0)) %&gt;%</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ly =</span> <span class="fu">log</span>(y)) <span class="sc">%&gt;%</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pre =</span> after,</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">tx =</span> high) <span class="sc">%&gt;%</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">glue</span>(<span class="st">"t{pre}_tx{tx}"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> y) <span class="sc">%&gt;%</span> </span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(x<span class="sc">&gt;</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">log</span>(y),</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="fu">log</span>(x))</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>y00 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(after<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> high<span class="sc">==</span><span class="dv">0</span>) </span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>y01 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(after<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> high <span class="sc">==</span><span class="dv">0</span>) </span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>y10 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(after<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> high<span class="sc">==</span><span class="dv">1</span>) </span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>y11 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(after<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> high <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>df_lalonde <span class="ot">&lt;-</span> </span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>  lalonde.exp <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(treat,re75,re78,id) <span class="sc">%&gt;%</span> </span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(var,x,<span class="sc">-</span>treat,<span class="sc">-</span>id)  <span class="sc">%&gt;%</span> </span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x_orig =</span> x) <span class="sc">%&gt;%</span> </span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(x&gt;0) %&gt;% </span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mutate(x = log(x+0.25*as.integer(x==0))) %&gt;% </span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> x)</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a><span class="co"># y00 &lt;- df_lalonde %&gt;%</span></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(var=="re75" &amp; treat==0)</span></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a><span class="co"># y01 &lt;- df_lalonde %&gt;%</span></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(var=="re78" &amp; treat==0)</span></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a><span class="co"># y10 &lt;- df_lalonde %&gt;%</span></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(var=="re75" &amp; treat==1)</span></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a><span class="co"># y11 &lt;- df_lalonde %&gt;%</span></span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(var=="re78" &amp; treat==1)</span></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>q_ <span class="ot">=</span> q <span class="ot">=</span> <span class="fl">0.9</span></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Untreated, Pre</span></span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>F00_ <span class="ot">&lt;-</span> y00 <span class="sc">%&gt;%</span> <span class="fu">pull</span>(y) <span class="sc">%&gt;%</span> <span class="fu">sort</span>()</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>eF00 <span class="ot">&lt;-</span> <span class="fu">ecdf</span>(F00_)</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>F00 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(F00_) <span class="sc">/</span> <span class="fu">length</span>(F00_)</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Treated, Pre</span></span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>F10_ <span class="ot">&lt;-</span> y10 <span class="sc">%&gt;%</span> <span class="fu">pull</span>(y) <span class="sc">%&gt;%</span> <span class="fu">sort</span>()</span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>eF10 <span class="ot">&lt;-</span> <span class="fu">ecdf</span>(F10_)</span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>F10 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(F10_) <span class="sc">/</span> <span class="fu">length</span>(F10_)</span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Untreated, Post</span></span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>F01_ <span class="ot">&lt;-</span> y01 <span class="sc">%&gt;%</span> <span class="fu">pull</span>(y) <span class="sc">%&gt;%</span> <span class="fu">sort</span>()</span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>eF01_ <span class="ot">&lt;-</span> <span class="fu">ecdf</span>(F01_)</span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a>F01 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(F01_) <span class="sc">/</span> <span class="fu">length</span>(F01_)</span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>F11_ <span class="ot">&lt;-</span> y11 <span class="sc">%&gt;%</span> <span class="fu">pull</span>(y) <span class="sc">%&gt;%</span> <span class="fu">sort</span>()</span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a>eF11_ <span class="ot">&lt;-</span> <span class="fu">ecdf</span>(F11_)</span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>F11 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(F11_) <span class="sc">/</span> <span class="fu">length</span>(F11_)</span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Tx, Pre -- find the value of the qth quantile</span></span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> F10_[<span class="fu">which</span>(F10 <span class="sc">&gt;=</span> q)[<span class="dv">1</span>]]</span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a><span class="co"># Step2: Cx, Pre -- what is the quantile associated with this value?</span></span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">eF00</span>(x1)</span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Cx, Post -- what happens to this quantile in the Cx in the post period?</span></span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a>x3 <span class="ot">&lt;-</span> F01_[<span class="fu">which</span>(F01 <span class="sc">&gt;=</span> x2)[<span class="dv">1</span>]]</span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a><span class="co"># # Step 4:</span></span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a>tau <span class="ot">=</span> F11_[<span class="fu">which</span>(F11 <span class="sc">&gt;=</span> q)[<span class="dv">1</span>]] <span class="sc">-</span> x3</span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternative Version:</span></span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a><span class="co"># Counterfactual is x3 - x1</span></span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a>cfx <span class="ot">&lt;-</span> x3 <span class="sc">-</span> x1</span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a><span class="co"># What happens to qth quantile in Tx gruop?</span></span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a><span class="co"># (F11_[which(F11 &gt;= q)[1]] - F10_[which(F10 &gt;= q)[1]]) - cfx</span></span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Plot the PDF of the Treatment Group in the PRE Period</span></span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a><span class="co"># Include the quantile of interest in the plot</span></span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a>df1a <span class="ot">&lt;-</span> y10 <span class="sc">%&gt;%</span> <span class="fu">pdf_to_cdf</span>(<span class="at">scene =</span> <span class="dv">2</span>,<span class="at">q_  =</span> q_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_filter(dots, env_filter): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 1a is the PDF</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>p1a <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df1a[[<span class="dv">1</span>]], <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> df1a[[<span class="dv">2</span>]], <span class="fu">aes</span>(<span class="at">label =</span> quantile, <span class="at">group =</span> quantile),<span class="at">hjust=</span><span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> df1a[[<span class="dv">2</span>]]<span class="sc">$</span>x, <span class="at">label =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"value = {round(df1a[[2]]$x,2)}"</span>)) <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte_revised</span>() <span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.25</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Value"</span>, <span class="at">y =</span> <span class="st">"Density"</span>,<span class="at">title =</span> <span class="st">"Empirical Distribution</span><span class="sc">\n</span><span class="st">Treated, Pre-Intervention"</span>) <span class="sc">+</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>))</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 1b is the CDF</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>df1b <span class="ot">&lt;-</span> y10 <span class="sc">%&gt;%</span> <span class="fu">pdf_to_cdf</span>(<span class="at">scene =</span> <span class="dv">3</span>,<span class="at">q_  =</span> q_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_filter(dots, env_filter): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>p1b <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df1b[[<span class="dv">1</span>]], <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> df1b[[<span class="dv">2</span>]], <span class="fu">aes</span>(<span class="at">label =</span> quantile, <span class="at">x =</span> x <span class="sc">-</span> .<span class="dv">5</span>,<span class="at">y =</span> y<span class="fl">+.02</span>,<span class="at">group =</span> quantile)) <span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> df1b[[<span class="dv">2</span>]]<span class="sc">$</span>x, <span class="at">label =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"value = {round(df1b[[2]]$x,2)}"</span>), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult=</span>.<span class="dv">25</span>)) <span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"q"</span>,<span class="st">""</span>,df1b[[<span class="dv">2</span>]]<span class="sc">$</span>quantile))) <span class="sc">+</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte_revised</span>() <span class="sc">+</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> q_) <span class="sc">+</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="fu">c</span>(<span class="st">"black"</span>,<span class="st">"blue"</span>),</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.75</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.25</span>,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Value"</span>, <span class="at">y =</span> <span class="st">"Quantile"</span> , <span class="at">title =</span> <span class="st">"Empirical Cumulative Distribution</span><span class="sc">\n</span><span class="st">Treated, Pre-Intervention"</span>) <span class="sc">+</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'y' is already present. Adding another scale for 'y', which will
replace the existing scale.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Map the outcome value at the quantile of interest to the quantile of the comparison group (pre-intevention)</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> y00 <span class="sc">%&gt;%</span> <span class="fu">pdf_to_cdf</span>(<span class="at">q =</span> x2, <span class="at">scene =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_filter(dots, env_filter): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>cdf_Cxpre <span class="ot">&lt;-</span> <span class="fu">approxfun</span>(df2<span class="sc">$</span>cdf<span class="sc">$</span>x, df2<span class="sc">$</span>cdf<span class="sc">$</span>y)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>Cx_quant <span class="ot">&lt;-</span> <span class="fu">cdf_Cxpre</span>(df1b<span class="sc">$</span>p_df_label<span class="sc">$</span>x)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 2a is the overlay of the pre-intervention treatment and control</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>p2a <span class="ot">&lt;-</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> df1b[[<span class="dv">1</span>]], <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> df1b[[<span class="dv">2</span>]], <span class="fu">aes</span>(<span class="at">label =</span> quantile, <span class="at">x =</span> x <span class="sc">-</span> .<span class="dv">5</span>,<span class="at">y =</span> y<span class="fl">+.01</span>,<span class="at">group =</span> quantile)) <span class="sc">+</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> df1b[[<span class="dv">2</span>]]<span class="sc">$</span>x, <span class="at">label =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"value = {round(df1b[[2]]$x,2)}"</span>), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult=</span>.<span class="dv">25</span>)) <span class="sc">+</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte_revised</span>() <span class="sc">+</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Value"</span>, <span class="at">y =</span> <span class="st">"Quantile"</span> , <span class="at">title =</span> <span class="st">"Empirical Cumulative Distribution</span><span class="sc">\n</span><span class="st">Treated (Black) and Untreated (Blue), Pre-Intervention"</span>) <span class="sc">+</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df2[[<span class="dv">1</span>]], <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> df2[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{round(Cx_quant,3)}"</span>),</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">y =</span> Cx_quant), <span class="fu">aes</span>(<span class="at">label =</span> quantile, <span class="at">y =</span> y<span class="fl">+.02</span>, <span class="at">x =</span> p1b <span class="sc">%&gt;%</span> <span class="fu">ggplot_build</span>() <span class="sc">%&gt;%</span> <span class="fu">pluck</span>(<span class="st">"data"</span>) <span class="sc">%&gt;%</span> <span class="fu">pluck</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(x)), <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df2[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{round(Cx_quant,3)}"</span>),</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">y =</span> Cx_quant), <span class="fu">aes</span>( <span class="at">y =</span> y, <span class="at">x =</span> x), <span class="at">colour =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df1b[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{round(Cx_quant,3)}"</span>),</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">y =</span> q_), <span class="fu">aes</span>( <span class="at">y =</span> y, <span class="at">x =</span> x), <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">3</span>)    <span class="sc">+</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(q_,Cx_quant),<span class="at">labels =</span> <span class="fu">round</span>(<span class="fu">c</span>(q_,Cx_quant),<span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="fu">c</span>(<span class="st">"black"</span>,<span class="st">"blue"</span>),</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.75</span>,</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">size =</span> <span class="fl">0.25</span>,</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'y' is already present. Adding another scale for 'y', which will
replace the existing scale.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Get the counterfactual change</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> y01 <span class="sc">%&gt;%</span> <span class="fu">pdf_to_cdf</span>(<span class="at">q =</span> x2, <span class="at">scene =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_filter(dots, env_filter): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>cdf_Cxpost <span class="ot">&lt;-</span> <span class="fu">approxfun</span>(df3<span class="sc">$</span>cdf<span class="sc">$</span>y, df3<span class="sc">$</span>cdf<span class="sc">$</span>x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
collapsing to unique 'x' values</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>cdf_Cxpre <span class="ot">&lt;-</span> <span class="fu">approxfun</span>(df2<span class="sc">$</span>cdf<span class="sc">$</span>y, df2<span class="sc">$</span>cdf<span class="sc">$</span>x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
collapsing to unique 'x' values</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df_cfx <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">cdf_Cxpre</span>(Cx_quant), <span class="at">xend =</span> <span class="fu">cdf_Cxpost</span>(Cx_quant), <span class="at">y =</span> <span class="fl">0.25</span>,<span class="at">yend =</span> <span class="fl">0.25</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> df3[[<span class="dv">1</span>]], <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">colour =</span> <span class="st">"blue"</span>,<span class="at">lty=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(df2[[<span class="dv">2</span>]]<span class="sc">$</span>x,df3[[<span class="dv">2</span>]]<span class="sc">$</span>x), <span class="at">label =</span> <span class="fu">c</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"value = {round(df2[[2]]$x,2)}"</span>),glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"value = {round(df3[[2]]$x,2)}"</span>)), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult=</span>.<span class="dv">25</span>),<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">n.dodge =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte_revised</span>() <span class="sc">+</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Value"</span>, <span class="at">y =</span> <span class="st">"Quantile"</span> , <span class="at">title =</span> <span class="st">"Empirical Cumulative Distribution</span><span class="sc">\n</span><span class="st">Untreated Group, Pre- and Post-Intervention"</span>) <span class="sc">+</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df2[[<span class="dv">1</span>]], <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df2[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{round(Cx_quant,3)}"</span>),</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">y =</span> Cx_quant), <span class="fu">aes</span>( <span class="at">y =</span> y, <span class="at">x =</span> x), <span class="at">colour =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df3[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{round(Cx_quant,3)}"</span>),</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">y =</span> Cx_quant), <span class="fu">aes</span>( <span class="at">y =</span> y, <span class="at">x =</span> x), <span class="at">colour =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>)    <span class="sc">+</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(Cx_quant),<span class="at">labels =</span> <span class="fu">round</span>(<span class="fu">c</span>(Cx_quant),<span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="fu">c</span>(<span class="st">"blue"</span>),</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.75</span>,</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.25</span>,</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> df_cfx, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend, <span class="at">y =</span> y , <span class="at">yend =</span> yend),<span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,<span class="at">y =</span> <span class="fl">0.25</span>, <span class="at">x =</span> df_cfx<span class="sc">$</span>xend[<span class="dv">1</span>], <span class="at">label =</span> <span class="fu">glue</span>(<span class="st">"  Counterfactual: {ifelse(sign(df_cfx$xend - df_cfx$x)==1,'+','')}{round(df_cfx$xend - df_cfx$x,3)}    "</span>),<span class="at">hjust=</span><span class="dv">0</span>, <span class="at">colour =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'y' is already present. Adding another scale for 'y', which will
replace the existing scale.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Get teh Treatmetn Effect</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>df5a <span class="ot">&lt;-</span> y10 <span class="sc">%&gt;%</span> <span class="fu">pdf_to_cdf</span>(<span class="at">q =</span> q_, <span class="at">scene =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_filter(dots, env_filter): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>df5b <span class="ot">&lt;-</span> y11 <span class="sc">%&gt;%</span> <span class="fu">pdf_to_cdf</span>(<span class="at">q =</span> q_, <span class="at">scene =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_filter(dots, env_filter): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>cdf_Cxpost <span class="ot">&lt;-</span> <span class="fu">approxfun</span>(df3<span class="sc">$</span>cdf<span class="sc">$</span>y, df3<span class="sc">$</span>cdf<span class="sc">$</span>x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
collapsing to unique 'x' values</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>cdf_Cxpre <span class="ot">&lt;-</span> <span class="fu">approxfun</span>(df2<span class="sc">$</span>cdf<span class="sc">$</span>y, df2<span class="sc">$</span>cdf<span class="sc">$</span>x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
collapsing to unique 'x' values</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>obs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> df5a[[<span class="dv">2</span>]]<span class="sc">$</span>x, <span class="at">xend =</span> df5b[[<span class="dv">2</span>]]<span class="sc">$</span>x, <span class="at">y =</span> <span class="fl">0.3</span>,<span class="at">yend =</span> <span class="fl">0.3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cfx =</span> df_cfx<span class="sc">$</span>xend <span class="sc">-</span> df_cfx<span class="sc">$</span>x) <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">te =</span> (xend <span class="sc">-</span> x)<span class="sc">-</span>(cfx)); obs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         x     xend   y yend       cfx        te
1 2.833213 3.178054 0.3  0.3 0.1070012 0.2378392</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>te <span class="ot">=</span> obs <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fl">0.2</span>,<span class="at">yend=</span><span class="fl">0.2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xstartte =</span> x <span class="sc">+</span> cfx,</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">xendte =</span> x <span class="sc">+</span> cfx <span class="sc">+</span> te)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df5a[[<span class="dv">1</span>]], <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">colour =</span> <span class="st">"black"</span>,<span class="at">lty=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(df5a[[<span class="dv">2</span>]]<span class="sc">$</span>x,df5b[[<span class="dv">2</span>]]<span class="sc">$</span>x), <span class="at">label =</span> <span class="fu">c</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"pre-intervention value = {round(df5a[[2]]$x,2)}"</span>),glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"post-intervention value = {round(df5b[[2]]$x,2)}"</span>)), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult=</span>.<span class="dv">25</span>),<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">n.dodge =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte_revised</span>() <span class="sc">+</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Value"</span>, <span class="at">y =</span> <span class="st">"Quantile"</span> , <span class="at">title =</span> <span class="st">"Empirical Cumulative Distribution</span><span class="sc">\n</span><span class="st">Treated Group,  Pre- and Post-Intervention"</span>) <span class="sc">+</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df5b[[<span class="dv">1</span>]], <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df5a[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{q_}"</span>),</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">y =</span> q_), <span class="fu">aes</span>( <span class="at">y =</span> y, <span class="at">x =</span> x), <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df5b[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{q_}"</span>),</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">y =</span> q_), <span class="fu">aes</span>( <span class="at">y =</span> y, <span class="at">x =</span> x), <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">3</span>)    <span class="sc">+</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(q_),<span class="at">labels =</span> <span class="fu">round</span>(<span class="fu">c</span>(q_),<span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="fu">c</span>(<span class="st">"black"</span>),</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.75</span>,</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.25</span>,</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> df_cfx, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend, <span class="at">y =</span> y , <span class="at">yend =</span> yend),<span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,<span class="at">y =</span> <span class="fl">0.25</span>, <span class="at">x =</span> df_cfx<span class="sc">$</span>xend[<span class="dv">1</span>], <span class="at">label =</span> <span class="fu">glue</span>(<span class="st">"  Counterfactual:  {ifelse(sign(df_cfx$xend - df_cfx$x)==1,'+','')}{round(df_cfx$xend - df_cfx$x,3)}    "</span>),<span class="at">hjust=</span><span class="dv">0</span>, <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> obs, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend, <span class="at">y =</span> y , <span class="at">yend =</span> yend),<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,<span class="at">y =</span> <span class="fl">0.3</span>, <span class="at">x =</span> df_cfx<span class="sc">$</span>xend[<span class="dv">1</span>], <span class="at">label =</span> <span class="fu">glue</span>(<span class="st">"  Observed:  {ifelse(sign(obs$xend - obs$x)==1,'+','')}{round(obs$xend - obs$x,3)}    "</span>),<span class="at">hjust=</span><span class="dv">0</span>, <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> obs, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend, <span class="at">y =</span> y , <span class="at">yend =</span> yend),<span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,<span class="at">y =</span> <span class="fl">0.2</span>, <span class="at">x =</span> te<span class="sc">$</span>xend[<span class="dv">1</span>], <span class="at">label =</span> <span class="fu">glue</span>(<span class="st">"  tau(q={q_}):  {ifelse(sign(te$te)==1,'+','')}{round(te$te,3)}    "</span>),<span class="at">hjust=</span><span class="dv">0</span>, <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> te, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> x <span class="sc">+</span> cfx, <span class="at">y =</span> y , <span class="at">yend =</span> yend),<span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> te, <span class="fu">aes</span>(<span class="at">x =</span> x <span class="sc">+</span> cfx, <span class="at">xend =</span> xend, <span class="at">y =</span> y , <span class="at">yend =</span> yend),<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">colour =</span> <span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'y' is already present. Adding another scale for 'y', which will
replace the existing scale.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(qte)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>df_mvd <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">here</span>(<span class="st">"ignore/cicprograms/mvd.dat"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">fips =</span> V19) <span class="sc">%&gt;%</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fips <span class="sc">==</span> <span class="dv">16</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">y =</span> V1,</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">head =</span> V10,</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">neck =</span> V11,</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">upper_extr =</span> V12,</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">trunk =</span> V13,</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_back =</span> V14,</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">lower_extr =</span> V15,</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">occ_dis =</span> V16,</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">male =</span> V5,</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">marital =</span> V6,</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">age =</span> V20,</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">manu =</span> V8,</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">constr =</span> V9,</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">prev_earn =</span> V21) <span class="sc">%&gt;%</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ind =</span> <span class="fu">as.integer</span>((age<span class="sc">&lt;</span><span class="dv">99</span>) <span class="sc">&amp;</span> (marital<span class="sc">&lt;</span><span class="dv">8</span>) <span class="sc">&amp;</span> (male<span class="sc">&lt;</span><span class="dv">9</span>) <span class="sc">&amp;</span> (manu<span class="sc">&lt;</span><span class="dv">8</span>) <span class="sc">&amp;</span> (constr<span class="sc">&lt;</span><span class="dv">8</span>) <span class="sc">&amp;</span> (V18<span class="sc">&lt;</span><span class="dv">9</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(ind ==1) %&gt;%</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">after =</span> V3,</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> V4) <span class="sc">%&gt;%</span></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> y <span class="sc">+</span> <span class="fl">0.25</span> <span class="sc">*</span><span class="fu">as.integer</span>(y<span class="sc">==</span><span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pre =</span> after,</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">tx =</span> high) <span class="sc">%&gt;%</span></span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">glue</span>(<span class="st">"t{pre}_tx{tx}"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">year =</span> after,</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>         y, <span class="at">treat =</span> high) <span class="sc">%&gt;%</span></span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">idno =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">yorig =</span> y) <span class="sc">%&gt;%</span></span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">log</span>(y))</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>fit_cic <span class="ot">&lt;-</span></span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">CiC</span>(y <span class="sc">~</span> treat, <span class="at">t =</span> <span class="dv">1</span>, <span class="at">tmin1 =</span> <span class="dv">0</span>, <span class="at">tname =</span> <span class="st">"year"</span>,</span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">xformla=</span><span class="cn">NULL</span>,</span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> y00 <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>(y01) <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>(y10) <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>(y11) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">year=</span>after, <span class="at">treat =</span> high),</span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">idname =</span> <span class="st">"idno"</span>,</span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">se =</span> <span class="cn">TRUE</span>,</span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">probs =</span> <span class="fu">seq</span>(<span class="fl">0.05</span>,<span class="fl">0.95</span>,.<span class="dv">05</span>)) <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a><span class="co"># fit_cic &lt;-</span></span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a><span class="co">#       CiC(y ~ treat, t = 1978, tmin1 = 1975, tname = "year",</span></span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a><span class="co">#       xformla=NULL,</span></span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a><span class="co">#       data = df_lalonde  %&gt;% </span></span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a><span class="co">#          mutate(year=  ifelse(var=="re75",1975,1978)),</span></span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a><span class="co">#       idname = "id",</span></span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a><span class="co">#       se = TRUE,</span></span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a><span class="co">#       probs = seq(0.05,0.95,.05)) %&gt;% summary()</span></span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a><span class="co"># c1 &lt;- CiC(re ~ treat, t=1978, tmin1=1975, tname="year",</span></span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a><span class="co">#  xformla=~NULL,</span></span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a><span class="co">#  data=lalonde.exp.panel, idname="id", se=FALSE,</span></span>
<span id="cb40-56"><a href="#cb40-56" aria-hidden="true" tabindex="-1"></a><span class="co">#  probs=seq(0.05, 0.95, 0.05))</span></span>
<span id="cb40-57"><a href="#cb40-57" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-58"><a href="#cb40-58" aria-hidden="true" tabindex="-1"></a><span class="co"># p_cic &lt;- ggqte(fit_cic)</span></span>
<span id="cb40-59"><a href="#cb40-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-60"><a href="#cb40-60" aria-hidden="true" tabindex="-1"></a> <span class="co"># jt.cia &lt;- ci.qte(y ~ treat,</span></span>
<span id="cb40-61"><a href="#cb40-61" aria-hidden="true" tabindex="-1"></a> <span class="co">#   xformla=NULL,</span></span>
<span id="cb40-62"><a href="#cb40-62" aria-hidden="true" tabindex="-1"></a> <span class="co">#   data=df_mvd,</span></span>
<span id="cb40-63"><a href="#cb40-63" aria-hidden="true" tabindex="-1"></a> <span class="co">#   probs=seq(0.05,0.95,0.05), se=FALSE)</span></span>
<span id="cb40-64"><a href="#cb40-64" aria-hidden="true" tabindex="-1"></a> <span class="co"># summary(jt.cia)</span></span>
<span id="cb40-65"><a href="#cb40-65" aria-hidden="true" tabindex="-1"></a> <span class="co"># </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">

</div>
</section>
<section id="normal-distribution-pdf" class="level2">
<h2 class="anchored" data-anchor-id="normal-distribution-pdf">Normal Distribution: PDF</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="media/pdf-to-cdf-norm.png" data-layout-valign="center" height="500" class="figure-img"></p>
</figure>
</div>
</section>
<section id="normal-distribution-cdf" class="level2">
<h2 class="anchored" data-anchor-id="normal-distribution-cdf">Normal Distribution: CDF</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="media/pdf-to-cdf-norm4.png" data-layout-valign="center" height="500" class="figure-img"></p>
</figure>
</div>
</section>
<section id="normal-distribution-pdf-to-cdf" class="level2">
<h2 class="anchored" data-anchor-id="normal-distribution-pdf-to-cdf">Normal Distribution: PDF to CDF</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="media/pdf-to-cdf-norm.gif" data-layout-valign="center" height="500" class="figure-img"></p>
</figure>
</div>
</section>
<section id="quantile-treatment-effects-under-randomization" class="level1">
<h1>Quantile Treatment Effects Under Randomization</h1>
<section id="qte-under-randomization" class="level2">
<h2 class="anchored" data-anchor-id="qte-under-randomization">QTE Under Randomization</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>q_ <span class="ot">&lt;-</span> <span class="fl">0.9</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>dfrand1 <span class="ot">&lt;-</span> </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  lalonde.exp <span class="sc">%&gt;%</span> </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()  <span class="sc">%&gt;%</span> </span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(re78,treat) <span class="sc">%&gt;%</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(treat<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">y =</span> re78,</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> re78) <span class="sc">%&gt;%</span> </span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pdf_to_cdf</span>(<span class="at">scene =</span> <span class="dv">2</span>, <span class="at">q_ =</span> q_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_filter(dots, env_filter): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 1a is the PDF</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dfrand1[[<span class="dv">1</span>]], <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> dfrand1[[<span class="dv">2</span>]], <span class="fu">aes</span>(<span class="at">label =</span> quantile, <span class="at">group =</span> quantile),<span class="at">hjust=</span><span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> dfrand1[[<span class="dv">2</span>]]<span class="sc">$</span>x, <span class="at">label =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"value = {round(dfrand1[[2]]$x,2)}"</span>)) <span class="sc">+</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte_revised</span>() <span class="sc">+</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.25</span>,</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Value"</span>, <span class="at">y =</span> <span class="st">"Density"</span>,<span class="at">title =</span> <span class="st">"Empirical Distribution</span><span class="sc">\n</span><span class="st">Treated, Post-Intervention"</span>) <span class="sc">+</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="holding-pen_quantile-tx-effects-changes-in-changes_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="qte-under-randomization-1" class="level2">
<h2 class="anchored" data-anchor-id="qte-under-randomization-1">QTE Under Randomization</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 1b is the CDF</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>dfrand1b <span class="ot">&lt;-</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  lalonde.exp <span class="sc">%&gt;%</span> </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()  <span class="sc">%&gt;%</span> </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(re78,treat) <span class="sc">%&gt;%</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(treat<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">y =</span> re78,</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> re78) <span class="sc">%&gt;%</span> </span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pdf_to_cdf</span>(<span class="at">scene =</span> <span class="dv">3</span>, <span class="at">q_ =</span> q_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_filter(dots, env_filter): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dfrand1b[[<span class="dv">1</span>]], <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> dfrand1b[[<span class="dv">2</span>]], <span class="fu">aes</span>(<span class="at">label =</span> quantile, <span class="at">x =</span> x <span class="sc">-</span> .<span class="dv">5</span>,<span class="at">y =</span> y<span class="fl">+.02</span>,<span class="at">group =</span> quantile)) <span class="sc">+</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> dfrand1b[[<span class="dv">2</span>]]<span class="sc">$</span>x, <span class="at">label =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"value = {round(dfrand1b[[2]]$x,2)}"</span>), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult=</span>.<span class="dv">25</span>)) <span class="sc">+</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"q"</span>,<span class="st">""</span>,dfrand1b[[<span class="dv">2</span>]]<span class="sc">$</span>quantile))) <span class="sc">+</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte_revised</span>() <span class="sc">+</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> q_) <span class="sc">+</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="fu">c</span>(<span class="st">"black"</span>,<span class="st">"blue"</span>),</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.75</span>,</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.25</span>,</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Value"</span>, <span class="at">y =</span> <span class="st">"Quantile"</span> , <span class="at">title =</span> <span class="st">"Empirical Cumulative Distribution</span><span class="sc">\n</span><span class="st">Treated, Post-Intervention"</span>) <span class="sc">+</span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'y' is already present. Adding another scale for 'y', which will
replace the existing scale.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="holding-pen_quantile-tx-effects-changes-in-changes_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="qte-under-randomization-2" class="level2">
<h2 class="anchored" data-anchor-id="qte-under-randomization-2">QTE Under Randomization</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>dfrand0b <span class="ot">&lt;-</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  lalonde.exp <span class="sc">%&gt;%</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()  <span class="sc">%&gt;%</span> </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(re78,treat) <span class="sc">%&gt;%</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(treat<span class="sc">==</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">y =</span> re78,</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> re78) <span class="sc">%&gt;%</span> </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pdf_to_cdf</span>(<span class="at">scene =</span> <span class="dv">3</span>, <span class="at">q_ =</span> q_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_filter(dots, env_filter): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Get the counterfactual change</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>cdf_Cxpost <span class="ot">&lt;-</span> <span class="fu">approxfun</span>(dfrand0b<span class="sc">$</span>cdf<span class="sc">$</span>y, dfrand0b<span class="sc">$</span>cdf<span class="sc">$</span>x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
collapsing to unique 'x' values</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>cdf_Txpost <span class="ot">&lt;-</span> <span class="fu">approxfun</span>(dfrand1b<span class="sc">$</span>cdf<span class="sc">$</span>y, dfrand1b<span class="sc">$</span>cdf<span class="sc">$</span>x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
collapsing to unique 'x' values</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>df_te <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">cdf_Cxpost</span>(q_), <span class="at">xend =</span> <span class="fu">cdf_Txpost</span>(q_), <span class="at">y =</span> <span class="fl">0.25</span>,<span class="at">yend =</span> <span class="fl">0.25</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co">#p3 &lt;-</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> dfrand0b[[<span class="dv">1</span>]], <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">colour =</span> <span class="st">"blue"</span>,<span class="at">lty=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dfrand1b[[<span class="dv">1</span>]], <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(dfrand0b[[<span class="dv">2</span>]]<span class="sc">$</span>x,dfrand1b[[<span class="dv">2</span>]]<span class="sc">$</span>x), <span class="at">label =</span> <span class="fu">c</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"value = {round(dfrand0b[[2]]$x,2)}"</span>),glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"value = {round(dfrand1b[[2]]$x,2)}"</span>)), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult=</span>.<span class="dv">25</span>),<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">n.dodge =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte_revised</span>() <span class="sc">+</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Value"</span>, <span class="at">y =</span> <span class="st">"Quantile"</span> , <span class="at">title =</span> <span class="st">"Empirical Cumulative Distribution</span><span class="sc">\n</span><span class="st">Treated (Black) and Untreated (Blue) Group, Post Intervention"</span>) <span class="sc">+</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> dfrand0b[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{round(q_,3)}"</span>),</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">y =</span> q_), <span class="fu">aes</span>( <span class="at">y =</span> y, <span class="at">x =</span> x), <span class="at">colour =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> dfrand1b[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{round(q_,3)}"</span>),</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">y =</span> q_), <span class="fu">aes</span>( <span class="at">y =</span> y, <span class="at">x =</span> x), <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span>    </span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(q_),<span class="at">labels =</span> <span class="fu">round</span>(<span class="fu">c</span>(q_),<span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="fu">c</span>(<span class="st">"blue"</span>),</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.75</span>,</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.25</span>,</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> df_te, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend, <span class="at">y =</span> y , <span class="at">yend =</span> yend),<span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,<span class="at">y =</span> <span class="fl">0.25</span>, <span class="at">x =</span> df_te<span class="sc">$</span>x[<span class="dv">1</span>], <span class="at">label =</span> <span class="fu">glue</span>(<span class="st">"  Treatment Effect:</span><span class="sc">\n</span><span class="st"> {ifelse(sign(df_te$xend - df_te$x)==1,'+','')}{round(df_te$xend - df_te$x,2)}    "</span>),<span class="at">hjust=</span><span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'y' is already present. Adding another scale for 'y', which will
replace the existing scale.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="holding-pen_quantile-tx-effects-changes-in-changes_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="qte-under-randomization-3" class="level2">
<h2 class="anchored" data-anchor-id="qte-under-randomization-3">QTE Under Randomization</h2>
<div class="columns">
<div class="column">
<div class="sourceCode" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>jt.rand <span class="ot">&lt;-</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ci.qtet</span>(re78 <span class="sc">~</span> treat, </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data=</span>lalonde.exp, </span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">probs=</span><span class="fu">seq</span>(<span class="fl">0.05</span>,<span class="fl">0.95</span>,<span class="fl">0.05</span>), </span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">se=</span>T, </span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">iters=</span><span class="dv">10</span>)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(jt.rand)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>jt.rand <span class="ot">&lt;-</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ci.qtet</span>(re78 <span class="sc">~</span> treat, </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data=</span>lalonde.exp, </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">probs=</span><span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.75</span>,<span class="fl">0.9</span>), </span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">se=</span>T, </span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">iters=</span><span class="dv">10</span>)</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>foo <span class="ot">&lt;-</span> <span class="fu">summary</span>(jt.rand)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">quantile =</span> <span class="fu">unname</span>(foo<span class="sc">$</span>probs), <span class="at">tau =</span> <span class="fu">unname</span>(foo<span class="sc">$</span>qte)) <span class="sc">%&gt;%</span> </span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span>  <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:right;"> quantile </th>
   <th style="text-align:right;"> tau </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 0.10 </td>
   <td style="text-align:right;"> 0.00 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.25 </td>
   <td style="text-align:right;"> 338.65 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.50 </td>
   <td style="text-align:right;"> 1123.55 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.75 </td>
   <td style="text-align:right;"> 2347.50 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.90 </td>
   <td style="text-align:right;"> 3239.60 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</section>
<section id="qte-under-randomization-4" class="level2">
<h2 class="anchored" data-anchor-id="qte-under-randomization-4">QTE Under Randomization</h2>
<div class="sourceCode" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggqte</span>(jt.rand)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggqte</span>(jt.rand) <span class="sc">+</span> <span class="fu">theme_tufte_revised</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="holding-pen_quantile-tx-effects-changes-in-changes_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
<ul>
<li>Start with the distribution of oute</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>p1a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="holding-pen_quantile-tx-effects-changes-in-changes_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="section-1" class="level2">
<h2 class="anchored" data-anchor-id="section-1"></h2>
<ul>
<li>Test</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>p1b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="holding-pen_quantile-tx-effects-changes-in-changes_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="section-2" class="level2">
<h2 class="anchored" data-anchor-id="section-2"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>p2a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="holding-pen_quantile-tx-effects-changes-in-changes_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="section-3" class="level2">
<h2 class="anchored" data-anchor-id="section-3"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>p3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="holding-pen_quantile-tx-effects-changes-in-changes_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="section-4" class="level2">
<h2 class="anchored" data-anchor-id="section-4"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>p4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="holding-pen_quantile-tx-effects-changes-in-changes_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="quantile-difference-in-differences" class="level2">
<h2 class="anchored" data-anchor-id="quantile-difference-in-differences">Quantile Difference-in-Differences</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> y00 <span class="sc">%&gt;%</span> <span class="fu">pdf_to_cdf</span>(<span class="at">q =</span> q_, <span class="at">scene =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_filter(dots, env_filter): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>cdf_Cxpre <span class="ot">&lt;-</span> <span class="fu">approxfun</span>(df2<span class="sc">$</span>cdf<span class="sc">$</span>x, df2<span class="sc">$</span>cdf<span class="sc">$</span>y)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>Cx_quant <span class="ot">&lt;-</span> q_ <span class="co">#cdf_Cxpre(df1b$p_df_label$x)</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 2a is the overlay of the pre-intervention treatment and control</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>p2aQDID <span class="ot">&lt;-</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> df1b[[<span class="dv">1</span>]], <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> df1b[[<span class="dv">2</span>]], <span class="fu">aes</span>(<span class="at">label =</span> quantile, <span class="at">x =</span> x <span class="sc">-</span> .<span class="dv">5</span>,<span class="at">y =</span> y<span class="fl">+.01</span>,<span class="at">group =</span> quantile)) <span class="sc">+</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(df1b[[<span class="dv">2</span>]]<span class="sc">$</span>x,df2[[<span class="dv">2</span>]]<span class="sc">$</span>x), <span class="at">label =</span> <span class="fu">c</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"value = {round(df1b[[2]]$x,2)}"</span>),glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"value = {round(df2[[2]]$x,2)}"</span>)), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult=</span>.<span class="dv">25</span>),<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">n.dodge =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte_revised</span>() <span class="sc">+</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Value"</span>, <span class="at">y =</span> <span class="st">"Quantile"</span> , <span class="at">title =</span> <span class="st">"Empirical Cumulative Distribution</span><span class="sc">\n</span><span class="st">Treated (Black) and Untreated (Blue), Pre-Intervention"</span>) <span class="sc">+</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df2[[<span class="dv">1</span>]], <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> df2[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{round(Cx_quant,3)}"</span>),</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">y =</span> Cx_quant), <span class="fu">aes</span>(<span class="at">label =</span> quantile, <span class="at">y =</span> y<span class="fl">+.02</span>, <span class="at">x =</span> {p1b <span class="sc">%&gt;%</span> <span class="fu">ggplot_build</span>() <span class="sc">%&gt;%</span> <span class="fu">pluck</span>(<span class="st">"data"</span>) <span class="sc">%&gt;%</span> <span class="fu">pluck</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(x)}<span class="sc">-</span>.<span class="dv">5</span>), <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df2[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{round(Cx_quant,3)}"</span>),</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">y =</span> Cx_quant), <span class="fu">aes</span>( <span class="at">y =</span> y, <span class="at">x =</span> x), <span class="at">colour =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df1b[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{round(Cx_quant,3)}"</span>),</span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">y =</span> q_), <span class="fu">aes</span>( <span class="at">y =</span> y, <span class="at">x =</span> x), <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">3</span>)    <span class="sc">+</span></span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(q_,Cx_quant),<span class="at">labels =</span> <span class="fu">round</span>(<span class="fu">c</span>(q_,Cx_quant),<span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="fu">c</span>(<span class="st">"black"</span>,<span class="st">"blue"</span>),</span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.75</span>,</span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.25</span>,</span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'y' is already present. Adding another scale for 'y', which will
replace the existing scale.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Get the counterfactual change</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> y01 <span class="sc">%&gt;%</span> <span class="fu">pdf_to_cdf</span>(<span class="at">q =</span> q_, <span class="at">scene =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_filter(dots, env_filter): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>cdf_Cxpost <span class="ot">&lt;-</span> <span class="fu">approxfun</span>(df3<span class="sc">$</span>cdf<span class="sc">$</span>y, df3<span class="sc">$</span>cdf<span class="sc">$</span>x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
collapsing to unique 'x' values</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>cdf_Cxpre <span class="ot">&lt;-</span> <span class="fu">approxfun</span>(df2<span class="sc">$</span>cdf<span class="sc">$</span>y, df2<span class="sc">$</span>cdf<span class="sc">$</span>x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
collapsing to unique 'x' values</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>df_cfx <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">cdf_Cxpre</span>(Cx_quant), <span class="at">xend =</span> <span class="fu">cdf_Cxpost</span>(Cx_quant), <span class="at">y =</span> <span class="fl">0.25</span>,<span class="at">yend =</span> <span class="fl">0.25</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>p3QDID <span class="ot">&lt;-</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> df3[[<span class="dv">1</span>]], <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">colour =</span> <span class="st">"blue"</span>,<span class="at">lty=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(df2[[<span class="dv">2</span>]]<span class="sc">$</span>x,df3[[<span class="dv">2</span>]]<span class="sc">$</span>x), <span class="at">label =</span> <span class="fu">c</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"value = {round(df2[[2]]$x,2)}"</span>),glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"value = {round(df3[[2]]$x,2)}"</span>)), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult=</span>.<span class="dv">25</span>),<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">n.dodge =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte_revised</span>() <span class="sc">+</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Value"</span>, <span class="at">y =</span> <span class="st">"Quantile"</span> , <span class="at">title =</span> <span class="st">"Empirical Cumulative Distribution</span><span class="sc">\n</span><span class="st">Untreated Group, Pre- and Post-Intervention"</span>) <span class="sc">+</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df2[[<span class="dv">1</span>]], <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df2[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{round(Cx_quant,3)}"</span>),</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">y =</span> Cx_quant), <span class="fu">aes</span>( <span class="at">y =</span> y, <span class="at">x =</span> x), <span class="at">colour =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df3[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{round(Cx_quant,3)}"</span>),</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">y =</span> Cx_quant), <span class="fu">aes</span>( <span class="at">y =</span> y, <span class="at">x =</span> x), <span class="at">colour =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>)    <span class="sc">+</span></span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(Cx_quant),<span class="at">labels =</span> <span class="fu">round</span>(<span class="fu">c</span>(Cx_quant),<span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="fu">c</span>(<span class="st">"blue"</span>),</span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.75</span>,</span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.25</span>,</span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> df_cfx, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend, <span class="at">y =</span> y , <span class="at">yend =</span> yend),<span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,<span class="at">y =</span> <span class="fl">0.25</span>, <span class="at">x =</span> df_cfx<span class="sc">$</span>x[<span class="dv">1</span>], <span class="at">label =</span> <span class="fu">glue</span>(<span class="st">"  Counterfactual:</span><span class="sc">\n</span><span class="st"> {ifelse(sign(df_cfx$xend - df_cfx$x)==1,'+','')}{round(df_cfx$xend - df_cfx$x,3)}    "</span>),<span class="at">hjust=</span><span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'y' is already present. Adding another scale for 'y', which will
replace the existing scale.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Get teh Treatmetn Effect</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>df5a <span class="ot">&lt;-</span> y10 <span class="sc">%&gt;%</span> <span class="fu">pdf_to_cdf</span>(<span class="at">q =</span> q_, <span class="at">scene =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_filter(dots, env_filter): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>df5b <span class="ot">&lt;-</span> y11 <span class="sc">%&gt;%</span> <span class="fu">pdf_to_cdf</span>(<span class="at">q =</span> q_, <span class="at">scene =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_filter(dots, env_filter): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>cdf_Cxpost <span class="ot">&lt;-</span> <span class="fu">approxfun</span>(df3<span class="sc">$</span>cdf<span class="sc">$</span>y, df3<span class="sc">$</span>cdf<span class="sc">$</span>x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
collapsing to unique 'x' values</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>cdf_Cxpre <span class="ot">&lt;-</span> <span class="fu">approxfun</span>(df2<span class="sc">$</span>cdf<span class="sc">$</span>y, df2<span class="sc">$</span>cdf<span class="sc">$</span>x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
collapsing to unique 'x' values</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>obs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> df5a[[<span class="dv">2</span>]]<span class="sc">$</span>x, <span class="at">xend =</span> df5b[[<span class="dv">2</span>]]<span class="sc">$</span>x, <span class="at">y =</span> <span class="fl">0.3</span>,<span class="at">yend =</span> <span class="fl">0.3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cfx =</span> df_cfx<span class="sc">$</span>xend <span class="sc">-</span> df_cfx<span class="sc">$</span>x) <span class="sc">%&gt;%</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">te =</span> (xend <span class="sc">-</span> x)<span class="sc">-</span>(cfx))</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>te <span class="ot">=</span> obs <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fl">0.2</span>,<span class="at">yend=</span><span class="fl">0.2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xstartte =</span> x <span class="sc">+</span> cfx,</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">xendte =</span> x <span class="sc">+</span> cfx <span class="sc">+</span> te)</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>p4QDID <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df5a[[<span class="dv">1</span>]], <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">colour =</span> <span class="st">"black"</span>,<span class="at">lty=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(df5a[[<span class="dv">2</span>]]<span class="sc">$</span>x,df5b[[<span class="dv">2</span>]]<span class="sc">$</span>x), <span class="at">label =</span> <span class="fu">c</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"pre-intervention value = {round(df5a[[2]]$x,2)}"</span>),glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"post-intervention value = {round(df5b[[2]]$x,2)}"</span>)), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult=</span>.<span class="dv">25</span>),<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">n.dodge =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte_revised</span>() <span class="sc">+</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Value"</span>, <span class="at">y =</span> <span class="st">"Quantile"</span> , <span class="at">title =</span> <span class="st">"Empirical Cumulative Distribution</span><span class="sc">\n</span><span class="st">Treated Group,  Pre- and Post-Intervention"</span>) <span class="sc">+</span></span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df5b[[<span class="dv">1</span>]], <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df5a[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{q_}"</span>),</span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">y =</span> q_), <span class="fu">aes</span>( <span class="at">y =</span> y, <span class="at">x =</span> x), <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df5b[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{q_}"</span>),</span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">y =</span> q_), <span class="fu">aes</span>( <span class="at">y =</span> y, <span class="at">x =</span> x), <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">3</span>)    <span class="sc">+</span></span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(q_),<span class="at">labels =</span> <span class="fu">round</span>(<span class="fu">c</span>(q_),<span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb85-23"><a href="#cb85-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="fu">c</span>(<span class="st">"black"</span>),</span>
<span id="cb85-24"><a href="#cb85-24" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.75</span>,</span>
<span id="cb85-25"><a href="#cb85-25" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb85-26"><a href="#cb85-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb85-27"><a href="#cb85-27" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.25</span>,</span>
<span id="cb85-28"><a href="#cb85-28" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb85-29"><a href="#cb85-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb85-30"><a href="#cb85-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> df_cfx, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend, <span class="at">y =</span> y , <span class="at">yend =</span> yend),<span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb85-31"><a href="#cb85-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,<span class="at">y =</span> <span class="fl">0.25</span>, <span class="at">x =</span> df_cfx<span class="sc">$</span>x[<span class="dv">1</span>], <span class="at">label =</span> <span class="fu">glue</span>(<span class="st">"  Counterfactual:  {ifelse(sign(df_cfx$xend - df_cfx$x)==1,'+','')}{round(df_cfx$xend - df_cfx$x,3)}    "</span>),<span class="at">hjust=</span><span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb85-32"><a href="#cb85-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> obs, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend, <span class="at">y =</span> y , <span class="at">yend =</span> yend),<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb85-33"><a href="#cb85-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,<span class="at">y =</span> <span class="fl">0.3</span>, <span class="at">x =</span> df_cfx<span class="sc">$</span>x[<span class="dv">1</span>], <span class="at">label =</span> <span class="fu">glue</span>(<span class="st">"  Observed:  {ifelse(sign(obs$xend - obs$x)==1,'+','')}{round(obs$xend - obs$x,3)}    "</span>),<span class="at">hjust=</span><span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb85-34"><a href="#cb85-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> obs, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend, <span class="at">y =</span> y , <span class="at">yend =</span> yend),<span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb85-35"><a href="#cb85-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,<span class="at">y =</span> <span class="fl">0.2</span>, <span class="at">x =</span> te<span class="sc">$</span>x[<span class="dv">1</span>], <span class="at">label =</span> <span class="fu">glue</span>(<span class="st">"  tau(q={q_}):  {ifelse(sign(te$te)==1,'+','')}{round(te$te,3)}    "</span>),<span class="at">hjust=</span><span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb85-36"><a href="#cb85-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> te, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> x <span class="sc">+</span> cfx, <span class="at">y =</span> y , <span class="at">yend =</span> yend),<span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb85-37"><a href="#cb85-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> te, <span class="fu">aes</span>(<span class="at">x =</span> x <span class="sc">+</span> cfx, <span class="at">xend =</span> xend, <span class="at">y =</span> y , <span class="at">yend =</span> yend),<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb85-38"><a href="#cb85-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df2[[<span class="dv">1</span>]], <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span>  <span class="fu">geom_line</span>(<span class="at">data =</span> df3[[<span class="dv">1</span>]], <span class="at">colour =</span> <span class="st">"blue"</span>,<span class="at">lty=</span><span class="dv">2</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'y' is already present. Adding another scale for 'y', which will
replace the existing scale.</code></pre>
</div>
</div>
</section>
<section id="section-5" class="level2">
<h2 class="anchored" data-anchor-id="section-5"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>p1a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="holding-pen_quantile-tx-effects-changes-in-changes_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="section-6" class="level2">
<h2 class="anchored" data-anchor-id="section-6"></h2>
<ul>
<li>Test</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>p1b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="holding-pen_quantile-tx-effects-changes-in-changes_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="section-7" class="level2">
<h2 class="anchored" data-anchor-id="section-7"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>p2aQDID</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="holding-pen_quantile-tx-effects-changes-in-changes_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="section-8" class="level2">
<h2 class="anchored" data-anchor-id="section-8"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>p3QDID</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="holding-pen_quantile-tx-effects-changes-in-changes_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="section-9" class="level2">
<h2 class="anchored" data-anchor-id="section-9"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>p4QDID</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="holding-pen_quantile-tx-effects-changes-in-changes_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="approach-1" class="level2">
<h2 class="anchored" data-anchor-id="approach-1">Approach</h2>
<p>There are two general approaches to understanding</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gganimate)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(qte)</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>theme_tufte_revised <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">base_size =</span> <span class="dv">11</span>, <span class="at">base_family =</span> <span class="st">"Gill Sans"</span>, <span class="at">ticks =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_family =</span> base_family, <span class="at">base_size =</span> base_size) <span class="sc">+</span></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.line =</span> ggplot2<span class="sc">::</span><span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">'black'</span>),</span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.3</span>),</span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">vjust =</span> <span class="fl">0.8</span>),</span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.background =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),</span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.key =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),</span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"plain"</span>),</span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),</span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.border =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),</span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),</span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.background =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>(),</span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.background =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>ticks) {</span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a>    ret <span class="ot">&lt;-</span> ret <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">axis.ticks =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>())</span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a>  ret</span>
<span id="cb92-32"><a href="#cb92-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb92-33"><a href="#cb92-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-34"><a href="#cb92-34" aria-hidden="true" tabindex="-1"></a>pdf_to_cdf <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">scene_to_show =</span> <span class="cn">NULL</span>, <span class="at">q_ =</span> <span class="fu">c</span>(.<span class="dv">9</span>), <span class="at">breaks_to_show =</span> <span class="cn">NULL</span> ) {</span>
<span id="cb92-35"><a href="#cb92-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-36"><a href="#cb92-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-37"><a href="#cb92-37" aria-hidden="true" tabindex="-1"></a>  pdf <span class="ot">&lt;-</span></span>
<span id="cb92-38"><a href="#cb92-38" aria-hidden="true" tabindex="-1"></a>    {df <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span> <span class="fu">geom_density</span>()} <span class="sc">%&gt;%</span></span>
<span id="cb92-39"><a href="#cb92-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot_build</span>() <span class="sc">%&gt;%</span> <span class="fu">pluck</span>(<span class="st">"data"</span>) <span class="sc">%&gt;%</span> <span class="fu">pluck</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-40"><a href="#cb92-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb92-41"><a href="#cb92-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(x,y) <span class="sc">%&gt;%</span></span>
<span id="cb92-42"><a href="#cb92-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.table</span>(<span class="at">key =</span> <span class="st">"x"</span>)</span>
<span id="cb92-43"><a href="#cb92-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-44"><a href="#cb92-44" aria-hidden="true" tabindex="-1"></a>  cdf <span class="ot">&lt;-</span></span>
<span id="cb92-45"><a href="#cb92-45" aria-hidden="true" tabindex="-1"></a>    {df <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span> <span class="fu">stat_ecdf</span>()} <span class="sc">%&gt;%</span></span>
<span id="cb92-46"><a href="#cb92-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot_build</span>() <span class="sc">%&gt;%</span> <span class="fu">pluck</span>(<span class="st">"data"</span>) <span class="sc">%&gt;%</span> <span class="fu">pluck</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-47"><a href="#cb92-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb92-48"><a href="#cb92-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(x,y) <span class="sc">%&gt;%</span></span>
<span id="cb92-49"><a href="#cb92-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.table</span>(<span class="at">key =</span> <span class="st">"y"</span>)</span>
<span id="cb92-50"><a href="#cb92-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-51"><a href="#cb92-51" aria-hidden="true" tabindex="-1"></a>  q <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">q_ =</span> <span class="fu">map_dbl</span>(q_,<span class="sc">~</span>(cdf<span class="sc">$</span>x[<span class="fu">which</span>(cdf<span class="sc">$</span>y<span class="sc">&gt;=</span>.x)][<span class="dv">1</span>]))) <span class="sc">%&gt;%</span></span>
<span id="cb92-52"><a href="#cb92-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">deframe</span>() <span class="sc">%&gt;%</span></span>
<span id="cb92-53"><a href="#cb92-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(q_) <span class="sc">%&gt;%</span></span>
<span id="cb92-54"><a href="#cb92-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb92-55"><a href="#cb92-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(<span class="st">"x_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-56"><a href="#cb92-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"quantile"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-57"><a href="#cb92-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.table</span>(<span class="at">key =</span> <span class="st">"x_"</span>)</span>
<span id="cb92-58"><a href="#cb92-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-59"><a href="#cb92-59" aria-hidden="true" tabindex="-1"></a>  scene2 <span class="ot">&lt;-</span></span>
<span id="cb92-60"><a href="#cb92-60" aria-hidden="true" tabindex="-1"></a>    pdf[q,roll<span class="ot">=</span><span class="st">"nearest"</span>] <span class="sc">%&gt;%</span></span>
<span id="cb92-61"><a href="#cb92-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb92-62"><a href="#cb92-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(y,quantile) <span class="sc">%&gt;%</span></span>
<span id="cb92-63"><a href="#cb92-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">right_join</span>(pdf,<span class="fu">c</span>(<span class="st">"y"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb92-64"><a href="#cb92-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(x,y) <span class="sc">%&gt;%</span></span>
<span id="cb92-65"><a href="#cb92-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">scene =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-66"><a href="#cb92-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">quantile =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"{as.numeric(quantile)}"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb92-67"><a href="#cb92-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(q,<span class="st">"quantile"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb92-68"><a href="#cb92-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">x =</span> <span class="fu">coalesce</span>(x_,x))</span>
<span id="cb92-69"><a href="#cb92-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-70"><a href="#cb92-70" aria-hidden="true" tabindex="-1"></a>  q2 <span class="ot">&lt;-</span></span>
<span id="cb92-71"><a href="#cb92-71" aria-hidden="true" tabindex="-1"></a>    q <span class="sc">%&gt;%</span></span>
<span id="cb92-72"><a href="#cb92-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb92-73"><a href="#cb92-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">as.numeric</span>(quantile)) <span class="sc">%&gt;%</span></span>
<span id="cb92-74"><a href="#cb92-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.table</span>(<span class="at">key=</span><span class="st">"quantile"</span>)</span>
<span id="cb92-75"><a href="#cb92-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-76"><a href="#cb92-76" aria-hidden="true" tabindex="-1"></a>  scene3 <span class="ot">&lt;-</span></span>
<span id="cb92-77"><a href="#cb92-77" aria-hidden="true" tabindex="-1"></a>    cdf[cdf<span class="sc">$</span>x<span class="sc">==</span>q<span class="sc">$</span>x_,] <span class="sc">%&gt;%</span></span>
<span id="cb92-78"><a href="#cb92-78" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">x_ =</span> q<span class="sc">$</span>x_) <span class="sc">%&gt;%</span></span>
<span id="cb92-79"><a href="#cb92-79" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">y =</span> q<span class="sc">$</span>quantile) <span class="sc">%&gt;%</span></span>
<span id="cb92-80"><a href="#cb92-80" aria-hidden="true" tabindex="-1"></a>      <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">"x"</span>,<span class="st">"quantile"</span>,<span class="st">"x_"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb92-81"><a href="#cb92-81" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>x_) <span class="sc">%&gt;%</span></span>
<span id="cb92-82"><a href="#cb92-82" aria-hidden="true" tabindex="-1"></a>      <span class="fu">right_join</span>(cdf,<span class="st">"x"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-83"><a href="#cb92-83" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(x,y)  <span class="sc">%&gt;%</span></span>
<span id="cb92-84"><a href="#cb92-84" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">scene =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-85"><a href="#cb92-85" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">quantile =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"{as.numeric(quantile)}"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb92-86"><a href="#cb92-86" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb92-87"><a href="#cb92-87" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">as.numeric</span>(quantile)) <span class="sc">|</span> <span class="fu">row_number</span>() <span class="sc">%in%</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.),<span class="dv">1000</span>, <span class="at">replace=</span><span class="cn">TRUE</span>)); <span class="fu">dim</span>(scene2)</span>
<span id="cb92-88"><a href="#cb92-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-89"><a href="#cb92-89" aria-hidden="true" tabindex="-1"></a>  p_df <span class="ot">&lt;-</span></span>
<span id="cb92-90"><a href="#cb92-90" aria-hidden="true" tabindex="-1"></a>    scene2 <span class="sc">%&gt;%</span></span>
<span id="cb92-91"><a href="#cb92-91" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">scene =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-92"><a href="#cb92-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(scene2) <span class="sc">%&gt;%</span></span>
<span id="cb92-93"><a href="#cb92-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(scene3) <span class="sc">%&gt;%</span></span>
<span id="cb92-94"><a href="#cb92-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(scene3 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">scene=</span><span class="dv">4</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb92-95"><a href="#cb92-95" aria-hidden="true" tabindex="-1"></a>    <span class="co">#bind_rows(scene3 %&gt;% mutate(scene=5)) %&gt;%</span></span>
<span id="cb92-96"><a href="#cb92-96" aria-hidden="true" tabindex="-1"></a>    <span class="co">#bind_rows(scene3 %&gt;% mutate(scene=6)) %&gt;%</span></span>
<span id="cb92-97"><a href="#cb92-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">ifelse</span>(quantile<span class="sc">==</span><span class="st">"NA"</span>,<span class="cn">NA</span>, quantile))</span>
<span id="cb92-98"><a href="#cb92-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-99"><a href="#cb92-99" aria-hidden="true" tabindex="-1"></a>  p_df_label <span class="ot">=</span></span>
<span id="cb92-100"><a href="#cb92-100" aria-hidden="true" tabindex="-1"></a>    p_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(quantile)) <span class="sc">%&gt;%</span></span>
<span id="cb92-101"><a href="#cb92-101" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">as.numeric</span>(<span class="fu">paste0</span>(quantile))) <span class="sc">%&gt;%</span></span>
<span id="cb92-102"><a href="#cb92-102" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">ifelse</span>(scene<span class="sc">==</span><span class="dv">1</span>,<span class="dv">0</span>,y)) <span class="sc">%&gt;%</span></span>
<span id="cb92-103"><a href="#cb92-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">x =</span> <span class="fu">ifelse</span>(scene<span class="sc">==</span><span class="dv">4</span>,<span class="fu">min</span>(scene3<span class="sc">$</span>x),x)) <span class="sc">%&gt;%</span></span>
<span id="cb92-104"><a href="#cb92-104" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">ifelse</span>(scene<span class="sc">==</span><span class="dv">6</span>,<span class="dv">0</span>,y)) <span class="sc">%&gt;%</span></span>
<span id="cb92-105"><a href="#cb92-105" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">quantile =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">" q{round(quantile,2)}"</span>))</span>
<span id="cb92-106"><a href="#cb92-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-107"><a href="#cb92-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-108"><a href="#cb92-108" aria-hidden="true" tabindex="-1"></a>  p_df <span class="ot">&lt;-</span></span>
<span id="cb92-109"><a href="#cb92-109" aria-hidden="true" tabindex="-1"></a>      p_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(scene<span class="sc">==</span>scene_to_show)</span>
<span id="cb92-110"><a href="#cb92-110" aria-hidden="true" tabindex="-1"></a>  p_df_label <span class="ot">&lt;-</span></span>
<span id="cb92-111"><a href="#cb92-111" aria-hidden="true" tabindex="-1"></a>        p_df_label <span class="sc">%&gt;%</span> <span class="fu">filter</span>(scene<span class="sc">==</span>scene_to_show)</span>
<span id="cb92-112"><a href="#cb92-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-113"><a href="#cb92-113" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">p_df =</span> p_df , <span class="at">p_df_label =</span> p_df_label, <span class="at">cdf =</span> cdf, <span class="at">pdf =</span> pdf)</span>
<span id="cb92-114"><a href="#cb92-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb92-115"><a href="#cb92-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-116"><a href="#cb92-116" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb92-117"><a href="#cb92-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-118"><a href="#cb92-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-119"><a href="#cb92-119" aria-hidden="true" tabindex="-1"></a><span class="co">#http://bcallaway11.github.io/qte/articles/R-QTEs.html</span></span>
<span id="cb92-120"><a href="#cb92-120" aria-hidden="true" tabindex="-1"></a><span class="co"># https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/LAK5DC</span></span>
<span id="cb92-121"><a href="#cb92-121" aria-hidden="true" tabindex="-1"></a><span class="co"># https://direct.mit.edu/rest/article/102/5/994/96756/Quantile-Treatment-Effects-in-the-Presence-of</span></span>
<span id="cb92-122"><a href="#cb92-122" aria-hidden="true" tabindex="-1"></a><span class="co"># https://watermark.silverchair.com/rest_a_00858.pdf?token=AQECAHi208BE49Ooan9kkhW_Ercy7Dm3ZL_9Cf3qfKAc485ysgAAAsYwggLCBgkqhkiG9w0BBwagggKzMIICrwIBADCCAqgGCSqGSIb3DQEHATAeBglghkgBZQMEAS4wEQQMxPCVV8nCAOyn3HdDAgEQgIICeVT7FEkNgEVp1U1LMaGWitdbw4MSLqMgCXK2ABWErAlq8TG3FgMi6mgcSpKGUF_QAAuRVbuaSJ-VIuhV1Mw0jdC2gvqD-zd93tvx_kXyZN4_6m1mYTGVDbdXd-6srVmLD9reQCRbYunkKLSrytZxEsI-aBUGM3593aI0vjwo7KbexCKRa2FFaj4w8rPK8v2908Bhg4igo2Yic3yDVp9Rpj1OdKDA8Xo99s4M3QlcVidEDZrA4EsF4XTR5i-Mke5rfIAHEhgQFl2IYxKDYwEq607O2cXudmNJaXthu6ndBghneG0coAMz_XT56hYsoCAEgOdnKu4UTh6x6Nq2sCJkgbBev3UuBO_02oUxFY_UIV8EhirzptXbxbg6FB9N11QK66RYYUqo-sCQt4JnI-WnVoy3677sAkpqGMQR5srhlUuhfGvBvB-Vh2ayMQNpPaCbPfp0t0BxOBj6dWndG6N-lraFD9awXX-BsdBCIRlM_knNVb9QOr3PLAeYbWEgo0JQwYlI4Ll3nXkX_LLSYmCimviOlF0OoB7WnRn1VbEZKrTVG_LUrQyUxmHdzDEx4ZSH68lkAc4XYJf87X3Zdf9mdBYcooswHUzBvAfLMwugMvg_EA2CEwb4TDvNLt6gqdZ5HjwAn9TOgex7IeNuqm66iAI4eK8SrP4-Bz_Hrrb2WJaJ-ucM6YpCUMN22vZJFPT9ssfBvbPnsGlwXweDEDlqqDIWKjK_h-l-dANM4DWqv-KvEzV_OWQ6RBOnbge6J-dkXCnVZ12AmpKvsCxCkwV660Szltj86WYIN8ubPVp_wuOZI4M2Fi-UgNxVVYBpbrZ29mtmghztFFFjwA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="holding-pen_quantile-tx-effects-changes-in-changes_cache/html/unnamed-chunk-21_b35e815abad4eb99cfc78fb698be4f4a">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">here</span>(<span class="st">"ignore/cicprograms/mvd.dat"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">fips =</span> V19) <span class="sc">%&gt;%</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fips <span class="sc">==</span> <span class="dv">16</span>) <span class="sc">%&gt;%</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">y =</span> V1,</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">head =</span> V10,</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">neck =</span> V11,</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">upper_extr =</span> V12,</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">trunk =</span> V13,</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_back =</span> V14,</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">lower_extr =</span> V15,</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">occ_dis =</span> V16,</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">male =</span> V5,</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">marital =</span> V6,</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">age =</span> V20,</span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">manu =</span> V8,</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">constr =</span> V9,</span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">prev_earn =</span> V21) <span class="sc">%&gt;%</span></span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ind =</span> <span class="fu">as.integer</span>((age<span class="sc">&lt;</span><span class="dv">99</span>) <span class="sc">&amp;</span> (marital<span class="sc">&lt;</span><span class="dv">8</span>) <span class="sc">&amp;</span> (male<span class="sc">&lt;</span><span class="dv">9</span>) <span class="sc">&amp;</span> (manu<span class="sc">&lt;</span><span class="dv">8</span>) <span class="sc">&amp;</span> (constr<span class="sc">&lt;</span><span class="dv">8</span>) <span class="sc">&amp;</span> (V18<span class="sc">&lt;</span><span class="dv">9</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">after =</span> V3,</span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> V4) <span class="sc">%&gt;%</span></span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a> <span class="co"># mutate(y = y + 0.25 *as.integer(y==0)) %&gt;%</span></span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ly =</span> <span class="fu">log</span>(y)) <span class="sc">%&gt;%</span></span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pre =</span> after,</span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">tx =</span> high) <span class="sc">%&gt;%</span></span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">glue</span>(<span class="st">"t{pre}_tx{tx}"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb93-27"><a href="#cb93-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> y) <span class="sc">%&gt;%</span> </span>
<span id="cb93-28"><a href="#cb93-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(x<span class="sc">&gt;</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb93-29"><a href="#cb93-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">log</span>(y),</span>
<span id="cb93-30"><a href="#cb93-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="fu">log</span>(x))</span>
<span id="cb93-31"><a href="#cb93-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-32"><a href="#cb93-32" aria-hidden="true" tabindex="-1"></a>y00 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb93-33"><a href="#cb93-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(after<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> high<span class="sc">==</span><span class="dv">0</span>) </span>
<span id="cb93-34"><a href="#cb93-34" aria-hidden="true" tabindex="-1"></a>y01 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb93-35"><a href="#cb93-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(after<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> high <span class="sc">==</span><span class="dv">0</span>) </span>
<span id="cb93-36"><a href="#cb93-36" aria-hidden="true" tabindex="-1"></a>y10 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb93-37"><a href="#cb93-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(after<span class="sc">==</span><span class="dv">0</span> <span class="sc">&amp;</span> high<span class="sc">==</span><span class="dv">1</span>) </span>
<span id="cb93-38"><a href="#cb93-38" aria-hidden="true" tabindex="-1"></a>y11 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb93-39"><a href="#cb93-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(after<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> high <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb93-40"><a href="#cb93-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-41"><a href="#cb93-41" aria-hidden="true" tabindex="-1"></a>df_lalonde <span class="ot">&lt;-</span> </span>
<span id="cb93-42"><a href="#cb93-42" aria-hidden="true" tabindex="-1"></a>  lalonde.exp <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb93-43"><a href="#cb93-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(treat,re75,re78,id) <span class="sc">%&gt;%</span> </span>
<span id="cb93-44"><a href="#cb93-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(var,x,<span class="sc">-</span>treat,<span class="sc">-</span>id)  <span class="sc">%&gt;%</span> </span>
<span id="cb93-45"><a href="#cb93-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x_orig =</span> x) <span class="sc">%&gt;%</span> </span>
<span id="cb93-46"><a href="#cb93-46" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(x&gt;0) %&gt;% </span></span>
<span id="cb93-47"><a href="#cb93-47" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mutate(x = log(x+0.25*as.integer(x==0))) %&gt;% </span></span>
<span id="cb93-48"><a href="#cb93-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> x)</span>
<span id="cb93-49"><a href="#cb93-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-50"><a href="#cb93-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-51"><a href="#cb93-51" aria-hidden="true" tabindex="-1"></a><span class="co"># y00 &lt;- df_lalonde %&gt;%</span></span>
<span id="cb93-52"><a href="#cb93-52" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(var=="re75" &amp; treat==0)</span></span>
<span id="cb93-53"><a href="#cb93-53" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb93-54"><a href="#cb93-54" aria-hidden="true" tabindex="-1"></a><span class="co"># y01 &lt;- df_lalonde %&gt;%</span></span>
<span id="cb93-55"><a href="#cb93-55" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(var=="re78" &amp; treat==0)</span></span>
<span id="cb93-56"><a href="#cb93-56" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb93-57"><a href="#cb93-57" aria-hidden="true" tabindex="-1"></a><span class="co"># y10 &lt;- df_lalonde %&gt;%</span></span>
<span id="cb93-58"><a href="#cb93-58" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(var=="re75" &amp; treat==1)</span></span>
<span id="cb93-59"><a href="#cb93-59" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb93-60"><a href="#cb93-60" aria-hidden="true" tabindex="-1"></a><span class="co"># y11 &lt;- df_lalonde %&gt;%</span></span>
<span id="cb93-61"><a href="#cb93-61" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(var=="re78" &amp; treat==1)</span></span>
<span id="cb93-62"><a href="#cb93-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-63"><a href="#cb93-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-64"><a href="#cb93-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-65"><a href="#cb93-65" aria-hidden="true" tabindex="-1"></a>q_ <span class="ot">=</span> q <span class="ot">=</span> <span class="fl">0.9</span></span>
<span id="cb93-66"><a href="#cb93-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-67"><a href="#cb93-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Untreated, Pre</span></span>
<span id="cb93-68"><a href="#cb93-68" aria-hidden="true" tabindex="-1"></a>F00_ <span class="ot">&lt;-</span> y00 <span class="sc">%&gt;%</span> <span class="fu">pull</span>(y) <span class="sc">%&gt;%</span> <span class="fu">sort</span>()</span>
<span id="cb93-69"><a href="#cb93-69" aria-hidden="true" tabindex="-1"></a>eF00 <span class="ot">&lt;-</span> <span class="fu">ecdf</span>(F00_)</span>
<span id="cb93-70"><a href="#cb93-70" aria-hidden="true" tabindex="-1"></a>F00 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(F00_) <span class="sc">/</span> <span class="fu">length</span>(F00_)</span>
<span id="cb93-71"><a href="#cb93-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-72"><a href="#cb93-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Treated, Pre</span></span>
<span id="cb93-73"><a href="#cb93-73" aria-hidden="true" tabindex="-1"></a>F10_ <span class="ot">&lt;-</span> y10 <span class="sc">%&gt;%</span> <span class="fu">pull</span>(y) <span class="sc">%&gt;%</span> <span class="fu">sort</span>()</span>
<span id="cb93-74"><a href="#cb93-74" aria-hidden="true" tabindex="-1"></a>eF10 <span class="ot">&lt;-</span> <span class="fu">ecdf</span>(F10_)</span>
<span id="cb93-75"><a href="#cb93-75" aria-hidden="true" tabindex="-1"></a>F10 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(F10_) <span class="sc">/</span> <span class="fu">length</span>(F10_)</span>
<span id="cb93-76"><a href="#cb93-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-77"><a href="#cb93-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Untreated, Post</span></span>
<span id="cb93-78"><a href="#cb93-78" aria-hidden="true" tabindex="-1"></a>F01_ <span class="ot">&lt;-</span> y01 <span class="sc">%&gt;%</span> <span class="fu">pull</span>(y) <span class="sc">%&gt;%</span> <span class="fu">sort</span>()</span>
<span id="cb93-79"><a href="#cb93-79" aria-hidden="true" tabindex="-1"></a>eF01_ <span class="ot">&lt;-</span> <span class="fu">ecdf</span>(F01_)</span>
<span id="cb93-80"><a href="#cb93-80" aria-hidden="true" tabindex="-1"></a>F01 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(F01_) <span class="sc">/</span> <span class="fu">length</span>(F01_)</span>
<span id="cb93-81"><a href="#cb93-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-82"><a href="#cb93-82" aria-hidden="true" tabindex="-1"></a>F11_ <span class="ot">&lt;-</span> y11 <span class="sc">%&gt;%</span> <span class="fu">pull</span>(y) <span class="sc">%&gt;%</span> <span class="fu">sort</span>()</span>
<span id="cb93-83"><a href="#cb93-83" aria-hidden="true" tabindex="-1"></a>eF11_ <span class="ot">&lt;-</span> <span class="fu">ecdf</span>(F11_)</span>
<span id="cb93-84"><a href="#cb93-84" aria-hidden="true" tabindex="-1"></a>F11 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(F11_) <span class="sc">/</span> <span class="fu">length</span>(F11_)</span>
<span id="cb93-85"><a href="#cb93-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-86"><a href="#cb93-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Tx, Pre -- find the value of the qth quantile</span></span>
<span id="cb93-87"><a href="#cb93-87" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> F10_[<span class="fu">which</span>(F10 <span class="sc">&gt;=</span> q)[<span class="dv">1</span>]]</span>
<span id="cb93-88"><a href="#cb93-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-89"><a href="#cb93-89" aria-hidden="true" tabindex="-1"></a><span class="co"># Step2: Cx, Pre -- what is the quantile associated with this value?</span></span>
<span id="cb93-90"><a href="#cb93-90" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">eF00</span>(x1)</span>
<span id="cb93-91"><a href="#cb93-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-92"><a href="#cb93-92" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Cx, Post -- what happens to this quantile in the Cx in the post period?</span></span>
<span id="cb93-93"><a href="#cb93-93" aria-hidden="true" tabindex="-1"></a>x3 <span class="ot">&lt;-</span> F01_[<span class="fu">which</span>(F01 <span class="sc">&gt;=</span> x2)[<span class="dv">1</span>]]</span>
<span id="cb93-94"><a href="#cb93-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-95"><a href="#cb93-95" aria-hidden="true" tabindex="-1"></a><span class="co"># # Step 4:</span></span>
<span id="cb93-96"><a href="#cb93-96" aria-hidden="true" tabindex="-1"></a>tau <span class="ot">=</span> F11_[<span class="fu">which</span>(F11 <span class="sc">&gt;=</span> q)[<span class="dv">1</span>]] <span class="sc">-</span> x3</span>
<span id="cb93-97"><a href="#cb93-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-98"><a href="#cb93-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternative Version:</span></span>
<span id="cb93-99"><a href="#cb93-99" aria-hidden="true" tabindex="-1"></a><span class="co"># Counterfactual is x3 - x1</span></span>
<span id="cb93-100"><a href="#cb93-100" aria-hidden="true" tabindex="-1"></a>cfx <span class="ot">&lt;-</span> x3 <span class="sc">-</span> x1</span>
<span id="cb93-101"><a href="#cb93-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-102"><a href="#cb93-102" aria-hidden="true" tabindex="-1"></a><span class="co"># What happens to qth quantile in Tx gruop?</span></span>
<span id="cb93-103"><a href="#cb93-103" aria-hidden="true" tabindex="-1"></a><span class="co"># (F11_[which(F11 &gt;= q)[1]] - F10_[which(F10 &gt;= q)[1]]) - cfx</span></span>
<span id="cb93-104"><a href="#cb93-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-105"><a href="#cb93-105" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Plot the PDF of the Treatment Group in the PRE Period</span></span>
<span id="cb93-106"><a href="#cb93-106" aria-hidden="true" tabindex="-1"></a><span class="co"># Include the quantile of interest in the plot</span></span>
<span id="cb93-107"><a href="#cb93-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-108"><a href="#cb93-108" aria-hidden="true" tabindex="-1"></a>df1a <span class="ot">&lt;-</span> y10 <span class="sc">%&gt;%</span> <span class="fu">pdf_to_cdf</span>(<span class="at">scene =</span> <span class="dv">2</span>,<span class="at">q_  =</span> q_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_filter(dots, env_filter): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 1a is the PDF</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>p1a <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df1a[[<span class="dv">1</span>]], <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> df1a[[<span class="dv">2</span>]], <span class="fu">aes</span>(<span class="at">label =</span> quantile, <span class="at">group =</span> quantile),<span class="at">hjust=</span><span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> df1a[[<span class="dv">2</span>]]<span class="sc">$</span>x, <span class="at">label =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"value = {round(df1a[[2]]$x,2)}"</span>)) <span class="sc">+</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte_revised</span>() <span class="sc">+</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.25</span>,</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Value"</span>, <span class="at">y =</span> <span class="st">"Density"</span>,<span class="at">title =</span> <span class="st">"Empirical Distribution</span><span class="sc">\n</span><span class="st">Treated, Pre-Intervention"</span>) <span class="sc">+</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>))</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 1b is the CDF</span></span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>df1b <span class="ot">&lt;-</span> y10 <span class="sc">%&gt;%</span> <span class="fu">pdf_to_cdf</span>(<span class="at">scene =</span> <span class="dv">3</span>,<span class="at">q_  =</span> q_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_filter(dots, env_filter): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>p1b <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df1b[[<span class="dv">1</span>]], <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> df1b[[<span class="dv">2</span>]], <span class="fu">aes</span>(<span class="at">label =</span> quantile, <span class="at">x =</span> x <span class="sc">-</span> .<span class="dv">5</span>,<span class="at">y =</span> y<span class="fl">+.02</span>,<span class="at">group =</span> quantile)) <span class="sc">+</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> df1b[[<span class="dv">2</span>]]<span class="sc">$</span>x, <span class="at">label =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"value = {round(df1b[[2]]$x,2)}"</span>), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult=</span>.<span class="dv">25</span>)) <span class="sc">+</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"q"</span>,<span class="st">""</span>,df1b[[<span class="dv">2</span>]]<span class="sc">$</span>quantile))) <span class="sc">+</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte_revised</span>() <span class="sc">+</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> q_) <span class="sc">+</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="fu">c</span>(<span class="st">"black"</span>,<span class="st">"blue"</span>),</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.75</span>,</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.25</span>,</span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Value"</span>, <span class="at">y =</span> <span class="st">"Quantile"</span> , <span class="at">title =</span> <span class="st">"Empirical Cumulative Distribution</span><span class="sc">\n</span><span class="st">Treated, Pre-Intervention"</span>) <span class="sc">+</span></span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'y' is already present. Adding another scale for 'y', which will
replace the existing scale.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Map the outcome value at the quantile of interest to the quantile of the comparison group (pre-intevention)</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> y00 <span class="sc">%&gt;%</span> <span class="fu">pdf_to_cdf</span>(<span class="at">q =</span> x2, <span class="at">scene =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_filter(dots, env_filter): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>cdf_Cxpre <span class="ot">&lt;-</span> <span class="fu">approxfun</span>(df2<span class="sc">$</span>cdf<span class="sc">$</span>x, df2<span class="sc">$</span>cdf<span class="sc">$</span>y)</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>Cx_quant <span class="ot">&lt;-</span> <span class="fu">cdf_Cxpre</span>(df1b<span class="sc">$</span>p_df_label<span class="sc">$</span>x)</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 2a is the overlay of the pre-intervention treatment and control</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>p2a <span class="ot">&lt;-</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> df1b[[<span class="dv">1</span>]], <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> df1b[[<span class="dv">2</span>]], <span class="fu">aes</span>(<span class="at">label =</span> quantile, <span class="at">x =</span> x <span class="sc">-</span> .<span class="dv">5</span>,<span class="at">y =</span> y<span class="fl">+.01</span>,<span class="at">group =</span> quantile)) <span class="sc">+</span></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> df1b[[<span class="dv">2</span>]]<span class="sc">$</span>x, <span class="at">label =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"value = {round(df1b[[2]]$x,2)}"</span>), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult=</span>.<span class="dv">25</span>)) <span class="sc">+</span></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte_revised</span>() <span class="sc">+</span></span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Value"</span>, <span class="at">y =</span> <span class="st">"Quantile"</span> , <span class="at">title =</span> <span class="st">"Empirical Cumulative Distribution</span><span class="sc">\n</span><span class="st">Treated (Black) and Untreated (Blue), Pre-Intervention"</span>) <span class="sc">+</span></span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df2[[<span class="dv">1</span>]], <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> df2[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{round(Cx_quant,3)}"</span>),</span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">y =</span> Cx_quant), <span class="fu">aes</span>(<span class="at">label =</span> quantile, <span class="at">y =</span> y<span class="fl">+.02</span>, <span class="at">x =</span> p1b <span class="sc">%&gt;%</span> <span class="fu">ggplot_build</span>() <span class="sc">%&gt;%</span> <span class="fu">pluck</span>(<span class="st">"data"</span>) <span class="sc">%&gt;%</span> <span class="fu">pluck</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(x)), <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df2[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{round(Cx_quant,3)}"</span>),</span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">y =</span> Cx_quant), <span class="fu">aes</span>( <span class="at">y =</span> y, <span class="at">x =</span> x), <span class="at">colour =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df1b[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{round(Cx_quant,3)}"</span>),</span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">y =</span> q_), <span class="fu">aes</span>( <span class="at">y =</span> y, <span class="at">x =</span> x), <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">3</span>)    <span class="sc">+</span></span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(q_,Cx_quant),<span class="at">labels =</span> <span class="fu">round</span>(<span class="fu">c</span>(q_,Cx_quant),<span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb101-24"><a href="#cb101-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="fu">c</span>(<span class="st">"black"</span>,<span class="st">"blue"</span>),</span>
<span id="cb101-25"><a href="#cb101-25" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.75</span>,</span>
<span id="cb101-26"><a href="#cb101-26" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb101-27"><a href="#cb101-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb101-28"><a href="#cb101-28" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">size =</span> <span class="fl">0.25</span>,</span>
<span id="cb101-29"><a href="#cb101-29" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb101-30"><a href="#cb101-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'y' is already present. Adding another scale for 'y', which will
replace the existing scale.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Get the counterfactual change</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> y01 <span class="sc">%&gt;%</span> <span class="fu">pdf_to_cdf</span>(<span class="at">q =</span> x2, <span class="at">scene =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_filter(dots, env_filter): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>cdf_Cxpost <span class="ot">&lt;-</span> <span class="fu">approxfun</span>(df3<span class="sc">$</span>cdf<span class="sc">$</span>y, df3<span class="sc">$</span>cdf<span class="sc">$</span>x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
collapsing to unique 'x' values</code></pre>
</div>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>cdf_Cxpre <span class="ot">&lt;-</span> <span class="fu">approxfun</span>(df2<span class="sc">$</span>cdf<span class="sc">$</span>y, df2<span class="sc">$</span>cdf<span class="sc">$</span>x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
collapsing to unique 'x' values</code></pre>
</div>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>df_cfx <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">cdf_Cxpre</span>(Cx_quant), <span class="at">xend =</span> <span class="fu">cdf_Cxpost</span>(Cx_quant), <span class="at">y =</span> <span class="fl">0.25</span>,<span class="at">yend =</span> <span class="fl">0.25</span>)</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> df3[[<span class="dv">1</span>]], <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">colour =</span> <span class="st">"blue"</span>,<span class="at">lty=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(df2[[<span class="dv">2</span>]]<span class="sc">$</span>x,df3[[<span class="dv">2</span>]]<span class="sc">$</span>x), <span class="at">label =</span> <span class="fu">c</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"value = {round(df2[[2]]$x,2)}"</span>),glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"value = {round(df3[[2]]$x,2)}"</span>)), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult=</span>.<span class="dv">25</span>),<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">n.dodge =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte_revised</span>() <span class="sc">+</span></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Value"</span>, <span class="at">y =</span> <span class="st">"Quantile"</span> , <span class="at">title =</span> <span class="st">"Empirical Cumulative Distribution</span><span class="sc">\n</span><span class="st">Untreated Group, Pre- and Post-Intervention"</span>) <span class="sc">+</span></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df2[[<span class="dv">1</span>]], <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df2[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{round(Cx_quant,3)}"</span>),</span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">y =</span> Cx_quant), <span class="fu">aes</span>( <span class="at">y =</span> y, <span class="at">x =</span> x), <span class="at">colour =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df3[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{round(Cx_quant,3)}"</span>),</span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">y =</span> Cx_quant), <span class="fu">aes</span>( <span class="at">y =</span> y, <span class="at">x =</span> x), <span class="at">colour =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>)    <span class="sc">+</span></span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(Cx_quant),<span class="at">labels =</span> <span class="fu">round</span>(<span class="fu">c</span>(Cx_quant),<span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb109-17"><a href="#cb109-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="fu">c</span>(<span class="st">"blue"</span>),</span>
<span id="cb109-18"><a href="#cb109-18" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.75</span>,</span>
<span id="cb109-19"><a href="#cb109-19" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb109-20"><a href="#cb109-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb109-21"><a href="#cb109-21" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.25</span>,</span>
<span id="cb109-22"><a href="#cb109-22" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb109-23"><a href="#cb109-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb109-24"><a href="#cb109-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> df_cfx, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend, <span class="at">y =</span> y , <span class="at">yend =</span> yend),<span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb109-25"><a href="#cb109-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,<span class="at">y =</span> <span class="fl">0.25</span>, <span class="at">x =</span> df_cfx<span class="sc">$</span>xend[<span class="dv">1</span>], <span class="at">label =</span> <span class="fu">glue</span>(<span class="st">"  Counterfactual: {ifelse(sign(df_cfx$xend - df_cfx$x)==1,'+','')}{round(df_cfx$xend - df_cfx$x,3)}    "</span>),<span class="at">hjust=</span><span class="dv">0</span>, <span class="at">colour =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'y' is already present. Adding another scale for 'y', which will
replace the existing scale.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Get teh Treatmetn Effect</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>df5a <span class="ot">&lt;-</span> y10 <span class="sc">%&gt;%</span> <span class="fu">pdf_to_cdf</span>(<span class="at">q =</span> q_, <span class="at">scene =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_filter(dots, env_filter): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>df5b <span class="ot">&lt;-</span> y11 <span class="sc">%&gt;%</span> <span class="fu">pdf_to_cdf</span>(<span class="at">q =</span> q_, <span class="at">scene =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_filter(dots, env_filter): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>cdf_Cxpost <span class="ot">&lt;-</span> <span class="fu">approxfun</span>(df3<span class="sc">$</span>cdf<span class="sc">$</span>y, df3<span class="sc">$</span>cdf<span class="sc">$</span>x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
collapsing to unique 'x' values</code></pre>
</div>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>cdf_Cxpre <span class="ot">&lt;-</span> <span class="fu">approxfun</span>(df2<span class="sc">$</span>cdf<span class="sc">$</span>y, df2<span class="sc">$</span>cdf<span class="sc">$</span>x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
collapsing to unique 'x' values</code></pre>
</div>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>obs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> df5a[[<span class="dv">2</span>]]<span class="sc">$</span>x, <span class="at">xend =</span> df5b[[<span class="dv">2</span>]]<span class="sc">$</span>x, <span class="at">y =</span> <span class="fl">0.3</span>,<span class="at">yend =</span> <span class="fl">0.3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cfx =</span> df_cfx<span class="sc">$</span>xend <span class="sc">-</span> df_cfx<span class="sc">$</span>x) <span class="sc">%&gt;%</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">te =</span> (xend <span class="sc">-</span> x)<span class="sc">-</span>(cfx)); obs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         x     xend   y yend       cfx        te
1 2.833213 3.178054 0.3  0.3 0.1070012 0.2378392</code></pre>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>te <span class="ot">=</span> obs <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fl">0.2</span>,<span class="at">yend=</span><span class="fl">0.2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xstartte =</span> x <span class="sc">+</span> cfx,</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">xendte =</span> x <span class="sc">+</span> cfx <span class="sc">+</span> te)</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df5a[[<span class="dv">1</span>]], <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">colour =</span> <span class="st">"black"</span>,<span class="at">lty=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(df5a[[<span class="dv">2</span>]]<span class="sc">$</span>x,df5b[[<span class="dv">2</span>]]<span class="sc">$</span>x), <span class="at">label =</span> <span class="fu">c</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"pre-intervention value = {round(df5a[[2]]$x,2)}"</span>),glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"post-intervention value = {round(df5b[[2]]$x,2)}"</span>)), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult=</span>.<span class="dv">25</span>),<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">n.dodge =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte_revised</span>() <span class="sc">+</span></span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Value"</span>, <span class="at">y =</span> <span class="st">"Quantile"</span> , <span class="at">title =</span> <span class="st">"Empirical Cumulative Distribution</span><span class="sc">\n</span><span class="st">Treated Group,  Pre- and Post-Intervention"</span>) <span class="sc">+</span></span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df5b[[<span class="dv">1</span>]], <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df5a[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{q_}"</span>),</span>
<span id="cb121-14"><a href="#cb121-14" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">y =</span> q_), <span class="fu">aes</span>( <span class="at">y =</span> y, <span class="at">x =</span> x), <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb121-15"><a href="#cb121-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df5b[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{q_}"</span>),</span>
<span id="cb121-16"><a href="#cb121-16" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">y =</span> q_), <span class="fu">aes</span>( <span class="at">y =</span> y, <span class="at">x =</span> x), <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">3</span>)    <span class="sc">+</span></span>
<span id="cb121-17"><a href="#cb121-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-18"><a href="#cb121-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(q_),<span class="at">labels =</span> <span class="fu">round</span>(<span class="fu">c</span>(q_),<span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb121-19"><a href="#cb121-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="fu">c</span>(<span class="st">"black"</span>),</span>
<span id="cb121-20"><a href="#cb121-20" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.75</span>,</span>
<span id="cb121-21"><a href="#cb121-21" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb121-22"><a href="#cb121-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb121-23"><a href="#cb121-23" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.25</span>,</span>
<span id="cb121-24"><a href="#cb121-24" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb121-25"><a href="#cb121-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb121-26"><a href="#cb121-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> df_cfx, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend, <span class="at">y =</span> y , <span class="at">yend =</span> yend),<span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb121-27"><a href="#cb121-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,<span class="at">y =</span> <span class="fl">0.25</span>, <span class="at">x =</span> df_cfx<span class="sc">$</span>xend[<span class="dv">1</span>], <span class="at">label =</span> <span class="fu">glue</span>(<span class="st">"  Counterfactual:  {ifelse(sign(df_cfx$xend - df_cfx$x)==1,'+','')}{round(df_cfx$xend - df_cfx$x,3)}    "</span>),<span class="at">hjust=</span><span class="dv">0</span>, <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb121-28"><a href="#cb121-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> obs, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend, <span class="at">y =</span> y , <span class="at">yend =</span> yend),<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb121-29"><a href="#cb121-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,<span class="at">y =</span> <span class="fl">0.3</span>, <span class="at">x =</span> df_cfx<span class="sc">$</span>xend[<span class="dv">1</span>], <span class="at">label =</span> <span class="fu">glue</span>(<span class="st">"  Observed:  {ifelse(sign(obs$xend - obs$x)==1,'+','')}{round(obs$xend - obs$x,3)}    "</span>),<span class="at">hjust=</span><span class="dv">0</span>, <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb121-30"><a href="#cb121-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> obs, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend, <span class="at">y =</span> y , <span class="at">yend =</span> yend),<span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb121-31"><a href="#cb121-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,<span class="at">y =</span> <span class="fl">0.2</span>, <span class="at">x =</span> te<span class="sc">$</span>xend[<span class="dv">1</span>], <span class="at">label =</span> <span class="fu">glue</span>(<span class="st">"  tau(q={q_}):  {ifelse(sign(te$te)==1,'+','')}{round(te$te,3)}    "</span>),<span class="at">hjust=</span><span class="dv">0</span>, <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb121-32"><a href="#cb121-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> te, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> x <span class="sc">+</span> cfx, <span class="at">y =</span> y , <span class="at">yend =</span> yend),<span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb121-33"><a href="#cb121-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> te, <span class="fu">aes</span>(<span class="at">x =</span> x <span class="sc">+</span> cfx, <span class="at">xend =</span> xend, <span class="at">y =</span> y , <span class="at">yend =</span> yend),<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">colour =</span> <span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'y' is already present. Adding another scale for 'y', which will
replace the existing scale.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(qte)</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>df_mvd <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">here</span>(<span class="st">"ignore/cicprograms/mvd.dat"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">fips =</span> V19) <span class="sc">%&gt;%</span></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fips <span class="sc">==</span> <span class="dv">16</span>) <span class="sc">%&gt;%</span></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">y =</span> V1,</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">head =</span> V10,</span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">neck =</span> V11,</span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">upper_extr =</span> V12,</span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">trunk =</span> V13,</span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">low_back =</span> V14,</span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">lower_extr =</span> V15,</span>
<span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">occ_dis =</span> V16,</span>
<span id="cb123-14"><a href="#cb123-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">male =</span> V5,</span>
<span id="cb123-15"><a href="#cb123-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">marital =</span> V6,</span>
<span id="cb123-16"><a href="#cb123-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">age =</span> V20,</span>
<span id="cb123-17"><a href="#cb123-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">manu =</span> V8,</span>
<span id="cb123-18"><a href="#cb123-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">constr =</span> V9,</span>
<span id="cb123-19"><a href="#cb123-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">prev_earn =</span> V21) <span class="sc">%&gt;%</span></span>
<span id="cb123-20"><a href="#cb123-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ind =</span> <span class="fu">as.integer</span>((age<span class="sc">&lt;</span><span class="dv">99</span>) <span class="sc">&amp;</span> (marital<span class="sc">&lt;</span><span class="dv">8</span>) <span class="sc">&amp;</span> (male<span class="sc">&lt;</span><span class="dv">9</span>) <span class="sc">&amp;</span> (manu<span class="sc">&lt;</span><span class="dv">8</span>) <span class="sc">&amp;</span> (constr<span class="sc">&lt;</span><span class="dv">8</span>) <span class="sc">&amp;</span> (V18<span class="sc">&lt;</span><span class="dv">9</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb123-21"><a href="#cb123-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(ind ==1) %&gt;%</span></span>
<span id="cb123-22"><a href="#cb123-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb123-23"><a href="#cb123-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">after =</span> V3,</span>
<span id="cb123-24"><a href="#cb123-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> V4) <span class="sc">%&gt;%</span></span>
<span id="cb123-25"><a href="#cb123-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> y <span class="sc">+</span> <span class="fl">0.25</span> <span class="sc">*</span><span class="fu">as.integer</span>(y<span class="sc">==</span><span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb123-26"><a href="#cb123-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pre =</span> after,</span>
<span id="cb123-27"><a href="#cb123-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">tx =</span> high) <span class="sc">%&gt;%</span></span>
<span id="cb123-28"><a href="#cb123-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">glue</span>(<span class="st">"t{pre}_tx{tx}"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb123-29"><a href="#cb123-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">year =</span> after,</span>
<span id="cb123-30"><a href="#cb123-30" aria-hidden="true" tabindex="-1"></a>         y, <span class="at">treat =</span> high) <span class="sc">%&gt;%</span></span>
<span id="cb123-31"><a href="#cb123-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">idno =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb123-32"><a href="#cb123-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">yorig =</span> y) <span class="sc">%&gt;%</span></span>
<span id="cb123-33"><a href="#cb123-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">log</span>(y))</span>
<span id="cb123-34"><a href="#cb123-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-35"><a href="#cb123-35" aria-hidden="true" tabindex="-1"></a>fit_cic <span class="ot">&lt;-</span></span>
<span id="cb123-36"><a href="#cb123-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">CiC</span>(y <span class="sc">~</span> treat, <span class="at">t =</span> <span class="dv">1</span>, <span class="at">tmin1 =</span> <span class="dv">0</span>, <span class="at">tname =</span> <span class="st">"year"</span>,</span>
<span id="cb123-37"><a href="#cb123-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">xformla=</span><span class="cn">NULL</span>,</span>
<span id="cb123-38"><a href="#cb123-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> y00 <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>(y01) <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>(y10) <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>(y11) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">year=</span>after, <span class="at">treat =</span> high),</span>
<span id="cb123-39"><a href="#cb123-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">idname =</span> <span class="st">"idno"</span>,</span>
<span id="cb123-40"><a href="#cb123-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">se =</span> <span class="cn">TRUE</span>,</span>
<span id="cb123-41"><a href="#cb123-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">probs =</span> <span class="fu">seq</span>(<span class="fl">0.05</span>,<span class="fl">0.95</span>,.<span class="dv">05</span>)) <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span>
<span id="cb123-42"><a href="#cb123-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-43"><a href="#cb123-43" aria-hidden="true" tabindex="-1"></a><span class="co"># fit_cic &lt;-</span></span>
<span id="cb123-44"><a href="#cb123-44" aria-hidden="true" tabindex="-1"></a><span class="co">#       CiC(y ~ treat, t = 1978, tmin1 = 1975, tname = "year",</span></span>
<span id="cb123-45"><a href="#cb123-45" aria-hidden="true" tabindex="-1"></a><span class="co">#       xformla=NULL,</span></span>
<span id="cb123-46"><a href="#cb123-46" aria-hidden="true" tabindex="-1"></a><span class="co">#       data = df_lalonde  %&gt;% </span></span>
<span id="cb123-47"><a href="#cb123-47" aria-hidden="true" tabindex="-1"></a><span class="co">#          mutate(year=  ifelse(var=="re75",1975,1978)),</span></span>
<span id="cb123-48"><a href="#cb123-48" aria-hidden="true" tabindex="-1"></a><span class="co">#       idname = "id",</span></span>
<span id="cb123-49"><a href="#cb123-49" aria-hidden="true" tabindex="-1"></a><span class="co">#       se = TRUE,</span></span>
<span id="cb123-50"><a href="#cb123-50" aria-hidden="true" tabindex="-1"></a><span class="co">#       probs = seq(0.05,0.95,.05)) %&gt;% summary()</span></span>
<span id="cb123-51"><a href="#cb123-51" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb123-52"><a href="#cb123-52" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb123-53"><a href="#cb123-53" aria-hidden="true" tabindex="-1"></a><span class="co"># c1 &lt;- CiC(re ~ treat, t=1978, tmin1=1975, tname="year",</span></span>
<span id="cb123-54"><a href="#cb123-54" aria-hidden="true" tabindex="-1"></a><span class="co">#  xformla=~NULL,</span></span>
<span id="cb123-55"><a href="#cb123-55" aria-hidden="true" tabindex="-1"></a><span class="co">#  data=lalonde.exp.panel, idname="id", se=FALSE,</span></span>
<span id="cb123-56"><a href="#cb123-56" aria-hidden="true" tabindex="-1"></a><span class="co">#  probs=seq(0.05, 0.95, 0.05))</span></span>
<span id="cb123-57"><a href="#cb123-57" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb123-58"><a href="#cb123-58" aria-hidden="true" tabindex="-1"></a><span class="co"># p_cic &lt;- ggqte(fit_cic)</span></span>
<span id="cb123-59"><a href="#cb123-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-60"><a href="#cb123-60" aria-hidden="true" tabindex="-1"></a> <span class="co"># jt.cia &lt;- ci.qte(y ~ treat,</span></span>
<span id="cb123-61"><a href="#cb123-61" aria-hidden="true" tabindex="-1"></a> <span class="co">#   xformla=NULL,</span></span>
<span id="cb123-62"><a href="#cb123-62" aria-hidden="true" tabindex="-1"></a> <span class="co">#   data=df_mvd,</span></span>
<span id="cb123-63"><a href="#cb123-63" aria-hidden="true" tabindex="-1"></a> <span class="co">#   probs=seq(0.05,0.95,0.05), se=FALSE)</span></span>
<span id="cb123-64"><a href="#cb123-64" aria-hidden="true" tabindex="-1"></a> <span class="co"># summary(jt.cia)</span></span>
<span id="cb123-65"><a href="#cb123-65" aria-hidden="true" tabindex="-1"></a> <span class="co"># </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">

</div>
</section>
<section id="normal-distribution-pdf-1" class="level2">
<h2 class="anchored" data-anchor-id="normal-distribution-pdf-1">Normal Distribution: PDF</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="media/pdf-to-cdf-norm.png" data-layout-valign="center" height="500" class="figure-img"></p>
</figure>
</div>
</section>
<section id="normal-distribution-cdf-1" class="level2">
<h2 class="anchored" data-anchor-id="normal-distribution-cdf-1">Normal Distribution: CDF</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="media/pdf-to-cdf-norm4.png" data-layout-valign="center" height="500" class="figure-img"></p>
</figure>
</div>
</section>
<section id="normal-distribution-pdf-to-cdf-1" class="level2">
<h2 class="anchored" data-anchor-id="normal-distribution-pdf-to-cdf-1">Normal Distribution: PDF to CDF</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="media/pdf-to-cdf-norm.gif" data-layout-valign="center" height="500" class="figure-img"></p>
</figure>
</div>
</section>
</section>
<section id="quantile-treatment-effects-under-randomization-1" class="level1">
<h1>Quantile Treatment Effects Under Randomization</h1>
<section id="qte-under-randomization-5" class="level2">
<h2 class="anchored" data-anchor-id="qte-under-randomization-5">QTE Under Randomization</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>q_ <span class="ot">&lt;-</span> <span class="fl">0.9</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>dfrand1 <span class="ot">&lt;-</span> </span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>  lalonde.exp <span class="sc">%&gt;%</span> </span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()  <span class="sc">%&gt;%</span> </span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(re78,treat) <span class="sc">%&gt;%</span></span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(treat<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">y =</span> re78,</span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> re78) <span class="sc">%&gt;%</span> </span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pdf_to_cdf</span>(<span class="at">scene =</span> <span class="dv">2</span>, <span class="at">q_ =</span> q_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_filter(dots, env_filter): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 1a is the PDF</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dfrand1[[<span class="dv">1</span>]], <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> dfrand1[[<span class="dv">2</span>]], <span class="fu">aes</span>(<span class="at">label =</span> quantile, <span class="at">group =</span> quantile),<span class="at">hjust=</span><span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> dfrand1[[<span class="dv">2</span>]]<span class="sc">$</span>x, <span class="at">label =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"value = {round(dfrand1[[2]]$x,2)}"</span>)) <span class="sc">+</span></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte_revised</span>() <span class="sc">+</span></span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.25</span>,</span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Value"</span>, <span class="at">y =</span> <span class="st">"Density"</span>,<span class="at">title =</span> <span class="st">"Empirical Distribution</span><span class="sc">\n</span><span class="st">Treated, Post-Intervention"</span>) <span class="sc">+</span></span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="holding-pen_quantile-tx-effects-changes-in-changes_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="qte-under-randomization-6" class="level2">
<h2 class="anchored" data-anchor-id="qte-under-randomization-6">QTE Under Randomization</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 1b is the CDF</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>dfrand1b <span class="ot">&lt;-</span> </span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>  lalonde.exp <span class="sc">%&gt;%</span> </span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()  <span class="sc">%&gt;%</span> </span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(re78,treat) <span class="sc">%&gt;%</span></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(treat<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">y =</span> re78,</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> re78) <span class="sc">%&gt;%</span> </span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pdf_to_cdf</span>(<span class="at">scene =</span> <span class="dv">3</span>, <span class="at">q_ =</span> q_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_filter(dots, env_filter): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dfrand1b[[<span class="dv">1</span>]], <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> dfrand1b[[<span class="dv">2</span>]], <span class="fu">aes</span>(<span class="at">label =</span> quantile, <span class="at">x =</span> x <span class="sc">-</span> .<span class="dv">5</span>,<span class="at">y =</span> y<span class="fl">+.02</span>,<span class="at">group =</span> quantile)) <span class="sc">+</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> dfrand1b[[<span class="dv">2</span>]]<span class="sc">$</span>x, <span class="at">label =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"value = {round(dfrand1b[[2]]$x,2)}"</span>), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult=</span>.<span class="dv">25</span>)) <span class="sc">+</span></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"q"</span>,<span class="st">""</span>,dfrand1b[[<span class="dv">2</span>]]<span class="sc">$</span>quantile))) <span class="sc">+</span></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte_revised</span>() <span class="sc">+</span></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> q_) <span class="sc">+</span></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="fu">c</span>(<span class="st">"black"</span>,<span class="st">"blue"</span>),</span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.75</span>,</span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.25</span>,</span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb129-14"><a href="#cb129-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb129-15"><a href="#cb129-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Value"</span>, <span class="at">y =</span> <span class="st">"Quantile"</span> , <span class="at">title =</span> <span class="st">"Empirical Cumulative Distribution</span><span class="sc">\n</span><span class="st">Treated, Post-Intervention"</span>) <span class="sc">+</span></span>
<span id="cb129-16"><a href="#cb129-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'y' is already present. Adding another scale for 'y', which will
replace the existing scale.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="holding-pen_quantile-tx-effects-changes-in-changes_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="qte-under-randomization-7" class="level2">
<h2 class="anchored" data-anchor-id="qte-under-randomization-7">QTE Under Randomization</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>dfrand0b <span class="ot">&lt;-</span> </span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>  lalonde.exp <span class="sc">%&gt;%</span> </span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()  <span class="sc">%&gt;%</span> </span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(re78,treat) <span class="sc">%&gt;%</span></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(treat<span class="sc">==</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">y =</span> re78,</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> re78) <span class="sc">%&gt;%</span> </span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pdf_to_cdf</span>(<span class="at">scene =</span> <span class="dv">3</span>, <span class="at">q_ =</span> q_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_filter(dots, env_filter): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Get the counterfactual change</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>cdf_Cxpost <span class="ot">&lt;-</span> <span class="fu">approxfun</span>(dfrand0b<span class="sc">$</span>cdf<span class="sc">$</span>y, dfrand0b<span class="sc">$</span>cdf<span class="sc">$</span>x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
collapsing to unique 'x' values</code></pre>
</div>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>cdf_Txpost <span class="ot">&lt;-</span> <span class="fu">approxfun</span>(dfrand1b<span class="sc">$</span>cdf<span class="sc">$</span>y, dfrand1b<span class="sc">$</span>cdf<span class="sc">$</span>x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
collapsing to unique 'x' values</code></pre>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>df_te <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">cdf_Cxpost</span>(q_), <span class="at">xend =</span> <span class="fu">cdf_Txpost</span>(q_), <span class="at">y =</span> <span class="fl">0.25</span>,<span class="at">yend =</span> <span class="fl">0.25</span>)</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="co">#p3 &lt;-</span></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> dfrand0b[[<span class="dv">1</span>]], <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">colour =</span> <span class="st">"blue"</span>,<span class="at">lty=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> dfrand1b[[<span class="dv">1</span>]], <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(dfrand0b[[<span class="dv">2</span>]]<span class="sc">$</span>x,dfrand1b[[<span class="dv">2</span>]]<span class="sc">$</span>x), <span class="at">label =</span> <span class="fu">c</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"value = {round(dfrand0b[[2]]$x,2)}"</span>),glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"value = {round(dfrand1b[[2]]$x,2)}"</span>)), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult=</span>.<span class="dv">25</span>),<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">n.dodge =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte_revised</span>() <span class="sc">+</span></span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Value"</span>, <span class="at">y =</span> <span class="st">"Quantile"</span> , <span class="at">title =</span> <span class="st">"Empirical Cumulative Distribution</span><span class="sc">\n</span><span class="st">Treated (Black) and Untreated (Blue) Group, Post Intervention"</span>) <span class="sc">+</span></span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> dfrand0b[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{round(q_,3)}"</span>),</span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">y =</span> q_), <span class="fu">aes</span>( <span class="at">y =</span> y, <span class="at">x =</span> x), <span class="at">colour =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb137-13"><a href="#cb137-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> dfrand1b[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{round(q_,3)}"</span>),</span>
<span id="cb137-14"><a href="#cb137-14" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">y =</span> q_), <span class="fu">aes</span>( <span class="at">y =</span> y, <span class="at">x =</span> x), <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span>    </span>
<span id="cb137-15"><a href="#cb137-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb137-16"><a href="#cb137-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(q_),<span class="at">labels =</span> <span class="fu">round</span>(<span class="fu">c</span>(q_),<span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb137-17"><a href="#cb137-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="fu">c</span>(<span class="st">"blue"</span>),</span>
<span id="cb137-18"><a href="#cb137-18" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.75</span>,</span>
<span id="cb137-19"><a href="#cb137-19" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb137-20"><a href="#cb137-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb137-21"><a href="#cb137-21" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.25</span>,</span>
<span id="cb137-22"><a href="#cb137-22" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb137-23"><a href="#cb137-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb137-24"><a href="#cb137-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> df_te, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend, <span class="at">y =</span> y , <span class="at">yend =</span> yend),<span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb137-25"><a href="#cb137-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,<span class="at">y =</span> <span class="fl">0.25</span>, <span class="at">x =</span> df_te<span class="sc">$</span>x[<span class="dv">1</span>], <span class="at">label =</span> <span class="fu">glue</span>(<span class="st">"  Treatment Effect:</span><span class="sc">\n</span><span class="st"> {ifelse(sign(df_te$xend - df_te$x)==1,'+','')}{round(df_te$xend - df_te$x,2)}    "</span>),<span class="at">hjust=</span><span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'y' is already present. Adding another scale for 'y', which will
replace the existing scale.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="holding-pen_quantile-tx-effects-changes-in-changes_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="qte-under-randomization-8" class="level2">
<h2 class="anchored" data-anchor-id="qte-under-randomization-8">QTE Under Randomization</h2>
<div class="columns">
<div class="column">
<div class="sourceCode" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>jt.rand <span class="ot">&lt;-</span> </span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ci.qtet</span>(re78 <span class="sc">~</span> treat, </span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data=</span>lalonde.exp, </span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">probs=</span><span class="fu">seq</span>(<span class="fl">0.05</span>,<span class="fl">0.95</span>,<span class="fl">0.05</span>), </span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">se=</span>T, </span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">iters=</span><span class="dv">10</span>)</span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(jt.rand)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>jt.rand <span class="ot">&lt;-</span> </span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ci.qtet</span>(re78 <span class="sc">~</span> treat, </span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data=</span>lalonde.exp, </span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">probs=</span><span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.75</span>,<span class="fl">0.9</span>), </span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">se=</span>T, </span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">iters=</span><span class="dv">10</span>)</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>foo <span class="ot">&lt;-</span> <span class="fu">summary</span>(jt.rand)</span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">quantile =</span> <span class="fu">unname</span>(foo<span class="sc">$</span>probs), <span class="at">tau =</span> <span class="fu">unname</span>(foo<span class="sc">$</span>qte)) <span class="sc">%&gt;%</span> </span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span>  <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:right;"> quantile </th>
   <th style="text-align:right;"> tau </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 0.10 </td>
   <td style="text-align:right;"> 0.00 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.25 </td>
   <td style="text-align:right;"> 338.65 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.50 </td>
   <td style="text-align:right;"> 1123.55 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.75 </td>
   <td style="text-align:right;"> 2347.50 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.90 </td>
   <td style="text-align:right;"> 3239.60 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</section>
<section id="qte-under-randomization-9" class="level2">
<h2 class="anchored" data-anchor-id="qte-under-randomization-9">QTE Under Randomization</h2>
<div class="sourceCode" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggqte</span>(jt.rand)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggqte</span>(jt.rand) <span class="sc">+</span> <span class="fu">theme_tufte_revised</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="holding-pen_quantile-tx-effects-changes-in-changes_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="section-10" class="level2">
<h2 class="anchored" data-anchor-id="section-10"></h2>
<ul>
<li>Start with the distribution of oute</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>p1a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="holding-pen_quantile-tx-effects-changes-in-changes_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="section-11" class="level2">
<h2 class="anchored" data-anchor-id="section-11"></h2>
<ul>
<li>Test</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>p1b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="holding-pen_quantile-tx-effects-changes-in-changes_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="section-12" class="level2">
<h2 class="anchored" data-anchor-id="section-12"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>p2a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="holding-pen_quantile-tx-effects-changes-in-changes_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="section-13" class="level2">
<h2 class="anchored" data-anchor-id="section-13"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>p3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="holding-pen_quantile-tx-effects-changes-in-changes_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="section-14" class="level2">
<h2 class="anchored" data-anchor-id="section-14"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>p4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="holding-pen_quantile-tx-effects-changes-in-changes_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="quantile-difference-in-differences-1" class="level2">
<h2 class="anchored" data-anchor-id="quantile-difference-in-differences-1">Quantile Difference-in-Differences</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> y00 <span class="sc">%&gt;%</span> <span class="fu">pdf_to_cdf</span>(<span class="at">q =</span> q_, <span class="at">scene =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_filter(dots, env_filter): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>cdf_Cxpre <span class="ot">&lt;-</span> <span class="fu">approxfun</span>(df2<span class="sc">$</span>cdf<span class="sc">$</span>x, df2<span class="sc">$</span>cdf<span class="sc">$</span>y)</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>Cx_quant <span class="ot">&lt;-</span> q_ <span class="co">#cdf_Cxpre(df1b$p_df_label$x)</span></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 2a is the overlay of the pre-intervention treatment and control</span></span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>p2aQDID <span class="ot">&lt;-</span></span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> df1b[[<span class="dv">1</span>]], <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> df1b[[<span class="dv">2</span>]], <span class="fu">aes</span>(<span class="at">label =</span> quantile, <span class="at">x =</span> x <span class="sc">-</span> .<span class="dv">5</span>,<span class="at">y =</span> y<span class="fl">+.01</span>,<span class="at">group =</span> quantile)) <span class="sc">+</span></span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(df1b[[<span class="dv">2</span>]]<span class="sc">$</span>x,df2[[<span class="dv">2</span>]]<span class="sc">$</span>x), <span class="at">label =</span> <span class="fu">c</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"value = {round(df1b[[2]]$x,2)}"</span>),glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"value = {round(df2[[2]]$x,2)}"</span>)), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult=</span>.<span class="dv">25</span>),<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">n.dodge =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb150-10"><a href="#cb150-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte_revised</span>() <span class="sc">+</span></span>
<span id="cb150-11"><a href="#cb150-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb150-12"><a href="#cb150-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb150-13"><a href="#cb150-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Value"</span>, <span class="at">y =</span> <span class="st">"Quantile"</span> , <span class="at">title =</span> <span class="st">"Empirical Cumulative Distribution</span><span class="sc">\n</span><span class="st">Treated (Black) and Untreated (Blue), Pre-Intervention"</span>) <span class="sc">+</span></span>
<span id="cb150-14"><a href="#cb150-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df2[[<span class="dv">1</span>]], <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb150-15"><a href="#cb150-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb150-16"><a href="#cb150-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> df2[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{round(Cx_quant,3)}"</span>),</span>
<span id="cb150-17"><a href="#cb150-17" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">y =</span> Cx_quant), <span class="fu">aes</span>(<span class="at">label =</span> quantile, <span class="at">y =</span> y<span class="fl">+.02</span>, <span class="at">x =</span> {p1b <span class="sc">%&gt;%</span> <span class="fu">ggplot_build</span>() <span class="sc">%&gt;%</span> <span class="fu">pluck</span>(<span class="st">"data"</span>) <span class="sc">%&gt;%</span> <span class="fu">pluck</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(x)}<span class="sc">-</span>.<span class="dv">5</span>), <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb150-18"><a href="#cb150-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df2[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{round(Cx_quant,3)}"</span>),</span>
<span id="cb150-19"><a href="#cb150-19" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">y =</span> Cx_quant), <span class="fu">aes</span>( <span class="at">y =</span> y, <span class="at">x =</span> x), <span class="at">colour =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb150-20"><a href="#cb150-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df1b[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{round(Cx_quant,3)}"</span>),</span>
<span id="cb150-21"><a href="#cb150-21" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">y =</span> q_), <span class="fu">aes</span>( <span class="at">y =</span> y, <span class="at">x =</span> x), <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">3</span>)    <span class="sc">+</span></span>
<span id="cb150-22"><a href="#cb150-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb150-23"><a href="#cb150-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(q_,Cx_quant),<span class="at">labels =</span> <span class="fu">round</span>(<span class="fu">c</span>(q_,Cx_quant),<span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb150-24"><a href="#cb150-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="fu">c</span>(<span class="st">"black"</span>,<span class="st">"blue"</span>),</span>
<span id="cb150-25"><a href="#cb150-25" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.75</span>,</span>
<span id="cb150-26"><a href="#cb150-26" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb150-27"><a href="#cb150-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb150-28"><a href="#cb150-28" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.25</span>,</span>
<span id="cb150-29"><a href="#cb150-29" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb150-30"><a href="#cb150-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'y' is already present. Adding another scale for 'y', which will
replace the existing scale.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Get the counterfactual change</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> y01 <span class="sc">%&gt;%</span> <span class="fu">pdf_to_cdf</span>(<span class="at">q =</span> q_, <span class="at">scene =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_filter(dots, env_filter): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>cdf_Cxpost <span class="ot">&lt;-</span> <span class="fu">approxfun</span>(df3<span class="sc">$</span>cdf<span class="sc">$</span>y, df3<span class="sc">$</span>cdf<span class="sc">$</span>x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
collapsing to unique 'x' values</code></pre>
</div>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>cdf_Cxpre <span class="ot">&lt;-</span> <span class="fu">approxfun</span>(df2<span class="sc">$</span>cdf<span class="sc">$</span>y, df2<span class="sc">$</span>cdf<span class="sc">$</span>x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
collapsing to unique 'x' values</code></pre>
</div>
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>df_cfx <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">cdf_Cxpre</span>(Cx_quant), <span class="at">xend =</span> <span class="fu">cdf_Cxpost</span>(Cx_quant), <span class="at">y =</span> <span class="fl">0.25</span>,<span class="at">yend =</span> <span class="fl">0.25</span>)</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>p3QDID <span class="ot">&lt;-</span></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> df3[[<span class="dv">1</span>]], <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">colour =</span> <span class="st">"blue"</span>,<span class="at">lty=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(df2[[<span class="dv">2</span>]]<span class="sc">$</span>x,df3[[<span class="dv">2</span>]]<span class="sc">$</span>x), <span class="at">label =</span> <span class="fu">c</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"value = {round(df2[[2]]$x,2)}"</span>),glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"value = {round(df3[[2]]$x,2)}"</span>)), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult=</span>.<span class="dv">25</span>),<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">n.dodge =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte_revised</span>() <span class="sc">+</span></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Value"</span>, <span class="at">y =</span> <span class="st">"Quantile"</span> , <span class="at">title =</span> <span class="st">"Empirical Cumulative Distribution</span><span class="sc">\n</span><span class="st">Untreated Group, Pre- and Post-Intervention"</span>) <span class="sc">+</span></span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df2[[<span class="dv">1</span>]], <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb158-11"><a href="#cb158-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df2[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{round(Cx_quant,3)}"</span>),</span>
<span id="cb158-12"><a href="#cb158-12" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">y =</span> Cx_quant), <span class="fu">aes</span>( <span class="at">y =</span> y, <span class="at">x =</span> x), <span class="at">colour =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb158-13"><a href="#cb158-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df3[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{round(Cx_quant,3)}"</span>),</span>
<span id="cb158-14"><a href="#cb158-14" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">y =</span> Cx_quant), <span class="fu">aes</span>( <span class="at">y =</span> y, <span class="at">x =</span> x), <span class="at">colour =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>)    <span class="sc">+</span></span>
<span id="cb158-15"><a href="#cb158-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb158-16"><a href="#cb158-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(Cx_quant),<span class="at">labels =</span> <span class="fu">round</span>(<span class="fu">c</span>(Cx_quant),<span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb158-17"><a href="#cb158-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="fu">c</span>(<span class="st">"blue"</span>),</span>
<span id="cb158-18"><a href="#cb158-18" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.75</span>,</span>
<span id="cb158-19"><a href="#cb158-19" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb158-20"><a href="#cb158-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb158-21"><a href="#cb158-21" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.25</span>,</span>
<span id="cb158-22"><a href="#cb158-22" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb158-23"><a href="#cb158-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb158-24"><a href="#cb158-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> df_cfx, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend, <span class="at">y =</span> y , <span class="at">yend =</span> yend),<span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb158-25"><a href="#cb158-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,<span class="at">y =</span> <span class="fl">0.25</span>, <span class="at">x =</span> df_cfx<span class="sc">$</span>x[<span class="dv">1</span>], <span class="at">label =</span> <span class="fu">glue</span>(<span class="st">"  Counterfactual:</span><span class="sc">\n</span><span class="st"> {ifelse(sign(df_cfx$xend - df_cfx$x)==1,'+','')}{round(df_cfx$xend - df_cfx$x,3)}    "</span>),<span class="at">hjust=</span><span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'y' is already present. Adding another scale for 'y', which will
replace the existing scale.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Get teh Treatmetn Effect</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>df5a <span class="ot">&lt;-</span> y10 <span class="sc">%&gt;%</span> <span class="fu">pdf_to_cdf</span>(<span class="at">q =</span> q_, <span class="at">scene =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_filter(dots, env_filter): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>df5b <span class="ot">&lt;-</span> y11 <span class="sc">%&gt;%</span> <span class="fu">pdf_to_cdf</span>(<span class="at">q =</span> q_, <span class="at">scene =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_filter(dots, env_filter): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>cdf_Cxpost <span class="ot">&lt;-</span> <span class="fu">approxfun</span>(df3<span class="sc">$</span>cdf<span class="sc">$</span>y, df3<span class="sc">$</span>cdf<span class="sc">$</span>x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
collapsing to unique 'x' values</code></pre>
</div>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>cdf_Cxpre <span class="ot">&lt;-</span> <span class="fu">approxfun</span>(df2<span class="sc">$</span>cdf<span class="sc">$</span>y, df2<span class="sc">$</span>cdf<span class="sc">$</span>x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
collapsing to unique 'x' values</code></pre>
</div>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>obs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> df5a[[<span class="dv">2</span>]]<span class="sc">$</span>x, <span class="at">xend =</span> df5b[[<span class="dv">2</span>]]<span class="sc">$</span>x, <span class="at">y =</span> <span class="fl">0.3</span>,<span class="at">yend =</span> <span class="fl">0.3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cfx =</span> df_cfx<span class="sc">$</span>xend <span class="sc">-</span> df_cfx<span class="sc">$</span>x) <span class="sc">%&gt;%</span></span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">te =</span> (xend <span class="sc">-</span> x)<span class="sc">-</span>(cfx))</span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>te <span class="ot">=</span> obs <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fl">0.2</span>,<span class="at">yend=</span><span class="fl">0.2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">xstartte =</span> x <span class="sc">+</span> cfx,</span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">xendte =</span> x <span class="sc">+</span> cfx <span class="sc">+</span> te)</span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true" tabindex="-1"></a>p4QDID <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df5a[[<span class="dv">1</span>]], <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">colour =</span> <span class="st">"black"</span>,<span class="at">lty=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb168-11"><a href="#cb168-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(df5a[[<span class="dv">2</span>]]<span class="sc">$</span>x,df5b[[<span class="dv">2</span>]]<span class="sc">$</span>x), <span class="at">label =</span> <span class="fu">c</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"pre-intervention value = {round(df5a[[2]]$x,2)}"</span>),glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"post-intervention value = {round(df5b[[2]]$x,2)}"</span>)), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult=</span>.<span class="dv">25</span>),<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">n.dodge =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb168-12"><a href="#cb168-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_tufte_revised</span>() <span class="sc">+</span></span>
<span id="cb168-13"><a href="#cb168-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb168-14"><a href="#cb168-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Value"</span>, <span class="at">y =</span> <span class="st">"Quantile"</span> , <span class="at">title =</span> <span class="st">"Empirical Cumulative Distribution</span><span class="sc">\n</span><span class="st">Treated Group,  Pre- and Post-Intervention"</span>) <span class="sc">+</span></span>
<span id="cb168-15"><a href="#cb168-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df5b[[<span class="dv">1</span>]], <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb168-16"><a href="#cb168-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb168-17"><a href="#cb168-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df5a[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{q_}"</span>),</span>
<span id="cb168-18"><a href="#cb168-18" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">y =</span> q_), <span class="fu">aes</span>( <span class="at">y =</span> y, <span class="at">x =</span> x), <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb168-19"><a href="#cb168-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df5b[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">quantile =</span> <span class="fu">glue</span>(<span class="st">"q{q_}"</span>),</span>
<span id="cb168-20"><a href="#cb168-20" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">y =</span> q_), <span class="fu">aes</span>( <span class="at">y =</span> y, <span class="at">x =</span> x), <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">3</span>)    <span class="sc">+</span></span>
<span id="cb168-21"><a href="#cb168-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb168-22"><a href="#cb168-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(q_),<span class="at">labels =</span> <span class="fu">round</span>(<span class="fu">c</span>(q_),<span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb168-23"><a href="#cb168-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="fu">c</span>(<span class="st">"black"</span>),</span>
<span id="cb168-24"><a href="#cb168-24" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.75</span>,</span>
<span id="cb168-25"><a href="#cb168-25" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb168-26"><a href="#cb168-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb168-27"><a href="#cb168-27" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">0.25</span>,</span>
<span id="cb168-28"><a href="#cb168-28" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb168-29"><a href="#cb168-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb168-30"><a href="#cb168-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> df_cfx, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend, <span class="at">y =</span> y , <span class="at">yend =</span> yend),<span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb168-31"><a href="#cb168-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,<span class="at">y =</span> <span class="fl">0.25</span>, <span class="at">x =</span> df_cfx<span class="sc">$</span>x[<span class="dv">1</span>], <span class="at">label =</span> <span class="fu">glue</span>(<span class="st">"  Counterfactual:  {ifelse(sign(df_cfx$xend - df_cfx$x)==1,'+','')}{round(df_cfx$xend - df_cfx$x,3)}    "</span>),<span class="at">hjust=</span><span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb168-32"><a href="#cb168-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> obs, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend, <span class="at">y =</span> y , <span class="at">yend =</span> yend),<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb168-33"><a href="#cb168-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,<span class="at">y =</span> <span class="fl">0.3</span>, <span class="at">x =</span> df_cfx<span class="sc">$</span>x[<span class="dv">1</span>], <span class="at">label =</span> <span class="fu">glue</span>(<span class="st">"  Observed:  {ifelse(sign(obs$xend - obs$x)==1,'+','')}{round(obs$xend - obs$x,3)}    "</span>),<span class="at">hjust=</span><span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb168-34"><a href="#cb168-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> obs, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend, <span class="at">y =</span> y , <span class="at">yend =</span> yend),<span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb168-35"><a href="#cb168-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,<span class="at">y =</span> <span class="fl">0.2</span>, <span class="at">x =</span> te<span class="sc">$</span>x[<span class="dv">1</span>], <span class="at">label =</span> <span class="fu">glue</span>(<span class="st">"  tau(q={q_}):  {ifelse(sign(te$te)==1,'+','')}{round(te$te,3)}    "</span>),<span class="at">hjust=</span><span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb168-36"><a href="#cb168-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> te, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> x <span class="sc">+</span> cfx, <span class="at">y =</span> y , <span class="at">yend =</span> yend),<span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb168-37"><a href="#cb168-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> te, <span class="fu">aes</span>(<span class="at">x =</span> x <span class="sc">+</span> cfx, <span class="at">xend =</span> xend, <span class="at">y =</span> y , <span class="at">yend =</span> yend),<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb168-38"><a href="#cb168-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df2[[<span class="dv">1</span>]], <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span>  <span class="fu">geom_line</span>(<span class="at">data =</span> df3[[<span class="dv">1</span>]], <span class="at">colour =</span> <span class="st">"blue"</span>,<span class="at">lty=</span><span class="dv">2</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'y' is already present. Adding another scale for 'y', which will
replace the existing scale.</code></pre>
</div>
</div>
</section>
<section id="section-15" class="level2">
<h2 class="anchored" data-anchor-id="section-15"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>p1a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="holding-pen_quantile-tx-effects-changes-in-changes_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="section-16" class="level2">
<h2 class="anchored" data-anchor-id="section-16"></h2>
<ul>
<li>Test</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>p1b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="holding-pen_quantile-tx-effects-changes-in-changes_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="section-17" class="level2">
<h2 class="anchored" data-anchor-id="section-17"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>p2aQDID</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="holding-pen_quantile-tx-effects-changes-in-changes_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="section-18" class="level2">
<h2 class="anchored" data-anchor-id="section-18"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>p3QDID</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="holding-pen_quantile-tx-effects-changes-in-changes_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="section-19" class="level2">
<h2 class="anchored" data-anchor-id="section-19"></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>p4QDID</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="holding-pen_quantile-tx-effects-changes-in-changes_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>