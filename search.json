[
  {
    "objectID": "ignore/meta-structure-equations.html",
    "href": "ignore/meta-structure-equations.html",
    "title": "Fixed, Random and Correlated Random Effects",
    "section": "",
    "text": "Add unobserved heterogeneity\n\\[\nY_i = \\mathbf{X}_i'\\beta + \\tau D_i + U_i +\\epsilon_i \\quad \\quad \\quad Eq. 2\n\\]\n\n\nMove to panel data setting\n\\[\nY_{it} = \\mathbf{X}_{it}'\\beta + \\tau D_{it} + U_i + \\epsilon_i \\quad \\quad \\quad Eq. 3\n\\]\n\n\nPooled OLS\n\\[\n\\begin{aligned}\nY_{it} &=\\mathbf{X}_{it}'\\beta + \\tau D_{it} + \\overbrace{U_i + \\epsilon_{it}}^{\\eta_{it}} \\\\\n&= \\mathbf{X}_{it}'\\beta + \\tau D_{it}  + \\eta_{it} \\quad \\quad \\quad Eq. 4\n\\end{aligned}\n\\]\n\n\nRandom Effects\n\\[\n\\begin{aligned}\nY_{it} &= \\mathbf{X}_{it}'\\beta + \\tau D_{it}  + \\overbrace{U_i + \\epsilon_{it}}^{v_it} \\\\\nY_{it} &= \\mathbf{X}_{it}'\\beta + \\tau D_{it}  + v_{it} \\quad \\quad \\quad Eq. 5 \\\\\nv_{it} &= U_i + \\epsilon_{it} \\\\\nU_i &\\sim N(0,\\sigma^2_u)\n\\end{aligned}\n\\]\n\n\nDummy Variable Regression\n\\[\nY_{it} = \\mathbf{X}_{it}'\\beta + \\tau D_i + \\mathbf{U}_i + \\epsilon_{it} \\quad \\quad \\quad Eq. 6\n\\]\n\n\nFirst Differences\n\\[\n\\begin{aligned}\nY_{it} &= \\mathbf{X}_{it}'\\beta + \\tau D_{it} + U_i + \\epsilon_{it} \\\\\nY_{i,t-1} &=  \\mathbf{X}_{i,t-1}'\\beta + \\tau D_{i,t-1} + U_i + \\epsilon_{i,t-1} \\\\\nY_{it} - Y_{i,t-1} &= (\\mathbf{X}_{it} - \\mathbf{X}_{i,t-1})'\\beta + \\tau (D_{it} - D_{i,t-1}) + (U_i - U_i) +  (\\epsilon_{it} - \\epsilon_{i,t-1}) \\\\\n&= (\\mathbf{X}_{it} - \\mathbf{X}_{i,t-1})'\\beta + \\tau (D_{it} - D_{i,t-1}) + (\\epsilon_{it} - \\epsilon_{i,t-1}) \\quad \\quad \\quad Eq. 7\n\\end{aligned}\n\\]\n\n\nDemeaning\n\\[\n\\begin{align}\n(Y_{it}-\\bar{Y_i}) &= (\\mathbf{X}_{it}-\\bar{\\mathbf{X}_i})'\\beta + \\tau (D_{it}-\\bar{D_i}) + (U_i - \\bar{U_i)} + (\\epsilon_{it} - \\bar{\\epsilon_i}) \\\\\n&= (\\mathbf{X}_{it}-\\bar{\\mathbf{X}_i})'\\beta + \\tau (D_{it}-\\bar{D_i})  + (\\epsilon_{it} - \\bar{\\epsilon_i}) \\quad \\quad \\quad Eq. 8\n\\end{align}\n\\]\n\n\nQuasi Demeaning\n\\[\n\\begin{align}\n(Y_{it}-\\theta \\bar{Y_i}) = (\\mathbf{X}_{it}-\\theta \\bar{\\mathbf{X}_i})'\\beta + \\tau (D_{it}-\\theta \\bar{D_i})  + (\\epsilon_{it} - \\theta \\bar{\\epsilon_i}) \\quad \\quad \\quad Eq. 9\n\\end{align}\n\\]\nnote: need to define theta still.\n\n\nCorrelated Random Effects\n\\[\n\\begin{align}\nY_{it} &= \\mathbf{X}_{it}'\\beta + \\tau D_i + \\overbrace{U_i}^{U_i = \\bar{\\mathbf{X}_i}'\\gamma+\\omega_i} + \\epsilon_{it} \\\\\n&= \\mathbf{X}_{it}'\\beta + \\tau D_i + \\bar{\\mathbf{X}_i}'\\gamma+ \\underbrace{\\omega_i + \\epsilon_{it}}_{v_{it}} \\\\\nv_{it} &= \\omega_i + \\epsilon_{it} \\\\\n\\omega_i &\\sim N(0,\\sigma^2_u\n\\end{align}\n\\]"
  },
  {
    "objectID": "ignore/did_stata_files/did_staggered_6_20220817.html",
    "href": "ignore/did_stata_files/did_staggered_6_20220817.html",
    "title": "did-staggered.do",
    "section": "",
    "text": "This file replicates the analysis in did_staggered_6_20220817"
  },
  {
    "objectID": "ignore/did_stata_files/did_staggered_6_20220817.html#constant-te-with-equivalence-between-pols-and-twfe",
    "href": "ignore/did_stata_files/did_staggered_6_20220817.html#constant-te-with-equivalence-between-pols-and-twfe",
    "title": "did-staggered.do",
    "section": "Constant TE, with equivalence between POLS and TWFE",
    "text": "Constant TE, with equivalence between POLS and TWFE\n\nff <- as.formula(\"y ~ w\")\nff_pols <- reformulate(c(\"w\",grep(\"^d_\",colnames(df), value=TRUE),grep(\"^year_\",colnames(df), value = TRUE)),ff[[2]])\nfit_pols <- lm(ff_pols, data = df); fit_pols\n\n\nCall:\nlm(formula = ff_pols, data = df)\n\nCoefficients:\n(Intercept)            w       d_2004       d_2005       d_2006    year_2001  \n    21.1214       3.5123      -0.8230      -1.1596      -1.2550      -0.8308  \n  year_2002    year_2003    year_2004    year_2005    year_2006  \n    -0.6235      -0.6625      -0.2149      -0.4554           NA  \n\nff_twfe <- as.formula(\"y ~ w + factor(year) | id\")\nfit_twfe <- feols(ff_twfe, data = df); fit_twfe\n\nOLS estimation, Dep. Var.: y\nObservations: 3,000 \nFixed-effects: id: 500\nStandard-errors: Clustered (id) \n                 Estimate Std. Error  t value   Pr(>|t|)    \nw                3.512326   0.172184 20.39862  < 2.2e-16 ***\nfactor(year)2002 0.207371   0.126646  1.63741 1.0218e-01    \nfactor(year)2003 0.168322   0.122300  1.37631 1.6934e-01    \nfactor(year)2004 0.615990   0.135606  4.54251 6.9790e-06 ***\nfactor(year)2005 0.375432   0.146311  2.56600 1.0579e-02 *  \nfactor(year)2006 0.830845   0.157906  5.26166 2.1233e-07 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\nRMSE: 2.00954     Adj. R2: 0.547048\n                Within R2: 0.299271"
  },
  {
    "objectID": "ignore/did_stata_files/did_staggered_6_20220817.html#tes-vary-by-entry-cohort-and-time-period-wooldridge-2021-wp-fe-and-pols-are-the-same",
    "href": "ignore/did_stata_files/did_staggered_6_20220817.html#tes-vary-by-entry-cohort-and-time-period-wooldridge-2021-wp-fe-and-pols-are-the-same",
    "title": "did-staggered.do",
    "section": "TEs vary by entry cohort and time period [Wooldridge (2021, WP)], FE and POLS are the same",
    "text": "TEs vary by entry cohort and time period [Wooldridge (2021, WP)], FE and POLS are the same\n\nff_twfe <- as.formula(paste0(\"y ~\",paste0(cohort_year_interactions$i,collapse=\"+\"),\"+ factor(year) | id\"))\nfit_twfe <- feols(ff_twfe, data = df); fit_twfe\n\nOLS estimation, Dep. Var.: y\nObservations: 3,000 \nFixed-effects: id: 500\nStandard-errors: Clustered (id) \n                   Estimate Std. Error  t value   Pr(>|t|)    \nI(d_2004 * f_2004) 3.522951   0.301484 11.68538  < 2.2e-16 ***\nI(d_2004 * f_2005) 4.258536   0.325970 13.06419  < 2.2e-16 ***\nI(d_2004 * f_2006) 4.216866   0.338442 12.45965  < 2.2e-16 ***\nI(d_2005 * f_2005) 2.989588   0.341643  8.75063  < 2.2e-16 ***\nI(d_2005 * f_2006) 3.693816   0.364633 10.13024  < 2.2e-16 ***\nI(d_2006 * f_2006) 2.006591   0.558389  3.59354 0.00035859 ***\nfactor(year)2002   0.207371   0.126752  1.63604 0.10246224    \nfactor(year)2003   0.168322   0.122402  1.37516 0.16969964    \n... 3 coefficients remaining (display them with summary() or use argument n)\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\nRMSE: 1.99544     Adj. R2: 0.552487\n                Within R2: 0.309074\n\nff_pols <- as.formula(paste0(\"y ~\",paste0(cohort_year_interactions$i,collapse=\"+\"),\"+\",paste0(grep(\"^d_\",colnames(df), value=TRUE),collapse=\"+\"),\"+ factor(year)\"))\nfit_pols <- lm(ff_pols,data = df); fit_pols\n\n\nCall:\nlm(formula = ff_pols, data = df)\n\nCoefficients:\n       (Intercept)  I(d_2004 * f_2004)  I(d_2004 * f_2005)  I(d_2004 * f_2006)  \n           20.3210              3.5230              4.2585              4.2169  \nI(d_2005 * f_2005)  I(d_2005 * f_2006)  I(d_2006 * f_2006)              d_2004  \n            2.9896              3.6938              2.0066             -1.0665  \n            d_2005              d_2006    factor(year)2002    factor(year)2003  \n           -1.1027             -1.0041              0.2074              0.1683  \n  factor(year)2004    factor(year)2005    factor(year)2006  \n            0.6135              0.2846              0.7415  \n\nff_re <- as.formula(paste0(\"y ~\",paste0(cohort_year_interactions$i,collapse=\"+\"),\"+\",paste0(grep(\"^d_\",colnames(df), value=TRUE),collapse=\"+\"),\"+ factor(year) + (1| id)\"))\nfit_re <- lmer(ff_re, data = df); summary(fit_re)\n\nLinear mixed model fit by REML ['lmerMod']\nFormula: y ~ I(d_2004 * f_2004) + I(d_2004 * f_2005) + I(d_2004 * f_2006) +  \n    I(d_2005 * f_2005) + I(d_2005 * f_2006) + I(d_2006 * f_2006) +  \n    d_2004 + d_2005 + d_2006 + factor(year) + (1 | id)\n   Data: df\n\nREML criterion at convergence: 14119.2\n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-3.8329 -0.6080  0.0064  0.6071  3.6490 \n\nRandom effects:\n Groups   Name        Variance Std.Dev.\n id       (Intercept) 3.987    1.997   \n Residual             4.799    2.191   \nNumber of obs: 3000, groups:  id, 500\n\nFixed effects:\n                   Estimate Std. Error t value\n(Intercept)         20.3210     0.1647 123.358\nI(d_2004 * f_2004)   3.5230     0.2656  13.262\nI(d_2004 * f_2005)   4.2585     0.2738  15.555\nI(d_2004 * f_2006)   4.2169     0.2786  15.137\nI(d_2005 * f_2005)   2.9896     0.3040   9.835\nI(d_2005 * f_2006)   3.6938     0.3083  11.980\nI(d_2006 * f_2006)   2.0066     0.4266   4.704\nd_2004              -1.0665     0.2602  -4.099\nd_2005              -1.1027     0.2867  -3.846\nd_2006              -1.0041     0.3954  -2.540\nfactor(year)2002     0.2074     0.1386   1.497\nfactor(year)2003     0.1683     0.1386   1.215\nfactor(year)2004     0.6135     0.1523   4.028\nfactor(year)2005     0.2846     0.1661   1.714\nfactor(year)2006     0.7415     0.1739   4.264\n\n\n\nCorrelation matrix not shown by default, as p = 15 > 12.\nUse print(x, correlation=TRUE)  or\n    vcov(x)        if you need it\n\n# Compute average effect by cohort:\nsum(coef(fit_twfe)[c(\"I(d_2004 * f_2004)\",\"I(d_2004 * f_2005)\",\"I(d_2004 * f_2006)\")])/3\n\n[1] 3.999451\n\nsum(coef(fit_twfe)[c(\"I(d_2005 * f_2005)\",\"I(d_2005 * f_2006)\")])/2\n\n[1] 3.341702"
  },
  {
    "objectID": "ignore/did_stata_files/did_staggered_6_20220817.html#dropping-early-time-dummies-gives-same-estimates.",
    "href": "ignore/did_stata_files/did_staggered_6_20220817.html#dropping-early-time-dummies-gives-same-estimates.",
    "title": "did-staggered.do",
    "section": "Dropping early time dummies gives same estimates.",
    "text": "Dropping early time dummies gives same estimates.\n(In general, avoid this because it should not be done in nonlinear models.)\n\nff_twfe <- as.formula(paste0(\"y ~\",paste0(cohort_year_interactions$i,collapse=\"+\"),\"+\",paste0(grep(\"^f_\",colnames(df), value=TRUE),collapse=\"+\"),\"| id\"))\nfit_twfe <- feols(ff_twfe, data = df); fit_twfe\n\n# \n# \n# xtreg y c.d4#c.f04 c.d4#c.f05 c.d4#c.f06 ///\n#   c.d5#c.f05 c.d5#c.f06 ///\n#   c.d6#c.f06 f04 f05 f06, fe vce(cluster id)"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#basic-model",
    "href": "ignore/panel-data-full-animation.html#basic-model",
    "title": "Panel Data",
    "section": "Basic Model",
    "text": "Basic Model\n\nA"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#basic-model-1",
    "href": "ignore/panel-data-full-animation.html#basic-model-1",
    "title": "Panel Data",
    "section": "Basic Model",
    "text": "Basic Model\n\nA+B\nA"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#basic-model-2",
    "href": "ignore/panel-data-full-animation.html#basic-model-2",
    "title": "Panel Data",
    "section": "Basic Model",
    "text": "Basic Model\n\n\\[\nY_i = \\mathbf{X}_i'\\beta + \\tau D_i \\quad \\quad  + \\quad \\quad \\epsilon_i\n\\]"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#basic-model-3",
    "href": "ignore/panel-data-full-animation.html#basic-model-3",
    "title": "Panel Data",
    "section": "Basic Model",
    "text": "Basic Model\n\n\\[\nY_i= \\underbrace{\\color{green}{\\mathbf{X}_i'\\beta} + \\color{green}{\\tau D_i}}_{\\text{Systematic component}} + \\underbrace{\\color{red}{\\epsilon_i}}_{\\text{Stochastic Component}}\n\\]"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#basic-model-4",
    "href": "ignore/panel-data-full-animation.html#basic-model-4",
    "title": "Panel Data",
    "section": "Basic Model",
    "text": "Basic Model\n\n\\[\nY_i= \\color{green}{\\mathbf{X}_i'\\beta} + \\color{green}{\\tau D_i} + \\color{red}{\\epsilon_i}\n\\]"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#add-unobserved-heterogeneity",
    "href": "ignore/panel-data-full-animation.html#add-unobserved-heterogeneity",
    "title": "Panel Data",
    "section": "Add Unobserved Heterogeneity",
    "text": "Add Unobserved Heterogeneity\n\\[\nY_i= \\color{green}{\\mathbf{X}_i'\\beta} + \\color{green}{\\tau D_i} + \\color{purple}{U_i} + \\color{red}{\\epsilon_i}\n\\]\n\n\\[\nY_i= \\color{green}{\\mathbf{X}_i'\\beta} + \\color{green}{\\tau D_i} + \\color{red}{\\epsilon_i}\n\\]"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#go-to-panel-data-setting",
    "href": "ignore/panel-data-full-animation.html#go-to-panel-data-setting",
    "title": "Panel Data",
    "section": "Go To Panel Data Setting",
    "text": "Go To Panel Data Setting\n\\[\nY_{it} = \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{grenn}{\\tau D_{it}} + \\color{purple}{U_i} + \\color{red}{\\epsilon_{it}}\n\\]\n\n\\[\nY_{it}= \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{green}{\\tau D_{it}} + \\color{purple}{U_i} + \\color{red}{\\epsilon_{it}}\n\\]"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#pooled-ols",
    "href": "ignore/panel-data-full-animation.html#pooled-ols",
    "title": "Panel Data",
    "section": "Pooled OLS",
    "text": "Pooled OLS\n\\[\nY_{it}= \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{green}{\\tau D_{it}} + \\overbrace{\\color{purple}{U_i} + \\color{red}{\\epsilon_{it}}}^{\\color{red}{\\eta_{it}}}\n\\]\n\n\\[\nY_{it} = \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{green}{\\tau D_{it}} + \\color{purple}{U_i} + \\color{red}{\\epsilon_{it}}\n\\]"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#pooled-ols-1",
    "href": "ignore/panel-data-full-animation.html#pooled-ols-1",
    "title": "Panel Data",
    "section": "Pooled OLS",
    "text": "Pooled OLS\n\\[\nY_{it}= \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{green}{\\tau D_{it}} + \\color{red}{\\eta_{it}}\n\\]\n\n\\[\nY_{it}= \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{green}{\\tau D_{it}} + \\overbrace{\\color{purple}{U_i} + \\color{red}{\\epsilon_i}}^{\\color{red}{\\eta_{it}}}\n\\]"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#random-effects",
    "href": "ignore/panel-data-full-animation.html#random-effects",
    "title": "Panel Data",
    "section": "Random Effects",
    "text": "Random Effects\n\\[\n\\begin{aligned}\nY_{it} &= \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{green}{\\tau D_{it}} + \\color{red}{\\eta_{it}}\n\\end{aligned}\n\\]\n\n\\[\n\\begin{aligned}\n\\color{red}{\\eta_{it}} &= \\color{purple}{U_i} + \\color{red}{\\epsilon_{it}}\n\\end{aligned}\n\\]\n\n\n\\[\n\\begin{aligned}\n\\color{purple}{U_i} &\\sim N(0,\\sigma^2_u)\n\\end{aligned}\n\\]"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#dummy-variable-regression",
    "href": "ignore/panel-data-full-animation.html#dummy-variable-regression",
    "title": "Panel Data",
    "section": "Dummy Variable Regression",
    "text": "Dummy Variable Regression\n\\[\nY_{it}= \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{green}{\\tau D_{it}} + \\color{purple}{U_i} + \\color{red}{\\epsilon_{it}}\n\\]\n\n\\[\n\\begin{aligned}\nY_{it} &= \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{green}{\\tau D_{it}} + \\color{red}{\\eta_{it}}\n\\end{aligned}\n\\]\n\\[\n\\begin{aligned}\n\\color{red}{\\eta_{it}} &= \\color{purple}{U_i} + \\color{red}{\\epsilon_{it}}\n\\end{aligned}\n\\]\n\\[\n\\begin{aligned}\n\\color{purple}{U_i} &\\sim N(0,\\sigma^2_u)\n\\end{aligned}\n\\]"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#dummy-variable-regression-1",
    "href": "ignore/panel-data-full-animation.html#dummy-variable-regression-1",
    "title": "Panel Data",
    "section": "Dummy Variable Regression",
    "text": "Dummy Variable Regression\n\\[\nY_{it}= \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{green}{\\tau D_{it}} + \\color{green}{\\mathbf{U_i}} + \\color{red}{\\epsilon_{it}}\n\\]\n\n\\[\nY_{it}= \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{green}{\\tau D_{it}} + \\color{purple}{U_i} + \\color{red}{\\epsilon_{it}}\n\\]"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#first-differences",
    "href": "ignore/panel-data-full-animation.html#first-differences",
    "title": "Panel Data",
    "section": "First Differences",
    "text": "First Differences\n\n\\[\nY_{it}= \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{green}{\\tau D_{it}} + \\color{green}{\\mathbf{U_i}} + \\color{red}{\\epsilon_{it}}\n\\]"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#first-differences-1",
    "href": "ignore/panel-data-full-animation.html#first-differences-1",
    "title": "Panel Data",
    "section": "First Differences",
    "text": "First Differences\n\n\\[\nY_{it}= \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{green}{\\tau D_{it}} + \\color{purple}{U_i} + \\color{red}{\\epsilon_{it}}\n\\]"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#first-differences-2",
    "href": "ignore/panel-data-full-animation.html#first-differences-2",
    "title": "Panel Data",
    "section": "First Differences",
    "text": "First Differences\n\\[\nY_{it}= \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{green}{\\tau D_{it}} + \\color{purple}{U_i} + \\color{red}{\\epsilon_{it}}\n\\]\n\n\\[\nY_{i,t-1}= \\color{green}{\\mathbf{X}_{i,t-1}'\\beta} + \\color{green}{\\tau D_{i,t-1}} + \\color{purple}{U_i} + \\color{red}{\\epsilon_{i,t-1}}\n\\]\n\n\n\\[\n\\(Y_{it} - Y_{i,t-1}) = \\color{green}{(\\mathbf{X}_{it}-\\mathbf{X}_{i,t-1})'\\beta} + \\color{green}{\\tau (D_{it}-D_{i,t-1})} + \\color{purple}{U_i} + \\color{red}{(\\epsilon_{it}-\\epsilon_{i,t-1})}\n\\]"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#first-differences-3",
    "href": "ignore/panel-data-full-animation.html#first-differences-3",
    "title": "Panel Data",
    "section": "First Differences",
    "text": "First Differences\n\\[\n\\Delta Y_{it}= \\color{green}{\\Delta \\mathbf{X}_{it}'\\beta} + \\color{green}{\\Delta \\tau D_{it}} + \\color{purple}{U_i} + \\color{red}{\\Delta \\epsilon_{it}}\n\\]\n\n\\[\nY_{it}= \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{green}{\\tau D_{it}} + \\color{purple}{U_i} + \\color{red}{\\epsilon_{it}}\n\\]\n\\[\nY_{i,t-1}= \\color{green}{\\mathbf{X}_{i,t-1}'\\beta} + \\color{green}{\\tau D_{i,t-1}} + \\color{purple}{U_i} + \\color{red}{\\epsilon_{i,t-1}}\n\\]\n\\[\n(Y_{it} - Y_{i,t-1}) = \\color{green}{(\\mathbf{X}_{it}-\\mathbf{X}_{i,t-1})'\\beta} + \\color{green}{\\tau (D_{it}-D_{i,t-1})} + \\color{purple}{U_i} + \\color{red}{(\\epsilon_{it}-\\epsilon_{i,t-1})}\n\\]"
  },
  {
    "objectID": "ignore/wooldridge-extended-twfe-did.html",
    "href": "ignore/wooldridge-extended-twfe-did.html",
    "title": "DID Estimators",
    "section": "",
    "text": "Let’s start by loading libraries and data.\n\n\n\n\n\nlemp\nyear\nfirst_treat\ncountyreal\n\n\n\n\n8.461469\n2003\n2007\n8001\n\n\n8.336870\n2004\n2007\n8001\n\n\n8.340217\n2005\n2007\n8001\n\n\n8.378161\n2006\n2007\n8001\n\n\n8.487352\n2007\n2007\n8001\n\n\n4.997212\n2003\n2007\n8019\n\n\n\n\n\nNow let’s create some design variables.\n\nA treatment indicator\nCategorical (factor) variables for treatment group and time.\nDummy indicators for the treatment group and time variables.\n\n\ndf <- \n  df_raw %>% \n     # Create a binary treatment indicator that is one if ever treated and \n     # current year is >= treatment year. \n     mutate(treated = case_when(\n       year >= first_treat & first_treat > 0 ~ 1, \n       TRUE ~ 0\n    )) %>% \n  mutate(year = factor(year), \n         first_treat = factor(first_treat)) %>% \n  fastDummies::dummy_cols(c(\"year\",\"first_treat\"))\n\ndf %>% \n  head() %>% \n  kable()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nlemp\nyear\nfirst_treat\ncountyreal\ntreated\nyear_2003\nyear_2004\nyear_2005\nyear_2006\nyear_2007\nfirst_treat_0\nfirst_treat_2004\nfirst_treat_2006\nfirst_treat_2007\n\n\n\n\n8.461469\n2003\n2007\n8001\n0\n1\n0\n0\n0\n0\n0\n0\n0\n1\n\n\n8.336870\n2004\n2007\n8001\n0\n0\n1\n0\n0\n0\n0\n0\n0\n1\n\n\n8.340217\n2005\n2007\n8001\n0\n0\n0\n1\n0\n0\n0\n0\n0\n1\n\n\n8.378161\n2006\n2007\n8001\n0\n0\n0\n0\n1\n0\n0\n0\n0\n1\n\n\n8.487352\n2007\n2007\n8001\n1\n0\n0\n0\n0\n1\n0\n0\n0\n1\n\n\n4.997212\n2003\n2007\n8019\n0\n1\n0\n0\n0\n0\n0\n0\n0\n1\n\n\n\n\n\nOur next step is to create a series of interaction terms between treatment group, time, and treated. However, for a given treatment group we only include interactions with times that occur on or after the treatment time.\nWe’ll figure out these using a crossing() command:\n\ntreatment_group_times <- levels(df$first_treat) %>% as.numeric(); treatment_group_times\n\n[1]    0 2004 2006 2007\n\n# Note we eventually need to get rid of hte never treated (0's) for the interactions\nall_times <- levels(df$year) %>% as.numeric() ; all_times\n\n[1] 2003 2004 2005 2006 2007\n\ninteractions_needed <- crossing(first_treat = treatment_group_times, year = all_times) %>% \n  mutate(occurs_on_or_after = as.integer(year >= first_treat)) %>% \n  filter(first_treat != \"0\") \n\ninteractions_needed %>% kable()\n\n\n\n\nfirst_treat\nyear\noccurs_on_or_after\n\n\n\n\n2004\n2003\n0\n\n\n2004\n2004\n1\n\n\n2004\n2005\n1\n\n\n2004\n2006\n1\n\n\n2004\n2007\n1\n\n\n2006\n2003\n0\n\n\n2006\n2004\n0\n\n\n2006\n2005\n0\n\n\n2006\n2006\n1\n\n\n2006\n2007\n1\n\n\n2007\n2003\n0\n\n\n2007\n2004\n0\n\n\n2007\n2005\n0\n\n\n2007\n2006\n0\n\n\n2007\n2007\n1\n\n\n\n\n\nLet’s now restrict to cases that were ever treated (i.e., treatment_group_time!=0) and the times that occur on or after those dates:\n\ninteractions_needed <- \n  interactions_needed %>% \n  filter(occurs_on_or_after==1)\n\ninteractions_needed %>% kable()\n\n\n\n\nfirst_treat\nyear\noccurs_on_or_after\n\n\n\n\n2004\n2004\n1\n\n\n2004\n2005\n1\n\n\n2004\n2006\n1\n\n\n2004\n2007\n1\n\n\n2006\n2006\n1\n\n\n2006\n2007\n1\n\n\n2007\n2007\n1\n\n\n\n\n\nNow lets create a column that has the formula for the interaction between group * time * treated:\n\ninteractions_needed <- \n  interactions_needed %>% \n  mutate(first_treat = glue(\"first_treat_{first_treat}\"),\n         year = glue(\"year_{year}\")) %>% \n  mutate(rhs = glue(\"{first_treat}:{year}:treated\")) \ninteractions_needed %>% kable()\n\n\n\n\n\n\n\n\n\n\nfirst_treat\nyear\noccurs_on_or_after\nrhs\n\n\n\n\nfirst_treat_2004\nyear_2004\n1\nfirst_treat_2004:year_2004:treated\n\n\nfirst_treat_2004\nyear_2005\n1\nfirst_treat_2004:year_2005:treated\n\n\nfirst_treat_2004\nyear_2006\n1\nfirst_treat_2004:year_2006:treated\n\n\nfirst_treat_2004\nyear_2007\n1\nfirst_treat_2004:year_2007:treated\n\n\nfirst_treat_2006\nyear_2006\n1\nfirst_treat_2006:year_2006:treated\n\n\nfirst_treat_2006\nyear_2007\n1\nfirst_treat_2006:year_2007:treated\n\n\nfirst_treat_2007\nyear_2007\n1\nfirst_treat_2007:year_2007:treated\n\n\n\n\n\nThis allows us to pull out the right-hand side variable definitions for our eventual regression.\n\nrhs <- interactions_needed %>% pull(rhs) %>% as.vector()\nrhs <- paste0(rhs, collapse = \"+\")\nrhs\n\n[1] \"first_treat_2004:year_2004:treated+first_treat_2004:year_2005:treated+first_treat_2004:year_2006:treated+first_treat_2004:year_2007:treated+first_treat_2006:year_2006:treated+first_treat_2006:year_2007:treated+first_treat_2007:year_2007:treated\"\n\n\nWe can now fit a TWFE regression:\n\nfit_fmla <- as.formula(glue(\"lemp ~ {rhs} | first_treat + year\")); fit_fmla\n\nlemp ~ first_treat_2004:year_2004:treated + first_treat_2004:year_2005:treated + \n    first_treat_2004:year_2006:treated + first_treat_2004:year_2007:treated + \n    first_treat_2006:year_2006:treated + first_treat_2006:year_2007:treated + \n    first_treat_2007:year_2007:treated | first_treat + year\n\nfit <- feols(fit_fmla, data = df)\n\n\n# library(data.table)\n# broom::tidy(fit) %>% kable()\n# \n# # Clean the results\n# etwfe = as.data.table(tidy(fit))\n# etwfe = etwfe[\n#     , .(term = term, etwfe = estimate)][\n#     , group := as.numeric(gsub(\".*cohort.\", \"\", term))][\n#     , year := as.numeric(gsub(\".*time_to_treat.(\\\\d+).*\", \"\\\\1\", term)) + group][\n#     , .(group, year, etwfe)]\n\n\nfeols(lemp ~ treated : factor(first_treat) : factor(year) | first_treat + year, data = df) %>% \n  broom::tidy() %>% kable()\n\n\nSCRATCH\n\n\n\n\n\nApproach 2\nSource\n\nlibrary(\"did\")\nlibrary(\"broom\")\nlibrary(\"fixest\")\nlibrary(\"ggplot2\")\nlibrary(\"data.table\")\n\nsimulation6 = function() {\n  dat = CJ(firm = 1:1000, year = 1980:2015)     [\n    , time_fe := rnorm(1, sd = .5), by = \"year\"][\n    , unit_fe := rnorm(1, sd = .5), by = \"firm\"][\n    , state := sample(1:50, 1), by = \"firm\"    ]\n\n  setkey(dat, state, firm, year)\n\n  treatment_groups = data.table(\n    state = c(1, 18, 35),\n    cohort = c(1989, 1998, 2007),\n    hat_gamma = c(.5, .3, .1))\n  dat = treatment_groups[dat, roll = TRUE, on = \"state\"]\n\n  dat                                                [\n    , treat  := as.numeric(year >= cohort)          ][\n    , gamma  := rnorm(.N, mean = hat_gamma, sd = .2)][\n    , tau    := fifelse(treat == 1, gamma, 0)       ][\n    , cumtau := cumsum(tau), by = \"firm\"            ][\n    , error  := rnorm(.N, 0, .5)                    ][\n    , y := unit_fe + time_fe + cumtau + error       ][\n    , time_to_treat := year - cohort                ]\n\n  return(dat)\n}\n\ndat = simulation6()\n\n\netwfe = feols(y ~ treat : factor(time_to_treat) : factor(cohort) | firm + year, data = dat)\n\n# Clean the results\netwfe = as.data.table(tidy(etwfe))\netwfe = etwfe[\n    , .(term = term, etwfe = estimate)][\n    , group := as.numeric(gsub(\".*cohort.\", \"\", term))][\n    , year := as.numeric(gsub(\".*time_to_treat.(\\\\d+).*\", \"\\\\1\", term)) + group][\n    , .(group, year, etwfe)]\n\n\ncsa = att_gt(\n    yname = \"y\",\n    gname = \"cohort\",\n    idname = \"firm\",\n    tname = \"year\",\n    control_group = \"notyettreated\",\n    data = dat)\n\n# Clean the results\ncsa = data.table(group = csa$group, year = csa$t, csa = csa$att)\n\n\n# merge the TWFE and CSA results\nresults = merge(etwfe, csa, by = c(\"group\", \"year\"))\ncolnames(results) = c(\"Cohort\", \"Year\", \"TWFE w/ interactions\", \"CSA (2021)\")\nresults[, Cohort := factor(Cohort)]\n\ndat_plot = melt(results, id.vars = c(\"Cohort\", \"Year\"))\nggplot(dat_plot, aes(Year, value, color = variable, linetype = Cohort)) +\n  geom_line(size = 1.4) +\n  theme_minimal() +\n  labs(x = \"Year\", y = \"ATT\", color = \"Estimator\", linetype = \"Cohort\")\n\n\nggplot(results, aes(`TWFE w/ interactions`, `CSA (2021)`, color = Cohort)) +\n  geom_point(size = 2) +\n  geom_abline(intercept = 0, slope = 1) +\n  labs(title = \"On the 45 degree line, estimates of the group-time ATT\\nare identical under the two strategies.\") +\n  theme_minimal()"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Advanced Program and Policy Evaluation",
    "section": "",
    "text": "Schedule\n    \n    \n  \n  \n    \n      \n      \n      \n    \n  \n  \n    \n      August 24, 2022\n    \n    8:45 AM\n10:45 AM\nCourse Introduction and Mechanics\n    \n      August 31, 2022\n    \n    8:45 AM\n10:45 AM\nSimulation as a Guide for Study Design, Estimation, and Inference\n    \n      September 7, 2022\n    \n    8:45 AM\n10:45 AM\nPanel Data Methods I: Fixed, Random, and Correlated Random Effects Estimation\n    \n      September 14, 2022\n    \n    8:45 AM\n10:45 AM\nPanel Data II: Extended Difference-in-Differences\n    \n      September 21, 2022\n    \n    8:45 AM\n10:45 AM\nNext Generation Difference-in-Differences Estimators\n    \n      September 28, 2022\n    \n    8:45 AM\n10:45 AM\nNonlinear Differences-in-Differences and Functional Form Considerations\n    \n      October 5, 2022\n    \n    8:45 AM\n10:45 AM\nInterrupted Time Series vs. Differences-in-Differences (Guest Lecture by Dr. Carrie Fry)\n    \n      October 12, 2022\n    \n    8:45 AM\n10:45 AM\nNO CLASS\n    \n      October 19, 2022\n    \n    8:45 AM\n8:45 AM\nPeer Review Writeup Due\n    8:45 AM\n10:45 AM\nNO CLASS\n    \n      October 26, 2022\n    \n    8:45 AM\n10:45 AM\nStatistical Inference for Policy Evaluation\n    \n      November 2, 2022\n    \n    8:45 AM\n10:45 AM\nNon-Parallel Trends and Conditional DID, Synthetic Control Methods\n    \n      November 9, 2022\n    \n    8:45 AM\n10:45 AM\nQuantile Treatment Effects and Changes-in-Changes\n    \n      November 16, 2022\n    \n    8:45 AM\n8:45 AM\nDraft Methods Writeup Due to Peer Reviewer\n    8:45 AM\n10:45 AM\nPartial Identification Methods: Treatment Effect Bounds\n    \n      December 1, 2022\n    \n    8:45 AM\n8:45 AM\nYour Review of Your Peer's Methods Writeup is Due Back to Them\n    8:45 AM\n10:45 AM\nResearch Project Organization, Execution and Workflows: Best Practices\n    \n      December 8, 2022\n    \n    8:45 AM\n8:45 AM\nFinal Methods Writeup Due to John\n    8:45 AM\n10:45 AM\nStudent Methods Presentations\n    \n      \n    \n    8:45 AM\n8:45 AM\nGEE\n  \n  \n  \n\n\n\n\n\n\n\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "blog/posts/extended-difference-in-differences.html#common-treatment-timing",
    "href": "blog/posts/extended-difference-in-differences.html#common-treatment-timing",
    "title": "A Practical Guide to Extended Difference-in-Differences",
    "section": "Common Treatment Timing",
    "text": "Common Treatment Timing\n\n\n\n\n\n\n\n\nMethod\nEstimation Formula\nFixed or Random Effect\n\n\n\n\nTwo-Way Fixed Effects\nfeols(I(w : f*) + factor(time)  | unit)\nUnit Fixed Effect\n\n\nPooled OLS\nlm(I(w : f*) + factor(time) + d*)\n\n\n\nTwo-Way Mundlak\nlmer(I(w : f*) + factor(time) + d* + (1|unit)\nUnit Random Effect"
  },
  {
    "objectID": "blog/posts/extended-difference-in-differences.html#staggered-treatment-timing",
    "href": "blog/posts/extended-difference-in-differences.html#staggered-treatment-timing",
    "title": "A Practical Guide to Extended Difference-in-Differences",
    "section": "Staggered Treatment Timing",
    "text": "Staggered Treatment Timing\n\n\n\n\n\n\n\n\nMethod\nEstimation Formula\nFixed or Random Effect\n\n\n\n\nTwo-Way Fixed Effects\nfeols(I(d* : f*) + factor(time)  | unit)\nUnit Fixed Effect\n\n\nPooled OLS\nlm(I(d* : f*) + factor(time) + d*)\n\n\n\nTwo-Way Mundlak\nlmer(I(d* : f*) + factor(time) + d* + (1|unit)\nUnit Random Effect"
  },
  {
    "objectID": "blog/posts/extended-difference-in-differences.html#staggered-treatment-timing-with-covariates",
    "href": "blog/posts/extended-difference-in-differences.html#staggered-treatment-timing-with-covariates",
    "title": "A Practical Guide to Extended Difference-in-Differences",
    "section": "Staggered Treatment Timing with Covariate(s)",
    "text": "Staggered Treatment Timing with Covariate(s)\n\n\n\n\n\n\n\n\nMethod\nEstimation Formula\nFixed or Random Effect\n\n\n\n\nTwo-Way Fixed Effects\nfeols(I(w : d* : f*) + I(w : d* : f* : x_dm_d*) + factor(time) + I(factor(time) * x_dm_d*) | unit)\nUnit Fixed Effect\n\n\nPooled OLS\nlm(I(w : d* : f*) + I(w: d* : f* : x_dm_d*) + factor(time) + I(factor(time) : x_dm_d*) + d* + x + I(d* : x_dm_d*))\n\n\n\nTwo-Way Mundlak\nlmer(I(w : d* : f*) + I(w: d* : f* : x_dm_d*) + factor(time) + I(factor(time) : x_dm_d*) + d* +  x + I(d* : x_dm_d*) + (1|unit)\nUnit Random Effect\n\n\n\n\nff_twfe <- as.formula(paste0(\"y_it ~\",paste0(cohort_year_interactions$i,collapse=\"+\"),\"+ factor(year) | unit\"))\nfit_twfe <- feols(ff_twfe, data = df_)\n\nff_pols <- as.formula(paste0(\"y_it ~\",paste0(cohort_year_interactions$i,collapse=\"+\"),\"+\",paste0(grep(\"^d_\",colnames(df_), value=TRUE),collapse=\"+\"),\"+ factor(year)\"))\nfit_pols <- lm(ff_pols,data = df_)\n\nff_re <- as.formula(paste0(\"y_it ~\",paste0(cohort_year_interactions$i,collapse=\"+\"),\"+\",paste0(grep(\"^d_\",colnames(df_), value=TRUE),collapse=\"+\"),\"+ factor(year) + (1| unit)\"))\nfit_re <- lmer(ff_re, data = df_)\n\n\n\n\n\n\n\n  \n  \n    \n      Estimator\n      Regression Call\n    \n  \n  \n    TWFE\nfeols(y_it ~ I(d_1989 * f_1989) + I(d_1989 * f_1990) + I(d_1989 * f_1991) +      I(d_1989 * f_1992) + I(d_1989 * f_1993) + I(d_1989 * f_1994) +      I(d_1989 * f_1995) + I(d_1989 * f_1996) + I(d_1989 * f_1997) +      I(d_1989 * f_1998) + I(d_1989 * f_1999) + I(d_1989 * f_2000) +      I(d_1989 * f_2001) + I(d_1989 * f_2002) + I(d_1989 * f_2003) +      I(d_1989 * f_2004) + I(d_1989 * f_2005) + I(d_1989 * f_2006) +      I(d_1989 * f_2007) + I(d_1989 * f_2008) + I(d_1989 * f_2009) +      I(d_1989 * f_2010) + I(d_1989 * f_2011) + I(d_1989 * f_2012) +      I(d_1989 * f_2013) + I(d_1989 * f_2014) + I(d_1989 * f_2015) +      I(d_1998 * f_1998) + I(d_1998 * f_1999) + I(d_1998 * f_2000) +      I(d_1998 * f_2001) + I(d_1998 * f_2002) + I(d_1998 * f_2003) +      I(d_1998 * f_2004) + I(d_1998 * f_2005) + I(d_1998 * f_2006) +      I(d_1998 * f_2007) + I(d_1998 * f_2008) + I(d_1998 * f_2009) +      I(d_1998 * f_2010) + I(d_1998 * f_2011) + I(d_1998 * f_2012) +      I(d_1998 * f_2013) + I(d_1998 * f_2014) + I(d_1998 * f_2015) +      factor(year) | unit, data = df_)\n    POLS\nlm(y_it ~ I(d_1989 * f_1989) + I(d_1989 * f_1990) + I(d_1989 * f_1991) +      I(d_1989 * f_1992) + I(d_1989 * f_1993) + I(d_1989 * f_1994) +      I(d_1989 * f_1995) + I(d_1989 * f_1996) + I(d_1989 * f_1997) +      I(d_1989 * f_1998) + I(d_1989 * f_1999) + I(d_1989 * f_2000) +      I(d_1989 * f_2001) + I(d_1989 * f_2002) + I(d_1989 * f_2003) +      I(d_1989 * f_2004) + I(d_1989 * f_2005) + I(d_1989 * f_2006) +      I(d_1989 * f_2007) + I(d_1989 * f_2008) + I(d_1989 * f_2009) +      I(d_1989 * f_2010) + I(d_1989 * f_2011) + I(d_1989 * f_2012) +      I(d_1989 * f_2013) + I(d_1989 * f_2014) + I(d_1989 * f_2015) +      I(d_1998 * f_1998) + I(d_1998 * f_1999) + I(d_1998 * f_2000) +      I(d_1998 * f_2001) + I(d_1998 * f_2002) + I(d_1998 * f_2003) +      I(d_1998 * f_2004) + I(d_1998 * f_2005) + I(d_1998 * f_2006) +      I(d_1998 * f_2007) + I(d_1998 * f_2008) + I(d_1998 * f_2009) +      I(d_1998 * f_2010) + I(d_1998 * f_2011) + I(d_1998 * f_2012) +      I(d_1998 * f_2013) + I(d_1998 * f_2014) + I(d_1998 * f_2015) +      d_1989 + d_1998 + factor(year), data = df_)\n    TWM\nlmer(y_it ~ I(d_1989 * f_1989) + I(d_1989 * f_1990) + I(d_1989 * f_1991) +      I(d_1989 * f_1992) + I(d_1989 * f_1993) + I(d_1989 * f_1994) +      I(d_1989 * f_1995) + I(d_1989 * f_1996) + I(d_1989 * f_1997) +      I(d_1989 * f_1998) + I(d_1989 * f_1999) + I(d_1989 * f_2000) +      I(d_1989 * f_2001) + I(d_1989 * f_2002) + I(d_1989 * f_2003) +      I(d_1989 * f_2004) + I(d_1989 * f_2005) + I(d_1989 * f_2006) +      I(d_1989 * f_2007) + I(d_1989 * f_2008) + I(d_1989 * f_2009) +      I(d_1989 * f_2010) + I(d_1989 * f_2011) + I(d_1989 * f_2012) +      I(d_1989 * f_2013) + I(d_1989 * f_2014) + I(d_1989 * f_2015) +      I(d_1998 * f_1998) + I(d_1998 * f_1999) + I(d_1998 * f_2000) +      I(d_1998 * f_2001) + I(d_1998 * f_2002) + I(d_1998 * f_2003) +      I(d_1998 * f_2004) + I(d_1998 * f_2005) + I(d_1998 * f_2006) +      I(d_1998 * f_2007) + I(d_1998 * f_2008) + I(d_1998 * f_2009) +      I(d_1998 * f_2010) + I(d_1998 * f_2011) + I(d_1998 * f_2012) +      I(d_1998 * f_2013) + I(d_1998 * f_2014) + I(d_1998 * f_2015) +      d_1989 + d_1998 + factor(year) + (1 | unit), data = df_)"
  },
  {
    "objectID": "blog/posts/a-comparison-of-difference-in-difference-estimators.html",
    "href": "blog/posts/a-comparison-of-difference-in-difference-estimators.html",
    "title": "Fourteen Difference-in-Difference Estimators Walk Into a Bar …",
    "section": "",
    "text": "Setup\n\n\n\n\nset.seed(23)\nsim6b <- params6b %>% make_data(N = 500, start = 2008, stop = 2022, rho_t=0.8) \nsim6b %>% plot_data()\ndf_sim6b <- sim6b %>% pluck(\"df\") %>% prepare()\nsim6b_truth <- sim6b$truth\nsim6b_desc <- sim6b$params$desc\nsim6b_est <- df_sim6b %>% estimate()\nsim6b_res <- sim6b_est %>% discriminate(truth = sim6b$truth)\nplan(multisession,workers=parallel::detectCores()-1)\nres6b <-\n  with_progress({\n    gen_est_disc(1:100, params = params6b, start = 2008, stop = 2022, rho_t = 0.8, N = 500)\n\n  })\n\n\np_df6b <-\n  res6b %>%\n  bind_rows() %>%\n  group_by(rel_time) %>%\n  summarise_all(mean) %>%\n  gather(estimator,estimate,-rel_time) %>%\n  filter(estimator!=\"truth\")\n\nests <- p_df6b$estimator %>% unique()\n\np_df6b_ <-\n  ests %>%\n    map_df(~({\n      res6b[[1]] %>%\n        select(rel_time,truth) %>%\n        gather(estimator,estimate,-rel_time) %>%\n        mutate(estimator_p = estimator) %>%\n        mutate(estimator=.x)\n    }))\n\n\n\np_df6b %>% mutate(estimator = ests_lut[estimator]) %>%\n  ggplot(aes(x = rel_time, y = estimate)) +\n  geom_point() +\n  geom_line() +\n  geom_line(data = p_df6b_ %>% mutate(estimator = ests_lut[estimator]), colour = \"red\") +\n  hrbrthemes::theme_ipsum() +\n  #ggsci::scale_color_aaas()+\n  #scale_y_continuous(limits = c(0,5.5)) +\n  #scale_x_continuous(expand=c(0.25,0), breaks = seq(0,10,1)) +\n  #geom_dl(method = list(\"last.bumpup\"),aes(label = estimator))+\n  #geom_dl(method = list(\"first.bumpup\"),aes(label = estimator))+\n  theme(legend.position=\"none\") +\n  facet_wrap(~estimator, scales = \"free\") +\n  labs(x = \"Relative Time\\n(Note: Truth is Shown in Red\", y = \"Estimate\") +\n  ggtitle(\"Staggered Enty\\nHeterogeneous Dynamic Treatment Effects\")"
  },
  {
    "objectID": "blog/posts/quasi-demeaning.html",
    "href": "blog/posts/quasi-demeaning.html",
    "title": "Quasi-Demeaning: The Relationship Between Fixed and Random Effects",
    "section": "",
    "text": "Setup\n\nlibrary(tidyverse)\n\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──\n✔ ggplot2 3.3.6      ✔ purrr   0.3.4 \n✔ tibble  3.1.8      ✔ dplyr   1.0.10\n✔ tidyr   1.2.1      ✔ stringr 1.4.1 \n✔ readr   2.1.2      ✔ forcats 0.5.2 \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n\nlibrary(lme4)\n\nLoading required package: Matrix\n\nAttaching package: 'Matrix'\n\nThe following objects are masked from 'package:tidyr':\n\n    expand, pack, unpack\n\nlibrary(broom)\nlibrary(knitr)\ntheme_set(theme_bw())\n\n\n\nCode\nparams_panel <- list(\n  N = 1000,\n  T = 2,\n  tx_time = 2, \n  rho_t = 0.8,\n  beta_0 = 0.5,\n  beta_1 = 2,\n  tau = 0.5,\n  p_d = 0.5\n)\n\ndgp_panel <- function(params) {\n  with(params, {\n\n    # Time effects\n    t_ <-\n      data.frame(t = 1:T,\n                 gamma_t = arima.sim(n=T, list(ar = rho_t, order=c(1,0,0))) %>% as.vector())\n\n    # Individual measures and effects\n    i_ <-\n      data.frame(\n        unit_id = 1:N,\n        x_i = rnorm(N, mean = 0, sd = 1),\n        u_i = rnorm(N, mean = 0, sd = 1)) %>%\n      rowwise() %>% # This allows us to get each value's pr_treated in the line below. \n      mutate(pr_treated = boot::inv.logit(u_i)) %>% \n      ungroup() %>%  # This undoes the rowwise \n      # Treatment indicator\n      mutate(d_i = rbinom(N, size = 1, prob = pr_treated)) %>% \n      ungroup()\n\n    crossing(unit_id = i_$unit_id,t = t_$t) %>%\n      left_join(i_,\"unit_id\") %>%\n      left_join(t_,\"t\") %>%\n      mutate(d_i = ifelse(t<tx_time,0,d_i)) %>%\n      mutate(y_i = beta_0 + beta_1 * x_i + tau * d_i + u_i + gamma_t + rnorm(N, mean = 0, sd = 1)) %>% \n      select(unit_id, t, y_i , x_i, d_i)\n  })\n}\n\nestimator_fn_re <- function(df) {\n  lmer(y_i ~  d_i + (1|unit_id) , df)\n}\n\ndisc_fn_re <- function(fit) {\n  fit %>% summary() %>% pluck(\"coefficients\") %>%\n    data.frame() %>%\n    rownames_to_column() %>%\n    janitor::clean_names() %>%\n    filter(rowname==\"d_i\") %>%\n    pull(estimate) %>%\n    as.vector()\n}\n\ngenerate_estimate_discriminate_re <- function(params) {\n  params %>% # Step 1: Parameterize the problem\n      dgp_panel() %>%  # Step 2: Define the data generation process\n        estimator_fn_re() %>%  # Step 3: Estimate \n          disc_fn_re() %>% # Step 4: Pull out what you need\n            data.frame(tau_hat = .) # store the result as a data frame object\n}\n\nconstruct_dm <- function(df) {\n  df_ <- \n    df %>% \n      # mutate(y_i = y_i + mean(y_i),\n      #       d_i = d_i + mean(d_i)) %>% \n      #       group_by(t) %>% \n      #       mutate(y_i = y_i - mean(y_i),\n      #       d_i = d_i - mean(d_i)) %>% \n            group_by(unit_id) %>% \n            mutate(y_i = y_i - mean(y_i),\n            d_i = d_i - mean(d_i))\n\n  return(df_)\n}\n\nestimate_dm <- function(df) {\n  lm(y_i ~ d_i   , data = df)\n}\n\ndisc_fn_dm = function(fit) {\n  fit_ =broom::tidy(fit)   # This cleans up the fitted regression object\n  out =fit_ %>% \n    filter(term==\"d_i\") %>% \n    pull(estimate)\n  \n  return(out)\n}\n\n\nset.seed(123)\ndf_c <- \n  modifyList(params_panel,list(T=400,tx_time=200)) %>% \n  dgp_panel() %>% \n  mutate(index = t-200) %>% \n  mutate(T2= as.integer(index %in% c(-1,0))) %>% \n  mutate(T4 = as.integer(index > -3 & index <2)) %>%\n  mutate(T10 = as.integer(index >= -5 & index<5)) %>% \n  mutate(T20 = as.integer(index >= -10 & index <10 )) %>%\n  mutate(T50 = 1 ) \n\ndf <- df_c %>% filter(T4==1)\n\nparams_panel %>% \n  dgp_panel() %>% \n  head() %>% \n  kable(digits=3)\n\n\n\n\n\nunit_id\nt\ny_i\nx_i\nd_i\n\n\n\n\n1\n1\n2.855\n0.502\n0\n\n\n1\n2\n2.825\n0.502\n0\n\n\n2\n1\n5.893\n1.434\n0\n\n\n2\n2\n7.620\n1.434\n1\n\n\n3\n1\n3.225\n2.166\n0\n\n\n3\n2\n6.555\n2.166\n0\n\n\n\n\n\nLet’s first show the equivalance between the random effect model and a quasi-demeaned linear regression model. We’ll do so by focusing on a case where \\(T=4\\).\n\nfit_re <- \n  df %>% \n  estimator_fn_re()\n\nsummary(fit_re)\n\nLinear mixed model fit by REML ['lmerMod']\nFormula: y_i ~ d_i + (1 | unit_id)\n   Data: df\n\nREML criterion at convergence: 14733.6\n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-2.0705 -0.7249  0.1037  0.6245  2.0637 \n\nRandom effects:\n Groups   Name        Variance Std.Dev.\n unit_id  (Intercept) 5.462    2.337   \n Residual             1.085    1.041   \nNumber of obs: 4000, groups:  unit_id, 1000\n\nFixed effects:\n            Estimate Std. Error t value\n(Intercept)  0.29151    0.07661   3.805\nd_i         -0.51889    0.04550 -11.403\n\nCorrelation of Fixed Effects:\n    (Intr)\nd_i -0.152\n\n\n\nNotice the use of the term “fixed effects” is based on a traditional statistical definition–these are the regression parameters not assumed to come from a stochastic (statsitical) distribution, such as the random effects.\n\nLet’s now extract out the variance parameter estimates \\(\\sigma^2_{\\epsilon}\\) and \\(\\sigma^2_u\\):\n\nget_re <- function(fit) {\n    x <- VarCorr(fit) %>% data.frame() %>% \n    tibble() %>% \n    select(grp,var1,vcov)\n}\n\nre_est <- \n  fit_re %>% \n  get_re()\n\n\n\n\n\n\ngrp\nvar1\nvcov\n\n\n\n\nunit_id\n(Intercept)\n5.462082\n\n\nResidual\nNA\n1.084670\n\n\n\n\n\nWe can then use these to calculatate \\(\\theta\\):\n\nsigma2_e = fit_re %>% get_re() %>% filter(grp==\"Residual\") %>% pull(vcov)\nsigma2_ui = fit_re %>% get_re() %>% filter(grp==\"unit_id\") %>% pull(vcov)\ntheta_i = 1 - sqrt(sigma2_e/(4*sigma2_ui + sigma2_e))\n\ntheta_i\n\n[1] 0.7825205\n\n\nNext we will create a quasi-demeaned version of our input data:\n\ndf_ <- \n  df %>% \n  group_by(unit_id) %>% \n  mutate(y_i = y_i - theta_i * mean(y_i),\n         d_i = d_i - theta_i * mean(d_i))\n\nWe now fit a quasi-demeaned\n\nfit_qdm <- lm(y_i ~ d_i, data = df_)\nsummary(fit_qdm)\n\n\nCall:\nlm(formula = y_i ~ d_i, data = df_)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-3.1586 -0.7768  0.0980  0.7425  3.2119 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  0.06340    0.01666   3.805 0.000144 ***\nd_i         -0.51889    0.04550 -11.403  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 1.041 on 3998 degrees of freedom\nMultiple R-squared:  0.0315,    Adjusted R-squared:  0.03126 \nF-statistic:   130 on 1 and 3998 DF,  p-value: < 2.2e-16\n\n\nNow let’s compare:\n\nres <- \n  fit_qdm %>% tidy() %>% \n  select(term,estimate_qdm = estimate) \n\ncbind(res,df %>% estimator_fn_re() %>% summary() %>% pluck(\"coefficients\") %>% \n  data.frame() %>% \n  select(estimate_re = Estimate)) %>% \n  mutate(theta = theta_i) %>% \n  select(term, estimate_re, estimate_qdm, theta) %>% \n  remove_rownames() %>% \n  kable(digits = 3)\n\n\n\n\nterm\nestimate_re\nestimate_qdm\ntheta\n\n\n\n\n(Intercept)\n0.292\n0.063\n0.783\n\n\nd_i\n-0.519\n-0.519\n0.783\n\n\n\n\n\n\n\nCode\nget_theta <- function(fit) {\n  sigma2_e = fit %>% get_re() %>% filter(grp==\"Residual\") %>% pull(vcov)\n  sigma2_ui = fit %>% get_re() %>% filter(grp==\"unit_id\") %>% pull(vcov)\n  theta = 1 - sqrt(sigma2_e/(4*sigma2_ui + sigma2_e))\n  theta \n}\n\nt_qdm <- tibble(\n  T2 = df_c %>% filter(T2==1) %>% estimator_fn_re() %>% disc_fn_re(),\n  theta2  = df_c %>% filter(T2==1) %>% estimator_fn_re() %>% get_theta(),\n  T2fe = df_c %>% filter(T2==1) %>% construct_dm() %>% estimate_dm() %>% disc_fn_dm()  ,\n  T4 = df_c %>% filter(T4==1) %>% estimator_fn_re() %>% disc_fn_re(),\n  theta4  = df_c %>% filter(T4==1) %>% estimator_fn_re() %>% get_theta(),\n  T4fe = df_c %>% filter(T4==1) %>% construct_dm() %>% estimate_dm() %>% disc_fn_dm()    ,\n  T10 = df_c %>% filter(T10==1) %>% estimator_fn_re() %>% disc_fn_re(),\n  theta10  = df_c %>% filter(T10==1) %>% estimator_fn_re() %>% get_theta(),  \n  T10fe = df_c %>% filter(T10==1) %>% construct_dm() %>% estimate_dm() %>% disc_fn_dm()   ,\n  T20 = df_c %>% filter(T20==1) %>% estimator_fn_re() %>% disc_fn_re(),\n  theta20  = df_c %>% filter(T20==1) %>% estimator_fn_re() %>% get_theta(),  \n  T20fe = df_c %>% filter(T20==1) %>% construct_dm() %>% estimate_dm() %>% disc_fn_dm()  ,\n  T400 = df_c %>%  estimator_fn_re() %>% disc_fn_re(),\n  theta400 =  df_c %>%  estimator_fn_re() %>% get_theta(),\n  T400fe = df_c %>% construct_dm() %>% estimate_dm() %>% disc_fn_dm()\n)\n  \nt_qdm %>% \n  select(-starts_with(\"theta\")) %>% \n  gather(measure,value) %>% \n  mutate(method = ifelse(grepl(\"fe\",measure),\"FE\",\"RE\")) %>% \n  mutate(measure = gsub(\"fe\",\"\",measure)) %>% \n  mutate(measure = case_when(measure == \"T2\" ~ \"T = 2\",\n                             measure == \"T4\" ~ \"T = 4\",\n                             measure == \"T10\" ~ \"T = 10\",\n                             measure == \"T20\" ~ \"T = 20\",\n                             measure == \"T400\" ~ \"T = 400\")) %>% \n  rename(time_periods = measure) %>% \n  spread(method, value) %>% \n  mutate(time_periods = factor(time_periods, levels = c(\"T = 2\",\"T = 4\", \"T = 10\",\"T = 20\" , \"T = 400\"))) %>% \n  arrange(time_periods) %>% \n  kable()"
  },
  {
    "objectID": "blog/drafts/gee.html",
    "href": "blog/drafts/gee.html",
    "title": "Generalized Estimating Equations",
    "section": "",
    "text": "library(tidyverse)\n\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──\n✔ ggplot2 3.3.6      ✔ purrr   0.3.4 \n✔ tibble  3.1.8      ✔ dplyr   1.0.10\n✔ tidyr   1.2.1      ✔ stringr 1.4.1 \n✔ readr   2.1.2      ✔ forcats 0.5.2 \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n\nlibrary(lme4)\n\nLoading required package: Matrix\n\nAttaching package: 'Matrix'\n\nThe following objects are masked from 'package:tidyr':\n\n    expand, pack, unpack\n\nlibrary(broom)\nlibrary(knitr)\nlibrary(gee)\ntheme_set(theme_bw())\noptions(\"scipen\" = 100, \"digits\" = 5)\n\n\n\n\n\n\nunit_id\nt\ny_i\nx_i\nd_i\n\n\n\n\n1\n1\n-1.542\n-1.368\n0\n\n\n1\n2\n-2.962\n-1.368\n1\n\n\n2\n1\n-2.419\n-0.414\n0\n\n\n2\n2\n-2.595\n-0.414\n0\n\n\n3\n1\n2.109\n0.668\n0\n\n\n3\n2\n0.208\n0.668\n1\n\n\n\n\n\n\nlibrary(geepack)\nlibrary(nlme)\n\n\nAttaching package: 'nlme'\n\n\nThe following object is masked from 'package:lme4':\n\n    lmList\n\n\nThe following object is masked from 'package:dplyr':\n\n    collapse\n\n#https://m-clark.github.io/clustered-data/gee.html\ngeeglm(y_i ~ d_i, data=df, id=unit_id)\n\n\nCall:\ngeeglm(formula = y_i ~ d_i, data = df, id = unit_id)\n\nCoefficients:\n(Intercept)         d_i \n    2.04211    -0.33648 \n\nDegrees of Freedom: 40000 Total (i.e. Null);  39998 Residual\n\nScale Link:                   identity\nEstimated Scale Parameters:  [1] 10.278\n\nCorrelation:  Structure = independence  \nNumber of clusters:   2000   Maximum cluster size: 20 \n\nlme(y_i ~ d_i, data=df, random = ~1|unit_id, \n                        control=lmeControl(opt='optim'), method='ML')  \n\nLinear mixed-effects model fit by maximum likelihood\n  Data: df \n  Log-likelihood: -93325\n  Fixed: y_i ~ d_i \n(Intercept)         d_i \n    2.13476    -0.70197 \n\nRandom effects:\n Formula: ~1 | unit_id\n        (Intercept) Residual\nStdDev:      2.2219   2.3165\n\nNumber of Observations: 40000\nNumber of Groups: 2000 \n\ndf %>% construct_dm() %>% estimate_dm() \n\n\nCall:\nlm(formula = y_i ~ d_i, data = df)\n\nCoefficients:\n         (Intercept)                   d_i  \n 0.00000000000000177  -0.73162297645096519  \n\ngee(y_i ~ x_i + d_i, data = df, id = unit_id,\n    family = gaussian,corstr=\"exchangeable\") %>% summary() %>% {.$coefficients} %>% {.[\"d_i\",]} %>% round(.,3)\n\nBeginning Cgee S-function, @(#) geeformula.q 4.13 98/01/27\n\n\nrunning glm to get initial regression estimate\n\n\n(Intercept)         x_i         d_i \n    2.03488     2.02944    -0.36911 \n\n\n   Estimate  Naive S.E.     Naive z Robust S.E.    Robust z \n     -0.611       0.031     -19.898       0.012     -50.426"
  },
  {
    "objectID": "blog/drafts/post1.html",
    "href": "blog/drafts/post1.html",
    "title": "Using Simulation to Calculate Power and Minimum Detectable Effects",
    "section": "",
    "text": "This posting will walk through the steps to perform power and minimum detectable effect calculations via simulation."
  },
  {
    "objectID": "blog/drafts/post1.html#power",
    "href": "blog/drafts/post1.html#power",
    "title": "Using Simulation to Calculate Power and Minimum Detectable Effects",
    "section": "Power",
    "text": "Power\n\nB = 1000\npower =\n    seq(100,1000,100) %>%\n    map(~(mc_replicate(B,est_power(modifyList(params,list(beta = .1,n=.x))),mc.cores=10))) %>%\n    map_dbl(~(mean(.x)))  %>%\n    data.frame(row.names = seq(100,1000,100)) %>%\n    rownames_to_column(var = \"N\") %>%\n    set_names(c(\"N\",\"power\")) %>%\n    as_tibble() %>%\n    mutate(N = as.numeric(paste0(N)))\npower %>% knitr::kable()\n\n\n\n\nN\npower\n\n\n\n\n100\n0.176\n\n\n200\n0.304\n\n\n300\n0.395\n\n\n400\n0.505\n\n\n500\n0.576\n\n\n600\n0.698\n\n\n700\n0.738\n\n\n800\n0.801\n\n\n900\n0.851\n\n\n1000\n0.886\n\n\n\n\npower %>%\n    ggplot(aes(x = N , y = power)) + geom_line() +\n    ggthemes::theme_few()"
  },
  {
    "objectID": "blog/drafts/twfe-twm-and-did.html",
    "href": "blog/drafts/twfe-twm-and-did.html",
    "title": "Two-Way Fixed Effects, the Two-Way Mundlak Regression, and Difference-in-Difference Estimators",
    "section": "",
    "text": "The objective of this posting is to walk through various data structuring and estimation issues for fitting two-way fixed effects, two-way Mundlak regressions, and difference-in-difference estimators.\nNote that this is adapted from staggered_6.do."
  },
  {
    "objectID": "blog/drafts/twfe-twm-and-did.html#data-setup",
    "href": "blog/drafts/twfe-twm-and-did.html#data-setup",
    "title": "Two-Way Fixed Effects, the Two-Way Mundlak Regression, and Difference-in-Difference Estimators",
    "section": "Data Setup",
    "text": "Data Setup\nFigure Figure 1 shows the first five rows of the raw data frame.\n\ndep_var is the outcome\ntreatment_time is the treatment group indicator set to the first treatment year for those treated, and set to missing for nontreated units.\nstate is the state of residence for the underlying unit.\nunit is the individual unit identifier\nyear is the time variable\ntreat takes a value of 1 if the unit is treated and the observation is in the post-treatment period.\n\n\n\nCode\ndf %>% \n  head(n=5) %>% \n  kable() %>% \n  kable_styling() %>%\n  scroll_box(width = \"100%\", height = \"400px\")\n\n\n\n\n\n\n\n\n\ndep_var\n\n\ntreatment_time\n\n\nstate\n\n\nunit\n\n\nyear\n\n\ntreat\n\n\n\n\n\n\n0.1832233\n\n\n1998\n\n\n8\n\n\n1\n\n\n1980\n\n\n0\n\n\n\n\n0.0480280\n\n\n1998\n\n\n8\n\n\n1\n\n\n1981\n\n\n0\n\n\n\n\n1.0665383\n\n\n1998\n\n\n8\n\n\n1\n\n\n1982\n\n\n0\n\n\n\n\n0.4692419\n\n\n1998\n\n\n8\n\n\n1\n\n\n1983\n\n\n0\n\n\n\n\n1.0057100\n\n\n1998\n\n\n8\n\n\n1\n\n\n1984\n\n\n0\n\n\n\n\n\n\nFigure 1: First five rows of data\n\n\n\nWe next need to construct a series of dummy indicators\n\nDefine all the years where at least one group is treated (treatment_years)\nDefine all the treated groups (treatment_groups)\n\n\n1. Define all the years where at least one group is treated (treatment_years)\n\ntreatment_years <-\n  df %>%\n  count(treat, year) %>%\n  filter(treat== 1 ) %>%\n  pull(year) %>%\n  as.vector()\ntreatment_years\n\n [1] \"1998\" \"1999\" \"2000\" \"2001\" \"2002\" \"2003\" \"2004\" \"2005\" \"2006\" \"2007\"\n[11] \"2008\" \"2009\" \"2010\" \"2011\" \"2012\" \"2013\" \"2014\" \"2015\"\n\n\n\n\n2. Define all the treated groups (treatment_groups)\n\ntreatment_groups <-\n  unique(df[df$treatment_time != 0 & !is.na(df$treatment_time),]$treatment_time) %>% \n  paste()\ntreatment_groups\n\n[1] \"1998\"\n\n\nWe will next structure the model matrix to fit the regression models. This involves:\n\nCreating dummy variables for all treatment times, but limiting the final set to only those times identified by treatment_times above.\nCreating dummy variables for all treatment groups.\n\nWe will also prefix all dummy variables created in (1) with f and those created in (2) with d. Figure Figure 2 shows the final data frame used for the regressions.\n\ndf_ <-\n  df %>%\n  mutate(treatment_time = ifelse(is.na(treatment_time),0,as.numeric(paste0(treatment_time)))) %>% \n  select(y = dep_var,w = treat, id = unit,year, treatment_time) %>%\n  fastDummies::dummy_cols(c(\"year\",\"treatment_time\")) %>%\n  select_at(vars(y,w,id,year,glue(\"year_{treatment_years}\") %>% as.vector(),\n                 glue(\"treatment_time_{treatment_groups}\"))) %>%\n  rename_at(vars(starts_with(\"year_\")),~gsub(\"year_\",\"f\",.)) %>%\n  rename_at(vars(starts_with(\"treatment_time_\")),~gsub(\"treatment_time_\",\"d\",.))\n\n\n\nCode\ndf_ %>% \n  head(n=5) %>% \n  kable() %>% \n  kable_styling() %>%\n  scroll_box(width = \"100%\", height = \"300px\")\n\n\n\n\n\n\n\n\n\ny\n\n\nw\n\n\nid\n\n\nyear\n\n\nf1998\n\n\nf1999\n\n\nf2000\n\n\nf2001\n\n\nf2002\n\n\nf2003\n\n\nf2004\n\n\nf2005\n\n\nf2006\n\n\nf2007\n\n\nf2008\n\n\nf2009\n\n\nf2010\n\n\nf2011\n\n\nf2012\n\n\nf2013\n\n\nf2014\n\n\nf2015\n\n\nd1998\n\n\n\n\n\n\n0.1832233\n\n\n0\n\n\n1\n\n\n1980\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n0.0480280\n\n\n0\n\n\n1\n\n\n1981\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n1.0665383\n\n\n0\n\n\n1\n\n\n1982\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n0.4692419\n\n\n0\n\n\n1\n\n\n1983\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n1.0057100\n\n\n0\n\n\n1\n\n\n1984\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n0\n\n\n1\n\n\n\n\n\n\nFigure 2: First five rows of data"
  },
  {
    "objectID": "blog/drafts/twfe-twm-and-did.html#estimate-models",
    "href": "blog/drafts/twfe-twm-and-did.html#estimate-models",
    "title": "Two-Way Fixed Effects, the Two-Way Mundlak Regression, and Difference-in-Difference Estimators",
    "section": "Estimate Models",
    "text": "Estimate Models\nWe next estimate the models\n\n\n\n\n\n\n\n\n\nMethod\nCommand\nDesign Variables\nFixed or Random Effect\n\n\n\n\nTwo-Way Fixed Effects\nfeols()\nw + f*\nUnit Fixed Effect\n\n\nPooled OLS\nlm()\nw + f* + d*\n\n\n\nTwo-Way Mundlak\nlmer()\nw + f* + d*\nUnit Random Effect\n\n\n\n\n\nCode\n# TWFE\nfmla_twfe1 <- glue(\"y ~ w + {paste0('f',treatment_years,collapse= '+')} | id \") %>% as.formula()\nfit_twfe1 <- feols(fmla_twfe1, data = df_)\nest_twfe1 <- tibble(method = \"TWFE\", estimate = coef(fit_twfe1)[\"w\"], formula = glue(\"feols({Reduce(paste,deparse(fmla_twfe1))}, data = df_)\"))\n\n# Alternative version based on a standard TWFE regression. \nfmla_twfe1_v2 <- glue(\"y ~ w + factor(year) | id \") %>% as.formula()\nfit_twfe1_v2 <- feols(fmla_twfe1_v2, data = df_) \nest_twfe1_v2 <- tibble(method = \"TWFE-V2\", estimate = coef(fit_twfe1_v2)[\"w\"], formula = glue(\"feols({Reduce(paste,deparse(fmla_twfe1_v2))}, data = df_)\"))\n\n# POLS\nfmla_lm1 <- glue(\"y ~ w + {paste0('f',treatment_years,collapse= '+')} + {paste0('d',treatment_groups,collapse= '+')}\") %>% as.formula()\nfit_lm1 <- lm(fmla_lm1, data = df_) \nest_lm1 <- tibble(method = \"POLS\", estimate = coef(fit_lm1)[\"w\"], formula = glue(\"lm({Reduce(paste,deparse(fmla_lm1))}, data = df_)\"))\n\n# TWM \nfmla_twm1 <- glue(\"y ~ w + {paste0('f',treatment_years,collapse= '+')} + {paste0('d',treatment_groups,collapse= '+')} + (1|id)\") %>% as.formula()\nfit_twm1 <- lmer( fmla_twm1 , data = df_) \nest_twm1 <- tibble(method = \"TWM\", estimate = coef(summary(fit_twm1))[\"w\",][1] %>% unname(), formula = glue(\"lmer({Reduce(paste,deparse(fmla_twm1))}, data = df_)\"))\n\n# CS\ndata1_cs <- \n  data1 %>% \n  mutate(year = as.numeric(paste0(year)),\n         treatment_time = as.numeric(paste0(treatment_time)))  %>% \n  mutate(treatment_time = ifelse(is.na(treatment_time),0,treatment_time))\n\n\nWarning in mask$eval_all_mutate(quo): NAs introduced by coercion\n\n\nCode\nfit_cs1 <- att_gt(yname = \"dep_var\",\n                  tname = \"year\",\n                  idname = \"unit\",\n                  gname = \"treatment_time\",\n                  control_group = \"notyettreated\",\n                  data = data1_cs\n)\n\nest_cs1 <-  tibble(group = paste0(fit_cs1$group), year = fit_cs1$t, estimate = fit_cs1$att) %>% \n  mutate(method = \"CS\") \n\ntibble(method = c(\"TWFE\",\"TWFE-V2\",\"POLS\",\"TWM\"),\n         formula = c(glue(\"feols({Reduce(paste,deparse(fmla_twfe1))}, data = df_)\"),\n                     glue(\"feols({Reduce(paste,deparse(fmla_twfe1_v2))}, data = df_)\"),\n                     glue(\"lm({Reduce(paste,deparse(fmla_lm1))}, data = df_)\"),\n                     glue(\"lmer({Reduce(paste,deparse(fmla_twm1))}, data = df_)\"))) %>% \n  gt() %>% \n  cols_label(\"method\" = \"Estimator\",\n             \"formula\" = \"Regression Call\")\n\n\n\n\n\n\n  \n  \n    \n      Estimator\n      Regression Call\n    \n  \n  \n    TWFE\nfeols(y ~ w + f1998 + f1999 + f2000 + f2001 + f2002 + f2003 + f2004 +      f2005 + f2006 + f2007 + f2008 + f2009 + f2010 + f2011 + f2012 +      f2013 + f2014 + f2015 | id, data = df_)\n    TWFE-V2\nfeols(y ~ w + factor(year) | id, data = df_)\n    POLS\nlm(y ~ w + f1998 + f1999 + f2000 + f2001 + f2002 + f2003 + f2004 +      f2005 + f2006 + f2007 + f2008 + f2009 + f2010 + f2011 + f2012 +      f2013 + f2014 + f2015 + d1998, data = df_)\n    TWM\nlmer(y ~ w + f1998 + f1999 + f2000 + f2001 + f2002 + f2003 + f2004 +      f2005 + f2006 + f2007 + f2008 + f2009 + f2010 + f2011 + f2012 +      f2013 + f2014 + f2015 + d1998 + (1 | id), data = df_)"
  },
  {
    "objectID": "blog/drafts/twfe-twm-and-did.html#summary-of-estimates",
    "href": "blog/drafts/twfe-twm-and-did.html#summary-of-estimates",
    "title": "Two-Way Fixed Effects, the Two-Way Mundlak Regression, and Difference-in-Difference Estimators",
    "section": "Summary of Estimates",
    "text": "Summary of Estimates\nTable Figure 3 summarizes the treatment effect estimates across all three approaches. These estimates are also plotted as lines in Figure 4.\n\n\nCode\nest1 <- \n  est_twfe1 %>% \n  bind_rows(est_twfe1_v2) %>% \n  bind_rows(est_lm1) %>% \n  bind_rows(est_twm1) \n\nest1 %>% \n  select(-formula) %>% \n  mutate(group = \"Intervention\") %>% \n  spread(method,estimate) %>% \n  mutate(truth = df1$truth %>% filter(type==\"Static\") %>% pull(mu_truth))  %>% \n  gt::gt() %>%\n  fmt_number(columns = c(TWFE,`TWFE-V2`,TWM, POLS),decimals=3) %>% \n  cols_label(\"group\" = \"\",\n             \"truth\"= \"Truth\")\n\n\n\n\n\n\n\n  \n  \n    \n      \n      POLS\n      TWFE\n      TWFE-V2\n      TWM\n      Truth\n    \n  \n  \n    Intervention\n1.983\n1.983\n1.983\n1.983\n2\n  \n  \n  \n\n\nFigure 3: Summary of Estimates - Common Treatment Time, Constant Treatment Effects\n\n\n\n\n\nCode\ndf_est1 <- crossing(group= treatment_groups, year = treatment_years) %>% \n                      as_tibble() %>%\n                      mutate(tmp = 1) %>% \n                      left_join(est1 %>% mutate(tmp=1)) %>% \n              mutate(year = as.numeric(paste0(year))) %>% \n  bind_rows(est_cs1 )\n  \nplot_data(df1) + \n  geom_line(data = df_est1, aes(x = year, y = estimate, colour = factor(group),lty=factor(method)), lwd=2)  +\n  theme(legend.position=\"bottom\") \n\n\n\n\n\nFigure 4: Treatment Effect Estimates"
  },
  {
    "objectID": "blog/drafts/twfe-twm-and-did.html#estimate-models-1",
    "href": "blog/drafts/twfe-twm-and-did.html#estimate-models-1",
    "title": "Two-Way Fixed Effects, the Two-Way Mundlak Regression, and Difference-in-Difference Estimators",
    "section": "Estimate Models",
    "text": "Estimate Models\nWe next estimate the models\n\n\n\n\n\n\n\n\n\nMethod\nCommand\nDesign Variables\nFixed or Random Effect\n\n\n\n\nTwo-Way Fixed Effects\nfeols()\nw : f* + f*\nUnit Fixed Effect\n\n\nPooled OLS\nlm()\nw : f* + f* + d*\n\n\n\nTwo-Way Mundlak\nlmer()\nw : f* + f* + d*\nUnit Random Effect\n\n\n\n\n\nCode\nfmla_twfe2 <- glue(\"y ~ {paste0('w : ',paste0('f',treatment_years2), collapse = ' + ')} + {paste0('f',treatment_years2,collapse=' + ')} | id\") %>% as.formula()\nfmla_twfe2 <- glue(\"y ~ {paste0('w : ',paste0('f',treatment_years2), collapse = ' + ')} + factor(year) | id\") %>% as.formula()\nfit_twfe2 <- feols(fmla_twfe2, data = df_)\n\nfmla_lm2 <- glue(\"y ~ {paste0('w : ',paste0('f',treatment_years2), collapse = ' + ')} + {paste0('f',treatment_years2,collapse=' + ')} + {paste0('d',treatment_groups2,collapse= '+')}\") %>% as.formula()\nfmla_lm2 <- glue(\"y ~ {paste0('w : ',paste0('f',treatment_years2), collapse = ' + ')} + factor(year) + {paste0('d',treatment_groups2,collapse= '+')}\") %>% as.formula()\nfit_lm2 <- lm(fmla_lm2, data = df_) \n\nfmla_twm2 <- glue(\"y ~ {paste0('w : ',paste0('f',treatment_years2), collapse = ' + ')} + factor(year) + {paste0('d',treatment_groups2,collapse= '+')} + (1|id)\") %>% as.formula()\nfit_twm2 <- lmer( fmla_twm2 , data = df_) \n\n# CS\ndata2_cs <- \n  data2 %>% \n  mutate(year = as.numeric(paste0(year)),\n         treatment_time = as.numeric(paste0(treatment_time)))  %>% \n  mutate(treatment_time = ifelse(is.na(treatment_time),0,treatment_time))\n\n\nWarning in mask$eval_all_mutate(quo): NAs introduced by coercion\n\n\nCode\nfit_cs2 <- att_gt(yname = \"dep_var\",\n                  tname = \"year\",\n                  idname = \"unit\",\n                  gname = \"treatment_time\",\n                  control_group = \"notyettreated\",\n                  data = data2_cs\n)\n\nest_cs2 <-  tibble(group = paste0(fit_cs2$group), year = fit_cs2$t, estimate = fit_cs2$att) %>% \n  mutate(method = \"CS\")  \n\n  tibble(method = c(\"TWFE\",\"POLS\",\"TWM\"),\n         formula = c(glue(\"feols({Reduce(paste,deparse(fmla_twfe2))}, data = df_)\"),\n                     glue(\"lm({Reduce(paste,deparse(fmla_lm2))}, data = df_)\"),\n                     glue(\"lmer({Reduce(paste,deparse(fmla_twm2))}, data = df_)\"))) %>% \n  gt() %>% \n  cols_label(\"method\" = \"Estimator\",\n             \"formula\" = \"Regression Call\")\n\n\n\n\n\n\n  \n  \n    \n      Estimator\n      Regression Call\n    \n  \n  \n    TWFE\nfeols(y ~ w:f1998 + w:f1999 + w:f2000 + w:f2001 + w:f2002 + w:f2003 +      w:f2004 + w:f2005 + w:f2006 + w:f2007 + w:f2008 + w:f2009 +      w:f2010 + w:f2011 + w:f2012 + w:f2013 + w:f2014 + w:f2015 +      factor(year) | id, data = df_)\n    POLS\nlm(y ~ w:f1998 + w:f1999 + w:f2000 + w:f2001 + w:f2002 + w:f2003 +      w:f2004 + w:f2005 + w:f2006 + w:f2007 + w:f2008 + w:f2009 +      w:f2010 + w:f2011 + w:f2012 + w:f2013 + w:f2014 + w:f2015 +      factor(year) + d1998, data = df_)\n    TWM\nlmer(y ~ w:f1998 + w:f1999 + w:f2000 + w:f2001 + w:f2002 + w:f2003 +      w:f2004 + w:f2005 + w:f2006 + w:f2007 + w:f2008 + w:f2009 +      w:f2010 + w:f2011 + w:f2012 + w:f2013 + w:f2014 + w:f2015 +      factor(year) + d1998 + (1 | id), data = df_)"
  },
  {
    "objectID": "blog/drafts/twfe-twm-and-did.html#summary-of-estimates-1",
    "href": "blog/drafts/twfe-twm-and-did.html#summary-of-estimates-1",
    "title": "Two-Way Fixed Effects, the Two-Way Mundlak Regression, and Difference-in-Difference Estimators",
    "section": "Summary of Estimates",
    "text": "Summary of Estimates\n\n\nCode\nest_twfe2 <- \n  fit_twfe2 %>% tidy() %>% \n  mutate(method = \"TWFE\") %>% \n  mutate(call = glue(\"feols({Reduce(paste,deparse(fmla_twfe2))}, data = df_)\"))\n\nest_lm2 <- \n  fit_lm2 %>% tidy() %>% \n  mutate(call = glue(\"lm({Reduce(paste,deparse(fmla_lm2))}, data = df_)\"))  %>% \n  mutate(method = \"POLS\")\n\nest_twm2 <- \n  fit_twm2  %>% summary() %>% \n  coef() %>% \n  data.frame() %>% \n  rownames_to_column(var = \"term\") %>% \n  janitor::clean_names() %>% \n  as_tibble() %>% \n  mutate(method = \"TWM\") %>% \n  mutate(call = glue(\"lmer({Reduce(paste,deparse(fmla_twm2))}, data = df_)\"))\n\nest2 <- \n  est_twfe2 %>% \n  bind_rows(est_lm2) %>% \n  bind_rows(est_twm2) %>% \n  filter(grepl(\"^w:\",term)) %>% \n  separate(term,into=c(\"tmp\",\"year\"), sep = \":\") %>% \n  mutate(year = gsub(\"f\",\"\",year)) %>% \n  mutate(year = as.numeric(paste0(year))) %>% \n  select(-tmp) %>% \n  bind_rows(est_cs2 %>% filter(!is.na(group))) %>% \n  select(-group)\n\ndf_est2 <- \n  crossing(group= treatment_groups, year = treatment_years) %>% \n  as_tibble() %>%\n  mutate(year = as.numeric(paste0(year))) %>% \n  left_join(est2, \"year\") %>% \n  mutate(year = as.numeric(paste0(year))) \n\ndf_est2 %>% \n  select(year,estimate,method) %>% \n  spread(method,estimate) %>% \n  select(year,TWFE,POLS,TWM, CS) %>% \n  gt() %>% \n  fmt_number(columns=c(TWFE,POLS,TWM,CS),decimals=3)\n\n\n\n\n\n\n\n  \n  \n    \n      year\n      TWFE\n      POLS\n      TWM\n      CS\n    \n  \n  \n    1998\n0.273\n0.273\n0.273\n0.288\n    1999\n0.489\n0.489\n0.489\n0.504\n    2000\n0.909\n0.909\n0.909\n0.924\n    2001\n1.291\n1.291\n1.291\n1.306\n    2002\n1.714\n1.714\n1.714\n1.729\n    2003\n1.898\n1.898\n1.898\n1.913\n    2004\n2.226\n2.226\n2.226\n2.241\n    2005\n2.434\n2.434\n2.434\n2.449\n    2006\n2.759\n2.759\n2.759\n2.774\n    2007\n3.190\n3.190\n3.190\n3.205\n    2008\n3.471\n3.471\n3.471\n3.486\n    2009\n3.676\n3.676\n3.676\n3.691\n    2010\n4.097\n4.097\n4.097\n4.112\n    2011\n4.328\n4.328\n4.328\n4.343\n    2012\n4.783\n4.783\n4.783\n4.799\n    2013\n4.994\n4.994\n4.994\n5.009\n    2014\n5.278\n5.278\n5.278\n5.293\n    2015\n5.718\n5.718\n5.718\n5.733\n  \n  \n  \n\n\nFigure 5: Summary of Estimates - Common Treatment Time, Dynamic Treatment Effects\n\n\n\n\n\nCode\nplot_data(df2) + \n  geom_line(data = df_est2, aes(x = year, y = estimate, colour = factor(group),lty=factor(method)), lwd=2)  +\n  theme(legend.position=\"bottom\")\n\n\n\n\n\nFigure 6: Treatment Effect Estimates"
  },
  {
    "objectID": "blog/drafts/twfe-twm-and-did.html#estimate-models-2",
    "href": "blog/drafts/twfe-twm-and-did.html#estimate-models-2",
    "title": "Two-Way Fixed Effects, the Two-Way Mundlak Regression, and Difference-in-Difference Estimators",
    "section": "Estimate Models",
    "text": "Estimate Models\nWe next estimate the models\n\n\n\n\n\n\n\n\n\nMethod\nCommand\nDesign Variables\nFixed or Random Effect\n\n\n\n\nTwo-Way Fixed Effects\nfeols()\nw + f*\nUnit Fixed Effect\n\n\nPooled OLS\nlm()\nw + f* + d*\n\n\n\nTwo-Way Mundlak\nlmer()\nw + f* + d*\nUnit Random Effect\n\n\n\n\n\nCode\nfmla_twfe3 <- glue(\"y ~ w + {paste0('f',treatment_years3,collapse= '+')} | id \") %>% as.formula()\nfit_twfe3 <- feols(fmla_twfe3, data = df_)\nest_twfe3 <- tibble(method = \"TWFE\", estimate = coef(fit_twfe3)[\"w\"], formula = glue(\"feols({Reduce(paste,deparse(fmla_twfe3))}, data = df_)\"))\n\nfmla_lm3 <- glue(\"y ~ w + {paste0('f',treatment_years3,collapse= '+')} + {paste0('d',treatment_groups3,collapse= '+')}\") %>% as.formula()\nfit_lm3 <- lm(fmla_lm3, data = df_) \nest_lm3 <- tibble(method = \"POLS\", estimate = coef(fit_lm3)[\"w\"], formula = glue(\"lm({Reduce(paste,deparse(fmla_lm3))}, data = df_)\"))\n\nfmla_twm3 <- glue(\"y ~ w + {paste0('f',treatment_years3,collapse= '+')} + {paste0('d',treatment_groups3,collapse= '+')} + (1|id)\") %>% as.formula()\nfit_twm3 <- lmer( fmla_twm3 , data = df_) \nest_twm3 <- tibble(method = \"TWM\", estimate = coef(summary(fit_twm3))[\"w\",][1] %>% unname(), formula = glue(\"lmer({Reduce(paste,deparse(fmla_twm3))}, data = df_)\"))\n\n# CS\ndata3_cs <- \n  data3 %>% \n  mutate(year = as.numeric(paste0(year)),\n         treatment_time = as.numeric(paste0(treatment_time)))  %>% \n  mutate(treatment_time = ifelse(is.na(treatment_time),0,treatment_time))\n\n\nfit_cs3 <- att_gt(yname = \"dep_var\",\n                  tname = \"year\",\n                  idname = \"unit\",\n                  gname = \"treatment_time\",\n                  control_group = \"notyettreated\",\n                  data = data3_cs\n)\n\nest_cs3 <-  tibble(group = paste0(fit_cs3$group), year = fit_cs3$t, estimate = fit_cs3$att) %>% \n  mutate(method = \"CS\") \n\ntibble(method = c(\"TWFE\",\"POLS\",\"TWM\"),\n         formula = c(glue(\"feols({Reduce(paste,deparse(fmla_twfe3))}, data = df_)\"),\n                     glue(\"lm({Reduce(paste,deparse(fmla_lm3))}, data = df_)\"),\n                     glue(\"lmer({Reduce(paste,deparse(fmla_twm3))}, data = df_)\"))) %>% \n  gt() %>% \n  cols_label(\"method\" = \"Estimator\",\n             \"formula\" = \"Regression Call\")\n\n\n\n\n\n\n  \n  \n    \n      Estimator\n      Regression Call\n    \n  \n  \n    TWFE\nfeols(y ~ w + f1989 + f1990 + f1991 + f1992 + f1993 + f1994 + f1995 +      f1996 + f1997 + f1998 + f1999 + f2000 + f2001 + f2002 + f2003 +      f2004 + f2005 + f2006 + f2007 + f2008 + f2009 + f2010 + f2011 +      f2012 + f2013 + f2014 + f2015 | id, data = df_)\n    POLS\nlm(y ~ w + f1989 + f1990 + f1991 + f1992 + f1993 + f1994 + f1995 +      f1996 + f1997 + f1998 + f1999 + f2000 + f2001 + f2002 + f2003 +      f2004 + f2005 + f2006 + f2007 + f2008 + f2009 + f2010 + f2011 +      f2012 + f2013 + f2014 + f2015 + d1989 + d1998 + d2007, data = df_)\n    TWM\nlmer(y ~ w + f1989 + f1990 + f1991 + f1992 + f1993 + f1994 + f1995 +      f1996 + f1997 + f1998 + f1999 + f2000 + f2001 + f2002 + f2003 +      f2004 + f2005 + f2006 + f2007 + f2008 + f2009 + f2010 + f2011 +      f2012 + f2013 + f2014 + f2015 + d1989 + d1998 + d2007 + (1 |      id), data = df_)"
  },
  {
    "objectID": "blog/drafts/twfe-twm-and-did.html#summary-of-estimates-2",
    "href": "blog/drafts/twfe-twm-and-did.html#summary-of-estimates-2",
    "title": "Two-Way Fixed Effects, the Two-Way Mundlak Regression, and Difference-in-Difference Estimators",
    "section": "Summary of Estimates",
    "text": "Summary of Estimates\n\n\nCode\nest3 <- \n  est_twfe3 %>% \n  bind_rows(est_lm3) %>% \n  bind_rows(est_twm3) \n\nest3 %>% \n  select(-formula) %>% \n  mutate(group = \"Intervention\") %>% \n  spread(method,estimate) %>% \n  gt::gt() %>%\n  fmt_number(columns = c(TWFE,TWM, POLS),decimals=3) %>% \n  cols_label(\"group\" = \"\")\n\n\n\n\n\n\n\n  \n  \n    \n      \n      POLS\n      TWFE\n      TWM\n    \n  \n  \n    Intervention\n3.009\n3.009\n3.009\n  \n  \n  \n\n\nFigure 7: Summary of Estimates - Common Treatment Time, Constant Treatment Effects\n\n\n\n\n\nCode\ndf_est3 <- crossing(group= treatment_groups3, year = treatment_years3) %>% \n                      as_tibble() %>%\n                      mutate(tmp = 1) %>% \n                      left_join(est3 %>% mutate(tmp=1)) %>% \n              mutate(year = as.numeric(paste0(year))) %>% \n  bind_rows(est_cs3)\n  \nplot_data(df3)  + \n  geom_line(data = df_est3, aes(x = year, y = estimate, colour = factor(group),lty=factor(method)), lwd=2)  +\n  theme(legend.position=\"bottom\")\n\n\n\n\n\nFigure 8: Treatment Effect Estimates"
  },
  {
    "objectID": "blog/drafts/twfe-twm-and-did.html#estimate-models-3",
    "href": "blog/drafts/twfe-twm-and-did.html#estimate-models-3",
    "title": "Two-Way Fixed Effects, the Two-Way Mundlak Regression, and Difference-in-Difference Estimators",
    "section": "Estimate Models",
    "text": "Estimate Models\nWe next estimate the models\n\n\n\n\n\n\n\n\n\nMethod\nCommand\nDesign Variables\nFixed or Random Effect\n\n\n\n\nTwo-Way Fixed Effects\nfeols()\nw : d* + f*\nUnit Fixed Effect\n\n\nPooled OLS\nlm()\nw : d* + f* + d*\n\n\n\nTwo-Way Mundlak\nlmer()\nw : d* + f* + d*\nUnit Random Effect\n\n\n\n\n\nCode\nfmla_twfe4a <- glue(\"y ~ {paste0('w : ',paste0('d',treatment_groups4a), collapse = ' + ')} + {paste0('f',treatment_years4a,collapse=' + ')} | id\") %>% as.formula()\nfit_twfe4a <- feols(fmla_twfe4a, data = df4a_)\n\nfmla_lm4a <- glue(\"y ~ {paste0('w : ',paste0('d',treatment_groups4a), collapse = ' + ')} + {paste0('f',treatment_years4a,collapse=' + ')} + {paste0('d',treatment_groups4a,collapse=' + ')}\") %>% as.formula()\nfit_lm4a <- lm(fmla_lm4a, data = df4a_) \n\n\nfmla_twm4a <- glue(\"y ~ {paste0('w : ',paste0('d',treatment_groups4a), collapse = ' + ')} + {paste0('f',treatment_years4a,collapse=' + ')} + {paste0('d',treatment_groups4a,collapse=' + ')} + (1|id)\") %>% as.formula()\nfit_twm4a <- lmer( fmla_twm4a , data = df4a_) \n\n# CS\ndata4a_cs <- \n  data4a %>% \n  mutate(year = as.numeric(paste0(year)),\n         treatment_time = as.numeric(paste0(treatment_time)))  %>% \n  mutate(treatment_time = ifelse(is.na(treatment_time),0,treatment_time))\n\n\nfit_cs4a <- att_gt(yname = \"dep_var\",\n                  tname = \"year\",\n                  idname = \"unit\",\n                  gname = \"treatment_time\",\n                  control_group = \"notyettreated\",\n                  data = data4a_cs\n)\n\nest_cs4a <-  tibble(group = paste0(fit_cs4a$group), year = fit_cs4a$t, estimate = fit_cs4a$att) %>% \n  mutate(method = \"CS\")  \n\ntibble(method = c(\"TWFE\",\"POLS\",\"TWM\"),\n         formula = c(glue(\"feols({Reduce(paste,deparse(fmla_twfe4a))}, data = df_)\"),\n                     glue(\"lm({Reduce(paste,deparse(fmla_lm4a))}, data = df_)\"),\n                     glue(\"lmer({Reduce(paste,deparse(fmla_twm4a))}, data = df_)\"))) %>% \n  gt() %>% \n  cols_label(\"method\" = \"Estimator\",\n             \"formula\" = \"Regression Call\")\n\n\n\n\n\n\n  \n  \n    \n      Estimator\n      Regression Call\n    \n  \n  \n    TWFE\nfeols(y ~ w:d1989 + w:d1998 + w:d2007 + f1989 + f1990 + f1991 + f1992 +      f1993 + f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 +      f2001 + f2002 + f2003 + f2004 + f2005 + f2006 + f2007 + f2008 +      f2009 + f2010 + f2011 + f2012 + f2013 + f2014 + f2015 | id, data = df_)\n    POLS\nlm(y ~ w:d1989 + w:d1998 + w:d2007 + f1989 + f1990 + f1991 + f1992 +      f1993 + f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 +      f2001 + f2002 + f2003 + f2004 + f2005 + f2006 + f2007 + f2008 +      f2009 + f2010 + f2011 + f2012 + f2013 + f2014 + f2015 + d1989 +      d1998 + d2007, data = df_)\n    TWM\nlmer(y ~ w:d1989 + w:d1998 + w:d2007 + f1989 + f1990 + f1991 + f1992 +      f1993 + f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 +      f2001 + f2002 + f2003 + f2004 + f2005 + f2006 + f2007 + f2008 +      f2009 + f2010 + f2011 + f2012 + f2013 + f2014 + f2015 + d1989 +      d1998 + d2007 + (1 | id), data = df_)\n  \n  \n  \n\n\n\n\n\n\nCode\nest_twfe4a <- \n  fit_twfe4a %>% tidy() %>% \n  mutate(method = \"TWFE\") %>% \n  mutate(call = glue(\"feols({Reduce(paste,deparse(fmla_twfe4a))}, data = df4a_)\"))\n\nest_lm4a <- \n  fit_lm4a %>% tidy() %>% \n  mutate(call = glue(\"lm({Reduce(paste,deparse(fmla_lm4a))}, data = df4a_)\"))  %>% \n  mutate(method = \"POLS\")\n\nest_twm4a <- \n  fit_twm4a  %>% summary() %>% \n  coef() %>% \n  data.frame() %>% \n  rownames_to_column(var = \"term\") %>% \n  janitor::clean_names() %>% \n  as_tibble() %>% \n  mutate(method = \"TWM\") %>% \n  mutate(call = glue(\"lmer({Reduce(paste,deparse(fmla_twm4a))}, data = df4a_)\"))\n\nest4a <- \n  est_twfe4a %>% \n  bind_rows(est_lm4a) %>% \n  bind_rows(est_twm4a) %>% \n  filter(grepl(\"^w:\",term)) %>% \n  separate(term,into=c(\"tmp\",\"group\"), sep = \":\") %>% \n  mutate(group = gsub(\"d\",\"\",group)) %>% \n  select(-tmp) #%>% \n  #bind_rows(est_cs4a %>% filter(!is.na(group))) \n\ndf_est4a <- \n  crossing(group= treatment_groups4a) %>% \n  as_tibble() %>%\n  left_join(est4a, \"group\") %>% \n  mutate(group = factor(group))\n\ndf_est4a %>% \n  select(group,estimate,method) %>% \n  spread(method,estimate) %>% \n  select(group,TWFE,POLS,TWM) %>% \n  gt() %>% \n  fmt_number(columns=c(TWFE,POLS,TWM),decimals=3)\n\n\n\n\n\n\n\n  \n  \n    \n      group\n      TWFE\n      POLS\n      TWM\n    \n  \n  \n    1989\n4.951\n4.951\n4.951\n    1998\n3.036\n3.036\n3.036\n    2007\n1.029\n1.029\n1.029\n  \n  \n  \n\n\nFigure 9: Summary of Estimates - Multiple Treatment Periods and Constant Different Treatment Effects"
  },
  {
    "objectID": "blog/drafts/twfe-twm-and-did.html#summary-of-estimates-3",
    "href": "blog/drafts/twfe-twm-and-did.html#summary-of-estimates-3",
    "title": "Two-Way Fixed Effects, the Two-Way Mundlak Regression, and Difference-in-Difference Estimators",
    "section": "Summary of Estimates",
    "text": "Summary of Estimates\n\n\nCode\ndf_est4a_ <- \n  crossing(year = treatment_years4a,group = treatment_groups4a) %>%\n  mutate(group = as.numeric(paste0(group))) %>% \n  mutate(year = as.numeric(paste0(year))) %>% \n  filter(year>=group) %>% \n  mutate(group = factor(group)) %>% \n  left_join(\n    df_est4a,\"group\"\n  ) %>% \n  bind_rows(est_cs4a)\n\nplot_data(df4a) + \n  geom_line(data = df_est4a_, aes(x = year, y = estimate, colour = factor(group),lty=factor(method)), lwd=2)  +\n  theme(legend.position=\"bottom\")\n\n\n\n\n\nFigure 10: Treatment Effect Estimates - Multiple Treatment Periods and Constant Different Treatment Effects"
  },
  {
    "objectID": "blog/drafts/twfe-twm-and-did.html#estimate-models-4",
    "href": "blog/drafts/twfe-twm-and-did.html#estimate-models-4",
    "title": "Two-Way Fixed Effects, the Two-Way Mundlak Regression, and Difference-in-Difference Estimators",
    "section": "Estimate Models",
    "text": "Estimate Models\nWe next estimate the models\n\n\n\n\n\n\n\n\n\nMethod\nCommand\nDesign Variables\nFixed or Random Effect\n\n\n\n\nTwo-Way Fixed Effects\nfeols()\nw : d* + f*\nUnit Fixed Effect\n\n\nPooled OLS\nlm()\nw : d* + f* + d*\n\n\n\nTwo-Way Mundlak\nlmer()\nw : d* + f* + d*\nUnit Random Effect\n\n\n\n\n\nCode\nfmla_twfe4b <- glue(\"y ~ {paste0('w : ',paste0('d',treatment_groups4b), collapse = ' + ')} + {paste0('f',treatment_years4b,collapse=' + ')} | id\") %>% as.formula()\nfit_twfe4b <- feols(fmla_twfe4b, data = df4b_)\n\nfmla_lm4b <- glue(\"y ~ {paste0('w : ',paste0('d',treatment_groups4b), collapse = ' + ')} + {paste0('f',treatment_years4b,collapse=' + ')} + {paste0('d',treatment_groups4b,collapse=' + ')}\") %>% as.formula()\nfit_lm4b <- lm(fmla_lm4b, data = df4b_) \n\nfmla_twm4b <- glue(\"y ~ {paste0('w : ',paste0('d',treatment_groups4b), collapse = ' + ')} + {paste0('f',treatment_years4b,collapse=' + ')} + {paste0('d',treatment_groups4b,collapse=' + ')} + (1|id)\") %>% as.formula()\nfit_twm4b <- lmer( fmla_twm4b , data = df4b_) \n\ntibble(method = c(\"TWFE\",\"POLS\",\"TWM\"),\n         formula = c(glue(\"feols({Reduce(paste,deparse(fmla_twfe4b))}, data = df_)\"),\n                     glue(\"lm({Reduce(paste,deparse(fmla_lm4b))}, data = df_)\"),\n                     glue(\"lmer({Reduce(paste,deparse(fmla_twm4b))}, data = df_)\"))) %>% \n  gt() %>% \n  cols_label(\"method\" = \"Estimator\",\n             \"formula\" = \"Regression Call\")\n\n\n\n\n\n\n  \n  \n    \n      Estimator\n      Regression Call\n    \n  \n  \n    TWFE\nfeols(y ~ w:d1989 + w:d1998 + f1989 + f1990 + f1991 + f1992 + f1993 +      f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 + f2001 +      f2002 + f2003 + f2004 + f2005 + f2006 + f2007 + f2008 + f2009 +      f2010 + f2011 + f2012 + f2013 + f2014 + f2015 | id, data = df_)\n    POLS\nlm(y ~ w:d1989 + w:d1998 + f1989 + f1990 + f1991 + f1992 + f1993 +      f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 + f2001 +      f2002 + f2003 + f2004 + f2005 + f2006 + f2007 + f2008 + f2009 +      f2010 + f2011 + f2012 + f2013 + f2014 + f2015 + d1989 + d1998, data = df_)\n    TWM\nlmer(y ~ w:d1989 + w:d1998 + f1989 + f1990 + f1991 + f1992 + f1993 +      f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 + f2001 +      f2002 + f2003 + f2004 + f2005 + f2006 + f2007 + f2008 + f2009 +      f2010 + f2011 + f2012 + f2013 + f2014 + f2015 + d1989 + d1998 +      (1 | id), data = df_)\n  \n  \n  \n\n\n\n\nCode\n# CS\ndata4b_cs <- \n  data4b %>% \n  mutate(year = as.numeric(paste0(year)),\n         treatment_time = as.numeric(paste0(treatment_time)))  %>% \n  mutate(treatment_time = ifelse(is.na(treatment_time),0,treatment_time))\n\n\nfit_cs4b <- att_gt(yname = \"dep_var\",\n                  tname = \"year\",\n                  idname = \"unit\",\n                  gname = \"treatment_time\",\n                  control_group = \"nevertreated\",\n                  data = data4b_cs\n)\n\nest_cs4b <-  tibble(group = paste0(fit_cs4b$group), year = fit_cs4b$t, estimate = fit_cs4b$att) %>% \n  mutate(method = \"CS\")"
  },
  {
    "objectID": "blog/drafts/twfe-twm-and-did.html#summary-of-estimates-4",
    "href": "blog/drafts/twfe-twm-and-did.html#summary-of-estimates-4",
    "title": "Two-Way Fixed Effects, the Two-Way Mundlak Regression, and Difference-in-Difference Estimators",
    "section": "Summary of Estimates",
    "text": "Summary of Estimates\n\n\nCode\nest_twfe4b <- \n  fit_twfe4b %>% tidy() %>% \n  mutate(method = \"TWFE\") %>% \n  mutate(call = glue(\"feols({Reduce(paste,deparse(fmla_twfe4b))}, data = df4b_)\")) \n\nest_lm4b <- \n  fit_lm4b %>% tidy() %>% \n  mutate(call = glue(\"lm({Reduce(paste,deparse(fmla_lm4b))}, data = df4b_)\"))  %>% \n  mutate(method = \"POLS\")\n\nest_twm4b <- \n  fit_twm4b  %>% summary() %>% \n  coef() %>% \n  data.frame() %>% \n  rownames_to_column(var = \"term\") %>% \n  janitor::clean_names() %>% \n  as_tibble() %>% \n  mutate(method = \"TWM\") %>% \n  mutate(call = glue(\"lmer({Reduce(paste,deparse(fmla_twm4b))}, data = df4b_)\"))\n\nest4b <- \n  est_twfe4b %>% \n  bind_rows(est_lm4b) %>% \n  bind_rows(est_twm4b) %>% \n  filter(grepl(\"^w:\",term)) %>% \n  separate(term,into=c(\"tmp\",\"group\"), sep = \":\") %>% \n  mutate(group = gsub(\"d\",\"\",group)) %>% \n  mutate(group = as.numeric(paste0(group))) %>% \n  select(-tmp) %>% \n  mutate(group = factor(group))\n\ndf_est4b <- \n  crossing(group= treatment_groups4b) %>% \n  as_tibble() %>%\n  left_join(est4b, \"group\") %>% \n  mutate(group = factor(group))\n\ndf_est4b %>% \n  select(group,estimate,method) %>% \n  spread(method,estimate) %>% \n  select(group,TWFE,POLS,TWM) %>% \n  gt() %>% \n  fmt_number(columns=c(TWFE,POLS,TWM),decimals=3)\n\n\n\n\n\n\n\n  \n  \n    \n      group\n      TWFE\n      POLS\n      TWM\n    \n  \n  \n    1989\n5.055\n5.055\n5.055\n    1998\n2.983\n2.983\n2.983\n  \n  \n  \n\n\nFigure 11: Summary of Estimates - Multiple Treatment Periods and Constant Different Treatment Effects\n\n\n\n\n\nCode\ndf_est4b_ <- \n  crossing(year = treatment_years4b,group = treatment_groups4b) %>%\n  mutate(group = as.numeric(paste0(group))) %>% \n  mutate(year = as.numeric(paste0(year))) %>% \n  filter(year>=group) %>% \n  mutate(group = factor(group)) %>% \n  left_join(\n    df_est4b,\"group\"\n  ) %>% \n  bind_rows(est_cs4b)\n\nplot_data(df4b) + \n  geom_line(data = df_est4b_, aes(x = year, y = estimate, colour = factor(group),lty=factor(method)), lwd=2)  +\n  theme(legend.position=\"bottom\")\n\n\n\n\n\nFigure 12: Treatment Effect Estimates - Multiple Treatment Periods and Constant Different Treatment Effects"
  },
  {
    "objectID": "blog/drafts/twfe-twm-and-did.html#estimate-models-5",
    "href": "blog/drafts/twfe-twm-and-did.html#estimate-models-5",
    "title": "Two-Way Fixed Effects, the Two-Way Mundlak Regression, and Difference-in-Difference Estimators",
    "section": "Estimate Models",
    "text": "Estimate Models\nWe next estimate the models\n\n\n\n\n\n\n\n\n\nMethod\nCommand\nDesign Variables\nFixed or Random Effect\n\n\n\n\nTwo-Way Fixed Effects\nfeols()\nw : d* + f*\nUnit Fixed Effect\n\n\nPooled OLS\nlm()\nw : d* + f* + d*\n\n\n\nTwo-Way Mundlak\nlmer()\nw : d* + f* + d*\nUnit Random Effect\n\n\n\n\n\nCode\ndf4b_nev_ <-\n  data4b %>%\n  mutate(treatment_time = ifelse(is.na(treatment_time),0,as.numeric(paste0(treatment_time)))) %>% \n  select(y = dep_var,w = treat, id = unit,year, treatment_time) %>%\n  fastDummies::dummy_cols(c(\"year\",\"treatment_time\")) %>%\n  select_at(vars(y,w,id,year,treatment_time,glue(\"year_{treatment_years4b_nev}\") %>% as.vector(),\n                 glue(\"treatment_time_{treatment_groups4b}\"))) %>%\n  rename_at(vars(starts_with(\"year_\")),~gsub(\"year_\",\"f\",.)) %>%\n  rename_at(vars(starts_with(\"treatment_time_\")),~gsub(\"treatment_time_\",\"d\",.))\n\nfmla_twfe4b_nev <- glue(\"y ~ {paste0('w : ',paste0('d',treatment_groups4b), collapse = ' + ')} + {paste0('f',treatment_years4b_nev[-1],collapse=' + ')} | id\") %>% as.formula()\nfit_twfe4b_nev <- feols(fmla_twfe4b_nev, data = df4b_nev_)\n\nfmla_lm4b_nev <- glue(\"y ~ {paste0('w : ',paste0('d',treatment_groups4b), collapse = ' + ')} + {paste0('f',treatment_years4b_nev[-1],collapse=' + ')} + {paste0('d',treatment_groups4b,collapse=' + ')}\") %>% as.formula()\nfit_lm4b_nev <- lm(fmla_lm4b_nev, data = df4b_nev_) \n\nfmla_twm4b_nev <- glue(\"y ~ {paste0('w : ',paste0('d',treatment_groups4b), collapse = ' + ')} + {paste0('f',treatment_years4b_nev[-1],collapse=' + ')} + {paste0('d',treatment_groups4b,collapse=' + ')} + (1|id)\") %>% as.formula()\nfit_twm4b_nev <- lmer( fmla_twm4b_nev , data = df4b_nev_) \n\ntibble(method = c(\"TWFE\",\"POLS\",\"TWM\"),\n         formula = c(glue(\"feols({Reduce(paste,deparse(fmla_twfe4b_nev))}, data = df_)\"),\n                     glue(\"lm({Reduce(paste,deparse(fmla_lm4b_nev))}, data = df_)\"),\n                     glue(\"lmer({Reduce(paste,deparse(fmla_twm4b_nev))}, data = df_)\"))) %>% \n  gt() %>% \n  cols_label(\"method\" = \"Estimator\",\n             \"formula\" = \"Regression Call\")\n\n\n\n\n\n\n  \n  \n    \n      Estimator\n      Regression Call\n    \n  \n  \n    TWFE\nfeols(y ~ w:d1989 + w:d1998 + f1981 + f1982 + f1983 + f1984 + f1985 +      f1986 + f1987 + f1988 + f1989 + f1990 + f1991 + f1992 + f1993 +      f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 + f2001 +      f2002 + f2003 + f2004 + f2005 + f2006 + f2007 + f2008 + f2009 +      f2010 + f2011 + f2012 + f2013 + f2014 + f2015 + f1989 + f1990 +      f1991 + f1992 + f1993 + f1994 + f1995 + f1996 + f1997 + f1998 +      f1999 + f2000 + f2001 + f2002 + f2003 + f2004 + f2005 + f2006 +      f2007 + f2008 + f2009 + f2010 + f2011 + f2012 + f2013 + f2014 +      f2015 | id, data = df_)\n    POLS\nlm(y ~ w:d1989 + w:d1998 + f1981 + f1982 + f1983 + f1984 + f1985 +      f1986 + f1987 + f1988 + f1989 + f1990 + f1991 + f1992 + f1993 +      f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 + f2001 +      f2002 + f2003 + f2004 + f2005 + f2006 + f2007 + f2008 + f2009 +      f2010 + f2011 + f2012 + f2013 + f2014 + f2015 + f1989 + f1990 +      f1991 + f1992 + f1993 + f1994 + f1995 + f1996 + f1997 + f1998 +      f1999 + f2000 + f2001 + f2002 + f2003 + f2004 + f2005 + f2006 +      f2007 + f2008 + f2009 + f2010 + f2011 + f2012 + f2013 + f2014 +      f2015 + d1989 + d1998, data = df_)\n    TWM\nlmer(y ~ w:d1989 + w:d1998 + f1981 + f1982 + f1983 + f1984 + f1985 +      f1986 + f1987 + f1988 + f1989 + f1990 + f1991 + f1992 + f1993 +      f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 + f2001 +      f2002 + f2003 + f2004 + f2005 + f2006 + f2007 + f2008 + f2009 +      f2010 + f2011 + f2012 + f2013 + f2014 + f2015 + f1989 + f1990 +      f1991 + f1992 + f1993 + f1994 + f1995 + f1996 + f1997 + f1998 +      f1999 + f2000 + f2001 + f2002 + f2003 + f2004 + f2005 + f2006 +      f2007 + f2008 + f2009 + f2010 + f2011 + f2012 + f2013 + f2014 +      f2015 + d1989 + d1998 + (1 | id), data = df_)\n  \n  \n  \n\n\n\n\nCode\n# CS\ndata4b_nev_cs <- \n  data4b %>% \n  mutate(year = as.numeric(paste0(year)),\n         treatment_time = as.numeric(paste0(treatment_time)))  %>% \n  mutate(treatment_time = ifelse(is.na(treatment_time),0,treatment_time))\n\n\nfit_cs4b_nev <- att_gt(yname = \"dep_var\",\n                  tname = \"year\",\n                  idname = \"unit\",\n                  gname = \"treatment_time\",\n                  control_group = \"nevertreated\",\n                  data = data4b_nev_cs\n)\n\nest_cs4b_nev <-  tibble(group = paste0(fit_cs4b$group), year = fit_cs4b$t, estimate = fit_cs4b$att) %>% \n  mutate(method = \"CS\")"
  },
  {
    "objectID": "blog/drafts/twfe-twm-and-did.html#summary-of-estimates-5",
    "href": "blog/drafts/twfe-twm-and-did.html#summary-of-estimates-5",
    "title": "Two-Way Fixed Effects, the Two-Way Mundlak Regression, and Difference-in-Difference Estimators",
    "section": "Summary of Estimates",
    "text": "Summary of Estimates\n\n\nCode\nest_twfe4b_nev <- \n  fit_twfe4b_nev %>% tidy() %>% \n  mutate(method = \"TWFE\") %>% \n  mutate(call = glue(\"feols({Reduce(paste,deparse(fmla_twfe4b_nev))}, data = df4b_nev_)\"))\n\nest_lm4b_nev <- \n  fit_lm4b_nev %>% tidy() %>% \n  mutate(call = glue(\"lm({Reduce(paste,deparse(fmla_lm4b_nev))}, data = df4b_nev_)\"))  %>% \n  mutate(method = \"POLS\")\n\nest_twm4b_nev <- \n  fit_twm4b_nev  %>% summary() %>% \n  coef() %>% \n  data.frame() %>% \n  rownames_to_column(var = \"term\") %>% \n  janitor::clean_names() %>% \n  as_tibble() %>% \n  mutate(method = \"TWM\") %>% \n  mutate(call = glue(\"lmer({Reduce(paste,deparse(fmla_twm4b_nev))}, data = df4b_nev_)\"))\n\nest4b_nev <- \n  est_twfe4b_nev %>% \n  bind_rows(est_lm4b_nev) %>% \n  bind_rows(est_twm4b_nev) %>% \n  filter(grepl(\"^w:\",term)) %>% \n  separate(term,into=c(\"tmp\",\"group\"), sep = \":\") %>% \n  mutate(group = gsub(\"d\",\"\",group)) %>% \n  mutate(group = as.numeric(paste0(group))) %>% \n  select(-tmp) %>% \n  mutate(group = factor(group))\n\ndf_est4b_nev <- \n  crossing(group= treatment_groups4b) %>% \n  as_tibble() %>%\n  left_join(est4b_nev, \"group\") %>% \n  mutate(group = factor(group))\n\ndf_est4b_nev %>% \n  select(group,estimate,method) %>% \n  spread(method,estimate) %>% \n  select(group,TWFE,POLS,TWM) %>% \n  gt() %>% \n  fmt_number(columns=c(TWFE,POLS,TWM),decimals=3)\n\n\n\n\n\n\n\n  \n  \n    \n      group\n      TWFE\n      POLS\n      TWM\n    \n  \n  \n    1989\n5.055\n5.055\n5.055\n    1998\n2.983\n2.983\n2.983\n  \n  \n  \n\n\nFigure 13: Summary of Estimates - Multiple Treatment Periods and Constant Different Treatment Effects (Never Treated as Only Control)\n\n\n\n\n\nCode\ndf_est4b_nev_ <- \n  crossing(year = treatment_years4b_nev,group = treatment_groups4b) %>%\n  mutate(group = as.numeric(paste0(group))) %>% \n  mutate(year = as.numeric(paste0(year))) %>% \n  filter(year>=group) %>% \n  mutate(group = factor(group)) %>% \n  left_join(\n    df_est4b,\"group\"\n  ) %>% \n  bind_rows(est_cs4b)\n\nplot_data(df4b) + \n  geom_line(data = df_est4b_nev_, aes(x = year, y = estimate, colour = factor(group),lty=factor(method)), lwd=2)  +\n  theme(legend.position=\"bottom\")\n\n\n\n\n\nFigure 14: Treatment Effect Estimates - Multiple Treatment Periods and Constant Different Treatment Effects (Never Treated as Only Control)"
  },
  {
    "objectID": "blog/drafts/twfe-twm-and-did.html#estimate-models-6",
    "href": "blog/drafts/twfe-twm-and-did.html#estimate-models-6",
    "title": "Two-Way Fixed Effects, the Two-Way Mundlak Regression, and Difference-in-Difference Estimators",
    "section": "Estimate Models",
    "text": "Estimate Models\nWe next estimate the models\n\n\n\n\n\n\n\n\n\nMethod\nCommand\nDesign Variables\nFixed or Random Effect\n\n\n\n\nTwo-Way Fixed Effects\nfeols()\nd* : f* + f*\nUnit Fixed Effect\n\n\nPooled OLS\nlm()\nd* : f* + f* + d*\n\n\n\nTwo-Way Mundlak\nlmer()\nd* : f* + f* + d*\nUnit Random Effect\n\n\n\n\n\nCode\nfmla_twfe5 <-   fmla <- glue(\"y ~ {paste0(treatment_interactions5, collapse = ' + ')} + {paste0('f',treatment_years5,collapse=' + ')} | id\") %>% as.formula()\nfit_twfe5 <- feols(fmla_twfe5, data = df5_)\n\nfmla_lm5 <- glue(\"y ~ {paste0(treatment_interactions5, collapse = ' + ')} + {paste0('f',treatment_years5,collapse=' + ')} + {paste0('d',treatment_groups5,collapse=' + ')}\") %>% as.formula()\nfit_lm5 <- lm(fmla_lm5, data = df5_) \n\nfmla_twm5 <- glue(\"y ~ {paste0(treatment_interactions5, collapse = ' + ')} + {paste0('f',treatment_years5,collapse=' + ')} + {paste0('d',treatment_groups5,collapse=' + ')} + (1|id)\") %>% as.formula()\nfit_twm5 <- lmer( fmla_twm5 , data = df5_) \n\ntibble(method = c(\"TWFE\",\"POLS\",\"TWM\"),\n         formula = c(glue(\"feols({Reduce(paste,deparse(fmla_twfe5))}, data = df_)\"),\n                     glue(\"lm({Reduce(paste,deparse(fmla_lm5))}, data = df_)\"),\n                     glue(\"lmer({Reduce(paste,deparse(fmla_twm5))}, data = df_)\"))) %>% \n  gt() %>% \n  cols_label(\"method\" = \"Estimator\",\n             \"formula\" = \"Regression Call\")\n\n\n\n\n\n\n  \n  \n    \n      Estimator\n      Regression Call\n    \n  \n  \n    TWFE\nfeols(y ~ d1989:f1989 + d1989:f1990 + d1989:f1991 + d1989:f1992 + d1989:f1993 +      d1989:f1994 + d1989:f1995 + d1989:f1996 + d1989:f1997 + d1989:f1998 +      d1989:f1999 + d1989:f2000 + d1989:f2001 + d1989:f2002 + d1989:f2003 +      d1989:f2004 + d1989:f2005 + d1989:f2006 + d1998:f1998 + d1998:f1999 +      d1998:f2000 + d1998:f2001 + d1998:f2002 + d1998:f2003 + d1998:f2004 +      d1998:f2005 + d1998:f2006 + f1989 + f1990 + f1991 + f1992 +      f1993 + f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 +      f2001 + f2002 + f2003 + f2004 + f2005 + f2006 | id, data = df_)\n    POLS\nlm(y ~ d1989:f1989 + d1989:f1990 + d1989:f1991 + d1989:f1992 + d1989:f1993 +      d1989:f1994 + d1989:f1995 + d1989:f1996 + d1989:f1997 + d1989:f1998 +      d1989:f1999 + d1989:f2000 + d1989:f2001 + d1989:f2002 + d1989:f2003 +      d1989:f2004 + d1989:f2005 + d1989:f2006 + d1998:f1998 + d1998:f1999 +      d1998:f2000 + d1998:f2001 + d1998:f2002 + d1998:f2003 + d1998:f2004 +      d1998:f2005 + d1998:f2006 + f1989 + f1990 + f1991 + f1992 +      f1993 + f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 +      f2001 + f2002 + f2003 + f2004 + f2005 + f2006 + d1989 + d1998, data = df_)\n    TWM\nlmer(y ~ d1989:f1989 + d1989:f1990 + d1989:f1991 + d1989:f1992 + d1989:f1993 +      d1989:f1994 + d1989:f1995 + d1989:f1996 + d1989:f1997 + d1989:f1998 +      d1989:f1999 + d1989:f2000 + d1989:f2001 + d1989:f2002 + d1989:f2003 +      d1989:f2004 + d1989:f2005 + d1989:f2006 + d1998:f1998 + d1998:f1999 +      d1998:f2000 + d1998:f2001 + d1998:f2002 + d1998:f2003 + d1998:f2004 +      d1998:f2005 + d1998:f2006 + f1989 + f1990 + f1991 + f1992 +      f1993 + f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 +      f2001 + f2002 + f2003 + f2004 + f2005 + f2006 + d1989 + d1998 +      (1 | id), data = df_)\n  \n  \n  \n\n\n\n\nCode\n# CS\ndata5_cs <- \n  data5 %>% \n  mutate(year = as.numeric(paste0(year)),\n         treatment_time = as.numeric(paste0(treatment_time)))  %>% \n  mutate(treatment_time = ifelse(is.na(treatment_time),0,treatment_time))\n\n\nfit_cs5 <- att_gt(yname = \"dep_var\",\n                  tname = \"year\",\n                  idname = \"unit\",\n                  gname = \"treatment_time\",\n                  control_group = \"notyettreated\",\n                  data = data5_cs\n)\n\nest_cs5 <-  tibble(group = paste0(fit_cs5$group), year = fit_cs5$t, estimate = fit_cs5$att) %>% \n  mutate(method = \"CS\")  \n\n\n\n\nCode\nest_twfe5 <- \n  fit_twfe5 %>% tidy() %>% \n  mutate(method = \"TWFE\") %>% \n  mutate(call = glue(\"feols({Reduce(paste,deparse(fmla_twfe5))}, data = df5_)\"))\n\nest_lm5 <- \n  fit_lm5 %>% tidy() %>% \n  mutate(call = glue(\"lm({Reduce(paste,deparse(fmla_lm5))}, data = df5_)\"))  %>% \n  mutate(method = \"POLS\")\n\nest_twm5 <- \n  fit_twm5  %>% summary() %>% \n  coef() %>% \n  data.frame() %>% \n  rownames_to_column(var = \"term\") %>% \n  janitor::clean_names() %>% \n  as_tibble() %>% \n  mutate(method = \"TWM\") %>% \n  mutate(call = glue(\"lmer({Reduce(paste,deparse(fmla_twm5))}, data = df5_)\"))\n\nest5 <- \n  est_twfe5 %>% \n  bind_rows(est_lm5) %>% \n  bind_rows(est_twm5) %>% \n  filter(grepl(\"^f|^d\",term)) %>% \n  filter(grepl(\":\",term)) %>%   \n  #data.frame() %>% select(term,estimate) %>% \n  separate(term,into=c(\"one\",\"two\"), sep = \":\")  %>% \n  mutate(group = case_when(grepl(\"^d\",one) ~ one, \n                           TRUE ~ two)) %>% \n  mutate(year = case_when(grepl(\"^f\",one) ~ one, \n                           TRUE ~ two))     %>% \n  mutate(group = gsub(\"d\",\"\",group)) %>% \n  mutate(group = as.numeric(paste0(group)))  %>% \n  mutate(year = gsub(\"f\",\"\",year)) %>%     \n  mutate(year = as.numeric(paste0(year))) %>% \n  select(-one,-two) %>% \n  bind_rows(est_cs5 %>% mutate(group = as.numeric(paste0(group))))\n\ndf_est5 <- \n  crossing(group= treatment_groups5, year = treatment_years5) %>% \n  as_tibble() %>%\n  mutate(year = as.numeric(paste0(year))) %>% \n  left_join(est5, c(\"group\",\"year\")) %>% \n  mutate(year = as.numeric(paste0(year))) %>% \n  filter(!is.na(estimate))\n\ndf_est5 %>% \n  select(group, year,estimate,method) %>% \n  spread(method,estimate) %>% \n  select(group, year,TWFE,POLS,TWM,CS) %>% \n  na.omit() %>% \n  gt() %>% \n  fmt_number(columns=c(TWFE,POLS,TWM,CS),decimals=3)\n\n\n\n\n\n\n  \n  \n    \n      group\n      year\n      TWFE\n      POLS\n      TWM\n      CS\n    \n  \n  \n    1989\n1989\n0.205\n0.205\n0.205\n0.120\n    1989\n1990\n0.504\n0.504\n0.504\n0.419\n    1989\n1991\n0.792\n0.792\n0.792\n0.706\n    1989\n1992\n1.053\n1.053\n1.053\n0.968\n    1989\n1993\n1.359\n1.359\n1.359\n1.274\n    1989\n1994\n1.740\n1.740\n1.740\n1.655\n    1989\n1995\n2.056\n2.056\n2.056\n1.971\n    1989\n1996\n2.167\n2.167\n2.167\n2.082\n    1989\n1997\n2.500\n2.500\n2.500\n2.415\n    1989\n1998\n2.628\n2.628\n2.628\n2.609\n    1989\n1999\n3.005\n3.005\n3.005\n2.986\n    1989\n2000\n3.310\n3.310\n3.310\n3.291\n    1989\n2001\n3.550\n3.550\n3.550\n3.531\n    1989\n2002\n3.890\n3.890\n3.890\n3.870\n    1989\n2003\n4.261\n4.261\n4.261\n4.242\n    1989\n2004\n4.366\n4.366\n4.366\n4.346\n    1989\n2005\n4.743\n4.743\n4.743\n4.724\n    1989\n2006\n5.018\n5.018\n5.018\n4.998\n    1998\n1998\n0.177\n0.177\n0.177\n0.281\n    1998\n1999\n0.624\n0.624\n0.624\n0.728\n    1998\n2000\n0.860\n0.860\n0.860\n0.964\n    1998\n2001\n1.174\n1.174\n1.174\n1.278\n    1998\n2002\n1.487\n1.487\n1.487\n1.591\n    1998\n2003\n1.871\n1.871\n1.871\n1.975\n    1998\n2004\n2.031\n2.031\n2.031\n2.135\n    1998\n2005\n2.495\n2.495\n2.495\n2.599\n    1998\n2006\n2.703\n2.703\n2.703\n2.807"
  },
  {
    "objectID": "blog/drafts/twfe-twm-and-did.html#summary-of-estimates-6",
    "href": "blog/drafts/twfe-twm-and-did.html#summary-of-estimates-6",
    "title": "Two-Way Fixed Effects, the Two-Way Mundlak Regression, and Difference-in-Difference Estimators",
    "section": "Summary of Estimates",
    "text": "Summary of Estimates\n\n\nCode\nplot_data(df5)  + \n  geom_line(data = df_est5, aes(x = year, y = estimate, colour = factor(group),lty=factor(method)), lwd=2)  +\n  theme(legend.position=\"bottom\")\n\n\n\n\n\nFigure 15: Treatment Effect Estimates - Multiple Treatment Periods and Constant Dynamic Treatment Effects\n\n\n\n\n\n\nCode\ndf_est5 %>% \n  select(group,year, estimate,method) %>% \n  filter(method %in% c(\"TWFE\",\"CS\")) %>% \n  spread(method,estimate) %>% \n  ggplot(aes(x = TWFE, y = CS, group = year, colour = factor(group)))+\n  geom_point() + \n  #facet_wrap(~group) + \n  theme_few() + \n  geom_abline(aes(slope=1,intercept=0),lty=3)  + \n  theme(legend.position = \"bottom\") + \n  ggsci::scale_color_aaas(name=\"Treatment Cohort\")\n\n\n\n\n\nFigure 16: Comparison of Treatment Effect Estimates - Multiple Treatment Periods and Constant Dynamic Treatment Effects"
  },
  {
    "objectID": "blog/drafts/twfe-twm-and-did.html#estimate-models-7",
    "href": "blog/drafts/twfe-twm-and-did.html#estimate-models-7",
    "title": "Two-Way Fixed Effects, the Two-Way Mundlak Regression, and Difference-in-Difference Estimators",
    "section": "Estimate Models",
    "text": "Estimate Models\nWe next estimate the models\n\n\n\n\n\n\n\n\n\nMethod\nCommand\nDesign Variables\nFixed or Random Effect\n\n\n\n\nTwo-Way Fixed Effects\nfeols()\nd* : f* + f*\nUnit Fixed Effect\n\n\nPooled OLS\nlm()\nd* : f* + f* + d*\n\n\n\nTwo-Way Mundlak\nlmer()\nd* : f* + f* + d*\nUnit Random Effect\n\n\n\n\n\nCode\nfmla_twfe6 <-   fmla <- glue(\"y ~ {paste0(treatment_interactions6, collapse = ' + ')} + {paste0('f',treatment_years6,collapse=' + ')} | id\") %>% as.formula()\nfit_twfe6 <- feols(fmla_twfe6, data = df6_)\n\nfmla_lm6 <- glue(\"y ~ {paste0(treatment_interactions6, collapse = ' + ')} + {paste0('f',treatment_years6,collapse=' + ')} + {paste0('d',treatment_groups6,collapse=' + ')}\") %>% as.formula()\nfit_lm6 <- lm(fmla_lm6, data = df6_) \n\nfmla_twm6 <- glue(\"y ~ {paste0(treatment_interactions6, collapse = ' + ')} + {paste0('f',treatment_years6,collapse=' + ')} + {paste0('d',treatment_groups6,collapse=' + ')} + (1|id)\") %>% as.formula()\nfit_twm6 <- lmer( fmla_twm6 , data = df6_) \n\ntibble(method = c(\"TWFE\",\"POLS\",\"TWM\"),\n         formula = c(glue(\"feols({Reduce(paste,deparse(fmla_twfe6))}, data = df_)\"),\n                     glue(\"lm({Reduce(paste,deparse(fmla_lm6))}, data = df_)\"),\n                     glue(\"lmer({Reduce(paste,deparse(fmla_twm6))}, data = df_)\"))) %>% \n  gt() %>% \n  cols_label(\"method\" = \"Estimator\",\n             \"formula\" = \"Regression Call\")\n\n\n\n\n\n\n  \n  \n    \n      Estimator\n      Regression Call\n    \n  \n  \n    TWFE\nfeols(y ~ d1989:f1989 + d1989:f1990 + d1989:f1991 + d1989:f1992 + d1989:f1993 +      d1989:f1994 + d1989:f1995 + d1989:f1996 + d1989:f1997 + d1989:f1998 +      d1989:f1999 + d1989:f2000 + d1989:f2001 + d1989:f2002 + d1989:f2003 +      d1989:f2004 + d1989:f2005 + d1989:f2006 + d1998:f1998 + d1998:f1999 +      d1998:f2000 + d1998:f2001 + d1998:f2002 + d1998:f2003 + d1998:f2004 +      d1998:f2005 + d1998:f2006 + f1989 + f1990 + f1991 + f1992 +      f1993 + f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 +      f2001 + f2002 + f2003 + f2004 + f2005 + f2006 | id, data = df_)\n    POLS\nlm(y ~ d1989:f1989 + d1989:f1990 + d1989:f1991 + d1989:f1992 + d1989:f1993 +      d1989:f1994 + d1989:f1995 + d1989:f1996 + d1989:f1997 + d1989:f1998 +      d1989:f1999 + d1989:f2000 + d1989:f2001 + d1989:f2002 + d1989:f2003 +      d1989:f2004 + d1989:f2005 + d1989:f2006 + d1998:f1998 + d1998:f1999 +      d1998:f2000 + d1998:f2001 + d1998:f2002 + d1998:f2003 + d1998:f2004 +      d1998:f2005 + d1998:f2006 + f1989 + f1990 + f1991 + f1992 +      f1993 + f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 +      f2001 + f2002 + f2003 + f2004 + f2005 + f2006 + d1989 + d1998, data = df_)\n    TWM\nlmer(y ~ d1989:f1989 + d1989:f1990 + d1989:f1991 + d1989:f1992 + d1989:f1993 +      d1989:f1994 + d1989:f1995 + d1989:f1996 + d1989:f1997 + d1989:f1998 +      d1989:f1999 + d1989:f2000 + d1989:f2001 + d1989:f2002 + d1989:f2003 +      d1989:f2004 + d1989:f2005 + d1989:f2006 + d1998:f1998 + d1998:f1999 +      d1998:f2000 + d1998:f2001 + d1998:f2002 + d1998:f2003 + d1998:f2004 +      d1998:f2005 + d1998:f2006 + f1989 + f1990 + f1991 + f1992 +      f1993 + f1994 + f1995 + f1996 + f1997 + f1998 + f1999 + f2000 +      f2001 + f2002 + f2003 + f2004 + f2005 + f2006 + d1989 + d1998 +      (1 | id), data = df_)\n  \n  \n  \n\n\n\n\nCode\n# CS\ndata6_cs <- \n  data6 %>% \n  mutate(year = as.numeric(paste0(year)),\n         treatment_time = as.numeric(paste0(treatment_time)))  %>% \n  mutate(treatment_time = ifelse(is.na(treatment_time),0,treatment_time))\n\n\nfit_cs6 <- att_gt(yname = \"dep_var\",\n                  tname = \"year\",\n                  idname = \"unit\",\n                  gname = \"treatment_time\",\n                  control_group = \"notyettreated\",\n                  data = data6_cs\n)\n\nest_cs6 <-  tibble(group = paste0(fit_cs6$group), year = fit_cs6$t, estimate = fit_cs6$att) %>% \n  mutate(method = \"CS\")"
  },
  {
    "objectID": "blog/drafts/twfe-twm-and-did.html#summary-of-estimates-7",
    "href": "blog/drafts/twfe-twm-and-did.html#summary-of-estimates-7",
    "title": "Two-Way Fixed Effects, the Two-Way Mundlak Regression, and Difference-in-Difference Estimators",
    "section": "Summary of Estimates",
    "text": "Summary of Estimates\n\n\nCode\nest_twfe6 <- \n  fit_twfe6 %>% tidy() %>% \n  mutate(method = \"TWFE\") %>% \n  mutate(call = glue(\"feols({Reduce(paste,deparse(fmla_twfe6))}, data = df6_)\"))\n\nest_lm6 <- \n  fit_lm6 %>% tidy() %>% \n  mutate(call = glue(\"lm({Reduce(paste,deparse(fmla_lm6))}, data = df6_)\"))  %>% \n  mutate(method = \"POLS\")\n\nest_twm6 <- \n  fit_twm6  %>% summary() %>% \n  coef() %>% \n  data.frame() %>% \n  rownames_to_column(var = \"term\") %>% \n  janitor::clean_names() %>% \n  as_tibble() %>% \n  mutate(method = \"TWM\") %>% \n  mutate(call = glue(\"lmer({Reduce(paste,deparse(fmla_twm6))}, data = df6_)\"))\n\nest6 <- \n  est_twfe6 %>% \n  bind_rows(est_lm6) %>% \n  bind_rows(est_twm6) %>% \n  filter(grepl(\"^f|^d\",term)) %>% \n  filter(grepl(\":\",term)) %>%   \n  #data.frame() %>% select(term,estimate) %>% \n  separate(term,into=c(\"one\",\"two\"), sep = \":\")  %>% \n  mutate(group = case_when(grepl(\"^d\",one) ~ one, \n                           TRUE ~ two)) %>% \n  mutate(year = case_when(grepl(\"^f\",one) ~ one, \n                           TRUE ~ two))     %>% \n  mutate(group = gsub(\"d\",\"\",group)) %>% \n  mutate(group = as.numeric(paste0(group)))  %>% \n  mutate(year = gsub(\"f\",\"\",year)) %>%     \n  mutate(year = as.numeric(paste0(year))) %>% \n  select(-one,-two) %>% \n  bind_rows(est_cs6 %>% mutate(group = as.numeric(paste0(group))))\n\ndf_est6 <- \n  crossing(group= treatment_groups6, year = treatment_years6) %>% \n  as_tibble() %>%\n  mutate(year = as.numeric(paste0(year))) %>% \n  left_join(est6, c(\"group\",\"year\")) %>% \n  mutate(year = as.numeric(paste0(year))) %>% \n  filter(!is.na(estimate))\n\ndf_est6 %>% \n  select(group, year,estimate,method) %>% \n  spread(method,estimate) %>% \n  select(group, year,TWFE,POLS,TWM,CS) %>% \n  na.omit() %>% \n  gt() %>% \n  fmt_number(columns=c(TWFE,POLS,TWM,CS),decimals=3)\n\n\n\n\n\n\n  \n  \n    \n      group\n      year\n      TWFE\n      POLS\n      TWM\n      CS\n    \n  \n  \n    1989\n1989\n0.405\n0.405\n0.405\n0.320\n    1989\n1990\n0.904\n0.904\n0.904\n0.819\n    1989\n1991\n1.392\n1.392\n1.392\n1.306\n    1989\n1992\n1.853\n1.853\n1.853\n1.768\n    1989\n1993\n2.359\n2.359\n2.359\n2.274\n    1989\n1994\n2.940\n2.940\n2.940\n2.855\n    1989\n1995\n3.456\n3.456\n3.456\n3.371\n    1989\n1996\n3.767\n3.767\n3.767\n3.682\n    1989\n1997\n4.300\n4.300\n4.300\n4.215\n    1989\n1998\n4.628\n4.628\n4.628\n4.609\n    1989\n1999\n5.205\n5.205\n5.205\n5.186\n    1989\n2000\n5.710\n5.710\n5.710\n5.691\n    1989\n2001\n6.150\n6.150\n6.150\n6.131\n    1989\n2002\n6.690\n6.690\n6.690\n6.670\n    1989\n2003\n7.261\n7.261\n7.261\n7.242\n    1989\n2004\n7.566\n7.566\n7.566\n7.546\n    1989\n2005\n8.143\n8.143\n8.143\n8.124\n    1989\n2006\n8.618\n8.618\n8.618\n8.598\n    1998\n1998\n0.177\n0.177\n0.177\n0.281\n    1998\n1999\n0.624\n0.624\n0.624\n0.728\n    1998\n2000\n0.860\n0.860\n0.860\n0.964\n    1998\n2001\n1.174\n1.174\n1.174\n1.278\n    1998\n2002\n1.487\n1.487\n1.487\n1.591\n    1998\n2003\n1.871\n1.871\n1.871\n1.975\n    1998\n2004\n2.031\n2.031\n2.031\n2.135\n    1998\n2005\n2.495\n2.495\n2.495\n2.599\n    1998\n2006\n2.703\n2.703\n2.703\n2.807\n  \n  \n  \n\n\n\n\n\n\nCode\nplot_data(df6) + \n  geom_line(data = df_est6, aes(x = year, y = estimate, colour = factor(group),lty=factor(method)), lwd=2)  +\n  theme(legend.position=\"bottom\")\n\n\n\n\n\nFigure 17: Treatment Effect Estimates - Multiple Treatment Periods and Heterogeneous Dynamic Treatment Effects\n\n\n\n\n\n\nCode\ndf_est6 %>% \n  select(group,year, estimate,method) %>% \n  filter(method %in% c(\"TWFE\",\"CS\")) %>% \n  spread(method,estimate) %>% \n  ggplot(aes(x = TWFE, y = CS, group = year, colour = factor(group)))+\n  geom_point() + \n  #facet_wrap(~group) + \n  theme_few() + \n  geom_abline(aes(slope=1,intercept=0),lty=3) +  theme(legend.position = \"bottom\") + \n  ggsci::scale_color_aaas(name=\"Treatment Cohort\")\n\n\n\n\n\nFigure 18: Comparison of Treatment Effect Estimates - Multiple Treatment Periods and Heterogeneous Dynamic Treatment Effects\n\n\n\n\nNice video discussion of hte above."
  },
  {
    "objectID": "blog/storage/post2.html",
    "href": "blog/storage/post2.html",
    "title": "second post",
    "section": "",
    "text": "National Harbor1 is a census-designated place (CDP) in Prince George’s County, Maryland, United States, located along the Potomac River near the Woodrow Wilson Bridge and just south of Washington. It originated as a 300-acre (1.2 km2) multi-use waterfront development. Per the 2020 census, the population was 5,509."
  },
  {
    "objectID": "blog/storage/post2.html#development",
    "href": "blog/storage/post2.html#development",
    "title": "second post",
    "section": "Development",
    "text": "Development\nThe Gaylord National Resort & Convention Center at National Harbor opened on April 1, 2008 in Oxon Hill, Maryland. The site is being developed by Milton Peterson’s Peterson Companies with the project expected to cost well over $2 billion, and a construction time frame of 2007 to late 2014. As of April 2016 construction was continuing and the cost was set at $4 billion. In 2010, the development was designated as a census-designated place.\n\n\nReasons to go:\n\nFerris wheel\nFerris wheel\n\n\n\n\n\n\n\nGaylord National Resort\n\n\n\nBe prepared for the massive scale of the atrium which has a mini-version of a town inside it.\n\n\n\n\n\n\n\n\nDisney\nThe land developed for National Harbor was previously Salubria Plantation, built in 1827 by Dr. John H. Bayne. The plantation house burned down in 1981 and was offered for sale along with the surrounding land. The land was sold in 1984 and in 1994 was rezoned for mixed-use development. In the fall of 1997, the Maryland Department of the Environment and the Army Corps of Engineers approved new developer permits, granted for the PortAmerica project in 1988.\n\n\n\n\n\n\n\n(a) View from Virginia.\n\n\n\n\n\n\n\n(b) View from the air.\n\n\n\n\n\n\n\n\n\n(c) View from the promenade.\n\n\n\n\nFigure 1: Three views of the ferris wheel.\n\n\nHere’s a big version of one of those images!\n\n\n\n\nA BIG view from the promenade."
  },
  {
    "objectID": "blog/storage/did-revisited.html#plot-data",
    "href": "blog/storage/did-revisited.html#plot-data",
    "title": "Simulate DID Data",
    "section": "Plot Data",
    "text": "Plot Data\n\n\n\n\n\n\n\n\nSource\nReview paper\nWooldridge"
  },
  {
    "objectID": "slides/peer-review-assignment.html#peer-review-assigment",
    "href": "slides/peer-review-assignment.html#peer-review-assigment",
    "title": "Peer Review Assignment",
    "section": "Peer Review Assigment",
    "text": "Peer Review Assigment\n\nDue in roughly one month!\nIdea: Critique an unpublished working paper from NBER series, or from MedRxiv\nNext slides will provide an overview and structure of a “good” peer review.\nSource for material is here"
  },
  {
    "objectID": "slides/peer-review-assignment.html#first-read-overview",
    "href": "slides/peer-review-assignment.html#first-read-overview",
    "title": "Peer Review Assignment",
    "section": "First Read: Overview",
    "text": "First Read: Overview\n\nDoes your expertise cover all aspects of the article? If not, describe which sections you can respond to and why?"
  },
  {
    "objectID": "slides/peer-review-assignment.html#first-read-overview-1",
    "href": "slides/peer-review-assignment.html#first-read-overview-1",
    "title": "Peer Review Assignment",
    "section": "First Read: Overview",
    "text": "First Read: Overview\n\n\n“Mirror” the article. Make a first draft describing the main aim of the article and why it’s innovative.\n\nThink of this as an opportunity to summarize what you think the thrust of the study is about. It provides the author & editor with an opportunity to see another “abstract”—are the reviewers primary takeways the same as the author?"
  },
  {
    "objectID": "slides/peer-review-assignment.html#second-read-the-science",
    "href": "slides/peer-review-assignment.html#second-read-the-science",
    "title": "Peer Review Assignment",
    "section": "Second Read: The Science",
    "text": "Second Read: The Science\n\nFor the rest of the review, try and separate your points into “Major” or “Minor” issues and/or suggestions. Using bullet points can help the author(s) keep track when responding to your review."
  },
  {
    "objectID": "slides/peer-review-assignment.html#second-read-the-science-1",
    "href": "slides/peer-review-assignment.html#second-read-the-science-1",
    "title": "Peer Review Assignment",
    "section": "Second Read: The Science",
    "text": "Second Read: The Science\n\nDo the Introduction and Abstract clearly identify the need and relevance for this research?"
  },
  {
    "objectID": "slides/peer-review-assignment.html#second-read-the-science-2",
    "href": "slides/peer-review-assignment.html#second-read-the-science-2",
    "title": "Peer Review Assignment",
    "section": "Second Read: The Science",
    "text": "Second Read: The Science\n\nDoes the Methodology target the main question(s) appropriately?"
  },
  {
    "objectID": "slides/peer-review-assignment.html#second-read-the-science-3",
    "href": "slides/peer-review-assignment.html#second-read-the-science-3",
    "title": "Peer Review Assignment",
    "section": "Second Read: The Science",
    "text": "Second Read: The Science\n\nAre the Results clearly and logically presented, and are they justified by the data presented?\nAre the figures clear and fully described?"
  },
  {
    "objectID": "slides/peer-review-assignment.html#second-read-the-science-4",
    "href": "slides/peer-review-assignment.html#second-read-the-science-4",
    "title": "Peer Review Assignment",
    "section": "Second Read: The Science",
    "text": "Second Read: The Science\n\nDo the Conclusions justifiably respond to main questions the author(s) posed?\nDo the Conclusions go too far or not far enough based on the results?"
  },
  {
    "objectID": "slides/peer-review-assignment.html#second-read-the-science-5",
    "href": "slides/peer-review-assignment.html#second-read-the-science-5",
    "title": "Peer Review Assignment",
    "section": "Second Read: The Science",
    "text": "Second Read: The Science\n\nIs the manuscript’s story cohesive and tightly reasoned throughout?\nIf not, where does it deviate from the central argument?"
  },
  {
    "objectID": "slides/peer-review-assignment.html#final-review-report",
    "href": "slides/peer-review-assignment.html#final-review-report",
    "title": "Peer Review Assignment",
    "section": "Final Review Report",
    "text": "Final Review Report\nCompile your responses to the points above into a single document. Here is a suggested order for your review."
  },
  {
    "objectID": "slides/peer-review-assignment.html#final-review-report-1",
    "href": "slides/peer-review-assignment.html#final-review-report-1",
    "title": "Peer Review Assignment",
    "section": "Final Review Report",
    "text": "Final Review Report\n1. Introduction\n\nMirror the article, your expertise and whether the paper is publishable or if there are fatal flaws\nInclude a short list of the paper’s key strengths and weaknesses."
  },
  {
    "objectID": "slides/peer-review-assignment.html#final-review-report-2",
    "href": "slides/peer-review-assignment.html#final-review-report-2",
    "title": "Peer Review Assignment",
    "section": "Final Review Report",
    "text": "Final Review Report\n2. Major issues\n\nIf there is a major issue you believe must be addressed in revision, note that explicitly here."
  },
  {
    "objectID": "slides/peer-review-assignment.html#final-review-report-3",
    "href": "slides/peer-review-assignment.html#final-review-report-3",
    "title": "Peer Review Assignment",
    "section": "Final Review Report",
    "text": "Final Review Report\n3. Minor issues and other suggestions.\n\nThis could include some specification checks or additions to supplementary material you think might be useful.\nIt could include some exploratory comments (‘you might try..’) and/or suggestions"
  },
  {
    "objectID": "slides/peer-review-assignment.html#final-comments",
    "href": "slides/peer-review-assignment.html#final-comments",
    "title": "Peer Review Assignment",
    "section": "Final Comments",
    "text": "Final Comments\n\nIt is common to receive 1-2pp reviews.\n“Borderline” reviews (i.e., peer review of a study that would need a lot of work to accept) often run longer, as you want to lay out explicitly what the author(s) need to do.\nCommon review turnaround times are 2-4weeks for clinical/health services journals, 1-2 months for longer form (e.g., economics)."
  },
  {
    "objectID": "slides/peer-review-assignment.html#more-resources",
    "href": "slides/peer-review-assignment.html#more-resources",
    "title": "Peer Review Assignment",
    "section": "More Resources",
    "text": "More Resources\n\nA nice overview paper on peer review.\nNature Masterclass on Peer Review\n\n\n\nBack to Website"
  },
  {
    "objectID": "slides/next-gen-DID.html#policy-evaluation-methods-until-2018",
    "href": "slides/next-gen-DID.html#policy-evaluation-methods-until-2018",
    "title": "Fourteen DID estimators walk into a bar \\(\\tau\\)",
    "section": "Policy Evaluation Methods Until 2018",
    "text": "Policy Evaluation Methods Until 2018"
  },
  {
    "objectID": "slides/next-gen-DID.html#policy-evaluation-2018-2021",
    "href": "slides/next-gen-DID.html#policy-evaluation-2018-2021",
    "title": "Fourteen DID estimators walk into a bar \\(\\tau\\)",
    "section": "Policy Evaluation: 2018-2021",
    "text": "Policy Evaluation: 2018-2021"
  },
  {
    "objectID": "slides/next-gen-DID.html#policy-evaluation-2018-2021-1",
    "href": "slides/next-gen-DID.html#policy-evaluation-2018-2021-1",
    "title": "Fourteen DID estimators walk into a bar \\(\\tau\\)",
    "section": "Policy Evaluation: 2018-2021",
    "text": "Policy Evaluation: 2018-2021\nThe rest of us:"
  },
  {
    "objectID": "slides/next-gen-DID.html#policy-evaluation-2021",
    "href": "slides/next-gen-DID.html#policy-evaluation-2021",
    "title": "Fourteen DID estimators walk into a bar \\(\\tau\\)",
    "section": "Policy Evaluation: 2021",
    "text": "Policy Evaluation: 2021\nEconometricians:"
  },
  {
    "objectID": "slides/next-gen-DID.html#policy-evaluation-2021-1",
    "href": "slides/next-gen-DID.html#policy-evaluation-2021-1",
    "title": "Fourteen DID estimators walk into a bar \\(\\tau\\)",
    "section": "Policy Evaluation: 2021",
    "text": "Policy Evaluation: 2021\nThe rest of us:"
  },
  {
    "objectID": "slides/next-gen-DID.html#after-today",
    "href": "slides/next-gen-DID.html#after-today",
    "title": "Fourteen DID estimators walk into a bar \\(\\tau\\)",
    "section": "After Today",
    "text": "After Today"
  },
  {
    "objectID": "slides/next-gen-DID.html#todays-plan",
    "href": "slides/next-gen-DID.html#todays-plan",
    "title": "Fourteen DID estimators walk into a bar \\(\\tau\\)",
    "section": "Today’s Plan",
    "text": "Today’s Plan\n\n\nGeneral principles for DID designs with staggered adoption.\nData wrangling for DID designs with staggered adoption.\nlearnr exercise for eight DID estimators.\n\n\nWe’re going to ignore standard TWFE and TWFE Event Study estimators, given all the problems.\nWe’ll also focus on dynamic treatment effect estimates, though some estimators also yield static estimates.\nWe’ll also skip over extended POLS and extended Mundlak (random effects), though implementing them is straightforward (see last week’s exercises).\n\n\nWe’ll come back to “conditional DID” in a future class (i.e., the design variables will not include covariates)"
  },
  {
    "objectID": "slides/next-gen-DID.html#general-principles-for-did-designs-with-staggered-adoption.",
    "href": "slides/next-gen-DID.html#general-principles-for-did-designs-with-staggered-adoption.",
    "title": "Fourteen DID estimators walk into a bar \\(\\tau\\)",
    "section": "General principles for DID designs with staggered adoption.",
    "text": "General principles for DID designs with staggered adoption.\nData selection and setup is key.\n\n\n\n\n\n\nImportant\n\n\n\nIf all groups are eventually treated, you’ll need to “trim” the data of all observations on or after the last treated cohort date."
  },
  {
    "objectID": "slides/next-gen-DID.html#general-principles-for-did-designs-with-staggered-adoption.-1",
    "href": "slides/next-gen-DID.html#general-principles-for-did-designs-with-staggered-adoption.-1",
    "title": "Fourteen DID estimators walk into a bar \\(\\tau\\)",
    "section": "General principles for DID designs with staggered adoption.",
    "text": "General principles for DID designs with staggered adoption.\nData selection and setup is key.\n\n\n\n\n\n\nImportant\n\n\n\nDefine a treatment cohort variable with values set to the first year of treatment for the unit. Never treated units should be assigned a value of 0 for this cohort variable."
  },
  {
    "objectID": "slides/next-gen-DID.html#general-principles-for-did-designs-with-staggered-adoption.-2",
    "href": "slides/next-gen-DID.html#general-principles-for-did-designs-with-staggered-adoption.-2",
    "title": "Fourteen DID estimators walk into a bar \\(\\tau\\)",
    "section": "General principles for DID designs with staggered adoption.",
    "text": "General principles for DID designs with staggered adoption.\nData selection and setup is key.\n\n\n\n\n\n\nImportant\n\n\n\nWhen constructing a relative-time variable (i.e., time - cohort_tx_time), never treated units should get a value of -Inf."
  },
  {
    "objectID": "slides/next-gen-DID.html#general-principles-for-did-designs-with-staggered-adoption.-3",
    "href": "slides/next-gen-DID.html#general-principles-for-did-designs-with-staggered-adoption.-3",
    "title": "Fourteen DID estimators walk into a bar \\(\\tau\\)",
    "section": "General principles for DID designs with staggered adoption.",
    "text": "General principles for DID designs with staggered adoption.\nOnce you do all the above, you are teed up to fit any of the NextGen DID estimators.\n\nWooldridge (2021): Extended TWFE, POLS and Mundlak (Random Effects) regression.\nCallaway and Sant’Anna (2021) : Group-time ATTs\nBorusyak, Jaravel, and Spiess (2021) : Imputation-based DID\nGardner (2021) : Two-stage DID\nDe Chaisemartin and d’Haultfoeuille (2020) : Generalized “fix” for two-way fixed effects.\nAthey et al. (2021): Matrix completion methods\nCengiz et al. (2019): Stacked regression"
  },
  {
    "objectID": "slides/next-gen-DID.html#nextgen-did-estimators",
    "href": "slides/next-gen-DID.html#nextgen-did-estimators",
    "title": "Fourteen DID estimators walk into a bar \\(\\tau\\)",
    "section": "NextGen DID Estimators",
    "text": "NextGen DID Estimators\n\nI won’t go through details today, but you should familiarize yourself with whatever method you choose."
  },
  {
    "objectID": "slides/next-gen-DID.html#nextgen-did-estimators-1",
    "href": "slides/next-gen-DID.html#nextgen-did-estimators-1",
    "title": "Fourteen DID estimators walk into a bar \\(\\tau\\)",
    "section": "NextGen DID Estimators",
    "text": "NextGen DID Estimators\n\n\nStandard practice used to be just (naively) fitting a TWFE-based regression.\n\nThis is fine in the simple 2x2 DID case.\nIt breaks down in the presense of staggered treatment adoption and heterogeneous treatment effects.\n\nWooldridge (2021) demonstrates that a carefully specified regression can give us a line of sight through the danger zones."
  },
  {
    "objectID": "slides/next-gen-DID.html#nextgen-did-estimators-2",
    "href": "slides/next-gen-DID.html#nextgen-did-estimators-2",
    "title": "Fourteen DID estimators walk into a bar \\(\\tau\\)",
    "section": "NextGen DID Estimators",
    "text": "NextGen DID Estimators\n\n\nIn general, the other new estimators are explicit about making “clean” comparisons and avoiding “forbidden” comparisons.\nGeneral Idea #1: estimate “clean” treatment effects for various treatment cohorts, and then aggregate them together into relative time (or calendar time).\nGeneral Idea #2: Imputation of missing potential outcomes."
  },
  {
    "objectID": "slides/next-gen-DID.html#nextgen-did-estimators-3",
    "href": "slides/next-gen-DID.html#nextgen-did-estimators-3",
    "title": "Fourteen DID estimators walk into a bar \\(\\tau\\)",
    "section": "NextGen DID Estimators",
    "text": "NextGen DID Estimators\n\n\nBenefit of new estimators: in principle, you’re being transparent about your comparisons and the “weights” you use to aggregate across groups.\nDouble-edged sword: many of the estimators have R & Stata commands, but they can be a bit of a “black box.”\nRoth et al. (2022) provides a very nice, approchable summary of the recent literature. Link to paper."
  },
  {
    "objectID": "slides/next-gen-DID.html#data-prep-step-0-raw-data",
    "href": "slides/next-gen-DID.html#data-prep-step-0-raw-data",
    "title": "Fourteen DID estimators walk into a bar \\(\\tau\\)",
    "section": "Data Prep Step 0: Raw Data",
    "text": "Data Prep Step 0: Raw Data\nLet’s start out with the simplest possible data structure.\n\nUnits (e.g., patients, states, etc.) unit\nTime year\nOutcome y_it\nTime-varying (binary) treatment indicator d_it\nA unit-specific (time invariant) covariate x_i\nA unit- and time-specific covariate x_it\n\nWe actually won’t use x_i or x_it today, so we can ignore them for now."
  },
  {
    "objectID": "slides/next-gen-DID.html#data-prep-step-0-raw-data-1",
    "href": "slides/next-gen-DID.html#data-prep-step-0-raw-data-1",
    "title": "Fourteen DID estimators walk into a bar \\(\\tau\\)",
    "section": "Data Prep Step 0: Raw Data",
    "text": "Data Prep Step 0: Raw Data\nLet’s take a look at the first few rows of our data:\n\n\n\n\n \n  \n    unit \n    year \n    y_it \n    d_it \n    x_i \n    x_it \n  \n \n\n  \n    1 \n    2005 \n    0.627 \n    0 \n    1.553 \n    -0.484 \n  \n  \n    1 \n    2006 \n    -0.157 \n    0 \n    1.553 \n    0.472 \n  \n  \n    1 \n    2007 \n    -0.261 \n    0 \n    1.553 \n    -0.406 \n  \n  \n    1 \n    2008 \n    -0.319 \n    0 \n    1.553 \n    -0.735 \n  \n  \n    1 \n    2009 \n    -1.670 \n    0 \n    1.553 \n    -2.017 \n  \n  \n    1 \n    2010 \n    -2.920 \n    0 \n    1.553 \n    -2.331"
  },
  {
    "objectID": "slides/next-gen-DID.html#data-prep-step-1a-identify-treatment-cohorts",
    "href": "slides/next-gen-DID.html#data-prep-step-1a-identify-treatment-cohorts",
    "title": "Fourteen DID estimators walk into a bar \\(\\tau\\)",
    "section": "Data Prep Step 1a: Identify Treatment Cohorts",
    "text": "Data Prep Step 1a: Identify Treatment Cohorts\n\nOur next objective is to identify the various treatment cohorts in our data.\nTo do this, we will ask “when is the first year this unit is treated”?\nBased on the answer to this question, we will be able to identify all of the cohorts based on the first year they are treated."
  },
  {
    "objectID": "slides/next-gen-DID.html#data-prep-step-1a-identify-treatment-cohorts-1",
    "href": "slides/next-gen-DID.html#data-prep-step-1a-identify-treatment-cohorts-1",
    "title": "Fourteen DID estimators walk into a bar \\(\\tau\\)",
    "section": "Data Prep Step 1a: Identify Treatment Cohorts",
    "text": "Data Prep Step 1a: Identify Treatment Cohorts\n\nIdentify first year each unit was treated\n\ndf_ <- \n  df %>% \n  #########\n  # Step 1a\n  #########\n  arrange(unit,year) %>% \n  # What year is the unit first treated in?\n  mutate(first_treated = as.integer(lag(d_it==0) & d_it==1)) %>% \n  group_by(unit) %>% \n  # Is the unit never treated (i.e., d_it is never 1)\n  mutate(never_treated = as.integer(sum(d_it)==0))  %>% \n  ungroup() %>% \n  mutate(first_treated = year * first_treated) %>% \n  group_by(unit) %>% \n  # Treatment cohort \n  mutate(treatment_cohort = max(first_treated)) %>% \n  ungroup()"
  },
  {
    "objectID": "slides/next-gen-DID.html#data-prep-step-1a-identify-treatment-cohorts-2",
    "href": "slides/next-gen-DID.html#data-prep-step-1a-identify-treatment-cohorts-2",
    "title": "Fourteen DID estimators walk into a bar \\(\\tau\\)",
    "section": "Data Prep Step 1a: Identify Treatment Cohorts",
    "text": "Data Prep Step 1a: Identify Treatment Cohorts\n\nIdentify never-treated units (if any)\n\ndf_ <- \n  df %>% \n  #########\n  # Step 1a\n  #########\n  arrange(unit,year) %>% \n  # What year is the unit first treated in?\n  mutate(first_treated = as.integer(lag(d_it==0) & d_it==1)) %>% \n  group_by(unit) %>% \n  # Is the unit never treated (i.e., d_it is never 1)\n  mutate(never_treated = as.integer(sum(d_it)==0))  %>% \n  ungroup() %>% \n  mutate(first_treated = year * first_treated) %>% \n  group_by(unit) %>% \n  # Treatment cohort \n  mutate(treatment_cohort = max(first_treated)) %>% \n  ungroup()"
  },
  {
    "objectID": "slides/next-gen-DID.html#data-prep-step-1a-identify-treatment-cohorts-3",
    "href": "slides/next-gen-DID.html#data-prep-step-1a-identify-treatment-cohorts-3",
    "title": "Fourteen DID estimators walk into a bar \\(\\tau\\)",
    "section": "Data Prep Step 1a: Identify Treatment Cohorts",
    "text": "Data Prep Step 1a: Identify Treatment Cohorts\n\nTreatment cohort names are the year of first treatment.\nTreatment cohort name is “0” for never treated units.\n\ndf_ <- \n  df %>% \n  #########\n  # Step 1a\n  #########\n  arrange(unit,year) %>% \n  # What year is the unit first treated in?\n  mutate(first_treated = as.integer(lag(d_it==0) & d_it==1)) %>% \n  group_by(unit) %>% \n  # Is the unit never treated (i.e., d_it is never 1)\n  mutate(never_treated = as.integer(sum(d_it)==0))  %>% \n  ungroup() %>% \n  mutate(first_treated = year * first_treated) %>% \n  group_by(unit) %>% \n  # Treatment cohort \n  mutate(treatment_cohort = max(first_treated)) %>% \n  ungroup()"
  },
  {
    "objectID": "slides/next-gen-DID.html#data-prep-step-1b-trim-observations",
    "href": "slides/next-gen-DID.html#data-prep-step-1b-trim-observations",
    "title": "Fourteen DID estimators walk into a bar \\(\\tau\\)",
    "section": "Data Prep Step 1b: Trim Observations",
    "text": "Data Prep Step 1b: Trim Observations\n\n\n\n\n\n\nImportant\n\n\nIf all groups are eventually treated, you’ll need to “trim” the data of all observations on or after the last treated cohort date.\n\n\n\n\nThere is no natural comparator for the last-treated group, since all other groups are already treated.\nThis step alone can take care of a significant amount of the bias from “forbidden comparisons” in TWFE DID."
  },
  {
    "objectID": "slides/next-gen-DID.html#data-prep-step-2-define-relative-time-and-calendar-time-indicators",
    "href": "slides/next-gen-DID.html#data-prep-step-2-define-relative-time-and-calendar-time-indicators",
    "title": "Fourteen DID estimators walk into a bar \\(\\tau\\)",
    "section": "Data Prep Step 2: Define Relative Time and Calendar Time Indicators",
    "text": "Data Prep Step 2: Define Relative Time and Calendar Time Indicators\n\nSet relative time to -Inf for never treated units.\n\ndf_ <- \n  df %>% \n  #########\n  # Step 1a\n  #########\n  ... \n  ##########\n  # Step 2\n  ##########\n  # Relative time variable\n  mutate(rel_time = year - treatment_cohort) %>% \n  mutate(rel_time = ifelse(never_treated==1, -Inf, rel_time))  %>% \n  # Create dummy indicators for treatment cohorts, years, and relative time. \n  dummy_cols(c(\"treatment_cohort\",\"year\",\"rel_time\"))  %>%  \n  # Rename to remove the minus sign\n  rename_at(vars(contains(\"rel_time_\")),function(x) gsub(\"-\",\"lag\",x)) %>% \n  # Never treated units should have values of 0 for all relative-time indicators. \n  mutate_at(vars(contains(\"rel_time_\")),function(x) ifelse(is.na(x),0,x))"
  },
  {
    "objectID": "slides/next-gen-DID.html#data-prep-step-2-define-relative-time-and-calendar-time-indicators-1",
    "href": "slides/next-gen-DID.html#data-prep-step-2-define-relative-time-and-calendar-time-indicators-1",
    "title": "Fourteen DID estimators walk into a bar \\(\\tau\\)",
    "section": "Data Prep Step 2: Define Relative Time and Calendar Time Indicators",
    "text": "Data Prep Step 2: Define Relative Time and Calendar Time Indicators\n\nCan easily create dummy variable indicators using FastDummies package.\nDue to negative values, the - sign can complicate variable names, so we just replace with lag.\n\ndf_ <- \n  df %>% \n  #########\n  # Step 1a\n  #########\n  ... \n  ##########\n  # Step 2\n  ##########\n  # Relative time variable\n  mutate(rel_time = year - treatment_cohort) %>% \n  mutate(rel_time = ifelse(never_treated==1, -Inf, rel_time))  %>% \n  # Create dummy indicators for treatment cohorts, years, and relative time. \n  dummy_cols(c(\"treatment_cohort\",\"year\",\"rel_time\"))  %>%  \n  # Rename to remove the minus sign\n  rename_at(vars(contains(\"rel_time_\")),function(x) gsub(\"-\",\"lag\",x)) %>% \n  # Never treated units should have values of 0 for all relative-time indicators. \n  mutate_at(vars(contains(\"rel_time_\")),function(x) ifelse(is.na(x),0,x))"
  },
  {
    "objectID": "slides/next-gen-DID.html#data-prep-step-2-define-relative-time-and-calendar-time-indicators-2",
    "href": "slides/next-gen-DID.html#data-prep-step-2-define-relative-time-and-calendar-time-indicators-2",
    "title": "Fourteen DID estimators walk into a bar \\(\\tau\\)",
    "section": "Data Prep Step 2: Define Relative Time and Calendar Time Indicators",
    "text": "Data Prep Step 2: Define Relative Time and Calendar Time Indicators\n\nNever treated units should have values of 0 for all relative-time indicators.\n\ndf_ <- \n  df %>% \n  #########\n  # Step 1a\n  #########\n  ... \n  ##########\n  # Step 2\n  ##########\n  # Relative time variable\n  mutate(rel_time = year - treatment_cohort) %>% \n  mutate(rel_time = ifelse(never_treated==1, -Inf, rel_time))  %>% \n  # Create dummy indicators for treatment cohorts, years, and relative time. \n  dummy_cols(c(\"treatment_cohort\",\"year\",\"rel_time\"))  %>%  \n  # Rename to remove the minus sign\n  rename_at(vars(contains(\"rel_time_\")),function(x) gsub(\"-\",\"lag\",x)) %>% \n  # Never treated units should have values of 0 for all relative-time indicators. \n  mutate_at(vars(contains(\"rel_time_\")),function(x) ifelse(is.na(x),0,x))"
  },
  {
    "objectID": "slides/next-gen-DID.html#final-data",
    "href": "slides/next-gen-DID.html#final-data",
    "title": "Fourteen DID estimators walk into a bar \\(\\tau\\)",
    "section": "Final Data",
    "text": "Final Data\nLet’s take a look at a few rows of our final data:\n\n\n\n\n \n  \n    unit \n    year \n    y_it \n    d_it \n    x_i \n    x_it \n    first_treated \n    never_treated \n    treatment_cohort \n    rel_time \n    treatment_cohort_0 \n    treatment_cohort_2010 \n    treatment_cohort_2013 \n    year_2005 \n    year_2006 \n    year_2007 \n    year_2008 \n    year_2009 \n    year_2010 \n    year_2011 \n    year_2012 \n    year_2013 \n    year_2014 \n    year_2015 \n    year_2016 \n    year_2017 \n    year_2018 \n    year_2019 \n    year_2020 \n    year_2021 \n    year_2022 \n    rel_time_lag1 \n    rel_time_lag2 \n    rel_time_lag3 \n    rel_time_lag4 \n    rel_time_lag5 \n    rel_time_lag6 \n    rel_time_lag7 \n    rel_time_lag8 \n    rel_time_lagInf \n    rel_time_0 \n    rel_time_1 \n    rel_time_2 \n    rel_time_3 \n    rel_time_4 \n    rel_time_5 \n    rel_time_6 \n    rel_time_7 \n    rel_time_8 \n    rel_time_9 \n    rel_time_10 \n    rel_time_11 \n    rel_time_12 \n  \n \n\n  \n    1 \n    2010 \n    -2.920 \n    0 \n    1.553 \n    -2.331 \n    0 \n    0 \n    2013 \n    -3 \n    0 \n    0 \n    1 \n    0 \n    0 \n    0 \n    0 \n    0 \n    1 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    1 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n  \n  \n    1 \n    2011 \n    -2.979 \n    0 \n    1.553 \n    -1.304 \n    0 \n    0 \n    2013 \n    -2 \n    0 \n    0 \n    1 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    1 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    1 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n  \n  \n    1 \n    2012 \n    -0.744 \n    0 \n    1.553 \n    -0.905 \n    0 \n    0 \n    2013 \n    -1 \n    0 \n    0 \n    1 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    1 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    1 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n  \n  \n    1 \n    2013 \n    0.194 \n    1 \n    1.553 \n    -1.677 \n    2013 \n    0 \n    2013 \n    0 \n    0 \n    0 \n    1 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    1 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    1 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n  \n  \n    1 \n    2014 \n    -0.641 \n    1 \n    1.553 \n    -2.088 \n    0 \n    0 \n    2013 \n    1 \n    0 \n    0 \n    1 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    1 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    1 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n  \n  \n    1 \n    2015 \n    -1.243 \n    1 \n    1.553 \n    -0.602 \n    0 \n    0 \n    2013 \n    2 \n    0 \n    0 \n    1 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    1 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    1 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0 \n    0"
  },
  {
    "objectID": "slides/next-gen-DID.html#learnr-exercise",
    "href": "slides/next-gen-DID.html#learnr-exercise",
    "title": "Fourteen DID estimators walk into a bar \\(\\tau\\)",
    "section": "Learnr Exercise",
    "text": "Learnr Exercise\n\nWe’ll now turn to the learnr exercise to fit the various DID estimators.\nLink to exercise"
  },
  {
    "objectID": "slides/next-gen-DID.html#references",
    "href": "slides/next-gen-DID.html#references",
    "title": "Fourteen DID estimators walk into a bar \\(\\tau\\)",
    "section": "References",
    "text": "References\n\n\nAthey, Susan, Mohsen Bayati, Nikolay Doudchenko, Guido Imbens, and Khashayar Khosravi. 2021. “Matrix Completion Methods for Causal Panel Data Models.” Journal of the American Statistical Association 116 (536): 1716–30.\n\n\nBorusyak, Kirill, Xavier Jaravel, and Jann Spiess. 2021. “Revisiting Event Study Designs: Robust and Efficient Estimation.” arXiv Preprint arXiv:2108.12419. https://arxiv.org/abs/2108.12419.\n\n\nCallaway, Brantly, and Pedro HC Sant’Anna. 2021. “Difference-in-Differences with Multiple Time Periods.” Journal of Econometrics 225 (2): 200–230.\n\n\nCengiz, Doruk, Arindrajit Dube, Attila Lindner, and Ben Zipperer. 2019. “The Effect of Minimum Wages on Low-Wage Jobs.” The Quarterly Journal of Economics 134 (3): 1405–54.\n\n\nDe Chaisemartin, Clément, and Xavier d’Haultfoeuille. 2020. “Two-Way Fixed Effects Estimators with Heterogeneous Treatment Effects.” American Economic Review 110 (9): 2964–96.\n\n\nGardner, John. 2021. “Two-Stage Difference-in-Differences,” April.\n\n\nRoth, Jonathan, Pedro HC Sant’Anna, Alyssa Bilinski, and John Poe. 2022. “What’s Trending in Difference-in-Differences? A Synthesis of the Recent Econometrics Literature.” arXiv Preprint arXiv:2201.01194. https://arxiv.org/abs/2201.01194.\n\n\nWooldridge, Jeffrey. 2021. “Two-Way Fixed Effects, the Two-Way Mundlak Regression, and Difference-in-Difference Estimators,” September."
  },
  {
    "objectID": "slides/difference-in-differences.html#outline",
    "href": "slides/difference-in-differences.html#outline",
    "title": "Extending Difference-in-Differences",
    "section": "Outline",
    "text": "Outline\n\nReview DID identifying assumptions.\nDID Estimators\n\n\nCanonical \\(2\\times2\\)\nTwo-Way Fixed Effects (TWFE) DID\nTWFE Event Study DID\nExtended DID (TWFE, random effects, and pooled OLS)"
  },
  {
    "objectID": "slides/difference-in-differences.html#notation",
    "href": "slides/difference-in-differences.html#notation",
    "title": "Extending Difference-in-Differences",
    "section": "Notation",
    "text": "Notation\n\nBinary treatment\n\\(y_z^{t}(d)\\) is the potential outcome in treatment group \\(z\\) (e.g., comparison, intervention) at time \\(t\\).\n\n\\(y_1^{post}(1)\\) is the observed post-intervention outcome of individuals in the intervention group.\n\\(y_1^{post}(0)\\) is the counterfactual post-intervention outcome of individuals in the intervention group."
  },
  {
    "objectID": "slides/difference-in-differences.html#estimand-of-interest",
    "href": "slides/difference-in-differences.html#estimand-of-interest",
    "title": "Extending Difference-in-Differences",
    "section": "Estimand of Interest",
    "text": "Estimand of Interest\n\nAverage effect of treatment on the treated (ATT)\n\n\\[\n\\pi_1 = y_1^{post}(1) - y_1^{post}(0)\n\\]\n\nThis is the difference in the post-period potential outcome under treatment versus no treatment in the intervention group."
  },
  {
    "objectID": "slides/difference-in-differences.html#estimand-of-interest-1",
    "href": "slides/difference-in-differences.html#estimand-of-interest-1",
    "title": "Extending Difference-in-Differences",
    "section": "Estimand of Interest",
    "text": "Estimand of Interest\n\nIn the post-period, we only observe the intervention group under treatment, so its potential outcome distribution under no treatment, \\(y_1^{post} (0)\\), is an unobservable counterfactual.\nThus, we must make identifying assumptions to estimate \\(\\pi_1\\) with observable quantities."
  },
  {
    "objectID": "slides/difference-in-differences.html#identifying-assumptions",
    "href": "slides/difference-in-differences.html#identifying-assumptions",
    "title": "Extending Difference-in-Differences",
    "section": "Identifying Assumptions",
    "text": "Identifying Assumptions\n\nWe can use a parallel trends assumption that the comparison group’s (additive, linear) pre- to post-period change in untreated potential outcome distribution is the same as the intervention group’s:\n\n\\[\ny_0^{post} (0)-y_0^{pre}(0)=y_1^{post} (0)-y_1^{pre} (0)  \n\\]"
  },
  {
    "objectID": "slides/difference-in-differences.html#identifying-assumptions-1",
    "href": "slides/difference-in-differences.html#identifying-assumptions-1",
    "title": "Extending Difference-in-Differences",
    "section": "Identifying Assumptions",
    "text": "Identifying Assumptions\n\nSolving for the unobservable quantity we need\n\n\\[\ny_1^{post} (0)=y_0^{post} (0)-y_0^{pre} (0)+y_1^{pre} (0)\n\\]"
  },
  {
    "objectID": "slides/difference-in-differences.html#identifying-assumptions-2",
    "href": "slides/difference-in-differences.html#identifying-assumptions-2",
    "title": "Extending Difference-in-Differences",
    "section": "Identifying Assumptions",
    "text": "Identifying Assumptions\n\nPlugging in to the target estimand, we have\n\n\\[\n\\pi_1=y_1^{post} (1)-y_0^{post} (0)+y_0^{pre} (0)-y_1^{pre} (0).\n\\]"
  },
  {
    "objectID": "slides/difference-in-differences.html#estimator",
    "href": "slides/difference-in-differences.html#estimator",
    "title": "Extending Difference-in-Differences",
    "section": "Estimator",
    "text": "Estimator\n\nWe further assume that observed outcomes correspond to potential outcomes under observed treatments (called the consistency assumption) and write the estimand in terms of observable quantities,\n\n\\[\n\\pi_1=(y_1^{post}-y_1^{pre} )-(y_0^{post}-y_0^{pre} )\n\\] where \\(y_z^{t}\\) is the observed outcome in group \\(z\\) during period \\(t\\)."
  },
  {
    "objectID": "slides/difference-in-differences.html#estimator-1",
    "href": "slides/difference-in-differences.html#estimator-1",
    "title": "Extending Difference-in-Differences",
    "section": "Estimator",
    "text": "Estimator\n\nFor the canonical 2x2 case, we can estimate this quantity using simple summaries of the proportions in each outcome value, group, and period.\n\nAlternatively, if we need to condition on covariates to make identifying assumptions plausible, we can use regression or semi-parametric approaches."
  },
  {
    "objectID": "slides/difference-in-differences.html#dimensions-of-an-intervention-and-its-effect",
    "href": "slides/difference-in-differences.html#dimensions-of-an-intervention-and-its-effect",
    "title": "Extending Difference-in-Differences",
    "section": "Dimensions of an Intervention and its Effect",
    "text": "Dimensions of an Intervention and its Effect\n\nNumber of treatment groups (single, multiple).\nTreatment timing (single, staggered rollout).\nCohort-level treatment effect heterogeneity (yes, no)\nTreatment effect type (constant, dynamic)"
  },
  {
    "objectID": "slides/difference-in-differences.html#did-estimators",
    "href": "slides/difference-in-differences.html#did-estimators",
    "title": "Extending Difference-in-Differences",
    "section": "DID Estimators",
    "text": "DID Estimators\nCommon Treatment Time, Constant Treatment Effects\n\n\n\n\n \n  \n    tx_groups \n    timing \n    het \n    tx_effect \n  \n \n\n  \n    Single \n    Single \n    No \n    Constant"
  },
  {
    "objectID": "slides/difference-in-differences.html#did-estimators-1",
    "href": "slides/difference-in-differences.html#did-estimators-1",
    "title": "Extending Difference-in-Differences",
    "section": "DID Estimators",
    "text": "DID Estimators\nCommon Treatment Time, Dynamic Treatment Effects\n\n\n\n\n \n  \n    tx_groups \n    timing \n    het \n    tx_effect \n  \n \n\n  \n    Single \n    Single \n    No \n    Dynamic"
  },
  {
    "objectID": "slides/difference-in-differences.html#did-estimators-2",
    "href": "slides/difference-in-differences.html#did-estimators-2",
    "title": "Extending Difference-in-Differences",
    "section": "DID Estimators",
    "text": "DID Estimators\nMultiple Treatment Periods and Constant Equal Treatment Effects\n\n\n\n\n \n  \n    tx_groups \n    timing \n    het \n    tx_effect \n  \n \n\n  \n    Multiple \n    Staggered \n    No \n    Constant"
  },
  {
    "objectID": "slides/difference-in-differences.html#did-estimators-3",
    "href": "slides/difference-in-differences.html#did-estimators-3",
    "title": "Extending Difference-in-Differences",
    "section": "DID Estimators",
    "text": "DID Estimators\nMultiple Treatment Periods and Constant Different Treatment Effects, All Groups Eventually Treated\n\n\n\n\n \n  \n    tx_groups \n    timing \n    het \n    tx_effect \n  \n \n\n  \n    Multiple \n    Staggered \n    Yes \n    Constant"
  },
  {
    "objectID": "slides/difference-in-differences.html#did-estimators-4",
    "href": "slides/difference-in-differences.html#did-estimators-4",
    "title": "Extending Difference-in-Differences",
    "section": "DID Estimators",
    "text": "DID Estimators\nMultiple Treatment Periods and Constant Different Treatment Effects, Never Treated Group\n\n\n\n\n \n  \n    tx_groups \n    timing \n    het \n    tx_effect \n  \n \n\n  \n    Multiple \n    Staggered \n    Yes \n    Constant"
  },
  {
    "objectID": "slides/difference-in-differences.html#did-estimators-5",
    "href": "slides/difference-in-differences.html#did-estimators-5",
    "title": "Extending Difference-in-Differences",
    "section": "DID Estimators",
    "text": "DID Estimators\nMultiple Treatment Periods and Constant Dynamic Treatment Effects\n\n\n\n\n \n  \n    tx_groups \n    timing \n    het \n    tx_effect \n  \n \n\n  \n    Multiple \n    Staggered \n    No \n    Dynamic"
  },
  {
    "objectID": "slides/difference-in-differences.html#did-estimators-6",
    "href": "slides/difference-in-differences.html#did-estimators-6",
    "title": "Extending Difference-in-Differences",
    "section": "DID Estimators",
    "text": "DID Estimators\nMultiple Treatment Periods and Heterogeneous Dynamic Treatment Effects\n\n\n\n\n \n  \n    tx_groups \n    timing \n    het \n    tx_effect \n  \n \n\n  \n    Multiple \n    Staggered \n    Yes \n    Dynamic"
  },
  {
    "objectID": "slides/difference-in-differences.html#did-estimators-7",
    "href": "slides/difference-in-differences.html#did-estimators-7",
    "title": "Extending Difference-in-Differences",
    "section": "DID Estimators",
    "text": "DID Estimators\nMultiple Treatment Periods and Heterogeneous Dynamic Treatment Effects, Never Treated Group\n\n\n\n\n \n  \n    tx_groups \n    timing \n    het \n    tx_effect \n  \n \n\n  \n    Multiple \n    Staggered \n    Yes \n    Dynamic"
  },
  {
    "objectID": "slides/difference-in-differences.html#did-estimators-9",
    "href": "slides/difference-in-differences.html#did-estimators-9",
    "title": "Extending Difference-in-Differences",
    "section": "DID Estimators",
    "text": "DID Estimators\n\n\nTwo-Way Fixed Effects DID (“TWFE”)\nTwo-Way Fixed Effects Event Study DID (“TWFE-ES”)\nExtended Differences-in-Differences (“E-DID”)\n\nExtended Two-Way Fixed Effect DID (“E-TWFE”)\nExtended Pooled OLS (“E-POLS”)\nExtended Random Effect (“Extended Two Way Mundlak” or “E-TWM”)"
  },
  {
    "objectID": "slides/difference-in-differences.html#two-way-fixed-effects-did-estimator",
    "href": "slides/difference-in-differences.html#two-way-fixed-effects-did-estimator",
    "title": "Extending Difference-in-Differences",
    "section": "Two-Way Fixed Effects DID Estimator",
    "text": "Two-Way Fixed Effects DID Estimator\n\nA common approach is a so-called “two-way fixed effects” difference-in-differences estimator:\n\n\\[\ny_{it} = \\tau D_{it} + \\delta_i + \\gamma_t + \\epsilon_{it}\n\\]"
  },
  {
    "objectID": "slides/difference-in-differences.html#two-way-fixed-effects-did-estimator-1",
    "href": "slides/difference-in-differences.html#two-way-fixed-effects-did-estimator-1",
    "title": "Extending Difference-in-Differences",
    "section": "Two-Way Fixed Effects DID Estimator",
    "text": "Two-Way Fixed Effects DID Estimator\n\\[\nY_{it} = \\tau D_{it} + \\delta_i + \\gamma_t + \\epsilon_{it}\n\\]\n\n\\(D_{it}\\) is a binary treatment indicator set to 1 if the individual is in the treated group and the the observation is in the post-treatment period.\n\\(\\delta_i\\) and \\(\\gamma_t\\) are unit and time fixed effects, respectively.\nInclusion of unit and time fixed effects flexibly accounts for both unit-specific (but time-invariant) and time-specific (but unit-invariant) unobserved confounders."
  },
  {
    "objectID": "slides/difference-in-differences.html#two-way-fixed-effects-did-estimator-2",
    "href": "slides/difference-in-differences.html#two-way-fixed-effects-did-estimator-2",
    "title": "Extending Difference-in-Differences",
    "section": "Two-Way Fixed Effects DID Estimator",
    "text": "Two-Way Fixed Effects DID Estimator\n\\[\nY_{it} = \\tau D_{it} + \\delta_i + \\gamma_t + \\epsilon_{it}\n\\]\n\nCan think of \\(\\delta_i = h(\\mathbf{U_i})\\) and \\(\\gamma_t = f(\\mathbf{V_t})\\), where \\(\\mathbf{U_i}\\) are unit specific confounders and \\(\\mathbf{V_t}\\) are time-specific confounders that are common causes of the treatment and the outcome.\n\\(h(.)\\) and \\(f(.)\\) are arbitrary functions that we do not necessarily know the structure of."
  },
  {
    "objectID": "slides/difference-in-differences.html#two-way-fixed-effects-did-estimator-3",
    "href": "slides/difference-in-differences.html#two-way-fixed-effects-did-estimator-3",
    "title": "Extending Difference-in-Differences",
    "section": "Two-Way Fixed Effects DID Estimator",
    "text": "Two-Way Fixed Effects DID Estimator\n\\[\nY_{it} = \\tau D_{it} + \\delta_i + \\gamma_t + \\epsilon_{it}\n\\]\n\nWhile the model is assuming there are no interactions between confounders \\(\\mathbf{U_i}\\) and \\(\\mathbf{V_t}\\), there are no functional form restrictions placed on \\(h(.)\\) and \\(f(.)\\).\nSo the model is only making assumptions on the additivity and separability of unobserved confounders.\nSource: Imai and Kim"
  },
  {
    "objectID": "slides/difference-in-differences.html#two-way-fixed-effects-did-estimator-4",
    "href": "slides/difference-in-differences.html#two-way-fixed-effects-did-estimator-4",
    "title": "Extending Difference-in-Differences",
    "section": "Two-Way Fixed Effects DID Estimator",
    "text": "Two-Way Fixed Effects DID Estimator\n\n\n\n\n\n\n\n\n\n\n\nTreatment Group\nTiming\nHeterogx\nTx Effect\nTWFE\n\n\n\n\nSingle\nSingle\nNo\nConstant\nYes\n\n\nSingle\nSingle\nNo\nDynamic\nYes1\n\n\nMultiple\nSingle\nNo\nConstant\nYes\n\n\nMultiple\nSingle\nYes\nConstant\nNo\n\n\nMultiple\nStaggered\nNo\nConstant\nNo\n\n\nMultiple\nStaggered\nYes\nConstant\nNo\n\n\nMultiple\nSingle\nNo\nDynamic\nNo\n\n\nMultiple\nSingle\nYes\nDynamic\nNo\n\n\nMultiple\nStaggered\nNo\nDynamic\nNo\n\n\nMultiple\nStaggered\nYes\nDynamic\nNo\n\n\n\n\nAverage effect"
  },
  {
    "objectID": "slides/difference-in-differences.html#twfe-event-study-did-estimator",
    "href": "slides/difference-in-differences.html#twfe-event-study-did-estimator",
    "title": "Extending Difference-in-Differences",
    "section": "TWFE Event Study DID Estimator",
    "text": "TWFE Event Study DID Estimator\n\nAnother option is to fit a two-way fixed effects event study DID model."
  },
  {
    "objectID": "slides/difference-in-differences.html#twfe-event-study-did-estimator-1",
    "href": "slides/difference-in-differences.html#twfe-event-study-did-estimator-1",
    "title": "Extending Difference-in-Differences",
    "section": "TWFE Event Study DID Estimator",
    "text": "TWFE Event Study DID Estimator\n\\(Y_{it} = \\delta_i + \\gamma_t + \\gamma_k^{-K}D_{it}^{<-K} + \\sum_{k=-K}^{-2}\\gamma_k^{lead}D_{it}^k+\\sum_{k=0}^{L}\\gamma_k^{lag}D_{it}^k + \\gamma_k^{L+}D_{it}^{>L} + \\epsilon_{it}\\)\n\n\\(\\delta_i\\) and \\(\\gamma_t\\) are unit and time fixed effects, respectively.\nWe use \\(K\\) lags and \\(L\\) leads, and \\(D_{i,t}^k\\) are event study dummy variables that take a value of one if unit \\(i\\) is \\(k\\) periods away from initial treatment time at time \\(t\\) and zero otherwise."
  },
  {
    "objectID": "slides/difference-in-differences.html#twfe-event-study-did-estimator-2",
    "href": "slides/difference-in-differences.html#twfe-event-study-did-estimator-2",
    "title": "Extending Difference-in-Differences",
    "section": "TWFE Event Study DID Estimator",
    "text": "TWFE Event Study DID Estimator\n\nWe may not want to specify every lead and lag available in our data. As such, \\(D_{it}^{<-K}\\) and \\(D_{it}^{>L}\\) are Pre and Post variables if the observation is more than \\(K\\) time periods away in the pre period, and more than \\(L\\) periods away in the post period.\nAlso note that the indicator for the time period just before policy adoption, i.e., \\(D_{it}^{-1}\\) is the excluded category."
  },
  {
    "objectID": "slides/difference-in-differences.html#twfe-event-study-did-estimator-3",
    "href": "slides/difference-in-differences.html#twfe-event-study-did-estimator-3",
    "title": "Extending Difference-in-Differences",
    "section": "TWFE Event Study DID Estimator",
    "text": "TWFE Event Study DID Estimator\n\n\n\n\n\n\n\n\n\n\n\n\nTreatment Group\nTiming\nHeterogx\nTx Effect\nTWFE\nTWFE-ES\n\n\n\n\nSingle\nSingle\nNo\nConstant\nYes\nYes\n\n\nSingle\nSingle\nNo\nDynamic\nYes1\nYes\n\n\nMultiple\nSingle\nNo\nConstant\nYes\nYes\n\n\nMultiple\nSingle\nYes\nConstant\nNo\nNo\n\n\nMultiple\nStaggered\nNo\nConstant\nNo\nYes\n\n\nMultiple\nStaggered\nYes\nConstant\nNo\nNo\n\n\nMultiple\nSingle\nNo\nDynamic\nNo\nNo\n\n\nMultiple\nSingle\nYes\nDynamic\nNo\nNo\n\n\nMultiple\nStaggered\nNo\nDynamic\nNo\nNo\n\n\nMultiple\nStaggered\nYes\nDynamic\nNo\nNo\n\n\n\n\nAverage effect"
  },
  {
    "objectID": "slides/difference-in-differences.html#extended-difference-in-differences",
    "href": "slides/difference-in-differences.html#extended-difference-in-differences",
    "title": "Extending Difference-in-Differences",
    "section": "Extended Difference-in-Differences",
    "text": "Extended Difference-in-Differences\nWooldridge,“Two-Way Fixed Effects, the Two-Way Mundlak Regression, and Difference-in-Differences Estimators” (2021 Working Paper)\n\nEstablishes the equivalence between two estimators:\n\nTwo-way fixed effects (TWFE) DID estimator.\nA DID estimator that includes unit-specific time averages and time-period specific cross-sectional averages.\n\n#2 covers both pooled OLS (POLS) or correlated random effects (called “two-way Mundlak” or TWM)."
  },
  {
    "objectID": "slides/difference-in-differences.html#extended-difference-in-differences-1",
    "href": "slides/difference-in-differences.html#extended-difference-in-differences-1",
    "title": "Extending Difference-in-Differences",
    "section": "Extended Difference-in-Differences",
    "text": "Extended Difference-in-Differences\n\n\nEstablishes a clear line of sight through DID with heterogeneous treatment effects and staggered entry.\nBottom line: specify a flexible regression to allow for heterogeneity across time and treatment cohorts.\nFor a balanced panel, POLS, TWFE and TWM yield identical DID estimates.\nAllows for extensions into nonlinear DID models."
  },
  {
    "objectID": "slides/difference-in-differences.html#roadmap",
    "href": "slides/difference-in-differences.html#roadmap",
    "title": "Extending Difference-in-Differences",
    "section": "Roadmap",
    "text": "Roadmap"
  },
  {
    "objectID": "slides/difference-in-differences.html#data-generation-process",
    "href": "slides/difference-in-differences.html#data-generation-process",
    "title": "Extending Difference-in-Differences",
    "section": "Data Generation Process",
    "text": "Data Generation Process\nMultiple Treatment Periods and Heterogeneous Dynamic Treatment Effects, Never Treated Group"
  },
  {
    "objectID": "slides/difference-in-differences.html#please-note",
    "href": "slides/difference-in-differences.html#please-note",
    "title": "Extending Difference-in-Differences",
    "section": "Please Note",
    "text": "Please Note\nDGP code adapted from Baker, Andrew C., David F. Larcker, and Charles CY Wang. “How much should we trust staggered difference-in-differences estimates?.” Journal of Financial Economics 144.2 (2022): 370-395."
  },
  {
    "objectID": "slides/difference-in-differences.html#raw-data",
    "href": "slides/difference-in-differences.html#raw-data",
    "title": "Extending Difference-in-Differences",
    "section": "Raw Data",
    "text": "Raw Data\n\n\n\n\n \n  \n    unit \n    year \n    y_it \n    d_it \n    x_i \n    x_it \n  \n \n\n  \n    1 \n    1980 \n    0.659 \n    0 \n    2.666 \n    -0.416 \n  \n  \n    1 \n    1981 \n    -1.404 \n    0 \n    2.666 \n    1.125 \n  \n  \n    1 \n    1982 \n    -0.133 \n    0 \n    2.666 \n    1.001 \n  \n  \n    1 \n    1983 \n    1.849 \n    0 \n    2.666 \n    -0.575 \n  \n  \n    1 \n    1984 \n    1.833 \n    0 \n    2.666 \n    1.606 \n  \n  \n    1 \n    1985 \n    0.661 \n    0 \n    2.666 \n    1.565 \n  \n  \n    1 \n    1986 \n    0.508 \n    0 \n    2.666 \n    1.546 \n  \n  \n    1 \n    1987 \n    -0.279 \n    0 \n    2.666 \n    3.861 \n  \n  \n    1 \n    1988 \n    -2.180 \n    0 \n    2.666 \n    2.276 \n  \n  \n    1 \n    1989 \n    0.861 \n    1 \n    2.666 \n    2.653"
  },
  {
    "objectID": "slides/difference-in-differences.html#step-1",
    "href": "slides/difference-in-differences.html#step-1",
    "title": "Extending Difference-in-Differences",
    "section": "Step 1",
    "text": "Step 1"
  },
  {
    "objectID": "slides/difference-in-differences.html#step-1-1",
    "href": "slides/difference-in-differences.html#step-1-1",
    "title": "Extending Difference-in-Differences",
    "section": "Step 1",
    "text": "Step 1\n\nIdentify all treatment cohorts based on the first year of treatment.\nDefine cohort dummies\n\nd_1989 is a dummy set to one if the unit belongs to the 1989 treatment cohort.\nd_1998 is a dummy set to one if the unit belongs to the 1998 treatment cohort."
  },
  {
    "objectID": "slides/difference-in-differences.html#step-2",
    "href": "slides/difference-in-differences.html#step-2",
    "title": "Extending Difference-in-Differences",
    "section": "Step 2",
    "text": "Step 2"
  },
  {
    "objectID": "slides/difference-in-differences.html#step-2-1",
    "href": "slides/difference-in-differences.html#step-2-1",
    "title": "Extending Difference-in-Differences",
    "section": "Step 2",
    "text": "Step 2\n\n\nIdentify whether there is a never treated comparison group.\nIf there is, move to next step.\nIf all groups eventually treated:\n\nWe no longer have viable untreated comparisons after the last cohort is treated.\nIdentify the treatment year for the last treated cohort.\nDrop all observations with year \\(>=\\) the last treatment year."
  },
  {
    "objectID": "slides/difference-in-differences.html#step-2-2",
    "href": "slides/difference-in-differences.html#step-2-2",
    "title": "Extending Difference-in-Differences",
    "section": "Step 2",
    "text": "Step 2\n\nIn our example, there is a never treated group.\nThis means every treated group has a viable comparator across the entire analytic window.\nTherefore, we don’t need to drop any observations."
  },
  {
    "objectID": "slides/difference-in-differences.html#step-3",
    "href": "slides/difference-in-differences.html#step-3",
    "title": "Extending Difference-in-Differences",
    "section": "Step 3",
    "text": "Step 3"
  },
  {
    "objectID": "slides/difference-in-differences.html#step-3-1",
    "href": "slides/difference-in-differences.html#step-3-1",
    "title": "Extending Difference-in-Differences",
    "section": "Step 3",
    "text": "Step 3\n\nAnalytic window is 1980 to 2015\nFirst treated year is 1989.\nf_* covers year dummy variables from 1989 to 2015"
  },
  {
    "objectID": "slides/difference-in-differences.html#step-4",
    "href": "slides/difference-in-differences.html#step-4",
    "title": "Extending Difference-in-Differences",
    "section": "Step 4",
    "text": "Step 4"
  },
  {
    "objectID": "slides/difference-in-differences.html#step-4-1",
    "href": "slides/difference-in-differences.html#step-4-1",
    "title": "Extending Difference-in-Differences",
    "section": "Step 4",
    "text": "Step 4\n\nBasic idea is to create interactions between treatment cohort dummies and post-treatment time period dummies.\nFor the 1989 cohort, we’d create dummy interactions for\n\nd_1989 * f_1989\nd_1989 * f_1990\nd_1989 * f_1991\n… and so on."
  },
  {
    "objectID": "slides/difference-in-differences.html#step-4-2",
    "href": "slides/difference-in-differences.html#step-4-2",
    "title": "Extending Difference-in-Differences",
    "section": "Step 4",
    "text": "Step 4\n\nBasic idea is to create interactions between treatment cohort dummies and post-treatment time period dummies.\nFor the 1998 cohort, we’d create dummy interactions for\n\nd_1998 * f_1998\nd_1998 * f_1999\nd_1998 * f_2000\n… and so on."
  },
  {
    "objectID": "slides/difference-in-differences.html#step-4-3",
    "href": "slides/difference-in-differences.html#step-4-3",
    "title": "Extending Difference-in-Differences",
    "section": "Step 4",
    "text": "Step 4"
  },
  {
    "objectID": "slides/difference-in-differences.html#step-4-4",
    "href": "slides/difference-in-differences.html#step-4-4",
    "title": "Extending Difference-in-Differences",
    "section": "Step 4",
    "text": "Step 4\n\nIn R, you can specify these dummies in the regresison equation using I(d_1989 * f_1989)."
  },
  {
    "objectID": "slides/difference-in-differences.html#step-5",
    "href": "slides/difference-in-differences.html#step-5",
    "title": "Extending Difference-in-Differences",
    "section": "Step 5",
    "text": "Step 5"
  },
  {
    "objectID": "slides/difference-in-differences.html#step-5-1",
    "href": "slides/difference-in-differences.html#step-5-1",
    "title": "Extending Difference-in-Differences",
    "section": "Step 5",
    "text": "Step 5\n\n\n\n\n\n\n\n\n\nMethod\nEstimation Formula\nFixed or Random Effect\n\n\n\n\nTwo-Way Fixed Effects\nfeols(I(d* : f*) + factor(time)  | unit)\nUnit Fixed Effect\n\n\nPooled OLS\nlm(I(d* : f*) + factor(time) + d*)\n\n\n\nTwo-Way Mundlak\nlmer(I(d* : f*) + factor(time) + d* + (1|unit)\nUnit Random Effect"
  },
  {
    "objectID": "slides/difference-in-differences.html#step-5-with-covariates",
    "href": "slides/difference-in-differences.html#step-5-with-covariates",
    "title": "Extending Difference-in-Differences",
    "section": "Step 5 (with covariates)",
    "text": "Step 5 (with covariates)\nSee the course blog for how to demean the covariates so they can be included.\n\n\n\n\n\n\n\n\n\nMethod\nEstimation Formula\nFixed or Random Effect\n\n\n\n\nTwo-Way Fixed Effects\nfeols(I(w : d* : f*) + I(w : d* : f* : x_dm_d*) + factor(time) + I(factor(time) * x_dm_d*) | unit)\nUnit Fixed Effect\n\n\nPooled OLS\nlm(I(w : d* : f*) + I(w: d* : f* : x_dm_d*) + factor(time) + I(factor(time) : x_dm_d*) + d* + x + I(d* : x_dm_d*))\n\n\n\nTwo-Way Mundlak\nlmer(I(w : d* : f*) + I(w: d* : f* : x_dm_d*) + factor(time) + I(factor(time) : x_dm_d*) + d* +  x + I(d* : x_dm_d*) + (1|unit)\nUnit Random Effect"
  },
  {
    "objectID": "slides/difference-in-differences.html#regression-call-twfe",
    "href": "slides/difference-in-differences.html#regression-call-twfe",
    "title": "Extending Difference-in-Differences",
    "section": "Regression Call: TWFE",
    "text": "Regression Call: TWFE\nfeols(I(d* : f*) + factor(time)  | unit)"
  },
  {
    "objectID": "slides/difference-in-differences.html#results-coefficient-estimates",
    "href": "slides/difference-in-differences.html#results-coefficient-estimates",
    "title": "Extending Difference-in-Differences",
    "section": "Results: Coefficient Estimates",
    "text": "Results: Coefficient Estimates"
  },
  {
    "objectID": "slides/difference-in-differences.html#results-relative-time",
    "href": "slides/difference-in-differences.html#results-relative-time",
    "title": "Extending Difference-in-Differences",
    "section": "Results: Relative Time",
    "text": "Results: Relative Time\n\nYou can also align each coefficient to its point in relative time.\nFor 1989 treated cohort, coefficient on I(d_1989 * f_1989) corresponds to relative_time=0.\nFor 1998 treated cohort, coefficient on I(d_1998 * f_1998) corresponds to relative_time=0."
  },
  {
    "objectID": "slides/difference-in-differences.html#results-relative-time-1",
    "href": "slides/difference-in-differences.html#results-relative-time-1",
    "title": "Extending Difference-in-Differences",
    "section": "Results: Relative Time",
    "text": "Results: Relative Time\n\nOnce you get all treatment effect coefficients organized into relative time, you can take the average (across treated cohorts) at each time period.\nCan plot these effect estimates (analogous to the event study plot from earlier)."
  },
  {
    "objectID": "slides/difference-in-differences.html#results-relative-time-2",
    "href": "slides/difference-in-differences.html#results-relative-time-2",
    "title": "Extending Difference-in-Differences",
    "section": "Results: Relative Time",
    "text": "Results: Relative Time"
  },
  {
    "objectID": "slides/difference-in-differences.html#extended-difference-in-differences-2",
    "href": "slides/difference-in-differences.html#extended-difference-in-differences-2",
    "title": "Extending Difference-in-Differences",
    "section": "Extended Difference-in-Differences",
    "text": "Extended Difference-in-Differences\n\n\n\n\n\n\n\n\n\n\n\n\n\nTreatment Group\nTiming\nHeterogx\nTx Effect\nTWFE\nTWFE-ES\nExt-DID\n\n\n\n\nSingle\nSingle\nNo\nConstant\nYes\nYes\nYes\n\n\nSingle\nSingle\nNo\nDynamic\nYes1\nYes\nYes\n\n\nMultiple\nSingle\nNo\nConstant\nYes\nYes\nYes\n\n\nMultiple\nSingle\nYes\nConstant\nNo\nNo\nYes\n\n\nMultiple\nStaggered\nNo\nConstant\nNo\nYes\nYes\n\n\nMultiple\nStaggered\nYes\nConstant\nNo\nNo\nYes\n\n\nMultiple\nSingle\nNo\nDynamic\nNo\nNo\nYes\n\n\nMultiple\nSingle\nYes\nDynamic\nNo\nNo\nYes\n\n\nMultiple\nStaggered\nNo\nDynamic\nNo\nNo\nYes\n\n\nMultiple\nStaggered\nYes\nDynamic\nNo\nNo\nYes\n\n\n\n\nAverage effect"
  },
  {
    "objectID": "slides/difference-in-differences.html#section-5",
    "href": "slides/difference-in-differences.html#section-5",
    "title": "Extending Difference-in-Differences",
    "section": "",
    "text": "Back to Website"
  },
  {
    "objectID": "slides/fixed-vs-random-effect-definitions.html#fixed-and-random-effects",
    "href": "slides/fixed-vs-random-effect-definitions.html#fixed-and-random-effects",
    "title": "Random vs. Fixed Effects",
    "section": "Fixed and Random Effects",
    "text": "Fixed and Random Effects\n\n\n\n\n(Bio)statisticians and social scientists mean different things when they say “random” and (especially) “fixed” effects. Ugh.\nI will almost always refer to things from the social science angle.\nI’ll try to tease out the intuition for what each discipline is referring to in the next few slides."
  },
  {
    "objectID": "slides/fixed-vs-random-effect-definitions.html#the-most-important-thing-to-know",
    "href": "slides/fixed-vs-random-effect-definitions.html#the-most-important-thing-to-know",
    "title": "Random vs. Fixed Effects",
    "section": "The most important thing to know",
    "text": "The most important thing to know\n\nHow do we think about unit level heterogeneity and its (statistical) relationship to the included (observed) variables in our regression model?"
  },
  {
    "objectID": "slides/fixed-vs-random-effect-definitions.html#fixed-vs.-random-effects-the-statistics-angle",
    "href": "slides/fixed-vs-random-effect-definitions.html#fixed-vs.-random-effects-the-statistics-angle",
    "title": "Random vs. Fixed Effects",
    "section": "Fixed vs. Random Effects: The Statistics Angle",
    "text": "Fixed vs. Random Effects: The Statistics Angle\n\nWe’re interested in the relationship between some unit-level factor \\(X\\) and our outcome \\(Y\\).\nUnits in our data have attributes or factors that we inherently care about for our research or evaluation, such as whether they received treatment or not.\nTreatment may not be explicit (i.e., randomized binary treatment), but rather could be some unit-level attribute or exposure (e.g., an individual’s diet, education, etc.) and we want to understand the relationship between this implicit “treatment” and the outcome."
  },
  {
    "objectID": "slides/fixed-vs-random-effect-definitions.html#fixed-vs.-random-effects-the-statistics-angle-1",
    "href": "slides/fixed-vs-random-effect-definitions.html#fixed-vs.-random-effects-the-statistics-angle-1",
    "title": "Random vs. Fixed Effects",
    "section": "Fixed vs. Random Effects: The Statistics Angle",
    "text": "Fixed vs. Random Effects: The Statistics Angle\n\nThese unit-level factors that are of inherent interest to our study are referred to as “fixed effects” by statisticians.\nLet’s take the example of the effect of diet on health outcomes.\n\nWe collect longitudinal patient data on diet and outcomes from various different physician practices.\n\nOur encoded measure of “diet” is the envisioned “treatment” and we want to understand the relationship between diet and health outcomes.\n\nThe effect of our encoded diet measure on outcomes is a “fixed effect” in statistical parlance."
  },
  {
    "objectID": "slides/fixed-vs-random-effect-definitions.html#fixed-vs.-random-effects-the-statistics-angle-2",
    "href": "slides/fixed-vs-random-effect-definitions.html#fixed-vs.-random-effects-the-statistics-angle-2",
    "title": "Random vs. Fixed Effects",
    "section": "Fixed vs. Random Effects: The Statistics Angle",
    "text": "Fixed vs. Random Effects: The Statistics Angle\n\nBut in our quest to estimate this fixed effect, we likely have endogeneity/omitted variables that may arise from additional unit-level heterogeneity.\nExample: physicians have various levels of engagement with their patients on their dietary habits.\nOne unit of analysis in our data is physicians (since we sample from patients in various physician practices).\nBut we’re really not interested in the effect of one physician vs. another on outcomes, so this variation in our data is not really of inherent interest to us.\nWe still need to account for it though, because failing to will confound our estimated effects."
  },
  {
    "objectID": "slides/fixed-vs-random-effect-definitions.html#fixed-vs.-random-effects-the-statistics-angle-3",
    "href": "slides/fixed-vs-random-effect-definitions.html#fixed-vs.-random-effects-the-statistics-angle-3",
    "title": "Random vs. Fixed Effects",
    "section": "Fixed vs. Random Effects: The Statistics Angle",
    "text": "Fixed vs. Random Effects: The Statistics Angle\n\nAlso remember we have panel data, or repeated (longitudinal) measures on our units of interest.\nUsual regression assumes each observation in our data is the result of an independent draw from the population of interest.\nBut this assumption (likely) fails here because we observe each person more than once!\nTherefore, observations are also likely correlated within persons."
  },
  {
    "objectID": "slides/fixed-vs-random-effect-definitions.html#fixed-vs.-random-effects-the-statistics-angle-4",
    "href": "slides/fixed-vs-random-effect-definitions.html#fixed-vs.-random-effects-the-statistics-angle-4",
    "title": "Random vs. Fixed Effects",
    "section": "Fixed vs. Random Effects: The Statistics Angle",
    "text": "Fixed vs. Random Effects: The Statistics Angle\n\nRepeated measurements within various units (e.g., time) results in “pseudoreplication,” or the fact that even though our data are \\(N*T\\) rows long, we likely have an effective sample size closer to \\(N\\).\nSame logic could hold for different patients who see the same physician – are they really truly independent from each other? If physicians impact both diets and health outcomes, we may have an effective sample size less than that!\n\nThese types of considerations are a key motivation for the use of hierarchical modeling—you can take entire courses on this, so I will only tease it here!"
  },
  {
    "objectID": "slides/fixed-vs-random-effect-definitions.html#fixed-vs.-random-effects-the-statistics-angle-5",
    "href": "slides/fixed-vs-random-effect-definitions.html#fixed-vs.-random-effects-the-statistics-angle-5",
    "title": "Random vs. Fixed Effects",
    "section": "Fixed vs. Random Effects: The Statistics Angle",
    "text": "Fixed vs. Random Effects: The Statistics Angle\n\n\n\nWe need some additional way to account for these features in our panel data.\nThis is where the statistical concept of “random effects” comes in.\nThese effects capture unit-level heterogeneity, but are not really of inherent interest.\nIf heterogeneity is an unobserved confounder, failing to account for it results in the figure on the top-right. Accounting for heterogeneity can help us get the (correct) relationships, as shown on the bottom right.\nAnd even if it’s not confounding the relationships, we still have this concern over pseudoreplication to worry about—this would throw our inferences off (standard errors that are too low)"
  },
  {
    "objectID": "slides/fixed-vs-random-effect-definitions.html#econometric-fixed-effects",
    "href": "slides/fixed-vs-random-effect-definitions.html#econometric-fixed-effects",
    "title": "Random vs. Fixed Effects",
    "section": "Econometric Fixed Effects",
    "text": "Econometric Fixed Effects\n\nWe’ll now start to walk towards the econometric differentiation of a “fixed” effect.\nWe can do this by finding some common ground on “random” effects.\nAgain, it boils down to modeling unit-level heterogeneity."
  },
  {
    "objectID": "slides/fixed-vs-random-effect-definitions.html#fixed-and-random-effects-2",
    "href": "slides/fixed-vs-random-effect-definitions.html#fixed-and-random-effects-2",
    "title": "Random vs. Fixed Effects",
    "section": "Fixed and Random Effects",
    "text": "Fixed and Random Effects\n\\[\nY_{it} = X_{it}'\\beta + \\tau D_{it} + U_i + \\epsilon_{it}\n\\]\n\nRemember our (confounding) friend \\(U\\)? There it is in the model!\nNotice how it is only indexed by \\(i\\) and not \\(it\\)?\n\nThat means that within units (patients) in our panel (time) it remains … fixed!\nThis is what econometricians meand by a “fixed effect.”\nConfusing, no?"
  },
  {
    "objectID": "slides/fixed-vs-random-effect-definitions.html#fixed-and-random-effects-3",
    "href": "slides/fixed-vs-random-effect-definitions.html#fixed-and-random-effects-3",
    "title": "Random vs. Fixed Effects",
    "section": "Fixed and Random Effects",
    "text": "Fixed and Random Effects\n\nOk, so now we have differentiated between what statisticians mean by “fixed effects” and what social scientists mean by “fixed effect”\nBut again, lets focus on that individual heterogeneity term \\(U_i\\).\nThis heterogeneity is “fixed” but may be unobserved.\nWe need to account for it in some way, either because it is correlated with treatment (i.e., is a confounder) and/or because it allows us to account for pseudo-replication in our data (i.e., correlated observations within units)."
  },
  {
    "objectID": "slides/fixed-vs-random-effect-definitions.html#key-question",
    "href": "slides/fixed-vs-random-effect-definitions.html#key-question",
    "title": "Random vs. Fixed Effects",
    "section": "Key Question",
    "text": "Key Question\n\nHow strong a set of assumptions are we willing to place on the statistical relationship between \\(U_i\\) and what is observed (i.e., \\(X_{it}\\) and \\(D_{it}\\))?\n\n\nLet’s think of \\(U_i\\) as a summary measure capturing all fixed attributes of the unit."
  },
  {
    "objectID": "slides/lec_introduction.html#welcome-to-hpol8539",
    "href": "slides/lec_introduction.html#welcome-to-hpol8539",
    "title": "Introduction and Course Details",
    "section": "Welcome to HPOL8539!",
    "text": "Welcome to HPOL8539!\n\n\nYou are the inaugural cohort!\nCourse grew out of growing need to expand and de-mystify the “toolkit” of program and policy evaluation methods."
  },
  {
    "objectID": "slides/lec_introduction.html#the-dreaded-ice-breaker-questions",
    "href": "slides/lec_introduction.html#the-dreaded-ice-breaker-questions",
    "title": "Introduction and Course Details",
    "section": "The Dreaded Ice Breaker Questions",
    "text": "The Dreaded Ice Breaker Questions\n\n\nWhat research topics are you interested in / working on?\nWhat method vexes you the most?\nWhat do you hope to take away from this course?"
  },
  {
    "objectID": "slides/lec_introduction.html#welcome-to-hpol8539-1",
    "href": "slides/lec_introduction.html#welcome-to-hpol8539-1",
    "title": "Introduction and Course Details",
    "section": "Welcome to HPOL8539!",
    "text": "Welcome to HPOL8539!\n\n\nLast 5 years have witnessed a disorienting advancement in methods for program and policy evaluation.\nThe social sciences (naively) thought you could take basic panel data methods (e.g., fixed effects regression) and apply them to any “flavor” of policy intervention:\n\nStaggered treatment adoption.\nScenarios with heterogeneous treatment effects."
  },
  {
    "objectID": "slides/lec_introduction.html#policy-evaluation-methods-until-2019",
    "href": "slides/lec_introduction.html#policy-evaluation-methods-until-2019",
    "title": "Introduction and Course Details",
    "section": "Policy Evaluation Methods Until 2019",
    "text": "Policy Evaluation Methods Until 2019"
  },
  {
    "objectID": "slides/lec_introduction.html#policy-evaluation-2019-2021",
    "href": "slides/lec_introduction.html#policy-evaluation-2019-2021",
    "title": "Introduction and Course Details",
    "section": "Policy Evaluation: 2019-2021",
    "text": "Policy Evaluation: 2019-2021"
  },
  {
    "objectID": "slides/lec_introduction.html#policy-evaluation-2019-2021-1",
    "href": "slides/lec_introduction.html#policy-evaluation-2019-2021-1",
    "title": "Introduction and Course Details",
    "section": "Policy Evaluation: 2019-2021",
    "text": "Policy Evaluation: 2019-2021\nThe rest of us:\n\n\n\nvia GIPHY"
  },
  {
    "objectID": "slides/lec_introduction.html#policy-evaluation-2022",
    "href": "slides/lec_introduction.html#policy-evaluation-2022",
    "title": "Introduction and Course Details",
    "section": "Policy Evaluation: 2022",
    "text": "Policy Evaluation: 2022\nEconometricians:\n\n\n\n\n\nvia GIPHY\n\n\n\n\n\nvia GIPHY"
  },
  {
    "objectID": "slides/lec_introduction.html#policy-evaluation-2022-1",
    "href": "slides/lec_introduction.html#policy-evaluation-2022-1",
    "title": "Introduction and Course Details",
    "section": "Policy Evaluation: 2022",
    "text": "Policy Evaluation: 2022\nThe rest of us:\n\n\n\nvia GIPHY"
  },
  {
    "objectID": "slides/lec_introduction.html#welcome-to-hpol8539-2",
    "href": "slides/lec_introduction.html#welcome-to-hpol8539-2",
    "title": "Introduction and Course Details",
    "section": "Welcome to HPOL8539!",
    "text": "Welcome to HPOL8539!\n\n\nThe goal of this course is to chart an intuitive path through recent advancements in policy evaluation methods.\nWe’ll spend quite a bit of time on DID and event study methods.\nWe’ll also cover some other important new estimation approaches.\nWe’ll also cover statistical inference issues."
  },
  {
    "objectID": "slides/lec_introduction.html#guiding-principles-for-hpol8539",
    "href": "slides/lec_introduction.html#guiding-principles-for-hpol8539",
    "title": "Introduction and Course Details",
    "section": "Guiding Principles for HPOL8539",
    "text": "Guiding Principles for HPOL8539\n\n\nWe will take our time and adapt as needed.\nThe focus of the course will be on “proof by simulation.”\nBy the end of the course you will have access to materials on all the topics.\n\nDepending on our pacing, we may “decant” some of the methods from live class sessions to “blog” posts on the website."
  },
  {
    "objectID": "slides/lec_introduction.html#a-typical-causal-inference-policy-evaluation-course",
    "href": "slides/lec_introduction.html#a-typical-causal-inference-policy-evaluation-course",
    "title": "Introduction and Course Details",
    "section": "A Typical Causal Inference / Policy Evaluation Course",
    "text": "A Typical Causal Inference / Policy Evaluation Course\n\n\nRead a bunch of econometrics before class.\nSee a bunch of econometrics flashed on slides during class.\nBang your head against the wall outside of class to code up and complete an assignment based on the econometrics."
  },
  {
    "objectID": "slides/lec_introduction.html#how-this-class-will-operate",
    "href": "slides/lec_introduction.html#how-this-class-will-operate",
    "title": "Introduction and Course Details",
    "section": "How This Class Will Operate",
    "text": "How This Class Will Operate\n\n\nRead some econometrics before class.1\nCollectively bang our heads against the wall by coding up a “live” case study during class.\nAssignments will focus on rigorously peer reviewing an unpublished research study, and writing up a methods section for a grant proposal, dissertation proposal, or research project.\n\n\nCan’t avoid the econometrics entirely!"
  },
  {
    "objectID": "slides/lec_introduction.html#how-this-class-will-operate-1",
    "href": "slides/lec_introduction.html#how-this-class-will-operate-1",
    "title": "Introduction and Course Details",
    "section": "How This Class Will Operate",
    "text": "How This Class Will Operate\n\n\nThere are no formal lectures. Only discussions, some white board work, and “live case studies.”\nI have “flipped” the class format in the sense that the hard-core econometrics will show up primarily in the readings."
  },
  {
    "objectID": "slides/lec_introduction.html#guiding-principles-for-hpol8539-1",
    "href": "slides/lec_introduction.html#guiding-principles-for-hpol8539-1",
    "title": "Introduction and Course Details",
    "section": "Guiding Principles for HPOL8539",
    "text": "Guiding Principles for HPOL8539\n\nThe case studies will be done in R, but you will not need to be or become an advanced R programmer to do them!1\n\nI highly recommend becoming familiar with R / tidyverse methods, though!"
  },
  {
    "objectID": "slides/lec_introduction.html#grading-and-assignments",
    "href": "slides/lec_introduction.html#grading-and-assignments",
    "title": "Introduction and Course Details",
    "section": "Grading and Assignments",
    "text": "Grading and Assignments\n\n\n40% of student assessment is based on direct observation and engagement.\n20% is basd on a written critique of a working paper that applies course methods to a current research topic (DUE: OCTOBER 19)"
  },
  {
    "objectID": "slides/lec_introduction.html#grading-and-assignments-1",
    "href": "slides/lec_introduction.html#grading-and-assignments-1",
    "title": "Introduction and Course Details",
    "section": "Grading and Assignments",
    "text": "Grading and Assignments\n\n\nRemaining 40% is based on written methods section for a proposed research study you aim to undertake during your dissertation (or afterwards).\nThere are two choices for the structure of this assignment:\n\nAs an “Approach” section for an NIH/AHRQ grant application\nAs a methods section for a research study or PhD dissertation proposal.\nAlternative structures may be pursued after consultation with Dr. Graves, and with his permission."
  },
  {
    "objectID": "slides/lec_introduction.html#grading-and-assignments-2",
    "href": "slides/lec_introduction.html#grading-and-assignments-2",
    "title": "Introduction and Course Details",
    "section": "Grading and Assignments",
    "text": "Grading and Assignments\n\n\nThree weeks in advance of the final written methods section being due (on December 8), you will submit a draft to a peer reviewer in the course (November 16)\nYou will also be a peer reviewer for another student’s work."
  },
  {
    "objectID": "slides/lec_introduction.html#grading-and-assignments-3",
    "href": "slides/lec_introduction.html#grading-and-assignments-3",
    "title": "Introduction and Course Details",
    "section": "Grading and Assignments",
    "text": "Grading and Assignments\n\n\n15 percentage points (of the 40% total for the assignment) will be based on your written assessment of your peer’s work. This will be due to them (with a copy to me) on December 1.\nBased on this feedback, you will revise your methods writeup and submit a final version on December 8. This final writeup will be worth 25 percentage points (of the 40% total for the assignment).\nMake sense?"
  },
  {
    "objectID": "slides/lec_introduction.html#grading-and-assignments-4",
    "href": "slides/lec_introduction.html#grading-and-assignments-4",
    "title": "Introduction and Course Details",
    "section": "Grading and Assignments",
    "text": "Grading and Assignments\n\n\nThe guiding principle for this assignment structure is to unearth much of the “hidden curriculum” that often goes untaught in graduate school.\n\nYou will be called upon often to be a peer reviewer.\nThe audience for a grant reviewer and for a peer reviewer are different and you should learn how to write for both.\nYou will often circulate your research to trusted peers for comments before formally submitting for publication."
  },
  {
    "objectID": "slides/lec_introduction.html#questions-or-comments",
    "href": "slides/lec_introduction.html#questions-or-comments",
    "title": "Introduction and Course Details",
    "section": "Questions or Comments?",
    "text": "Questions or Comments?\n\nAre there additional methods you want to learn?\n\n\n\nBack to Website"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "1 + 1\n\n[1] 2"
  },
  {
    "objectID": "modules/d2-panel.html",
    "href": "modules/d2-panel.html",
    "title": "Panel Data Methods",
    "section": "",
    "text": "Introductions\nItem Two"
  },
  {
    "objectID": "modules/d2-panel.html#slides",
    "href": "modules/d2-panel.html#slides",
    "title": "Panel Data Methods",
    "section": "Slides",
    "text": "Slides\nView slides in full screen"
  },
  {
    "objectID": "modules/d2-panel.html#exercises",
    "href": "modules/d2-panel.html#exercises",
    "title": "Panel Data Methods",
    "section": "Exercises",
    "text": "Exercises\n\n\n\n\n\n\nExercise\n\n\n\n\n\n\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "modules/d1-introduction.html",
    "href": "modules/d1-introduction.html",
    "title": "Introduction",
    "section": "",
    "text": "Introductions\nItem Two"
  },
  {
    "objectID": "modules/d1-introduction.html#slides",
    "href": "modules/d1-introduction.html#slides",
    "title": "Introduction",
    "section": "Slides",
    "text": "Slides\nView slides in full screen"
  },
  {
    "objectID": "modules/d1-introduction.html#exercises",
    "href": "modules/d1-introduction.html#exercises",
    "title": "Introduction",
    "section": "Exercises",
    "text": "Exercises\n\n\n\n\n\n\nExercise\n\n\n\n\n\n\n\n\n\n\n\n\nNo matching items"
  }
]