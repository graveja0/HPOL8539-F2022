[
  {
    "objectID": "ignore/meta-structure-equations.html",
    "href": "ignore/meta-structure-equations.html",
    "title": "Fixed, Random and Correlated Random Effects",
    "section": "",
    "text": "Add unobserved heterogeneity\n\\[\nY_i = \\mathbf{X}_i'\\beta + \\tau D_i + U_i +\\epsilon_i \\quad \\quad \\quad Eq. 2\n\\]\n\n\nMove to panel data setting\n\\[\nY_{it} = \\mathbf{X}_{it}'\\beta + \\tau D_{it} + U_i + \\epsilon_i \\quad \\quad \\quad Eq. 3\n\\]\n\n\nPooled OLS\n\\[\n\\begin{aligned}\nY_{it} &=\\mathbf{X}_{it}'\\beta + \\tau D_{it} + \\overbrace{U_i + \\epsilon_{it}}^{\\eta_{it}} \\\\\n&= \\mathbf{X}_{it}'\\beta + \\tau D_{it}  + \\eta_{it} \\quad \\quad \\quad Eq. 4\n\\end{aligned}\n\\]\n\n\nRandom Effects\n\\[\n\\begin{aligned}\nY_{it} &= \\mathbf{X}_{it}'\\beta + \\tau D_{it}  + \\overbrace{U_i + \\epsilon_{it}}^{v_it} \\\\\nY_{it} &= \\mathbf{X}_{it}'\\beta + \\tau D_{it}  + v_{it} \\quad \\quad \\quad Eq. 5 \\\\\nv_{it} &= U_i + \\epsilon_{it} \\\\\nU_i &\\sim N(0,\\sigma^2_u)\n\\end{aligned}\n\\]\n\n\nDummy Variable Regression\n\\[\nY_{it} = \\mathbf{X}_{it}'\\beta + \\tau D_i + \\mathbf{U}_i + \\epsilon_{it} \\quad \\quad \\quad Eq. 6\n\\]\n\n\nFirst Differences\n\\[\n\\begin{aligned}\nY_{it} &= \\mathbf{X}_{it}'\\beta + \\tau D_{it} + U_i + \\epsilon_{it} \\\\\nY_{i,t-1} &=  \\mathbf{X}_{i,t-1}'\\beta + \\tau D_{i,t-1} + U_i + \\epsilon_{i,t-1} \\\\\nY_{it} - Y_{i,t-1} &= (\\mathbf{X}_{it} - \\mathbf{X}_{i,t-1})'\\beta + \\tau (D_{it} - D_{i,t-1}) + (U_i - U_i) +  (\\epsilon_{it} - \\epsilon_{i,t-1}) \\\\\n&= (\\mathbf{X}_{it} - \\mathbf{X}_{i,t-1})'\\beta + \\tau (D_{it} - D_{i,t-1}) + (\\epsilon_{it} - \\epsilon_{i,t-1}) \\quad \\quad \\quad Eq. 7\n\\end{aligned}\n\\]\n\n\nDemeaning\n\\[\n\\begin{align}\n(Y_{it}-\\bar{Y_i}) &= (\\mathbf{X}_{it}-\\bar{\\mathbf{X}_i})'\\beta + \\tau (D_{it}-\\bar{D_i}) + (U_i - \\bar{U_i)} + (\\epsilon_{it} - \\bar{\\epsilon_i}) \\\\\n&= (\\mathbf{X}_{it}-\\bar{\\mathbf{X}_i})'\\beta + \\tau (D_{it}-\\bar{D_i})  + (\\epsilon_{it} - \\bar{\\epsilon_i}) \\quad \\quad \\quad Eq. 8\n\\end{align}\n\\]\n\n\nQuasi Demeaning\n\\[\n\\begin{align}\n(Y_{it}-\\theta \\bar{Y_i}) = (\\mathbf{X}_{it}-\\theta \\bar{\\mathbf{X}_i})'\\beta + \\tau (D_{it}-\\theta \\bar{D_i})  + (\\epsilon_{it} - \\theta \\bar{\\epsilon_i}) \\quad \\quad \\quad Eq. 9\n\\end{align}\n\\]\nnote: need to define theta still.\n\n\nCorrelated Random Effects\n\\[\n\\begin{align}\nY_{it} &= \\mathbf{X}_{it}'\\beta + \\tau D_i + \\overbrace{U_i}^{U_i = \\bar{\\mathbf{X}_i}'\\gamma+\\omega_i} + \\epsilon_{it} \\\\\n&= \\mathbf{X}_{it}'\\beta + \\tau D_i + \\bar{\\mathbf{X}_i}'\\gamma+ \\underbrace{\\omega_i + \\epsilon_{it}}_{v_{it}} \\\\\nv_{it} &= \\omega_i + \\epsilon_{it} \\\\\n\\omega_i &\\sim N(0,\\sigma^2_u\n\\end{align}\n\\]"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#basic-model",
    "href": "ignore/panel-data-full-animation.html#basic-model",
    "title": "Panel Data",
    "section": "Basic Model",
    "text": "Basic Model\n\nA"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#basic-model-1",
    "href": "ignore/panel-data-full-animation.html#basic-model-1",
    "title": "Panel Data",
    "section": "Basic Model",
    "text": "Basic Model\n\nA+B\nA"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#basic-model-2",
    "href": "ignore/panel-data-full-animation.html#basic-model-2",
    "title": "Panel Data",
    "section": "Basic Model",
    "text": "Basic Model\n\n\\[\nY_i = \\mathbf{X}_i'\\beta + \\tau D_i \\quad \\quad  + \\quad \\quad \\epsilon_i\n\\]"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#basic-model-3",
    "href": "ignore/panel-data-full-animation.html#basic-model-3",
    "title": "Panel Data",
    "section": "Basic Model",
    "text": "Basic Model\n\n\\[\nY_i= \\underbrace{\\color{green}{\\mathbf{X}_i'\\beta} + \\color{green}{\\tau D_i}}_{\\text{Systematic component}} + \\underbrace{\\color{red}{\\epsilon_i}}_{\\text{Stochastic Component}}\n\\]"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#basic-model-4",
    "href": "ignore/panel-data-full-animation.html#basic-model-4",
    "title": "Panel Data",
    "section": "Basic Model",
    "text": "Basic Model\n\n\\[\nY_i= \\color{green}{\\mathbf{X}_i'\\beta} + \\color{green}{\\tau D_i} + \\color{red}{\\epsilon_i}\n\\]"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#add-unobserved-heterogeneity",
    "href": "ignore/panel-data-full-animation.html#add-unobserved-heterogeneity",
    "title": "Panel Data",
    "section": "Add Unobserved Heterogeneity",
    "text": "Add Unobserved Heterogeneity\n\\[\nY_i= \\color{green}{\\mathbf{X}_i'\\beta} + \\color{green}{\\tau D_i} + \\color{purple}{U_i} + \\color{red}{\\epsilon_i}\n\\]\n\n\\[\nY_i= \\color{green}{\\mathbf{X}_i'\\beta} + \\color{green}{\\tau D_i} + \\color{red}{\\epsilon_i}\n\\]"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#go-to-panel-data-setting",
    "href": "ignore/panel-data-full-animation.html#go-to-panel-data-setting",
    "title": "Panel Data",
    "section": "Go To Panel Data Setting",
    "text": "Go To Panel Data Setting\n\\[\nY_{it} = \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{grenn}{\\tau D_{it}} + \\color{purple}{U_i} + \\color{red}{\\epsilon_{it}}\n\\]\n\n\\[\nY_{it}= \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{green}{\\tau D_{it}} + \\color{purple}{U_i} + \\color{red}{\\epsilon_{it}}\n\\]"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#pooled-ols",
    "href": "ignore/panel-data-full-animation.html#pooled-ols",
    "title": "Panel Data",
    "section": "Pooled OLS",
    "text": "Pooled OLS\n\\[\nY_{it}= \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{green}{\\tau D_{it}} + \\overbrace{\\color{purple}{U_i} + \\color{red}{\\epsilon_{it}}}^{\\color{red}{\\eta_{it}}}\n\\]\n\n\\[\nY_{it} = \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{green}{\\tau D_{it}} + \\color{purple}{U_i} + \\color{red}{\\epsilon_{it}}\n\\]"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#pooled-ols-1",
    "href": "ignore/panel-data-full-animation.html#pooled-ols-1",
    "title": "Panel Data",
    "section": "Pooled OLS",
    "text": "Pooled OLS\n\\[\nY_{it}= \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{green}{\\tau D_{it}} + \\color{red}{\\eta_{it}}\n\\]\n\n\\[\nY_{it}= \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{green}{\\tau D_{it}} + \\overbrace{\\color{purple}{U_i} + \\color{red}{\\epsilon_i}}^{\\color{red}{\\eta_{it}}}\n\\]"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#random-effects",
    "href": "ignore/panel-data-full-animation.html#random-effects",
    "title": "Panel Data",
    "section": "Random Effects",
    "text": "Random Effects\n\\[\n\\begin{aligned}\nY_{it} &= \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{green}{\\tau D_{it}} + \\color{red}{\\eta_{it}}\n\\end{aligned}\n\\]\n\n\\[\n\\begin{aligned}\n\\color{red}{\\eta_{it}} &= \\color{purple}{U_i} + \\color{red}{\\epsilon_{it}}\n\\end{aligned}\n\\]\n\n\n\\[\n\\begin{aligned}\n\\color{purple}{U_i} &\\sim N(0,\\sigma^2_u)\n\\end{aligned}\n\\]"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#dummy-variable-regression",
    "href": "ignore/panel-data-full-animation.html#dummy-variable-regression",
    "title": "Panel Data",
    "section": "Dummy Variable Regression",
    "text": "Dummy Variable Regression\n\\[\nY_{it}= \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{green}{\\tau D_{it}} + \\color{purple}{U_i} + \\color{red}{\\epsilon_{it}}\n\\]\n\n\\[\n\\begin{aligned}\nY_{it} &= \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{green}{\\tau D_{it}} + \\color{red}{\\eta_{it}}\n\\end{aligned}\n\\]\n\\[\n\\begin{aligned}\n\\color{red}{\\eta_{it}} &= \\color{purple}{U_i} + \\color{red}{\\epsilon_{it}}\n\\end{aligned}\n\\]\n\\[\n\\begin{aligned}\n\\color{purple}{U_i} &\\sim N(0,\\sigma^2_u)\n\\end{aligned}\n\\]"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#dummy-variable-regression-1",
    "href": "ignore/panel-data-full-animation.html#dummy-variable-regression-1",
    "title": "Panel Data",
    "section": "Dummy Variable Regression",
    "text": "Dummy Variable Regression\n\\[\nY_{it}= \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{green}{\\tau D_{it}} + \\color{green}{\\mathbf{U_i}} + \\color{red}{\\epsilon_{it}}\n\\]\n\n\\[\nY_{it}= \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{green}{\\tau D_{it}} + \\color{purple}{U_i} + \\color{red}{\\epsilon_{it}}\n\\]"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#first-differences",
    "href": "ignore/panel-data-full-animation.html#first-differences",
    "title": "Panel Data",
    "section": "First Differences",
    "text": "First Differences\n\n\\[\nY_{it}= \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{green}{\\tau D_{it}} + \\color{green}{\\mathbf{U_i}} + \\color{red}{\\epsilon_{it}}\n\\]"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#first-differences-1",
    "href": "ignore/panel-data-full-animation.html#first-differences-1",
    "title": "Panel Data",
    "section": "First Differences",
    "text": "First Differences\n\n\\[\nY_{it}= \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{green}{\\tau D_{it}} + \\color{purple}{U_i} + \\color{red}{\\epsilon_{it}}\n\\]"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#first-differences-2",
    "href": "ignore/panel-data-full-animation.html#first-differences-2",
    "title": "Panel Data",
    "section": "First Differences",
    "text": "First Differences\n\\[\nY_{it}= \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{green}{\\tau D_{it}} + \\color{purple}{U_i} + \\color{red}{\\epsilon_{it}}\n\\]\n\n\\[\nY_{i,t-1}= \\color{green}{\\mathbf{X}_{i,t-1}'\\beta} + \\color{green}{\\tau D_{i,t-1}} + \\color{purple}{U_i} + \\color{red}{\\epsilon_{i,t-1}}\n\\]\n\n\n\\[\n\\(Y_{it} - Y_{i,t-1}) = \\color{green}{(\\mathbf{X}_{it}-\\mathbf{X}_{i,t-1})'\\beta} + \\color{green}{\\tau (D_{it}-D_{i,t-1})} + \\color{purple}{U_i} + \\color{red}{(\\epsilon_{it}-\\epsilon_{i,t-1})}\n\\]"
  },
  {
    "objectID": "ignore/panel-data-full-animation.html#first-differences-3",
    "href": "ignore/panel-data-full-animation.html#first-differences-3",
    "title": "Panel Data",
    "section": "First Differences",
    "text": "First Differences\n\\[\n\\Delta Y_{it}= \\color{green}{\\Delta \\mathbf{X}_{it}'\\beta} + \\color{green}{\\Delta \\tau D_{it}} + \\color{purple}{U_i} + \\color{red}{\\Delta \\epsilon_{it}}\n\\]\n\n\\[\nY_{it}= \\color{green}{\\mathbf{X}_{it}'\\beta} + \\color{green}{\\tau D_{it}} + \\color{purple}{U_i} + \\color{red}{\\epsilon_{it}}\n\\]\n\\[\nY_{i,t-1}= \\color{green}{\\mathbf{X}_{i,t-1}'\\beta} + \\color{green}{\\tau D_{i,t-1}} + \\color{purple}{U_i} + \\color{red}{\\epsilon_{i,t-1}}\n\\]\n\\[\n(Y_{it} - Y_{i,t-1}) = \\color{green}{(\\mathbf{X}_{it}-\\mathbf{X}_{i,t-1})'\\beta} + \\color{green}{\\tau (D_{it}-D_{i,t-1})} + \\color{purple}{U_i} + \\color{red}{(\\epsilon_{it}-\\epsilon_{i,t-1})}\n\\]"
  },
  {
    "objectID": "ignore/wooldridge-extended-twfe-did.html",
    "href": "ignore/wooldridge-extended-twfe-did.html",
    "title": "DID Estimators",
    "section": "",
    "text": "Let’s start by loading libraries and data.\n\n\n\n\n\nlemp\nyear\nfirst_treat\ncountyreal\n\n\n\n\n8.461469\n2003\n2007\n8001\n\n\n8.336870\n2004\n2007\n8001\n\n\n8.340217\n2005\n2007\n8001\n\n\n8.378161\n2006\n2007\n8001\n\n\n8.487352\n2007\n2007\n8001\n\n\n4.997212\n2003\n2007\n8019\n\n\n\n\n\nNow let’s create some design variables.\n\nA treatment indicator\nCategorical (factor) variables for treatment group and time.\nDummy indicators for the treatment group and time variables.\n\n\ndf <- \n  df_raw %>% \n     # Create a binary treatment indicator that is one if ever treated and \n     # current year is >= treatment year. \n     mutate(treated = case_when(\n       year >= first_treat & first_treat > 0 ~ 1, \n       TRUE ~ 0\n    )) %>% \n  mutate(year = factor(year), \n         first_treat = factor(first_treat)) %>% \n  fastDummies::dummy_cols(c(\"year\",\"first_treat\"))\n\ndf %>% \n  head() %>% \n  kable()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nlemp\nyear\nfirst_treat\ncountyreal\ntreated\nyear_2003\nyear_2004\nyear_2005\nyear_2006\nyear_2007\nfirst_treat_0\nfirst_treat_2004\nfirst_treat_2006\nfirst_treat_2007\n\n\n\n\n8.461469\n2003\n2007\n8001\n0\n1\n0\n0\n0\n0\n0\n0\n0\n1\n\n\n8.336870\n2004\n2007\n8001\n0\n0\n1\n0\n0\n0\n0\n0\n0\n1\n\n\n8.340217\n2005\n2007\n8001\n0\n0\n0\n1\n0\n0\n0\n0\n0\n1\n\n\n8.378161\n2006\n2007\n8001\n0\n0\n0\n0\n1\n0\n0\n0\n0\n1\n\n\n8.487352\n2007\n2007\n8001\n1\n0\n0\n0\n0\n1\n0\n0\n0\n1\n\n\n4.997212\n2003\n2007\n8019\n0\n1\n0\n0\n0\n0\n0\n0\n0\n1\n\n\n\n\n\nOur next step is to create a series of interaction terms between treatment group, time, and treated. However, for a given treatment group we only include interactions with times that occur on or after the treatment time.\nWe’ll figure out these using a crossing() command:\n\ntreatment_group_times <- levels(df$first_treat) %>% as.numeric(); treatment_group_times\n\n[1]    0 2004 2006 2007\n\n# Note we eventually need to get rid of hte never treated (0's) for the interactions\nall_times <- levels(df$year) %>% as.numeric() ; all_times\n\n[1] 2003 2004 2005 2006 2007\n\ninteractions_needed <- crossing(first_treat = treatment_group_times, year = all_times) %>% \n  mutate(occurs_on_or_after = as.integer(year >= first_treat)) %>% \n  filter(first_treat != \"0\") \n\ninteractions_needed %>% kable()\n\n\n\n\nfirst_treat\nyear\noccurs_on_or_after\n\n\n\n\n2004\n2003\n0\n\n\n2004\n2004\n1\n\n\n2004\n2005\n1\n\n\n2004\n2006\n1\n\n\n2004\n2007\n1\n\n\n2006\n2003\n0\n\n\n2006\n2004\n0\n\n\n2006\n2005\n0\n\n\n2006\n2006\n1\n\n\n2006\n2007\n1\n\n\n2007\n2003\n0\n\n\n2007\n2004\n0\n\n\n2007\n2005\n0\n\n\n2007\n2006\n0\n\n\n2007\n2007\n1\n\n\n\n\n\nLet’s now restrict to cases that were ever treated (i.e., treatment_group_time!=0) and the times that occur on or after those dates:\n\ninteractions_needed <- \n  interactions_needed %>% \n  filter(occurs_on_or_after==1)\n\ninteractions_needed %>% kable()\n\n\n\n\nfirst_treat\nyear\noccurs_on_or_after\n\n\n\n\n2004\n2004\n1\n\n\n2004\n2005\n1\n\n\n2004\n2006\n1\n\n\n2004\n2007\n1\n\n\n2006\n2006\n1\n\n\n2006\n2007\n1\n\n\n2007\n2007\n1\n\n\n\n\n\nNow lets create a column that has the formula for the interaction between group * time * treated:\n\ninteractions_needed <- \n  interactions_needed %>% \n  mutate(first_treat = glue(\"first_treat_{first_treat}\"),\n         year = glue(\"year_{year}\")) %>% \n  mutate(rhs = glue(\"{first_treat}:{year}:treated\")) \ninteractions_needed %>% kable()\n\n\n\n\n\n\n\n\n\n\nfirst_treat\nyear\noccurs_on_or_after\nrhs\n\n\n\n\nfirst_treat_2004\nyear_2004\n1\nfirst_treat_2004:year_2004:treated\n\n\nfirst_treat_2004\nyear_2005\n1\nfirst_treat_2004:year_2005:treated\n\n\nfirst_treat_2004\nyear_2006\n1\nfirst_treat_2004:year_2006:treated\n\n\nfirst_treat_2004\nyear_2007\n1\nfirst_treat_2004:year_2007:treated\n\n\nfirst_treat_2006\nyear_2006\n1\nfirst_treat_2006:year_2006:treated\n\n\nfirst_treat_2006\nyear_2007\n1\nfirst_treat_2006:year_2007:treated\n\n\nfirst_treat_2007\nyear_2007\n1\nfirst_treat_2007:year_2007:treated\n\n\n\n\n\nThis allows us to pull out the right-hand side variable definitions for our eventual regression.\n\nrhs <- interactions_needed %>% pull(rhs) %>% as.vector()\nrhs <- paste0(rhs, collapse = \"+\")\nrhs\n\n[1] \"first_treat_2004:year_2004:treated+first_treat_2004:year_2005:treated+first_treat_2004:year_2006:treated+first_treat_2004:year_2007:treated+first_treat_2006:year_2006:treated+first_treat_2006:year_2007:treated+first_treat_2007:year_2007:treated\"\n\n\nWe can now fit a TWFE regression:\n\nfit_fmla <- as.formula(glue(\"lemp ~ {rhs} | first_treat + year\")); fit_fmla\n\nlemp ~ first_treat_2004:year_2004:treated + first_treat_2004:year_2005:treated + \n    first_treat_2004:year_2006:treated + first_treat_2004:year_2007:treated + \n    first_treat_2006:year_2006:treated + first_treat_2006:year_2007:treated + \n    first_treat_2007:year_2007:treated | first_treat + year\n\nfit <- feols(fit_fmla, data = df)\n\n\n# library(data.table)\n# broom::tidy(fit) %>% kable()\n# \n# # Clean the results\n# etwfe = as.data.table(tidy(fit))\n# etwfe = etwfe[\n#     , .(term = term, etwfe = estimate)][\n#     , group := as.numeric(gsub(\".*cohort.\", \"\", term))][\n#     , year := as.numeric(gsub(\".*time_to_treat.(\\\\d+).*\", \"\\\\1\", term)) + group][\n#     , .(group, year, etwfe)]\n\n\nfeols(lemp ~ treated : factor(first_treat) : factor(year) | first_treat + year, data = df) %>% \n  broom::tidy() %>% kable()\n\n\nSCRATCH\n\n\n\n\n\nApproach 2\nSource\n\nlibrary(\"did\")\nlibrary(\"broom\")\nlibrary(\"fixest\")\nlibrary(\"ggplot2\")\nlibrary(\"data.table\")\n\nsimulation6 = function() {\n  dat = CJ(firm = 1:1000, year = 1980:2015)     [\n    , time_fe := rnorm(1, sd = .5), by = \"year\"][\n    , unit_fe := rnorm(1, sd = .5), by = \"firm\"][\n    , state := sample(1:50, 1), by = \"firm\"    ]\n\n  setkey(dat, state, firm, year)\n\n  treatment_groups = data.table(\n    state = c(1, 18, 35),\n    cohort = c(1989, 1998, 2007),\n    hat_gamma = c(.5, .3, .1))\n  dat = treatment_groups[dat, roll = TRUE, on = \"state\"]\n\n  dat                                                [\n    , treat  := as.numeric(year >= cohort)          ][\n    , gamma  := rnorm(.N, mean = hat_gamma, sd = .2)][\n    , tau    := fifelse(treat == 1, gamma, 0)       ][\n    , cumtau := cumsum(tau), by = \"firm\"            ][\n    , error  := rnorm(.N, 0, .5)                    ][\n    , y := unit_fe + time_fe + cumtau + error       ][\n    , time_to_treat := year - cohort                ]\n\n  return(dat)\n}\n\ndat = simulation6()\n\n\netwfe = feols(y ~ treat : factor(time_to_treat) : factor(cohort) | firm + year, data = dat)\n\n# Clean the results\netwfe = as.data.table(tidy(etwfe))\netwfe = etwfe[\n    , .(term = term, etwfe = estimate)][\n    , group := as.numeric(gsub(\".*cohort.\", \"\", term))][\n    , year := as.numeric(gsub(\".*time_to_treat.(\\\\d+).*\", \"\\\\1\", term)) + group][\n    , .(group, year, etwfe)]\n\n\ncsa = att_gt(\n    yname = \"y\",\n    gname = \"cohort\",\n    idname = \"firm\",\n    tname = \"year\",\n    control_group = \"notyettreated\",\n    data = dat)\n\n# Clean the results\ncsa = data.table(group = csa$group, year = csa$t, csa = csa$att)\n\n\n# merge the TWFE and CSA results\nresults = merge(etwfe, csa, by = c(\"group\", \"year\"))\ncolnames(results) = c(\"Cohort\", \"Year\", \"TWFE w/ interactions\", \"CSA (2021)\")\nresults[, Cohort := factor(Cohort)]\n\ndat_plot = melt(results, id.vars = c(\"Cohort\", \"Year\"))\nggplot(dat_plot, aes(Year, value, color = variable, linetype = Cohort)) +\n  geom_line(size = 1.4) +\n  theme_minimal() +\n  labs(x = \"Year\", y = \"ATT\", color = \"Estimator\", linetype = \"Cohort\")\n\n\nggplot(results, aes(`TWFE w/ interactions`, `CSA (2021)`, color = Cohort)) +\n  geom_point(size = 2) +\n  geom_abline(intercept = 0, slope = 1) +\n  labs(title = \"On the 45 degree line, estimates of the group-time ATT\\nare identical under the two strategies.\") +\n  theme_minimal()"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "HPOL8539-F2022",
    "section": "",
    "text": "No matching items"
  },
  {
    "objectID": "blog/posts/post1.html",
    "href": "blog/posts/post1.html",
    "title": "A post!",
    "section": "",
    "text": "This is a post!"
  },
  {
    "objectID": "blog/posts/post2.html",
    "href": "blog/posts/post2.html",
    "title": "second post",
    "section": "",
    "text": "National Harbor1 is a census-designated place (CDP) in Prince George’s County, Maryland, United States, located along the Potomac River near the Woodrow Wilson Bridge and just south of Washington. It originated as a 300-acre (1.2 km2) multi-use waterfront development. Per the 2020 census, the population was 5,509."
  },
  {
    "objectID": "blog/posts/post2.html#development",
    "href": "blog/posts/post2.html#development",
    "title": "second post",
    "section": "Development",
    "text": "Development\nThe Gaylord National Resort & Convention Center at National Harbor opened on April 1, 2008 in Oxon Hill, Maryland. The site is being developed by Milton Peterson’s Peterson Companies with the project expected to cost well over $2 billion, and a construction time frame of 2007 to late 2014. As of April 2016 construction was continuing and the cost was set at $4 billion. In 2010, the development was designated as a census-designated place.\n\n\nReasons to go:\n\nFerris wheel\nFerris wheel\n\n\n\n\n\n\n\nGaylord National Resort\n\n\n\nBe prepared for the massive scale of the atrium which has a mini-version of a town inside it.\n\n\n\n\n\n\n\n\nDisney\nThe land developed for National Harbor was previously Salubria Plantation, built in 1827 by Dr. John H. Bayne. The plantation house burned down in 1981 and was offered for sale along with the surrounding land. The land was sold in 1984 and in 1994 was rezoned for mixed-use development. In the fall of 1997, the Maryland Department of the Environment and the Army Corps of Engineers approved new developer permits, granted for the PortAmerica project in 1988.\n\n\n\n\n\n\n\n(a) View from Virginia.\n\n\n\n\n\n\n\n(b) View from the air.\n\n\n\n\n\n\n\n\n\n(c) View from the promenade.\n\n\n\n\nFigure 1: Three views of the ferris wheel.\n\n\nHere’s a big version of one of those images!\n\n\n\n\nA BIG view from the promenade."
  },
  {
    "objectID": "blog/posts/did-revisited.html#plot-data",
    "href": "blog/posts/did-revisited.html#plot-data",
    "title": "Simulate DID Data",
    "section": "Plot Data",
    "text": "Plot Data"
  },
  {
    "objectID": "blog/posts/did-revisited.html#extended-twfe-model",
    "href": "blog/posts/did-revisited.html#extended-twfe-model",
    "title": "Simulate DID Data",
    "section": "Extended TWFE Model",
    "text": "Extended TWFE Model\nThe problem I’m running into here is as follows. In a panel where there is a later treated unit (e.g., 2007) there should be no interactions with years at or above this. The problem is that when I run it this way, the constant term that is fit in Stata is not fit in R,so the coefficients are off. Only if I allow for these interactions will the coefficients be correct for the first treated groups, but not the latter.\nMaybe see here?\n\nDebugging\n\n\nStructuring the data\n\nNeed to only make interactions between group (treatment_time) and time (year) where year>treatment_time\n\n\n# This data frame is structured to use not-yet-treated groups as controls.\n\ndf_etwfe6 <- \n  data6 %>% \n  mutate_at(vars(treatment_time,year), function(x) as.numeric(paste0(x))) %>% \n  mutate(max_treat = max(treatment_time, na.rm=TRUE)) %>% \n  # DROP ALL OBSERVATIONS THAT AREN'T iDENTIFIED\n  filter(year < max_treat) %>% \n  mutate(year_lt_treatment_time = as.integer(year < treatment_time)) %>% \n  mutate(year_tmp = case_when(year >= treatment_time ~ year)) %>% \n  #mutate(year_tmp = case_when(year >= treatment_time & year < max(treatment_time,na.rm=TRUE) ~ year)) %>%  THIS IS THE PROBLEMATIC LINE\n  mutate(treatment_time_tmp = case_when(year >= treatment_time ~ treatment_time)) %>% \n  mutate(treatment_time = ifelse(is.na(treatment_time),0,treatment_time)) %>% \n  mutate(treatment_time = factor(treatment_time),\n         year = factor(year)) %>% \n  mutate(treatment_time_tmp = factor(treatment_time_tmp),\n         year_tmp = factor(year_tmp)) %>%   \n  mutate(i = interaction(treat,treatment_time_tmp,year_tmp,sep=\":\")) %>% \n  mutate(i = paste0(i)) %>% \n  dummy_cols(\"i\") %>%\n  janitor::clean_names() \n\n\nAll Groups Eventually Treated\nUsing group fixed effects.\n\n#1a  jwdid  dep_var , ivar(unit) tvar(year) gvar(treatment_time)  group\nfmla1a <- as.formula(glue(\"dep_var ~ {paste0(grep('i_1_',colnames(df_etwfe6),value=TRUE),collapse = '+')} | treatment_time + year\"))\nfmla1a\n\ndep_var ~ i_1_1989_1989 + i_1_1989_1990 + i_1_1989_1991 + i_1_1989_1992 + \n    i_1_1989_1993 + i_1_1989_1994 + i_1_1989_1995 + i_1_1989_1996 + \n    i_1_1989_1997 + i_1_1989_1998 + i_1_1989_1999 + i_1_1989_2000 + \n    i_1_1989_2001 + i_1_1989_2002 + i_1_1989_2003 + i_1_1989_2004 + \n    i_1_1989_2005 + i_1_1989_2006 + i_1_1998_1998 + i_1_1998_1999 + \n    i_1_1998_2000 + i_1_1998_2001 + i_1_1998_2002 + i_1_1998_2003 + \n    i_1_1998_2004 + i_1_1998_2005 + i_1_1998_2006 | treatment_time + \n    year\n\nfit1a <- feols(fmla1a,df_etwfe6); fit1a\n\nOLS estimation, Dep. Var.: dep_var\nObservations: 5,508 \nFixed-effects: treatment_time: 3,  year: 27\nStandard-errors: Clustered (treatment_time) \n              Estimate Std. Error   t value   Pr(>|t|)    \ni_1_1989_1989 0.550551   0.083236   6.61432 2.2103e-02 *  \ni_1_1989_1990 1.097450   0.029460  37.25211 7.1983e-04 ***\ni_1_1989_1991 1.649690   0.032895  50.14942 3.9738e-04 ***\ni_1_1989_1992 2.091558   0.018832 111.06601 8.1056e-05 ***\ni_1_1989_1993 2.706269   0.044696  60.54856 2.7266e-04 ***\ni_1_1989_1994 3.117833   0.009088 343.06036 8.4968e-06 ***\ni_1_1989_1995 3.548997   0.005236 677.86613 2.1763e-06 ***\ni_1_1989_1996 4.190584   0.008500 493.02953 4.1139e-06 ***\n... 19 coefficients remaining (display them with summary() or use argument n)\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\nRMSE: 1.55415     Adj. R2: 0.688456\n                Within R2: 0.433584\n\nest1a <- \n  tidy(fit1a) %>% \n  separate(term, into =c(\"tmp\",\"tmp2\",\"group\",\"year\"))  %>% \n  mutate(att = estimate) %>% \n  select(group, year , att) %>% \n  mutate(estimator = \"ETWFE - Group FE\") %>% \n  mutate_at(vars(group,year), as.numeric)\n    \nstata(\"jwdid  dep_var , ivar(unit) tvar(year) gvar(treatment_time)  group\", data.in = data6 %>% mutate_at(vars(year,treatment_time),function(x) as.numeric(paste0(x))))\n\n. jwdid  dep_var , ivar(unit) tvar(year) gvar(treatment_time)  group\nWARNING: Singleton observations not dropped; statistical significance is biased\n>  (link)\n(MWFE estimator converged in 2 iterations)\n\nHDFE Linear regression                            Number of obs   =      5,508\nAbsorbing 2 HDFE groups                           F(  27,    199) =      29.74\nStatistics robust to heteroskedasticity           Prob > F        =     0.0000\n                                                  R-squared       =     0.6916\n                                                  Adj R-squared   =     0.6885\n                                                  Within R-sq.    =     0.4336\nNumber of clusters (unit)    =        200         Root MSE        =     1.5621\n\n                                 (Std. Err. adjusted for 200 clusters in unit)\n------------------------------------------------------------------------------\n             |               Robust\n     dep_var |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\ntreatment_~e#|\n        year#|\n    c.__tr__ |\n  1989 1989  |   .5505505   .0856819     6.43   0.000     .3815895    .7195116\n  1989 1990  |    1.09745   .1012055    10.84   0.000     .8978769    1.297023\n  1989 1991  |    1.64969   .0984294    16.76   0.000     1.455591    1.843788\n  1989 1992  |   2.091558   .1270886    16.46   0.000     1.840945    2.342172\n  1989 1993  |   2.706269   .1405392    19.26   0.000     2.429132    2.983406\n  1989 1994  |   3.117833   .1547081    20.15   0.000     2.812755     3.42291\n  1989 1995  |   3.548997   .1871525    18.96   0.000      3.17994    3.918054\n  1989 1996  |   4.190584   .2031831    20.62   0.000     3.789915    4.591252\n  1989 1997  |   4.560902   .2223433    20.51   0.000      4.12245    4.999353\n  1989 1998  |   5.274783   .2381306    22.15   0.000     4.805199    5.744366\n  1989 1999  |   5.799933   .2777758    20.88   0.000     5.252171    6.347695\n  1989 2000  |    6.12532   .2842315    21.55   0.000     5.564828    6.685812\n  1989 2001  |   6.657937   .3127127    21.29   0.000     6.041281    7.274593\n  1989 2002  |   7.132307   .3291643    21.67   0.000      6.48321    7.781405\n  1989 2003  |   7.846859   .3622341    21.66   0.000     7.132549    8.561169\n  1989 2004  |   8.352164    .380407    21.96   0.000     7.602018     9.10231\n  1989 2005  |   8.761887   .3908817    22.42   0.000     7.991085    9.532689\n  1989 2006  |   9.213217   .4329893    21.28   0.000     8.359381    10.06705\n  1998 1998  |   .4548369   .0974278     4.67   0.000     .2627134    .6469604\n  1998 1999  |   .6896868   .0978636     7.05   0.000      .496704    .8826696\n  1998 2000  |   .8477485   .1120189     7.57   0.000     .6268522    1.068645\n  1998 2001  |   1.223767   .1228332     9.96   0.000     .9815457    1.465989\n  1998 2002  |   1.424722   .1439758     9.90   0.000     1.140808    1.708637\n  1998 2003  |    1.89068   .1665003    11.36   0.000     1.562349    2.219011\n  1998 2004  |    2.13663   .1823018    11.72   0.000     1.777139    2.496121\n  1998 2005  |   2.578458   .2068636    12.46   0.000     2.170532    2.986384\n  1998 2006  |   2.820769   .2196635    12.84   0.000     2.387602    3.253936\n             |\n       _cons |  -.0060328   .0754332    -0.08   0.936    -.1547838    .1427183\n------------------------------------------------------------------------------\n\nAbsorbed degrees of freedom:\n--------------------------------------------------------+\n    Absorbed FE | Categories  - Redundant  = Num. Coefs |\n----------------+---------------------------------------|\n treatment_time |         3           0           3     |\n           year |        27           1          26     |\n--------------------------------------------------------+\n\nest1a %>% kable()\n\n\n\n\ngroup\nyear\natt\nestimator\n\n\n\n\n1989\n1989\n0.5505505\nETWFE - Group FE\n\n\n1989\n1990\n1.0974499\nETWFE - Group FE\n\n\n1989\n1991\n1.6496898\nETWFE - Group FE\n\n\n1989\n1992\n2.0915583\nETWFE - Group FE\n\n\n1989\n1993\n2.7062687\nETWFE - Group FE\n\n\n1989\n1994\n3.1178326\nETWFE - Group FE\n\n\n1989\n1995\n3.5489970\nETWFE - Group FE\n\n\n1989\n1996\n4.1905836\nETWFE - Group FE\n\n\n1989\n1997\n4.5609016\nETWFE - Group FE\n\n\n1989\n1998\n5.2747825\nETWFE - Group FE\n\n\n1989\n1999\n5.7999327\nETWFE - Group FE\n\n\n1989\n2000\n6.1253203\nETWFE - Group FE\n\n\n1989\n2001\n6.6579370\nETWFE - Group FE\n\n\n1989\n2002\n7.1323074\nETWFE - Group FE\n\n\n1989\n2003\n7.8468588\nETWFE - Group FE\n\n\n1989\n2004\n8.3521641\nETWFE - Group FE\n\n\n1989\n2005\n8.7618869\nETWFE - Group FE\n\n\n1989\n2006\n9.2132170\nETWFE - Group FE\n\n\n1998\n1998\n0.4548369\nETWFE - Group FE\n\n\n1998\n1999\n0.6896868\nETWFE - Group FE\n\n\n1998\n2000\n0.8477485\nETWFE - Group FE\n\n\n1998\n2001\n1.2237674\nETWFE - Group FE\n\n\n1998\n2002\n1.4247225\nETWFE - Group FE\n\n\n1998\n2003\n1.8906801\nETWFE - Group FE\n\n\n1998\n2004\n2.1366302\nETWFE - Group FE\n\n\n1998\n2005\n2.5784581\nETWFE - Group FE\n\n\n1998\n2006\n2.8207688\nETWFE - Group FE\n\n\n\n\n\nUsing unit fixed effects – this one runs into p\n\n#2b jwdid  dep_var , ivar(unit) tvar(year) gvar(treatment_time) \nfmla1b <- as.formula(glue(\"dep_var ~ {paste0(grep('i_1_',colnames(df_etwfe6),value=TRUE),collapse = '+')} | unit + year\"))\nfit1b <- feols(fmla1b,df_etwfe6)\n\nest1b <- \n  tidy(fit1b) %>% \n  separate(term, into =c(\"tmp\",\"tmp2\",\"group\",\"year\"))  %>% \n  mutate(att = estimate) %>% \n  select(group, year , att) %>% \n  mutate(estimator = \"ETWFE - Unit FE\") %>% \n  mutate_at(vars(group,year), as.numeric)\n\n\n\nOnly Use a Never Treated Group as Control\n\ndf_etwfe6b <- \n  data6b %>% \n  mutate_at(vars(treatment_time,year), function(x) as.numeric(paste0(x))) %>% \n  \n  group_by(treatment_time) %>% \n  arrange(treatment_time,year) %>% \n  mutate(first_year = as.integer(row_number()==1)) %>% \n  \n  mutate(treatment_time = ifelse(is.na(treatment_time),0,treatment_time)) %>% \n  \n  mutate(year_tmp = case_when(year >= treatment_time  ~ year)) %>% \n  mutate(treatment_time_tmp = case_when(year >= treatment_time~ treatment_time)) %>% \n  \n \n  mutate(treatment_time = factor(treatment_time),\n         year = factor(year)) %>% \n  \n  mutate(treatment_time_tmp = factor(treatment_time_tmp),\n         year_tmp = factor(year_tmp)) %>%   \n  mutate(i = interaction(treat,treatment_time_tmp,year_tmp,sep=\":\")) %>% \n  mutate(i = paste0(i)) %>% \n  dummy_cols(\"i\") %>%\n  janitor::clean_names() %>% \n  select(-i_na)\n\n\n\n# This data frame is structured to only use never-treated groups as controls. \ndf_etwfe6b_nt <- \n  data6b %>% \n  mutate_at(vars(treatment_time,year), function(x) as.numeric(paste0(x))) %>% \n  \n  mutate(treat = 1) %>% \n  \n  mutate(treatment_time = ifelse(is.na(treatment_time),0,treatment_time)) %>% \n  \n  group_by(treatment_time) %>% \n  mutate(first_year = as.integer(year == min(year,na.rm=TRUE))) %>% \n  ungroup()  %>% \n  # mutate(year_tmp = year,\n         # treatment_time_tmp = treatment_time) %>% \n  mutate(year_tmp = case_when(first_year!=1  ~ year)) %>% \n\n  mutate(treatment_time_tmp = case_when( first_year != 1~ treatment_time)) %>% \n    \n\n  mutate(treatment_time_tmp = factor(treatment_time_tmp),\n         year_tmp = factor(year_tmp)) %>%   \n  \n    \n  mutate(treatment_time = factor(treatment_time),\n         year = factor(year)) %>% \n  \n  \n  mutate(i = interaction(treat,treatment_time_tmp,year_tmp,sep=\":\")) %>% \n  mutate(i = paste0(i)) %>% \n  dummy_cols(\"i\") %>%\n  janitor::clean_names() %>% \n  select(-contains(\"i_1_0_\"))\n\ngrep('i_1_',colnames(df_etwfe6b_nt),value=TRUE)\n\n [1] \"i_1_1989_1981\" \"i_1_1989_1982\" \"i_1_1989_1983\" \"i_1_1989_1984\"\n [5] \"i_1_1989_1985\" \"i_1_1989_1986\" \"i_1_1989_1987\" \"i_1_1989_1988\"\n [9] \"i_1_1989_1989\" \"i_1_1989_1990\" \"i_1_1989_1991\" \"i_1_1989_1992\"\n[13] \"i_1_1989_1993\" \"i_1_1989_1994\" \"i_1_1989_1995\" \"i_1_1989_1996\"\n[17] \"i_1_1989_1997\" \"i_1_1989_1998\" \"i_1_1989_1999\" \"i_1_1989_2000\"\n[21] \"i_1_1989_2001\" \"i_1_1989_2002\" \"i_1_1989_2003\" \"i_1_1989_2004\"\n[25] \"i_1_1989_2005\" \"i_1_1989_2006\" \"i_1_1989_2007\" \"i_1_1989_2008\"\n[29] \"i_1_1989_2009\" \"i_1_1989_2010\" \"i_1_1989_2011\" \"i_1_1989_2012\"\n[33] \"i_1_1989_2013\" \"i_1_1989_2014\" \"i_1_1989_2015\" \"i_1_1998_1981\"\n[37] \"i_1_1998_1982\" \"i_1_1998_1983\" \"i_1_1998_1984\" \"i_1_1998_1985\"\n[41] \"i_1_1998_1986\" \"i_1_1998_1987\" \"i_1_1998_1988\" \"i_1_1998_1989\"\n[45] \"i_1_1998_1990\" \"i_1_1998_1991\" \"i_1_1998_1992\" \"i_1_1998_1993\"\n[49] \"i_1_1998_1994\" \"i_1_1998_1995\" \"i_1_1998_1996\" \"i_1_1998_1997\"\n[53] \"i_1_1998_1998\" \"i_1_1998_1999\" \"i_1_1998_2000\" \"i_1_1998_2001\"\n[57] \"i_1_1998_2002\" \"i_1_1998_2003\" \"i_1_1998_2004\" \"i_1_1998_2005\"\n[61] \"i_1_1998_2006\" \"i_1_1998_2007\" \"i_1_1998_2008\" \"i_1_1998_2009\"\n[65] \"i_1_1998_2010\" \"i_1_1998_2011\" \"i_1_1998_2012\" \"i_1_1998_2013\"\n[69] \"i_1_1998_2014\" \"i_1_1998_2015\"\n\n#2a  jwdid  dep_var , ivar(unit) tvar(year) gvar(treatment_time)  group\nfmla2a <- as.formula(glue(\"dep_var ~ {paste0(grep('i_1_',colnames(df_etwfe6b),value=TRUE),collapse = '+')} | treatment_time + year\"))\nfmla2a\n\ndep_var ~ i_1_1989_1989 + i_1_1989_1990 + i_1_1989_1991 + i_1_1989_1992 + \n    i_1_1989_1993 + i_1_1989_1994 + i_1_1989_1995 + i_1_1989_1996 + \n    i_1_1989_1997 + i_1_1989_1998 + i_1_1989_1999 + i_1_1989_2000 + \n    i_1_1989_2001 + i_1_1989_2002 + i_1_1989_2003 + i_1_1989_2004 + \n    i_1_1989_2005 + i_1_1989_2006 + i_1_1989_2007 + i_1_1989_2008 + \n    i_1_1989_2009 + i_1_1989_2010 + i_1_1989_2011 + i_1_1989_2012 + \n    i_1_1989_2013 + i_1_1989_2014 + i_1_1989_2015 + i_1_1998_1998 + \n    i_1_1998_1999 + i_1_1998_2000 + i_1_1998_2001 + i_1_1998_2002 + \n    i_1_1998_2003 + i_1_1998_2004 + i_1_1998_2005 + i_1_1998_2006 + \n    i_1_1998_2007 + i_1_1998_2008 + i_1_1998_2009 + i_1_1998_2010 + \n    i_1_1998_2011 + i_1_1998_2012 + i_1_1998_2013 + i_1_1998_2014 + \n    i_1_1998_2015 | treatment_time + year\n\nfit2a <- feols(fmla2a,df_etwfe6b)\nest2a <- \n  tidy(fit2a) %>% \n  separate(term, into =c(\"tmp\",\"tmp2\",\"group\",\"year\"))  %>% \n  mutate(att = estimate) %>% \n  select(group, year , att) %>% \n  mutate(estimator = \"ETWFE - Group FE\") %>% \n  mutate_at(vars(group,year), as.numeric)\n\n#2b  jwdid  dep_var , ivar(unit) tvar(year) gvar(treatment_time)  \nfmla2b <- as.formula(glue(\"dep_var ~ {paste0(grep('i_1_',colnames(df_etwfe6b),value=TRUE),collapse = '+')} | unit + year\"))\nfmla2b\n\ndep_var ~ i_1_1989_1989 + i_1_1989_1990 + i_1_1989_1991 + i_1_1989_1992 + \n    i_1_1989_1993 + i_1_1989_1994 + i_1_1989_1995 + i_1_1989_1996 + \n    i_1_1989_1997 + i_1_1989_1998 + i_1_1989_1999 + i_1_1989_2000 + \n    i_1_1989_2001 + i_1_1989_2002 + i_1_1989_2003 + i_1_1989_2004 + \n    i_1_1989_2005 + i_1_1989_2006 + i_1_1989_2007 + i_1_1989_2008 + \n    i_1_1989_2009 + i_1_1989_2010 + i_1_1989_2011 + i_1_1989_2012 + \n    i_1_1989_2013 + i_1_1989_2014 + i_1_1989_2015 + i_1_1998_1998 + \n    i_1_1998_1999 + i_1_1998_2000 + i_1_1998_2001 + i_1_1998_2002 + \n    i_1_1998_2003 + i_1_1998_2004 + i_1_1998_2005 + i_1_1998_2006 + \n    i_1_1998_2007 + i_1_1998_2008 + i_1_1998_2009 + i_1_1998_2010 + \n    i_1_1998_2011 + i_1_1998_2012 + i_1_1998_2013 + i_1_1998_2014 + \n    i_1_1998_2015 | unit + year\n\nfit2b <- feols(fmla2b,df_etwfe6b)\nest2b <- \n  tidy(fit2b) %>% \n  separate(term, into =c(\"tmp\",\"tmp2\",\"group\",\"year\"))  %>% \n  mutate(att = estimate) %>% \n  select(group, year , att) %>% \n  mutate(estimator = \"ETWFE - Unit FE\") %>% \n  mutate_at(vars(group,year), as.numeric)#2b  jwdid  dep_var , ivar(unit) tvar(year) gvar(treatment_time)  \nfmla2b <- as.formula(glue(\"dep_var ~ {paste0(grep('i_1_',colnames(df_etwfe6b),value=TRUE),collapse = '+')} | unit + year\"))\nfmla2b\n\ndep_var ~ i_1_1989_1989 + i_1_1989_1990 + i_1_1989_1991 + i_1_1989_1992 + \n    i_1_1989_1993 + i_1_1989_1994 + i_1_1989_1995 + i_1_1989_1996 + \n    i_1_1989_1997 + i_1_1989_1998 + i_1_1989_1999 + i_1_1989_2000 + \n    i_1_1989_2001 + i_1_1989_2002 + i_1_1989_2003 + i_1_1989_2004 + \n    i_1_1989_2005 + i_1_1989_2006 + i_1_1989_2007 + i_1_1989_2008 + \n    i_1_1989_2009 + i_1_1989_2010 + i_1_1989_2011 + i_1_1989_2012 + \n    i_1_1989_2013 + i_1_1989_2014 + i_1_1989_2015 + i_1_1998_1998 + \n    i_1_1998_1999 + i_1_1998_2000 + i_1_1998_2001 + i_1_1998_2002 + \n    i_1_1998_2003 + i_1_1998_2004 + i_1_1998_2005 + i_1_1998_2006 + \n    i_1_1998_2007 + i_1_1998_2008 + i_1_1998_2009 + i_1_1998_2010 + \n    i_1_1998_2011 + i_1_1998_2012 + i_1_1998_2013 + i_1_1998_2014 + \n    i_1_1998_2015 | unit + year\n\nfit2b <- feols(fmla2b,df_etwfe6b)\nest2b <- \n  tidy(fit2b) %>% \n  separate(term, into =c(\"tmp\",\"tmp2\",\"group\",\"year\"))  %>% \n  mutate(att = estimate) %>% \n  select(group, year , att) %>% \n  mutate(estimator = \"ETWFE - Unit FE\") %>% \n  mutate_at(vars(group,year), as.numeric)\n\n\n\n\n## NEED TO GET RID OF ONE MORE CATEGORY (1998 x 1980)\n#2c  jwdid  dep_var , ivar(unit) tvar(year) gvar(treatment_time) group never\nfmla2c <- as.formula(glue(\"dep_var ~ {paste0(grep('i_1_',colnames(df_etwfe6b_nt),value=TRUE),collapse = '+')} | treatment_time + year\"))\nfit2c <- feols(fmla2c,df_etwfe6b_nt)\nest2c <- \n  tidy(fit2c) %>% \n  separate(term, into =c(\"tmp\",\"tmp2\",\"group\",\"year\"))  %>% \n  mutate(att = estimate) %>% \n  select(group, year , att) %>% \n  mutate(estimator = \"ETWFE - NT Cx - Group FE\") %>% \n  mutate_at(vars(group,year), as.numeric)\n\n#2d jwdid  dep_var , ivar(unit) tvar(year) gvar(treatment_time) never !!!! THIS ONE SEEMS TO BE WRONG IN STATA ... \nfmla2d <- as.formula(glue(\"dep_var ~ {paste0(grep('i_1_',colnames(df_etwfe6b_nt),value=TRUE),collapse = '+')} | unit + year\"))\nfit2d <- feols(fmla2d,df_etwfe6b_nt %>% mutate(unit = factor(unit)))\nest2d <- \n  tidy(fit2d) %>% \n  separate(term, into =c(\"tmp\",\"tmp2\",\"group\",\"year\"))  %>% \n  mutate(att = estimate) %>% \n  select(group, year , att) %>% \n  mutate(estimator = \"ETWFE - NT Cx - Unit FE\") %>% \n  mutate_at(vars(group,year), as.numeric)\n\nstata(\"\n      replace treatment_time = 0 if treatment_time==.\n      jwdid  dep_var , ivar(unit) tvar(year) gvar(treatment_time) never\n      \", data.in = data6b %>% mutate_at(vars(year,treatment_time),function(x) as.numeric(paste0(x))))\n\n. \n.       replace treatment_time = 0 if treatment_time==.\n(2,304 real changes made)\n.       jwdid  dep_var , ivar(unit) tvar(year) gvar(treatment_time) never\nWARNING: Singleton observations not dropped; statistical significance is biased\n>  (link)\n(MWFE estimator converged in 2 iterations)\n\nHDFE Linear regression                            Number of obs   =      7,344\nAbsorbing 2 HDFE groups                           F(  70,    199) =      11.60\nStatistics robust to heteroskedasticity           Prob > F        =     0.0000\n                                                  R-squared       =     0.8801\n                                                  Adj R-squared   =     0.8749\n                                                  Within R-sq.    =     0.6290\nNumber of clusters (unit)    =        200         Root MSE        =     1.5535\n\n                                 (Std. Err. adjusted for 200 clusters in unit)\n------------------------------------------------------------------------------\n             |               Robust\n     dep_var |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]\n-------------+----------------------------------------------------------------\ntreatment_~e#|\n        year#|\n    c.__tr__ |\n  1989 1981  |  -1.547624   .7704777    -2.01   0.046    -3.066972   -.0282756\n  1989 1982  |  -1.584289   .7772889    -2.04   0.043    -3.117069   -.0515092\n  1989 1983  |  -1.642049   .7722397    -2.13   0.035    -3.164872   -.1192261\n  1989 1984  |   -1.43341   .7549454    -1.90   0.059     -2.92213    .0553095\n  1989 1985  |  -1.535311   .7726244    -1.99   0.048    -3.058893   -.0117291\n  1989 1986  |  -1.648764   .7700177    -2.14   0.033    -3.167206    -.130323\n  1989 1987  |  -1.481473   .7525563    -1.97   0.050    -2.965481    .0025358\n  1989 1988  |  -1.518695   .7756531    -1.96   0.052    -3.048249    .0108597\n  1989 1989  |  -.9574712   .7657142    -1.25   0.213    -2.467426     .552484\n  1989 1990  |  -.3574772   .7526876    -0.47   0.635    -1.841744     1.12679\n  1989 1991  |    .140598   .7517545     0.19   0.852    -1.341829    1.623025\n  1989 1992  |   .6721532   .7727109     0.87   0.385    -.8515991    2.195905\n  1989 1993  |   1.184797   .7764752     1.53   0.129    -.3463783    2.715972\n  1989 1994  |   1.657065   .7854902     2.11   0.036     .1081125    3.206018\n  1989 1995  |   2.168771   .7807311     2.78   0.006     .6292032    3.708339\n  1989 1996  |   2.744621   .7966587     3.45   0.001     1.173644    4.315597\n  1989 1997  |   3.236545    .802859     4.03   0.000     1.653342    4.819748\n  1989 1998  |   3.702205   .8068537     4.59   0.000     2.111125    5.293285\n  1989 1999  |    4.24945   .8216235     5.17   0.000     2.629244    5.869656\n  1989 2000  |    4.81904   .8267467     5.83   0.000     3.188732    6.449349\n  1989 2001  |   5.289953   .8324853     6.35   0.000     3.648329    6.931578\n  1989 2002  |   5.852231   .8518576     6.87   0.000     4.172404    7.532057\n  1989 2003  |    6.35007   .8571423     7.41   0.000     4.659822    8.040317\n  1989 2004  |   6.756413    .880549     7.67   0.000     5.020009    8.492818\n  1989 2005  |   7.538427   .8896723     8.47   0.000     5.784031    9.292822\n  1989 2006  |   7.972006   .9043422     8.82   0.000     6.188682    9.755329\n  1989 2007  |   8.576618   .9269071     9.25   0.000     6.748798    10.40444\n  1989 2008  |   9.029933    .938673     9.62   0.000     7.178911    10.88096\n  1989 2009  |   9.555117    .956706     9.99   0.000     7.668534     11.4417\n  1989 2010  |   10.06048   .9658729    10.42   0.000     8.155825    11.96514\n  1989 2011  |   10.58318   .9875133    10.72   0.000     8.635846    12.53051\n  1989 2012  |    11.1655   1.003004    11.13   0.000     9.187621    13.14338\n  1989 2013  |   11.69397   1.012015    11.56   0.000     9.698322    13.68962\n  1989 2014  |   12.21836   1.044331    11.70   0.000     10.15898    14.27773\n  1989 2015  |   12.81408    1.06626    12.02   0.000     10.71146    14.91669\n  1998 1981  |  -2.891191     1.4403    -2.01   0.046    -5.731399   -.0509824\n  1998 1982  |  -2.889899   1.438253    -2.01   0.046    -5.726071   -.0537267\n  1998 1983  |    -2.9394   1.426655    -2.06   0.041    -5.752702   -.1260988\n  1998 1984  |  -2.876048   1.426257    -2.02   0.045    -5.688565   -.0635305\n  1998 1985  |  -2.842289   1.438295    -1.98   0.050    -5.678544   -.0060341\n  1998 1986  |  -2.990234   1.422831    -2.10   0.037    -5.795996   -.1844721\n  1998 1987  |   -2.71098   1.413242    -1.92   0.057    -5.497833    .0758717\n  1998 1988  |   -2.78655   1.437245    -1.94   0.054    -5.620734    .0476345\n  1998 1989  |  -2.832501    1.43221    -1.98   0.049    -5.656757   -.0082451\n  1998 1990  |  -2.759115   1.420724    -1.94   0.054     -5.56072    .0424909\n  1998 1991  |  -2.883721   1.399811    -2.06   0.041    -5.644088    -.123354\n  1998 1992  |  -2.804369   1.423898    -1.97   0.050    -5.612234    .0034966\n  1998 1993  |  -2.774502    1.41303    -1.96   0.051    -5.560936    .0119319\n  1998 1994  |   -2.81939   1.425141    -1.98   0.049    -5.629705   -.0090743\n  1998 1995  |  -2.815639   1.411897    -1.99   0.047    -5.599839   -.0314392\n  1998 1996  |  -2.779294   1.440586    -1.93   0.055    -5.620068    .0614789\n  1998 1997  |  -2.658515    1.43755    -1.85   0.066    -5.493302    .1762725\n  1998 1998  |  -2.547614   1.415547    -1.80   0.073    -5.339012    .2437835\n  1998 1999  |  -2.204368   1.404752    -1.57   0.118    -4.974479    .5657427\n  1998 2000  |  -2.044966    1.40235    -1.46   0.146    -4.810338    .7204066\n  1998 2001  |  -1.790538   1.391114    -1.29   0.200    -4.533754    .9526785\n  1998 2002  |  -1.368831   1.383051    -0.99   0.324    -4.096148    1.358486\n  1998 2003  |  -.9809712   1.370899    -0.72   0.475    -3.684325    1.722382\n  1998 2004  |  -.7812189   1.377396    -0.57   0.571    -3.497384    1.934946\n  1998 2005  |  -.3232407   1.389143    -0.23   0.816    -3.062571    2.416089\n  1998 2006  |  -.1415136   1.365938    -0.10   0.918    -2.835083    2.552056\n  1998 2007  |   .2364609   1.367123     0.17   0.863    -2.459446    2.932368\n  1998 2008  |    .671513   1.368328     0.49   0.624    -2.026771    3.369797\n  1998 2009  |   .8786274   1.373172     0.64   0.523    -1.829208    3.586462\n  1998 2010  |   1.156292   1.368928     0.84   0.399    -1.543175    3.855758\n  1998 2011  |     1.4396   1.375672     1.05   0.297    -1.273165    4.152365\n  1998 2012  |   1.768957    1.35629     1.30   0.194    -.9055885    4.443502\n  1998 2013  |   1.911296   1.353292     1.41   0.159    -.7573372    4.579929\n  1998 2014  |   2.354145   1.354785     1.74   0.084    -.3174335    5.025723\n  1998 2015  |   2.775042   1.364392     2.03   0.043     .0845195    5.465565\n             |\n       _cons |   1.455016   .7264596     2.00   0.047     .0224693    2.887563\n------------------------------------------------------------------------------\n\nAbsorbed degrees of freedom:\n-----------------------------------------------------+\n Absorbed FE | Categories  - Redundant  = Num. Coefs |\n-------------+---------------------------------------|\n        unit |       200         200           0    *|\n        year |        36           1          35     |\n-----------------------------------------------------+\n* = FE nested within cluster; treated as redundant for DoF computation\n."
  },
  {
    "objectID": "blog/posts/did-revisited.html#estimate-cs",
    "href": "blog/posts/did-revisited.html#estimate-cs",
    "title": "Simulate DID Data",
    "section": "Estimate CS",
    "text": "Estimate CS\n\ndata6_cs <- \n  data6 %>% \n  mutate(year = as.numeric(paste0(year)),\n         treatment_time = as.numeric(paste0(treatment_time)))  %>% \n  mutate(treatment_time = ifelse(is.na(treatment_time),0,treatment_time))\n  \n\nfit_cs6 <- att_gt(yname = \"dep_var\",\n                        tname = \"year\",\n                        idname = \"unit\",\n                        gname = \"treatment_time\",\n                        control_group = \"notyettreated\",\n                        data = data6_cs\n                        )\n\nWarning in pre_process_did(yname = yname, tname = tname, idname = idname, :\nDropped 4 observations while converting to balanced panel.\n\nest_cs6 <-  tibble(group = fit_cs6$group, year = fit_cs6$t, att = fit_cs6$att) %>% \n  mutate(estimator = \"CS\") \n\n\ndata6b_cs <- \n  data6b %>% \n  mutate(year = as.numeric(paste0(year)),\n         treatment_time = as.numeric(paste0(treatment_time)))  %>% \n  mutate(treatment_time = ifelse(is.na(treatment_time),0,treatment_time))\n\nWarning in mask$eval_all_mutate(quo): NAs introduced by coercion\n\nfit_cs6b <- att_gt(yname = \"dep_var\",\n                        tname = \"year\",\n                        idname = \"unit\",\n                        gname = \"treatment_time\",\n                        control_group = \"nevertreated\",\n                        data = data6b_cs\n                        )\n\nWarning in pre_process_did(yname = yname, tname = tname, idname = idname, :\nDropped 4 observations while converting to balanced panel.\n\nest_cs6b <-  tibble(group = fit_cs6b$group, year = fit_cs6b$t, att = fit_cs6b$att) %>% \n  mutate(estimator = \"CS\")"
  },
  {
    "objectID": "blog/posts/did-revisited.html#compare",
    "href": "blog/posts/did-revisited.html#compare",
    "title": "Simulate DID Data",
    "section": "Compare",
    "text": "Compare\n\nest1a %>% \n  bind_rows(est1b) %>% \n  bind_rows(est_cs6) %>% \n  ggplot(aes(x = year, y = att, colour = factor(group), pch = estimator)) + \n  geom_point() +\n  theme_clean() +\n  ggsci::scale_color_aaas() \n\n\n\nest2a %>% \n  bind_rows(est2b) %>% \n  bind_rows(est2c) %>% \n  bind_rows(est2d) %>% \n  bind_rows(est_cs6b) %>% \n  ggplot(aes(x = year, y = att, colour = factor(group), pch = estimator)) + \n  geom_point() +\n  theme_clean() +\n  ggsci::scale_color_aaas() +\n  #scale_shape_manual(values =c(19,4,3)) +\n  facet_grid(~group)\n\n\n\n\nSource\nReview paper\nWooldridge"
  },
  {
    "objectID": "slides/introduction/lec_intro.html#introduction",
    "href": "slides/introduction/lec_intro.html#introduction",
    "title": "HPOL8539 Introduction",
    "section": "Introduction",
    "text": "Introduction\n\nWelcome to Advanced Program and Policy Evaluation!"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "1 + 1\n\n[1] 2"
  },
  {
    "objectID": "modules/d2-panel.html",
    "href": "modules/d2-panel.html",
    "title": "Panel Data Methods",
    "section": "",
    "text": "Introductions\nItem Two"
  },
  {
    "objectID": "modules/d2-panel.html#slides",
    "href": "modules/d2-panel.html#slides",
    "title": "Panel Data Methods",
    "section": "Slides",
    "text": "Slides\nView slides in full screen"
  },
  {
    "objectID": "modules/d2-panel.html#exercises",
    "href": "modules/d2-panel.html#exercises",
    "title": "Panel Data Methods",
    "section": "Exercises",
    "text": "Exercises\n\n\n\n\n\n\nExercise\n\n\n\n\n\n\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "modules/d1-introduction.html",
    "href": "modules/d1-introduction.html",
    "title": "Introduction",
    "section": "",
    "text": "Introductions\nItem Two"
  },
  {
    "objectID": "modules/d1-introduction.html#slides",
    "href": "modules/d1-introduction.html#slides",
    "title": "Introduction",
    "section": "Slides",
    "text": "Slides\nView slides in full screen"
  },
  {
    "objectID": "modules/d1-introduction.html#exercises",
    "href": "modules/d1-introduction.html#exercises",
    "title": "Introduction",
    "section": "Exercises",
    "text": "Exercises\n\n\n\n\n\n\nExercise\n\n\n\n\n\n\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "schedule.html",
    "href": "schedule.html",
    "title": "Schedule",
    "section": "",
    "text": "August 31, 2022\n\n\n\n\n\n\n\n\nTime\n\n\nModule\n\n\nPresenter\n\n\n\n\n\n\n\n \n\n\n\n8:30 - 10:30\n\n\nPanel Data Methods\n\n\nJohn Graves\n\n\n\n\n\n\nNo matching items"
  }
]